<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR" xml:lang="pt-BR"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Geoestatística – Introdução à Estatística Espacial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lattice_data.html" rel="next">
<link href="./fundEstspatial.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6d088c4ce919446e15da3b20ce9bdb36.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./geostat.html">Geostatística</a></li><li class="breadcrumb-item"><a href="./geostat.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geoestatística</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introdução à Estatística Espacial</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Introdução ao R/Rstudio</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução ao R/RStudio</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Fundamentos da Estatística Espacial</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fundEstspatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fundamentos da Estatística Espacial</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Geostatística</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./geostat.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geoestatística</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Dados de Área (Lattice)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lattice_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dados de Área</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Processos Pontuais</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./point_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Processos Pontuais</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Espaço-Temporal</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatiotemporal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelagem Espaço-Temporal</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">Recursos Computacionais Complementares</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Rcomplementares.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Recursos Computacionais Complementares</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências Bibliográficas</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#variável-regionalizada-e-o-processo-estocástico" id="toc-variável-regionalizada-e-o-processo-estocástico" class="nav-link active" data-scroll-target="#variável-regionalizada-e-o-processo-estocástico"><span class="header-section-number">3.1</span> Variável Regionalizada e o Processo Estocástico</a></li>
  <li><a href="#estacionariedade-e-inferência-estatística" id="toc-estacionariedade-e-inferência-estatística" class="nav-link" data-scroll-target="#estacionariedade-e-inferência-estatística"><span class="header-section-number">3.2</span> Estacionariedade e Inferência Estatística</a></li>
  <li><a href="#sec-efeito_pepita" id="toc-sec-efeito_pepita" class="nav-link" data-scroll-target="#sec-efeito_pepita"><span class="header-section-number">3.3</span> Efeito Pepita e suas Implicações na Predição</a></li>
  <li><a href="#sec-variograma" id="toc-sec-variograma" class="nav-link" data-scroll-target="#sec-variograma"><span class="header-section-number">3.4</span> Variograma e funções de covariância</a></li>
  <li><a href="#estimadores-do-variograma" id="toc-estimadores-do-variograma" class="nav-link" data-scroll-target="#estimadores-do-variograma"><span class="header-section-number">3.5</span> Estimadores do Variograma</a></li>
  <li><a href="#modelagem-do-variograma" id="toc-modelagem-do-variograma" class="nav-link" data-scroll-target="#modelagem-do-variograma"><span class="header-section-number">3.6</span> Modelagem do Variograma</a></li>
  <li><a href="#diagnóstico-e-validação" id="toc-diagnóstico-e-validação" class="nav-link" data-scroll-target="#diagnóstico-e-validação"><span class="header-section-number">3.7</span> Diagnóstico e Validação</a>
  <ul class="collapse">
  <li><a href="#diagnóstico-via-derivada-na-origem-teoria-espectral." id="toc-diagnóstico-via-derivada-na-origem-teoria-espectral." class="nav-link" data-scroll-target="#diagnóstico-via-derivada-na-origem-teoria-espectral."><span class="header-section-number">3.7.1</span> Diagnóstico via Derivada na Origem (Teoria Espectral).</a></li>
  </ul></li>
  <li><a href="#construção-de-modelos-válidos-via-médias-móveis" id="toc-construção-de-modelos-válidos-via-médias-móveis" class="nav-link" data-scroll-target="#construção-de-modelos-válidos-via-médias-móveis"><span class="header-section-number">3.8</span> Construção de Modelos Válidos via Médias Móveis</a></li>
  <li><a href="#sec-anisotropia" id="toc-sec-anisotropia" class="nav-link" data-scroll-target="#sec-anisotropia"><span class="header-section-number">3.9</span> Anisotropia</a>
  <ul class="collapse">
  <li><a href="#anisotropia-geométrica" id="toc-anisotropia-geométrica" class="nav-link" data-scroll-target="#anisotropia-geométrica"><span class="header-section-number">3.9.1</span> Anisotropia Geométrica</a></li>
  <li><a href="#anisotropia-zonal" id="toc-anisotropia-zonal" class="nav-link" data-scroll-target="#anisotropia-zonal"><span class="header-section-number">3.9.2</span> Anisotropia Zonal</a></li>
  <li><a href="#anisotropia-mista-ou-combinada" id="toc-anisotropia-mista-ou-combinada" class="nav-link" data-scroll-target="#anisotropia-mista-ou-combinada"><span class="header-section-number">3.9.3</span> Anisotropia Mista (ou Combinada)</a></li>
  </ul></li>
  <li><a href="#diagnóstico-da-anisotropia" id="toc-diagnóstico-da-anisotropia" class="nav-link" data-scroll-target="#diagnóstico-da-anisotropia"><span class="header-section-number">3.10</span> Diagnóstico da Anisotropia</a>
  <ul class="collapse">
  <li><a href="#variogramas-direcionais" id="toc-variogramas-direcionais" class="nav-link" data-scroll-target="#variogramas-direcionais"><span class="header-section-number">3.10.1</span> Variogramas Direcionais</a></li>
  </ul></li>
  <li><a href="#sec-ajuste-diagnostico" id="toc-sec-ajuste-diagnostico" class="nav-link" data-scroll-target="#sec-ajuste-diagnostico"><span class="header-section-number">3.11</span> Ajuste de Modelos de semivariograma</a>
  <ul class="collapse">
  <li><a href="#mínimos-quadrados-ponderados" id="toc-mínimos-quadrados-ponderados" class="nav-link" data-scroll-target="#mínimos-quadrados-ponderados"><span class="header-section-number">3.11.1</span> Mínimos Quadrados Ponderados</a></li>
  </ul></li>
  <li><a href="#mínimos-quadrados-generalizados-explícitos-glse" id="toc-mínimos-quadrados-generalizados-explícitos-glse" class="nav-link" data-scroll-target="#mínimos-quadrados-generalizados-explícitos-glse"><span class="header-section-number">3.12</span> Mínimos Quadrados Generalizados Explícitos (GLSE)</a>
  <ul class="collapse">
  <li><a href="#métodos-de-máxima-verossimilhança-ml-e-máxima-verossimilhança-restrita-reml" id="toc-métodos-de-máxima-verossimilhança-ml-e-máxima-verossimilhança-restrita-reml" class="nav-link" data-scroll-target="#métodos-de-máxima-verossimilhança-ml-e-máxima-verossimilhança-restrita-reml"><span class="header-section-number">3.12.1</span> Métodos de Máxima Verossimilhança (ML) e Máxima Verossimilhança Restrita (REML)</a></li>
  <li><a href="#reml-robusto" id="toc-reml-robusto" class="nav-link" data-scroll-target="#reml-robusto"><span class="header-section-number">3.12.2</span> REML Robusto</a></li>
  </ul></li>
  <li><a href="#sec-metodos_predicao" id="toc-sec-metodos_predicao" class="nav-link" data-scroll-target="#sec-metodos_predicao"><span class="header-section-number">3.13</span> Métodos de Predição</a>
  <ul class="collapse">
  <li><a href="#krigagem-simples-ks" id="toc-krigagem-simples-ks" class="nav-link" data-scroll-target="#krigagem-simples-ks"><span class="header-section-number">3.13.1</span> Krigagem Simples (KS)</a></li>
  <li><a href="#krigagem-ordinária-ko" id="toc-krigagem-ordinária-ko" class="nav-link" data-scroll-target="#krigagem-ordinária-ko"><span class="header-section-number">3.13.2</span> Krigagem Ordinária (KO)</a></li>
  <li><a href="#krigagem-universal-ku" id="toc-krigagem-universal-ku" class="nav-link" data-scroll-target="#krigagem-universal-ku"><span class="header-section-number">3.13.3</span> Krigagem Universal (KU)</a></li>
  <li><a href="#krigagem-com-deriva-externa-ked" id="toc-krigagem-com-deriva-externa-ked" class="nav-link" data-scroll-target="#krigagem-com-deriva-externa-ked"><span class="header-section-number">3.13.4</span> Krigagem com Deriva Externa (KED)</a></li>
  <li><a href="#co-krigagem" id="toc-co-krigagem" class="nav-link" data-scroll-target="#co-krigagem"><span class="header-section-number">3.13.5</span> Co-Krigagem</a></li>
  </ul></li>
  <li><a href="#avaliação-da-performance-preditiva" id="toc-avaliação-da-performance-preditiva" class="nav-link" data-scroll-target="#avaliação-da-performance-preditiva"><span class="header-section-number">3.14</span> Avaliação da Performance Preditiva</a>
  <ul class="collapse">
  <li><a href="#validação-cruzada" id="toc-validação-cruzada" class="nav-link" data-scroll-target="#validação-cruzada"><span class="header-section-number">3.14.1</span> Validação Cruzada</a></li>
  </ul></li>
  <li><a href="#krigagem-indicatriz-ik" id="toc-krigagem-indicatriz-ik" class="nav-link" data-scroll-target="#krigagem-indicatriz-ik"><span class="header-section-number">3.15</span> Krigagem Indicatriz (IK)</a></li>
  <li><a href="#desafios-computacionais-e-a-abordagem-spde" id="toc-desafios-computacionais-e-a-abordagem-spde" class="nav-link" data-scroll-target="#desafios-computacionais-e-a-abordagem-spde"><span class="header-section-number">3.16</span> Desafios Computacionais e a Abordagem SPDE</a>
  <ul class="collapse">
  <li><a href="#equação-diferencial-parcial-estocástica-spde" id="toc-equação-diferencial-parcial-estocástica-spde" class="nav-link" data-scroll-target="#equação-diferencial-parcial-estocástica-spde"><span class="header-section-number">3.16.1</span> Equação Diferencial Parcial Estocástica (SPDE)</a></li>
  </ul></li>
  <li><a href="#algumas-aplicações-da-geoestatística-por-área" id="toc-algumas-aplicações-da-geoestatística-por-área" class="nav-link" data-scroll-target="#algumas-aplicações-da-geoestatística-por-área"><span class="header-section-number">3.17</span> Algumas aplicações da Geoestatística por área</a>
  <ul class="collapse">
  <li><a href="#geociências-e-engenharia-de-recursos" id="toc-geociências-e-engenharia-de-recursos" class="nav-link" data-scroll-target="#geociências-e-engenharia-de-recursos"><span class="header-section-number">3.17.1</span> Geociências e Engenharia de Recursos</a></li>
  <li><a href="#ciências-agrárias-e-ambientais" id="toc-ciências-agrárias-e-ambientais" class="nav-link" data-scroll-target="#ciências-agrárias-e-ambientais"><span class="header-section-number">3.17.2</span> 2. Ciências Agrárias e Ambientais</a></li>
  <li><a href="#saúde-pública-e-ciências-sociais" id="toc-saúde-pública-e-ciências-sociais" class="nav-link" data-scroll-target="#saúde-pública-e-ciências-sociais"><span class="header-section-number">3.17.3</span> 3. Saúde Pública e Ciências Sociais</a></li>
  <li><a href="#energias-renováveis" id="toc-energias-renováveis" class="nav-link" data-scroll-target="#energias-renováveis"><span class="header-section-number">3.17.4</span> 4. Energias Renováveis</a></li>
  </ul></li>
  <li><a href="#pacote-gstat" id="toc-pacote-gstat" class="nav-link" data-scroll-target="#pacote-gstat"><span class="header-section-number">3.18</span> Pacote gstat</a></li>
  <li><a href="#pacote-automap" id="toc-pacote-automap" class="nav-link" data-scroll-target="#pacote-automap"><span class="header-section-number">3.19</span> Pacote automap</a></li>
  <li><a href="#pacote-geor" id="toc-pacote-geor" class="nav-link" data-scroll-target="#pacote-geor"><span class="header-section-number">3.20</span> Pacote geoR</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./geostat.html">Geostatística</a></li><li class="breadcrumb-item"><a href="./geostat.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geoestatística</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-geoest" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geoestatística</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Imagine o desafio enfrentado por um engenheiro de minas na África do Sul, na década de 1950. A sua tarefa consistia em estimar o teor de ouro num bloco de rocha ainda não escavado, baseando-se apenas em algumas amostras recolhidas através de furos de sondagem <span class="citation" data-cites="ecker2003geostatistics">(<a href="references.html#ref-ecker2003geostatistics" role="doc-biblioref">Ecker 2003</a>)</span>. Ao aplicar os métodos estatísticos convencionais da época, baseados em médias aritméticas, os engenheiros deparavam-se consistentemente com um erro sistemático: as previsões tendiam a superestimar as áreas ricas e a subestimar as áreas pobres. Quando a exploração real avançava, o ouro recuperado não correspondia à estimativa inicial, gerando prejuízos avultados<span class="citation" data-cites="krige2005genesis">(<a href="references.html#ref-krige2005genesis" role="doc-biblioref">Krige e Kleingeld 2005</a>)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Sondagem">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Dica</span>Sondagem
</div>
</div>
<div class="callout-body-container callout-body">
<p>Assista ao vídeo produzido pela Federação Brasileira de Geólogos (FEBRAGEO) sobre furos de sondagem clicando <a href="https://www.youtube.com/watch?v=qikZsCRkHMU&amp;t=164s">aqui</a>.</p>
</div>
</div>
<p>A raiz deste problema não estava na precisão dos instrumentos, mas na premissa estatística utilizada. A estatística clássica assume, frequentemente, que as observações são independentes e identicamente distribuídas (i.i.d.) <span class="citation" data-cites="cressie2022spatial">(<a href="references.html#ref-cressie2022spatial" role="doc-biblioref">Cressie e Moores 2022</a>)</span>. No entanto, na natureza, esta independência raramente existe. O engenheiro sul-africano <a href="https://www.nae.edu/190431/DANIE-G-KRIGE-19192013">Danie Gerhardus Krige</a> percebeu empiricamente que uma amostra geológica não é um valor isolado; ela carrega consigo uma influência da sua vizinhança <span class="citation" data-cites="scalon2024analise">(<a href="references.html#ref-scalon2024analise" role="doc-biblioref">Scalon 2024</a>)</span>. Uma amostra com elevado teor de minério sugere que a rocha imediatamente adjacente tem também uma alta probabilidade de ser rica <span class="citation" data-cites="oliver2014tutorial">(<a href="references.html#ref-oliver2014tutorial" role="doc-biblioref">Oliver e Webster 2014</a>)</span> . Ao ignorar a localização espacial das amostras e tratá-las como eventos aleatórios independentes, perdia-se a informação mais valiosa para a predição: a continuidade espacial <span class="citation" data-cites="nhancololo2024comparison">(<a href="references.html#ref-nhancololo2024comparison" role="doc-biblioref">Nhancololo et al. 2024</a>)</span>.</p>
<p>Foi com base nesta intuição que o matemático francês <a href="https://en.wikipedia.org/wiki/Georges_Matheron">Georges Matheron</a>, na década de 1960, formalizou a disciplina que hoje conhecemos como Geoestatística <span class="citation" data-cites="journel1976mining scalon2024analise">(<a href="references.html#ref-journel1976mining" role="doc-biblioref">Andre G. Journel e Huijbregts 1976</a>; <a href="references.html#ref-scalon2024analise" role="doc-biblioref">Scalon 2024</a>)</span>. Matheron sistematizou as observações de Krige através da <strong>Teoria das Variáveis Regionalizadas</strong> <span class="citation" data-cites="matheron1963principles matheron1971theory">(<a href="references.html#ref-matheron1963principles" role="doc-biblioref">G. Matheron 1963</a>; <a href="references.html#ref-matheron1971theory" role="doc-biblioref">George Matheron 1971</a>)</span>, estabelecendo que fenômenos naturais não são nem puramente aleatórios, como o lançamento de um dado, nem puramente determinísticos, descritíveis por uma equação geométrica simples. Eles exibem uma estrutura mista: possuem continuidade estruturada (dependência espacial), mas também uma componente localmente imprevisível (aleatoriedade local) <span class="citation" data-cites="cressie1990origins wackernagel2003multivariate">(<a href="references.html#ref-cressie1990origins" role="doc-biblioref">Cressie 1990</a>; <a href="references.html#ref-wackernagel2003multivariate" role="doc-biblioref">Wackernagel 2003</a>)</span>.</p>
<p>A Geoestatística define-se, portanto, como o ramo da estatística espacial dedicado à modelagem e predição destes fenômenos contínuos<span class="citation" data-cites="myers1994spatial">(<a href="references.html#ref-myers1994spatial" role="doc-biblioref">Myers 1994</a>)</span>. Assume-se que a variável de interesse, denotada por <span class="math inline">\(Y(\mathbf{s})\)</span>, existe em qualquer ponto de um domínio contínuo fixo <span class="math inline">\(D^{G} \subseteq \mathbb{R}^d\)</span>, mas é observada apenas num conjunto finito de locais <span class="math inline">\(\{\mathbf{s}_1, \dots, \mathbf{s}_n\}\)</span> <span class="citation" data-cites="scalon2024analise cressie2022spatial">(<a href="references.html#ref-scalon2024analise" role="doc-biblioref">Scalon 2024</a>; <a href="references.html#ref-cressie2022spatial" role="doc-biblioref">Cressie e Moores 2022</a>)</span>.</p>
<p>Neste contexto de informação incompleta, o objetivo central passa a ser a utilização da estrutura de dependência espacial identificada nas amostras para inferir, com o menor erro possível, o comportamento da variável nos locais onde não foi realizada qualquer medição. Foi precisamente esta mudança de paradigma e robustez preditiva que permitiu resolver o problema original das minas de ouro, impulsionando a subsequente expansão da disciplina para a hidrologia, ciências do solo, meteorologia e epidemiologia, onde se consolidou como a ferramenta padrão para lidar com variáveis contínuas no espaço <span class="citation" data-cites="yamamoto2013geoestatistica nhancololo2024comparison">(<a href="references.html#ref-yamamoto2013geoestatistica" role="doc-biblioref">Yamamoto e Landim 2013</a>; <a href="references.html#ref-nhancololo2024comparison" role="doc-biblioref">Nhancololo et al. 2024</a>)</span>.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2, gstat, sf, viridis, gridExtra, knitr, tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>grid_df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>grid_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(grid_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>grid_df<span class="sc">$</span>iid <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(grid_df))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>modelo_vgm <span class="ot">&lt;-</span> gstat<span class="sc">::</span><span class="fu">vgm</span>(<span class="at">psill =</span> <span class="dv">1</span>, <span class="at">model =</span> <span class="st">"Sph"</span>, <span class="at">range =</span> <span class="dv">20</span>, <span class="at">nugget =</span> <span class="dv">0</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>g_dummy <span class="ot">&lt;-</span> gstat<span class="sc">::</span><span class="fu">gstat</span>(<span class="at">formula =</span> z<span class="sc">~</span><span class="dv">1</span>, <span class="at">locations =</span> grid_sf, <span class="at">dummy =</span> T, <span class="at">beta =</span> <span class="dv">0</span>, <span class="at">model =</span> modelo_vgm, <span class="at">nmax =</span> <span class="dv">20</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">capture.output</span>(yy <span class="ot">&lt;-</span> <span class="fu">predict</span>(g_dummy, <span class="at">newdata =</span> grid_sf, <span class="at">nsim =</span> <span class="dv">1</span>)))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>grid_df<span class="sc">$</span>geo <span class="ot">&lt;-</span> yy<span class="sc">$</span>sim1</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid_df, <span class="fu">aes</span>(x, y, <span class="at">fill =</span> iid)) <span class="sc">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">name =</span> <span class="st">"Teor"</span>) <span class="sc">+</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Amostras Independentes (Ruído)"</span>) <span class="sc">+</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid_df, <span class="fu">aes</span>(x, y, <span class="at">fill =</span> geo)) <span class="sc">+</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">name =</span> <span class="st">"Teor"</span>) <span class="sc">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Dependência Espacial (Continuidade)"</span>) <span class="sc">+</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>p1; p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-krige-intro" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krige-intro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krige-intro" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krige-intro-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krige-intro-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krige-intro-1.png" class="img-fluid figure-img" data-ref-parent="fig-krige-intro">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krige-intro-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Estatística Clássica
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krige-intro" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krige-intro-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krige-intro-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krige-intro-2.png" class="img-fluid figure-img" data-ref-parent="fig-krige-intro">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krige-intro-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Geoestatística
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krige-intro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.1: Intuição de Krige: A diferença entre Ruído Branco (Independente) e Continuidade Espacial (Estruturado).
</figcaption>
</figure>
</div>
<section id="variável-regionalizada-e-o-processo-estocástico" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="variável-regionalizada-e-o-processo-estocástico"><span class="header-section-number">3.1</span> Variável Regionalizada e o Processo Estocástico</h2>
<p>Para operar matematicamente sobre um fenômeno natural único, utilizamos o conceito de Variável Regionalizada. É crucial estabelecer uma distinção notacional usada aqui: denotamos por <span class="math inline">\(y(\mathbf{s})\)</span> o valor numérico observado do fenômeno no local <span class="math inline">\(\mathbf{s}\)</span> (a realização concreta, com letra minúscula), e por <span class="math inline">\(Y(\mathbf{s})\)</span> a variável aleatória no local <span class="math inline">\(\mathbf{s}\)</span> (o processo probabilístico antes da observação, com letra maiúscula). Embora na realidade <span class="math inline">\(y(\mathbf{s})\)</span> seja único e fixo, a geoestatística modela-o como uma realização de um Processo Estocástico (ou Função Aleatória/Campo Aleatório) <span class="math inline">\(Y(\mathbf{s})\)</span>.</p>
<p><strong>Variável Regionalizada</strong></p>
<p>Uma variável regionalizada é uma função numérica <span class="math inline">\(f(\mathbf{s})\)</span> que descreve a distribuição espacial de uma grandeza física (ex: teor de ouro, pH do solo) num domínio <span class="math inline">\(D^{G}\)</span>. Esta função possui propriedades duais: um aspeto estruturado (refletindo tendências geológicas ou climáticas de larga escala) e um aspeto aleatório (refletindo irregularidades locais imprevisíveis) <span class="citation" data-cites="matheron1971theory">(<a href="references.html#ref-matheron1971theory" role="doc-biblioref">George Matheron 1971</a>)</span>. Matematicamente, tratamos estas variáveis regionalizadas como realizações de um processo estocástico (ou campo aleatório) <span class="math inline">\(\{Y(s) : s \in D^{G}\}\)</span>, onde <span class="math inline">\(s\)</span> denota um vetor de coordenadas em um domínio espacial <span class="math inline">\(D^G \subseteq \mathbb{R}^d\)</span> (geralmente <span class="math inline">\(d=2\)</span> ou <span class="math inline">\(3\)</span>) <span class="citation" data-cites="cressie1991geostatistical">(<a href="references.html#ref-cressie1991geostatistical" role="doc-biblioref">Cressie 1991</a>)</span></p>
<p><strong>Processo Estocástico</strong></p>
<p>Um processo estocástico espacial é definido como uma coleção de variáveis aleatórias <span class="math inline">\(\{Y(\mathbf{s}) : \mathbf{s} \in D^{G}\}\)</span>, onde <span class="math inline">\(D^{G} \subseteq D \subseteq \mathbb{R}^d\)</span> é um conjunto de índices contínuo (uma área ou volume) com <a href="https://pt.wikipedia.org/wiki/Medida_de_Lebesgue">medida de Lebesgue</a> positiva (área <span class="math inline">\(&gt;0\)</span>) <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>. O objetivo da inferência geoestatística é reconstruir a lei de probabilidade do processo <span class="math inline">\(Y(\mathbf{s})\)</span> a partir de um conjunto finito de observações <span class="math inline">\(\{y(\mathbf{s}_1), \dots, y(\mathbf{s}_n)\}\)</span>.</p>
<p>Ao contrário da análise de séries temporais, onde o índice <span class="math inline">\(t\)</span> possui uma ordenação natural (passado <span class="math inline">\(\to\)</span> futuro), o índice espacial <span class="math inline">\(s\)</span> não possui uma ordenação única em <span class="math inline">\(\mathbb{R}^d\)</span> para <span class="math inline">\(d \ge 2\)</span>, o que introduz complexidades adicionais na modelação da dependência multidirecional <span class="citation" data-cites="cressie2022spatial">(<a href="references.html#ref-cressie2022spatial" role="doc-biblioref">Cressie e Moores 2022</a>)</span>.</p>
<p>Para tornar o processo estocástico tratável, decompomos a variável aleatória <span class="math inline">\(Y(\mathbf{s})\)</span> em componentes que explicam diferentes escalas de variação. Existem duas formulações principais: a decomposição simples e a decomposição estrutural completa.</p>
<p>Na decomposição simples assumimos que o processo estocástico é constituído por uma média determinística e um erro correlacionado:</p>
<p><span id="eq-decomp-simples"><span class="math display">\[Y(\mathbf{s}) = \mu(\mathbf{s}) + \delta(\mathbf{s}), \tag{3.1}\]</span></span></p>
<p>Onde <span class="math inline">\(\mu(\mathbf{s}) \equiv E[Y(\mathbf{s})]\)</span> representa a tendência de larga escala (<em>Trend</em> ou <em>Drift</em>), isto é, variação sistemática do fenômeno sobre o domínio <span class="math inline">\(DĜ\)</span>. Assume-se frequentemente que <span class="math inline">\(\mu(\mathbf{s})\)</span> é uma função suave das coordenadas ou uma combinação linear de covariáveis externas <span class="math inline">\(X(\mathbf{s})\)</span>, tal que <span class="math inline">\(\mu(\mathbf{s}) = \mathbf{x}(\mathbf{s})^\top \boldsymbol{\beta}\)</span> <span class="citation" data-cites="cressie2022spatial">(<a href="references.html#ref-cressie2022spatial" role="doc-biblioref">Cressie e Moores 2022</a>)</span>. <span class="math inline">\(\delta(\mathbf{s})\)</span>: Representa a variação de pequena escala ou o erro estocástico. Assume-se que este termo tem média zero, <span class="math inline">\(E[\delta(\mathbf{s})] = 0\)</span>, e captura a dependência espacial estatística (correlação) entre locais vizinhos.</p>
<p>A formulação usada na <a href="#eq-decomp-simples" class="quarto-xref">Eq.&nbsp;<span>3.1</span></a> é insuficiente pois não distingue entre a variabilidade natural do fenômeno e o erro humano. <span class="citation" data-cites="cressie1991geostatistical">Cressie (<a href="references.html#ref-cressie1991geostatistical" role="doc-biblioref">1991</a>)</span> e <span class="citation" data-cites="diggle1998model">Diggle, Tawn, e Moyeed (<a href="references.html#ref-diggle1998model" role="doc-biblioref">1998</a>)</span>, sugerem expandir o termo de erro (<span class="math inline">\(\delta(\mathbf{s})\)</span>:</p>
<p><span id="eq-decomp-completa"><span class="math display">\[Y(\mathbf{s}) = \mu(\mathbf{s}) + W(\mathbf{s}) + \eta(\mathbf{s}) + \epsilon(\mathbf{s}) \tag{3.2}\]</span></span></p>
<p>Onde:</p>
<ul>
<li><p><span class="math inline">\(\mu(\mathbf{s})\)</span> continua sendo componente determinística. Podendo ser modelada como uma constante, <span class="math inline">\(\mu(\mathbf{s})=\mu\)</span> (Krigagem simples e ordinária), um polinómio das coordenadas, <span class="math inline">\(Y(s) =\beta_0 + \beta_1 s_x + \beta_2 s_y\)</span>, (Krigagem Universal) ou função de covariáveis externas, como elevação (Krigagem com Deriva Externa) <span class="citation" data-cites="wackernagel2003multivariate">(<a href="references.html#ref-wackernagel2003multivariate" role="doc-biblioref">Wackernagel 2003</a>)</span>. Captura forçantes globais (ex: o gradiente de temperatura causado pela latitude).</p></li>
<li><p><span class="math inline">\(W(\mathbf{s})\)</span>) é o componente estocástico de interesse principal. É um processo estocástico com média zero e continuidade em média quadrática (<span class="math inline">\(L_2\)</span>-contínuo). <span class="math inline">\(E[(W(\mathbf{s+h}) - W(\mathbf{s}))^2] \to 0\)</span> quando <span class="math inline">\(\|\mathbf{h}\| \to 0\)</span>. Este componente captura a estrutura de dependência espacial observável na escala da amostragem. Em abordagens modernas de baixo posto este termo é frequentemente modelado por uma expansão de funções de base, <span class="math inline">\(W(\mathbf{s}) \approx \sum \alpha_j \phi_j(\mathbf{s})\)</span> (sugestão de leitura <span class="citation" data-cites="cressie2022basis">(<a href="references.html#ref-cressie2022basis" role="doc-biblioref">Cressie, Sainsbury-Dale, e Zammit-Mangion 2022</a>)</span> ).</p></li>
<li><p><span class="math inline">\(\eta(\mathbf{s})\)</span>) representa a variabilidade do fenômeno que ocorre a distâncias menores do que a menor distância de separação entre as observações disponíveis (<span class="math inline">\(\min \|\mathbf{s}_i - \mathbf{s}_j\|\)</span>). É uma variação intrínseca e física do fenômeno, não um erro. No entanto, dado que não temos dados suficientes para resolver esta continuidade, modelamo-la estatisticamente como um ruído branco espacialmente não correlacionado na escala de observação. <strong>Exemplo:</strong> Se medirmos o teor de ouro a cada 10 metros, a variação extrema que ocorre dentro de uma <a href="https://pt.wikipedia.org/wiki/Pepita">pepita</a> de 1 cm é classificada como variação de microescala (<span class="math inline">\(\eta\)</span>).</p></li>
</ul>
<p>Conforme descrito por <span class="citation" data-cites="diggle1998model">Diggle, Tawn, e Moyeed (<a href="references.html#ref-diggle1998model" role="doc-biblioref">1998</a>)</span> referem-se a componentes similares num contexto de modelos lineares generalizados mistos, onde a heterogeneidade latente de pequena escala deve ser contabilizada.</p>
<ul>
<li><span class="math inline">\(\epsilon(\mathbf{s})\)</span> é ruído branco puro (<span class="math inline">\(\epsilon \overset{iid}{\sim} N[0, \text{Var}(\epsilon(\mathbf{s}))]\)</span>), introduzido pelo processo de observação (precisão do instrumento, erro de laboratório, erro de localização). É puramente aleatório e não tem realidade no fenômeno natural <span class="math inline">\(S(\mathbf{s})\)</span> que estamos a tentar estudar.</li>
</ul>
<p>A soma das variâncias dos dois últimos componentes (<span class="math inline">\(\eta (s)\)</span> e <span class="math inline">\(\epsilon (s)\)</span>) constitui o que chamamos de Efeito Pepita (<span class="math inline">\(c_0\)</span>), visível no variograma experimental (assunto da próxima seção) como uma descontinuidade na origem (<span class="math inline">\(\gamma(h) \to c_0\)</span> quando <span class="math inline">\(h \to 0\)</span>):</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2, viridis)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>grid_df<span class="sc">$</span>tendencia <span class="ot">&lt;-</span> (grid_df<span class="sc">$</span>x <span class="sc">+</span> grid_df<span class="sc">$</span>y) <span class="sc">/</span> <span class="dv">20</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>grid_df<span class="sc">$</span>residuo   <span class="ot">&lt;-</span> grid_df<span class="sc">$</span>geo</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>grid_df<span class="sc">$</span>Y         <span class="ot">&lt;-</span> grid_df<span class="sc">$</span>tendencia <span class="sc">+</span> grid_df<span class="sc">$</span>residuo</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>tema_comum <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"C"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"npc"</span>), </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>, <span class="st">"cm"</span>),  </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">title.position =</span> <span class="st">"top"</span>,       </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">frame.colour =</span> <span class="st">"black"</span>,       </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">ticks.colour =</span> <span class="st">"black"</span>        </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">l =</span> <span class="dv">5</span>, <span class="at">r =</span> <span class="dv">5</span>) </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid_df, <span class="fu">aes</span>(x, y, <span class="at">fill =</span> Y)) <span class="sc">+</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  tema_comum <span class="sc">+</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Valor"</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid_df, <span class="fu">aes</span>(x, y, <span class="at">fill =</span> tendencia)) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  tema_comum <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Valor"</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid_df, <span class="fu">aes</span>(x, y, <span class="at">fill =</span> residuo)) <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  tema_comum <span class="sc">+</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Valor"</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>p1;p2;p3</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-decomposicao" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-decomposicao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-decomposicao" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-decomposicao-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-decomposicao-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-decomposicao-1.png" class="img-fluid figure-img" data-ref-parent="fig-decomposicao">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-decomposicao-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Fenômeno observado: <span class="math inline">\(Y(s)\)</span>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-decomposicao" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-decomposicao-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-decomposicao-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-decomposicao-2.png" class="img-fluid figure-img" data-ref-parent="fig-decomposicao">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-decomposicao-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Tendência global: <span class="math inline">\(\mu(s)\)</span>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-decomposicao" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-decomposicao-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-decomposicao-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-decomposicao-3.png" class="img-fluid figure-img" data-ref-parent="fig-decomposicao">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-decomposicao-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Resíduo estocástico: <span class="math inline">\(\delta(s)\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-decomposicao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.2: Decomposição de uma variável regionalizada: Tendência global + resíduo estocástico.
</figcaption>
</figure>
</div>
</section>
<section id="estacionariedade-e-inferência-estatística" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="estacionariedade-e-inferência-estatística"><span class="header-section-number">3.2</span> Estacionariedade e Inferência Estatística</h2>
<p>O obstáculo central na inferência espacial é a unicidade da realização: na prática, possuímos apenas um único conjunto de dados observados <span class="math inline">\(\{y(\mathbf{s}) : \mathbf{s} \in D\}\)</span>, que constitui apenas uma das infinitas realizações possíveis do processo estocástico gerador <span class="math inline">\(\{Y(\mathbf{s})\}\)</span>. Diferentemente de experiências laboratoriais controladas, não é possível replicar o processo geológico ou climático sob as mesmas condições para gerar múltiplas realizações e, assim, estimar a função de distribuição conjunta para qualquer conjunto finito de <span class="math inline">\(k\)</span> localizações: <span class="math display">\[F(y_1, \dots, y_k; \mathbf{s}_1, \dots, \mathbf{s}_k) = P\left(Y(\mathbf{s}_1) \le y_1, \dots, Y(\mathbf{s}_k) \le y_k\right),\]</span></p>
<p>Nem tão-pouco é possível calcular empiricamente os seus momentos de primeira <span class="math inline">\(\mu(\mathbf{s})\)</span>, <span class="math display">\[\mu(\mathbf{s}) = E[Y(\mathbf{s})] = \int_{-\infty}^{+\infty} y \cdot f(y; \mathbf{s}) \, dy\:, \]</span> e segunda ordem <span class="math inline">\(\sigma^2(\mathbf{s})\)</span>, <span class="math display">\[\sigma^2(\mathbf{s}) = \text{Var}(Y(\mathbf{s})) = E\left[(Y(\mathbf{s}) - \mu(\mathbf{s}))^2\right], \]</span> em cada local <span class="math inline">\(\mathbf{s}\)</span> <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>.</p>
<p>Para viabilizar a inferência estatística (i.e., estimar os parâmetros do processo a partir de uma única realização), é imperativo invocar a hipótese de estacionariedade. Este conceito assume a invariância das propriedades estatísticas (momentos da distribuição) do processo sob translação no domínio espacial <span class="math inline">\(D^G\)</span> <a href="fundEstspatial.html#sec-estacionaridade" class="quarto-xref"><span>Seção 2.3</span></a>. Sob esta premissa, assumimos que a estrutura de dependência é homogénea em todo o domínio, o que nos permite utilizar repetições espaciais, diferentes pares de pontos separados pelo mesmo vetor <span class="math inline">\(\mathbf{h}\)</span> em locais distintos, como substitutos válidos para as inexistentes repetições estocásticas. Este procedimento fundamenta-se na hipótese de <a href="https://en.wikipedia.org/wiki/Ergodicity">ergodicidade</a>, que estabelece a condição necessária para estimar parâmetros probabilísticos a partir de uma única realização observada. Sob condições específicas de mistura (onde a correlação espacial decai suficientemente rápido com a distância), a ergodicidade garante que as médias espaciais calculadas sobre o domínio <span class="math inline">\(D^G\)</span> convirjam para a esperança matemática (média populacional) à medida que o volume ou área do domínio de observação cresce indefinidamente (<span class="math inline">\(|D^G| \to \infty\)</span>) <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>. Esta convergência, é em média quadrática (ou convergência em <span class="math inline">\(L^2\)</span>). Seja <span class="math inline">\(\bar{Y}_D\)</span> a média espacial (se existir) do processo no domínio <span class="math inline">\(D\)</span>, definida como <span class="math inline">\(\bar{Y}_{D^G} = \frac{1}{|D|} \int_{D^G} Y(\mathbf{s}) d\mathbf{s}\)</span>. A propriedade ergódica assegura que o erro quadrático médio entre a média espacial e a média teórica <span class="math inline">\(\mu\)</span> tende para zero:</p>
<p><span class="math display">\[\lim_{|D^G| \to \infty} E\left[ \left( \bar{Y}_{D^G} - \mu \right)^2 \right] = 0 , \Longleftrightarrow \bar{Y}_{D^G} \xrightarrow{L^2} \mu\]</span> Esta convergência implica que a variância da média espacial diminui assintoticamente, permitindo que as estatísticas calculadas sobre uma única realização extensa sejam estimadores consistentes dos momentos do processo estocástico gerador <span class="citation" data-cites="matheron1971theory cressie1989geostatistics">(<a href="references.html#ref-matheron1971theory" role="doc-biblioref">George Matheron 1971</a>; <a href="references.html#ref-cressie1989geostatistics" role="doc-biblioref">Cressie 1989</a>)</span>.</p>
<p>Conforme descrito na <a href="fundEstspatial.html#sec-estacionaridade" class="quarto-xref"><span>Seção 2.3</span></a> existem dois níveis principais de estacionariedade utilizados na modelação geoestatística:</p>
<p>A estacionaridade mais comum em análise de séries temporais e estatística espacial é a estacionariedade de segunda ordem (ou fraca). Um processo estocástico <span class="math inline">\(\{Y(\mathbf{s})\}\)</span> diz-se estacionário de segunda ordem se satisfizer duas condições simultâneas:</p>
<ul>
<li>A esperança matemática deve ser constante e finita em todo o domínio <span class="math inline">\(D^G\)</span>, independentemente da localização <span class="math inline">\(\mathbf{s}\)</span>. O parâmetro <span class="math inline">\(\mu\)</span> representa o nível global em torno do qual o processo flutua:</li>
</ul>
<p><span class="math display">\[E[Y(\mathbf{s})] = \mu, \forall \mathbf{s} \in D^G\]</span>.</p>
<ul>
<li>A covariância entre dois pontos não depende das suas localizações absolutas <span class="math inline">\(\mathbf{s}\)</span> e <span class="math inline">\(\mathbf{s}+\mathbf{h}\)</span>, mas apenas do vetor de separação <span class="math inline">\(\mathbf{h}\)</span> (que define a distância e a direção entre eles):</li>
</ul>
<p><span id="eq-covariancia"><span class="math display">\[Cov(Y(\mathbf{s}), Y(\mathbf{s}+\mathbf{h})) = E[(Y(\mathbf{s}) - \mu)(Y(\mathbf{s}+\mathbf{h}) - \mu)] = C(\mathbf{h}) \tag{3.3}\]</span></span></p>
<p>onde <span class="math inline">\(C(\mathbf{h})\)</span> denota a função de covariância. Esta definição implica necessariamente que a variância do processo é finita e constante, dada por <span class="math inline">\(Var(Y(\mathbf{s})) = C(\mathbf{0}) &lt; \infty\)</span>.</p>
<p>Uma consequência analítica imediata da definição acima (<a href="#eq-covariancia" class="quarto-xref">Eq.&nbsp;<span>3.3</span></a>) é a estabilidade da variância. Se considerarmos o caso particular onde o vetor de separação é nulo (<span class="math inline">\(\mathbf{h} = \mathbf{0}\)</span>), a covariância de um ponto com ele próprio torna-se, por definição, a sua variância. Como <span class="math inline">\(C(\mathbf{h})\)</span> não depende da localização <span class="math inline">\(\mathbf{s}\)</span>, segue-se que <span class="math inline">\(C(\mathbf{0})\)</span> também não depende.</p>
<p>Portanto, a variância do processo é finita e constante em todo o domínio (propriedade de homocedasticidade espacial), sendo definida por:</p>
<p><span class="math display">\[Cov(Y(\mathbf{s}), Y(\mathbf{s+0}))=Var(Y(\mathbf{s})) = C(\mathbf{0}) = \sigma^2\]</span></p>
<p>Esta relação (<span class="math inline">\(C(\mathbf{0}) = \sigma^2\)</span>) estabelece que o “patamar” máximo de variabilidade do processo é fixo e conhecido a priori. Se a variabilidade do fenômeno crescer indefinidamente com a área (como na topografia de uma cadeia montanhosa), a condição <span class="math inline">\(C(\mathbf{0}) &lt; \infty\)</span> é violada, e a estacionariedade de segunda ordem não pode ser assumida, exigindo a adoção da hipótese intrínseca.</p>
<p>Muitos fenômenos naturais, como a dispersão de poluentes ou a topografia, apresentam uma variabilidade que cresce sem limites à medida que a área de estudo aumenta, violando a condição de variância a priori finita. Para acomodar estes processos, <span class="citation" data-cites="matheron1963principles">G. Matheron (<a href="references.html#ref-matheron1963principles" role="doc-biblioref">1963</a>)</span> introduziu uma condição mais fraca e generalista: a estacionariedade intrínseca. Esta hipótese exige apenas a estacionariedade dos incrementos do processo <span class="math inline">\(Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})\)</span>, definindo-se pelas seguintes propriedades:</p>
<p><span class="math display">\[\begin{aligned}
E[Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})] &amp;= 0 \\
Var(Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})) &amp;= 2\gamma(\mathbf{h})
\end{aligned}\]</span></p>
<p>A formulação intrínseca é vantajosa pois abrange uma classe mais ampla de processos estocásticos, incluindo aqueles com variância infinita (como o movimento Browniano), onde a função de covariância <span class="math inline">\(C(\mathbf{h})\)</span> não estaria definida, mas o variograma está perfeitamente caracterizado.</p>
<p>A função <span class="math inline">\(2\gamma(\mathbf{h})\)</span> é definida formalmente como o variograma, e <span class="math inline">\(\gamma(\mathbf{h})\)</span> como o semivariograma.</p>
<p>Partindo da definição do variograma <span class="math inline">\(\gamma(\mathbf{h})\)</span> como a variância do incremento, o desenvolvimento segue:</p>
<p><span id="eq-semivariograma"><span class="math display">\[\begin{aligned}
2\gamma(\mathbf{h}) &amp;= Var(Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})) \\
&amp;= E\left[ \left( \{Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})\} - E[Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})] \right)^2 \right] &amp;&amp; \text{(Definição de Variância)} \\
&amp;= E\left[ \left( Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s}) \right)^2 \right] &amp;&amp; \text{(Pois } E[Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})] = 0 \text{)} \\
&amp;= E\left[ \left( \{Y(\mathbf{s}+\mathbf{h}) - \mu\} - \{Y(\mathbf{s}) - \mu\} \right)^2 \right] &amp;&amp; \text{(Centrando na média } \mu \text{)} \\
&amp;= E\left[ (Y(\mathbf{s}+\mathbf{h}) - \mu)^2 - 2(Y(\mathbf{s}+\mathbf{h}) - \mu)(Y(\mathbf{s}) - \mu) + (Y(\mathbf{s}) - \mu)^2 \right] &amp;&amp; \text{(Expandindo o quadrado)} \\
&amp;= E[(Y(\mathbf{s}+\mathbf{h}) - \mu)^2] - 2E[(Y(\mathbf{s}+\mathbf{h}) - \mu)(Y(\mathbf{s}) - \mu)] + E[(Y(\mathbf{s}) - \mu)^2] &amp;&amp; \text{(Linearidade da Esperança)} \\
&amp;= Var(Y(\mathbf{s}+\mathbf{h})) - 2Cov(Y(\mathbf{s}+\mathbf{h}), Y(\mathbf{s})) + Var(Y(\mathbf{s})) &amp;&amp; \text{(Definições de Var e Cov)} \\
&amp;= C(0) - 2C(\mathbf{h}) + C(0) &amp;&amp; \text{(Estacionariedade de 2ª ordem)} \\
&amp;= 2(C(0) - C(\mathbf{h}))
\end{aligned} \tag{3.4}\]</span></span></p>
<p>Portanto, simplificando por 2, obtemos a relação fundamental para processos estacionários:</p>
<p><span id="eq-relacao_cov_var"><span class="math display">\[\gamma(\mathbf{h})= C(0) - C(\mathbf{h}) \tag{3.5}\]</span></span></p>
<p>A relação entre estas duas abordagens é hierárquica. Se um processo for estacionário de segunda ordem, ele é necessariamente intrínseco, existindo uma relação analítica direta que conecta o semivariograma <span class="math inline">\(\gamma(\mathbf{h})\)</span> à função de covariância <a href="#eq-relacao_cov_var" class="quarto-xref">Eq.&nbsp;<span>3.5</span></a>. Esta equação revela que o semivariograma é a imagem espelhada da covariância: enquanto a covariância <span class="math inline">\(C(\mathbf{h})\)</span> decresce com a distância (de <span class="math inline">\(\sigma^2\)</span> para assintoticamente 0), o semivariograma <span class="math inline">\(\gamma(\mathbf{h})\)</span> cresce com a distância (de 0 para um patamar <span class="math inline">\(\sigma^2\)</span>). No entanto, a formulação intrínseca é mais robusta, pois o variograma <span class="math inline">\(2\gamma(\mathbf{h})\)</span> permanece definido mesmo para processos com variância infinita onde a covariância <span class="math inline">\(C(\mathbf{h})\)</span> não existe, o que justifica a preferência de Matheron pelo variograma como ferramenta fundamental de análise estrutural <a href="#fig-cov-vs-vario" class="quarto-xref">Figura&nbsp;<span>3.3</span></a> .</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>nugget <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>partial_sill <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>range_val <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>sill <span class="ot">&lt;-</span> nugget <span class="sc">+</span> partial_sill</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(h <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ifelse</span>(h <span class="sc">&lt;=</span> range_val, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                nugget <span class="sc">+</span> partial_sill <span class="sc">*</span> (<span class="fl">1.5</span> <span class="sc">*</span> (h<span class="sc">/</span>range_val) <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> (h<span class="sc">/</span>range_val)<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                sill))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>gamma[<span class="dv">1</span>] <span class="ot">&lt;-</span> nugget </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>df_vgm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Distancia =</span> h, <span class="at">Semivariancia =</span> gamma)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>df_vgm<span class="sc">$</span>Covariancia <span class="ot">&lt;-</span> sill <span class="sc">-</span> df_vgm<span class="sc">$</span>Semivariancia</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>df_comp <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df_vgm, <span class="at">cols =</span> <span class="fu">c</span>(Semivariancia, Covariancia), <span class="at">names_to =</span> <span class="st">"Funcao"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_comp, <span class="fu">aes</span>(<span class="at">x =</span> Distancia, <span class="at">y =</span> Valor, <span class="at">color =</span> Funcao)) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Covariancia"</span> <span class="ot">=</span> <span class="st">"darkred"</span>, <span class="st">"Semivariancia"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">C</span>(h)), <span class="fu">expression</span>(<span class="fu">gamma</span>(h)))) <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Valor"</span>, <span class="at">x =</span> <span class="st">"Distância (h)"</span>, <span class="at">color =</span> <span class="st">"Função:"</span>) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-cov-vs-vario" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cov-vs-vario-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-cov-vs-vario-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cov-vs-vario-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.3: Covariância vs.&nbsp;Semivariograma em Processo Estacionário.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-efeito_pepita" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-efeito_pepita"><span class="header-section-number">3.3</span> Efeito Pepita e suas Implicações na Predição</h2>
<p>A caracterização da continuidade espacial de um fenômeno é frequentemente realizada através do variograma experimental (ver secção seguinte). Em muitos casos, observa-se que, à medida que a distância de separação (<span class="math inline">\(\|\mathbf{h}\|\)</span>) entre dois pontos tende a zero, o valor do semivariograma (<span class="math inline">\(\gamma(\mathbf{h})\)</span>) não converge para zero, mas sim para um valor positivo. Esta descontinuidade na origem é denominada Efeito Pepita (<span class="math inline">\(c_0\)</span> ou <a href="https://stats.stackexchange.com/questions/324825/what-is-the-nugget-effect">nugget effect</a>). O termo Efeito Pepita (ou <a href="https://en.wikipedia.org/wiki/Gold_nugget">Nugget Effect</a>) tem origem histórica nas minas de ouro sul-africanas. Matheron observou que, mesmo quando duas amostras eram recolhidas muito próximas uma da outra, os seus valores podiam diferir devido à presença de <a href="https://pt.wikipedia.org/wiki/Pepita">pepitas</a>, microscópicas de ouro distribuídas aleatoriamente.</p>
<p><span class="citation" data-cites="cressie1993statistics">Cressie (<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">1993</a>)</span> define este parâmetro como a soma das variâncias das duas componentes descritas acima:</p>
<p><span class="math display">\[c_0 = \lim_{\|\mathbf{h}\| \to 0} \gamma(\mathbf{h}) = \text{Var}(\eta(\mathbf{s})) + \text{Var}(\epsilon(\mathbf{s}))\]</span></p>
<p>Esta distinção permite-nos definir o “sinal” ou processo latente <span class="math inline">\(S(\mathbf{s})\)</span> que desejamos recuperar, livre do erro de medição instrumental:</p>
<p><span class="math display">\[S(\mathbf{s}) = \mu(\mathbf{s}) + W(\mathbf{s}) + \eta(\mathbf{s})\]</span></p>
<p>Consequentemente, os dados observados são compostos pelo sinal mais o erro de medição: <span class="math inline">\(Y(\mathbf{s}) = S(\mathbf{s}) + \epsilon(\mathbf{s})\)</span>. Esta formulação alinha-se com a Geoestatística Baseada em Modelos <span class="citation" data-cites="diggle1998model">(<a href="references.html#ref-diggle1998model" role="doc-biblioref">Diggle, Tawn, e Moyeed 1998</a>)</span>, que assume uma hierarquia:</p>
<ol type="1">
<li><p>Modelo de Processo: <span class="math inline">\([S(\cdot)]\)</span> (descreve a física do fenômeno).</p></li>
<li><p>Modelo de Dados: <span class="math inline">\([Y(\cdot) | S(\cdot)]\)</span> (descreve a observação ruidosa desse fenômeno).</p></li>
</ol>
<p><span class="citation" data-cites="cressie1993statistics">Cressie (<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">1993</a>)</span> e <span class="citation" data-cites="laslett1994kriging">Laslett (<a href="references.html#ref-laslett1994kriging" role="doc-biblioref">1994</a>)</span> destacam uma implicação fundamental desta decomposição. As equações de predição (Krigagem) devem ser ajustadas dependendo do nosso objetivo final:</p>
<ol type="1">
<li><p><strong>Predição do dado observável</strong> (<span class="math inline">\(Y\)</span>): Se o objetivo é prever o valor que um sensor mediria no local <span class="math inline">\(\mathbf{s}_0\)</span> (incluindo o erro inerente ao sensor), utilizamos a Krigagem Exata. Este interpolador respeita os dados originais e incorpora todo o <span class="math inline">\(c_0\)</span> na variabilidade estimada.</p></li>
<li><p><strong>Predição do processo latente</strong> (<span class="math inline">\(S\)</span>): Se o objetivo é prever o valor físico real do fenômeno, filtrado do ruído instrumental, utilizamos a Krigagem com Suavização. Isto é feito subtraindo a variância do erro de medição (<span class="math inline">\(\text{Var}(\epsilon)\)</span>) da diagonal da matriz de covariância do sistema de krigagem.</p></li>
</ol>
<p>Se ignorarmos esta distinção e tratarmos todo o efeito pepita como variabilidade natural (assumindo <span class="math inline">\(\text{Var}(\epsilon)=0\)</span>), os nossos mapas serão desnecessariamente ruidosos (“rugosos”) e respeitarão erros de medição como se fossem verdades. Por outro lado, se tratarmos todo o pepita como erro, obteremos mapas mais suaves.</p>
<div class="callout callout-style-default callout-important callout-titled" title="O problema da identificabilidade">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Importante</span>O problema da identificabilidade
</div>
</div>
<div class="callout-body-container callout-body">
<p>É importante notar que, sem medições repetidas no mesmo local (co-localizadas), é impossível separar estatisticamente o quanto do <span class="math inline">\(c_0\)</span> se deve a <span class="math inline">\(\eta(s)\)</span> (microescala) e o quanto se deve a <span class="math inline">\(\epsilon (s)\)</span> (erro). <span class="citation" data-cites="cressie1993statistics">Cressie (<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">1993</a>)</span> alerta que esta distinção é frequentemente uma escolha de modelagem baseada no conhecimento do equipamento, e não uma inferência puramente estatística.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Tendência e erro">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Nota</span>Tendência e erro
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="citation" data-cites="wackernagel2003multivariate">Wackernagel (<a href="references.html#ref-wackernagel2003multivariate" role="doc-biblioref">2003</a>)</span> demonstra que, em domínios pequenos, uma tendência local pode ser indistinguível de uma flutuação estocástica de baixa frequência: A estrutura determinística média de uma pessoa pode ser a estrutura de erro correlacionado de outra.</p>
</div>
</div>
</section>
<section id="sec-variograma" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-variograma"><span class="header-section-number">3.4</span> Variograma e funções de covariância</h2>
<p>Uma vez assumida a hipótese de estacionariedade, a inferência geoestatística exige a quantificação da dependência espacial do processo estocástico <span class="math inline">\(Y(\mathbf{s})\)</span>. Diferentemente da estatística clássica, onde a correlação é frequentemente um escalar único, na geoestatística a dependência é modelada como uma função contínua do vetor de separação <span class="math inline">\(\mathbf{h} \in \mathbb{R}^d\)</span> entre pares de pontos.</p>
<p>A caracterização desta estrutura é realizada através de duas ferramentas fundamentais, cuja aplicabilidade depende do nível de estacionariedade assumido: a Função de Covariância (Estacionariedade de 2.ª Ordem) e o Variograma (Estacionariedade Intrínseca).</p>
<p><strong>Função de Covariância</strong></p>
<p>A função de covariância <span class="math inline">\(C(\mathbf{h})\)</span> quantifica a covariância linear entre os valores do processo estocástico <span class="math inline">\(Y(\mathbf{s})\)</span> em dois locais <span class="math inline">\(\mathbf{s}\)</span> e <span class="math inline">\(\mathbf{s} + \mathbf{h}\)</span>, separados por um vetor de distância <span class="math inline">\(\mathbf{h} \in \mathbb{R}^d\)</span>:</p>
<p><span class="math display">\[C(\mathbf{h}) = \text{Cov}(Y(\mathbf{s}), Y(\mathbf{s} + \mathbf{h})) = E[(Y(\mathbf{s}) - \mu)(Y(\mathbf{s} + \mathbf{h}) - \mu)]\]</span></p>
<p>onde <span class="math inline">\(\mu\)</span> é a média estacionária do processo <span class="citation" data-cites="cressie1993statistics">Cressie (<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">1993</a>)</span>. Sob a hipótese de estacionariedade de segunda ordem, a covariância depende apenas de <span class="math inline">\(\mathbf{h}\)</span> e é simétrica em relação à origem, ou seja, <span class="math inline">\(C(\mathbf{h}) = C(-\mathbf{h})\)</span>.</p>
<p>Como descrito anteriormente, uma consequência fundamental desta definição é que a covariância na origem, <span class="math inline">\(C(\mathbf{0})\)</span>, corresponde à variância a priori do processo, <span class="math inline">\(\sigma^2_Y\)</span>, que se assume finita e constante em todo o domínio <span class="math inline">\(D^G\)</span>, <span class="math inline">\(C(\mathbf{0}) = \text{Var}(Y(\mathbf{s})) = \sigma^2_Y\)</span>.</p>
<p>Para garantir a validade estatística das predições (Krigagem), a função de covariância deve ser positiva definida, o que implica que a variância de qualquer combinação linear das variáveis aleatórias seja não negativa <span class="citation" data-cites="matheron1971theory">(<a href="references.html#ref-matheron1971theory" role="doc-biblioref">George Matheron 1971</a>)</span>.</p>
<p><strong>Variograma</strong></p>
<p>Em situações nas quais a variância do processo não é finita, a função de covariância não pode ser definida (por exemplo: movimento Browniano, topografia em grandes escalas, etc.). Esta condição de não-finitude, central na formulação da hipótese intrínseca por <span class="citation" data-cites="matheron1971theory">George Matheron (<a href="references.html#ref-matheron1971theory" role="doc-biblioref">1971</a>)</span>, não implica que um valor pontual seja infinito, mas sim que a dispersão a priori do processo cresce indefinidamente à medida que o domínio de observação se expande (<span class="math inline">\(|D| \to \infty\)</span>). Um exemplo clássico é o movimento Browniano unidimensional (processo de Wiener), denotado por <span class="math inline">\(Y(t)\)</span>, em que a variância da posição da partícula no instante <span class="math inline">\(t\)</span> é linearmente proporcional ao tempo decorrido, expressa por <span class="math inline">\(\text{Var}(Y(t)) = \sigma^2 t\)</span>. Consequentemente, num domínio temporal ilimitado (<span class="math inline">\(t \to \infty\)</span>), a variância global do processo tende ao infinito (<span class="math inline">\(\sigma^2_{global} \to \infty\)</span>), tornando matematicamente impossível a definição de um patamar <span class="math inline">\(C(0)\)</span> ou de uma função de covariância estacionária.</p>
<p>Nesses casos, onde a estacionariedade de segunda ordem é violada pela ausência de variância finita, utiliza-se o variograma <span class="math inline">\(2\gamma(\mathbf{h})\)</span>. Essa ferramenta baseia-se na hipótese de estacionaridade intrínseca introduzida por <span class="citation" data-cites="matheron1963principles">G. Matheron (<a href="references.html#ref-matheron1963principles" role="doc-biblioref">1963</a>)</span>, assumindo estacionariedade apenas para os incrementos do processo. Isto implica que os incrementos permanecem finitos e estáveis, mesmo quando a variância absoluta diverge. O variograma é definido como a variância da diferença entre os valores da variável em dois locais separados por um vetor <span class="math inline">\(\mathbf{h}\)</span> e, assumindo que a média dos incrementos é zero, equivale ao valor esperado do quadrado dessas diferenças:</p>
<p><span class="math display">\[2\gamma(\mathbf{h}) = \text{Var}(Y(\mathbf{s} + \mathbf{h}) - Y(\mathbf{s})) = E[(Y(\mathbf{s} + \mathbf{h}) - Y(\mathbf{s}))^2]\]</span></p>
<p>O semivariograma <span class="math inline">\(\gamma(\mathbf{h})\)</span> corresponde à metade do variograma. Sob a hipótese intrínseca, assume-se que o variograma depende apenas do vetor de separação <span class="math inline">\(\mathbf{h}\)</span>, garantindo a caracterização da continuidade espacial mesmo sem variância global definida. Contudo, se o processo satisfizer a estacionariedade de segunda ordem (onde <span class="math inline">\(C(\mathbf{0})\)</span> existe e é finito), estabelece-se uma relação analítica direta entre o variograma e a função de covariância (ver a dedução na <a href="#eq-semivariograma" class="quarto-xref">Eq.&nbsp;<span>3.4</span></a>).</p>
<p><strong>Elementos do Semivariograma</strong></p>
<p>Antes de procedermos à modelagem teórica, é crucial compreender os parâmetros que constituem o perfil de um variograma pois a correta identificação destes parâmetros condiciona diretamente a estrutura de covariância utilizada na predição espacial <span class="citation" data-cites="yamamoto2013geoestatistica">(<a href="references.html#ref-yamamoto2013geoestatistica" role="doc-biblioref">Yamamoto e Landim 2013</a>)</span>.</p>
<ol type="1">
<li><strong>Alcance (</strong><span class="math inline">\(a\)</span> ou Range)</li>
</ol>
<p>O alcance define o limite da dependência espacial. É a distância no eixo das abcissas (<span class="math inline">\(\|\mathbf{h}\|\)</span>) a partir da qual a correlação entre observações se torna desprezível e o variograma estabiliza. Em termos práticos, pontos separados por uma distância <span class="math inline">\(\|\mathbf{h}\| \ge a\)</span> são considerados estatisticamente independentes (ou não correlacionados). Este parâmetro impõe o critério crítico para a amostragem: para capturar a estrutura do fenômeno, a malha de amostragem deve possuir um espaçamento inferior ao alcance. Caso contrário, qualquer interpolação entre os pontos será meramente especulativa, uma vez que, além desta fronteira, a predição reverte estatisticamente para a média global do processo.</p>
<ol start="2" type="1">
<li><strong>Efeito Pepita (</strong><span class="math inline">\(C_0\)</span> ou Nugget Effect)</li>
</ol>
<p>Teoricamente, pela definição de variância de um incremento nulo, <span class="math inline">\(\gamma(\mathbf{0}) = 0\)</span>. Contudo, o variograma experimental frequentemente exibe uma descontinuidade na origem, intercetando o eixo das ordenadas num valor positivo <span class="math inline">\(C_0 &gt; 0\)</span>. Como descrito na secção <a href="#sec-efeito_pepita" class="quarto-xref"><span>Seção 3.3</span></a>, <span class="citation" data-cites="cressie1993statistics">Cressie (<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">1993</a>)</span> e <span class="citation" data-cites="diggle1998model">Diggle, Tawn, e Moyeed (<a href="references.html#ref-diggle1998model" role="doc-biblioref">1998</a>)</span> decompõem este parâmetro na soma de duas fontes de variabilidade que operam em escalas sub-amostrais: a variabilidade de microescala e o erro de medição (<span class="math inline">\(C_0 =\text{Var}(\eta(\mathbf{s})) + \text{Var}(\epsilon(\mathbf{s}))\)</span>). Embora seja um parâmetro a modelar, é desejável que a sua magnitude seja reduzida em comparação com a variância total (<span class="math inline">\(C_0 &lt;C\)</span>), indicando que o ruído não domina o sinal espacial.</p>
<ol start="3" type="1">
<li><strong>Contribuição (</strong><span class="math inline">\(C\)</span> ou Partial Sill)</li>
</ol>
<p>A Contribuição representa a componente da variância que é explicitamente explicada pela estrutura de dependência espacial. Corresponde à amplitude do crescimento do variograma, ou seja, a diferença entre o valor onde a função estabiliza e o ponto onde intercepta o eixo <span class="math inline">\(Y\)</span> (Efeito Pepita). É neste segmento da curva que reside a informação espacial útil para a krigagem: quanto maior for o valor de <span class="math inline">\(C\)</span> em relação a <span class="math inline">\(C_0\)</span>, mais forte e contínuo é o padrão espacial do fenômeno.</p>
<ol start="4" type="1">
<li><strong>Patamar (</strong><span class="math inline">\(C_0 + C\)</span> ou Sill)</li>
</ol>
<p>O Patamar é o valor assintótico onde a função <span class="math inline">\(\gamma(\mathbf{h})\)</span> estabiliza. Sob a hipótese de estacionariedade de segunda ordem, este valor corresponde teoricamente à variância total a priori do processo (<span class="math inline">\(\sigma^2 = C(\mathbf{0})\)</span>). Existe uma relação analítica de aditividade que conecta os elementos de variância descritos acima:</p>
<p><span class="math display">\[\text{Patamar} = \text{Efeito Pepita} (C_0) + \text{Contribuição} (C)\]</span></p>
<p>Se o variograma não estabilizar num patamar e continuar a crescer indefinidamente, isso indica que o processo não possui variância finita (é intrínseco) ou que existe uma tendência (drift) não removida nos dados.</p>
<p><strong>Interpretação Gráfica</strong></p>
<p>Para visualizar estes componentes no gráfico do semivariograma, observa-se o comportamento da curva <span class="math inline">\(\gamma(\mathbf{h})\)</span> em relação aos eixos cartesianos. O gráfico inicia-se no eixo Y à altura do Efeito Pepita (<span class="math inline">\(C_0\)</span>). À medida que a distância <span class="math inline">\(\mathbf{h}\)</span> (eixo X) aumenta, a semivariância cresce com uma amplitude igual à Contribuição (<span class="math inline">\(C\)</span>). A curva cessa o seu crescimento quando a distância atinge o Alcance (<span class="math inline">\(a\)</span>), momento em que a função se torna horizontal, fixando-se no valor do Patamar (<span class="math inline">\(C_0 + C\)</span>). Portanto, a altura total da curva representa a variabilidade total dos dados, a qual é particionada em variabilidade não explicada (pepita) e variabilidade estruturada (contribuição) <a href="#fig-variograma-teorico" class="quarto-xref">Figura&nbsp;<span>3.4</span></a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Uma discussão aprofundada sobre as implicações do efeito pepita na escolha entre Krigagem Exata e Krigagem com Suavização encontra-se na <a href="#sec-efeito_pepita" class="quarto-xref"><span>Seção 3.3</span></a>.</p>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_vgm, <span class="fu">aes</span>(<span class="at">x =</span> Distancia, <span class="at">y =</span> Semivariancia)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> sill, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> range_val, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> nugget, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">25</span>, <span class="at">y =</span> sill <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">label =</span> <span class="st">"Patamar (Sill)"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> range_val <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">"Alcance (Range)"</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> nugget), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> nugget <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">label =</span> <span class="st">"Efeito Pepita (C0)"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"curve"</span>, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> nugget <span class="sc">-</span> <span class="fl">0.2</span>,       </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">xend =</span> <span class="fl">0.15</span>, <span class="at">yend =</span> nugget <span class="sc">-</span> <span class="fl">0.05</span>, </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">curvature =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="dv">28</span>, <span class="at">xend =</span> <span class="dv">28</span>, <span class="at">y =</span> nugget, <span class="at">yend =</span> sill, </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"both"</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">28.5</span>, <span class="at">y =</span> (nugget <span class="sc">+</span> sill)<span class="sc">/</span><span class="dv">2</span> <span class="sc">-</span><span class="dv">2</span> , <span class="at">label =</span> <span class="st">"Contribuição (C)"</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Distância de Separação (h)"</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">gamma</span>(h))) <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-variograma-teorico" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-variograma-teorico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-variograma-teorico-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-variograma-teorico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.4: Elementos Teóricos do Semivariograma: Alcance, patamar, efeito pepita e contribuição.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="estimadores-do-variograma" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="estimadores-do-variograma"><span class="header-section-number">3.5</span> Estimadores do Variograma</h2>
<p>A definição teórica do variograma, <span class="math inline">\(2\gamma(\mathbf{h}) = E[(Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s}))^2]\)</span>, pressupõe o conhecimento da distribuição de probabilidade conjunta do processo estocástico <span class="math inline">\(Y(\mathbf{s})\)</span>. Contudo, na prática geoestatística, o investigador dispõe apenas de uma única realização finita do processo, materializada num conjunto discreto de observações amostrais <span class="math inline">\(\mathbf{y} = \{y(\mathbf{s}_1), y(\mathbf{s}_2), \dots, y(\mathbf{s}_n)\}\)</span>. Consequentemente, a função teórica <span class="math inline">\(\gamma(\mathbf{h})\)</span> é desconhecida e deve ser estimada empiricamente a partir destes dados. A qualidade desta estimativa é crítica, uma vez que o variograma experimental constitui a base para o ajuste do modelo teórico que alimentará as equações de krigagem.</p>
<p><strong>Estimador Experimental Clássico (Matheron)</strong></p>
<p>Proposto por <span class="citation" data-cites="matheron1963principles">G. Matheron (<a href="references.html#ref-matheron1963principles" role="doc-biblioref">1963</a>)</span>, este estimador baseia-se no método dos momentos. Ele calcula a média dos quadrados das diferenças entre pares de pontos separados por um vetor <span class="math inline">\(\mathbf{h}\)</span> (dentro de uma determinada tolerância de distância e direção). O semivariograma experimental <span class="math inline">\(\hat{\gamma}_{M}(\mathbf{h})\)</span> é dado por:</p>
<p><span id="eq-estimador_classico"><span class="math display">\[\hat{\gamma}_{M}(\mathbf{h}) = \frac{1}{2|N(\mathbf{h})|} \sum_{(\mathbf{s}_i, \mathbf{s}_j) \in N(\mathbf{h})} (y(\mathbf{s}_i) - y(\mathbf{s}_j))^2 \tag{3.6}\]</span></span></p>
<p>Onde <span class="math inline">\(N(\mathbf{h})\)</span> representa o conjunto de pares de localizações <span class="math inline">\((\mathbf{s}_i, \mathbf{s}_j)\)</span> tal que a separação <span class="math inline">\(\mathbf{s}_i - \mathbf{s}_j\)</span> se aproxima do vetor <span class="math inline">\(\mathbf{h}\)</span>, e <span class="math inline">\(|N(\mathbf{h})|\)</span> denota a cardinalidade (número de pares) desse conjunto.</p>
<p><strong>Estimador Robusto (Cressie-Hawkins)</strong></p>
<p>Embora o estimador clássico <a href="#eq-estimador_classico" class="quarto-xref">Eq.&nbsp;<span>3.6</span></a> seja não-viesado para processos Gaussianos, ele apresenta uma vulnerabilidade intrínseca: a elevação das diferenças ao quadrado, <span class="math inline">\((y(\mathbf{s}_i) - y(\mathbf{s}_j))^2\)</span>, amplifica desproporcionalmente o impacto de valores extremos. A presença de um único outlier ou erro grosseiro na amostragem pode inflar a variância estimada em determinadas classes de distância, distorcendo a estrutura de continuidade espacial e dificultando a modelagem do patamar e do alcance.</p>
<p>Em resposta à sensibilidade do estimador clássico a dados contaminados e a distribuições de cauda longa, <span class="citation" data-cites="cressie1980robust">Cressie e Hawkins (<a href="references.html#ref-cressie1980robust" role="doc-biblioref">1980</a>)</span> desenvolveram uma alternativa mais resiliente, conhecida como Estimador Robusto de Cressie-Hawkins. A premissa deste método reside na suavização das diferenças extremas através de uma transformação de raiz quadrada, aproximando a distribuição dos incrementos à normalidade antes do cálculo da média. A expressão para o estimador robusto <span class="math inline">\(\hat{\gamma}_{CH}(\mathbf{h})\)</span> é definida como:</p>
<p><span id="eq-estimador_robusto"><span class="math display">\[\hat{\gamma}_{CH}(\mathbf{h}) = \frac{\left( \frac{1}{|N(\mathbf{h})|} \sum_{(\mathbf{s}_i, \mathbf{s}_j) \in N(\mathbf{h})} |y(\mathbf{s}_i) - y(\mathbf{s}_j)|^{1/2} \right)^4}{0.457 + \frac{0.494}{|N(\mathbf{h})|}} \tag{3.7}\]</span></span></p>
<p>O denominador na <a href="#eq-estimador_robusto" class="quarto-xref">Eq.&nbsp;<span>3.7</span></a> atua como um fator de correção de viés para amostras finitas, garantindo a consistência estatística do estimador. A aplicação comparativa de ambos os estimadores constitui uma prática recomendada na fase de Análise Exploratória de Dados Espaciais (ESDA). Uma divergência significativa entre o perfil do variograma clássico e o do robusto especificamente, se <span class="math inline">\(\hat{\gamma}_{M}(\mathbf{h})\)</span> apresentar flutuações erráticas ou valores excessivamente elevados nas curtas distâncias em comparação com <span class="math inline">\(\hat{\gamma}_{CH}(\mathbf{h})\)</span>, é um indicador forte da presença de outliers ou de não-normalidade severa nos dados <a href="#fig-estimadores-comparacao" class="quarto-xref">Figura&nbsp;<span>3.5</span></a>, sugerindo a necessidade de adoção da abordagem robusta para a modelagem ou verificar possíveis falhas resultantes da ação humana <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span> .</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2, gstat, sf, viridis, dplyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>grid_exemplo <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>grid_sf_ex <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(grid_exemplo, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>modelo_verdadeiro <span class="ot">&lt;-</span> gstat<span class="sc">::</span><span class="fu">vgm</span>(<span class="at">psill =</span> <span class="dv">10</span>, <span class="at">model =</span> <span class="st">"Exp"</span>, <span class="at">range =</span> <span class="dv">15</span>, <span class="at">nugget =</span> <span class="dv">2</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>g_sim <span class="ot">&lt;-</span> gstat<span class="sc">::</span><span class="fu">gstat</span>(<span class="at">formula =</span> z<span class="sc">~</span><span class="dv">1</span>, <span class="at">locations =</span> grid_sf_ex, <span class="at">dummy =</span> <span class="cn">TRUE</span>, <span class="at">beta =</span> <span class="dv">0</span>, <span class="at">model =</span> modelo_verdadeiro, <span class="at">nmax =</span> <span class="dv">20</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>simulacao <span class="ot">&lt;-</span> <span class="fu">predict</span>(g_sim, <span class="at">newdata =</span> grid_sf_ex, <span class="at">nsim =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[using unconditional Gaussian simulation]</code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>simulacao<span class="sc">$</span>z_contaminado <span class="ot">&lt;-</span> simulacao<span class="sc">$</span>sim1</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Introduzindo Outliers (Contaminação)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionamos um erro grosseiro (+50) em apenas 0.2% dos dados</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>) </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>idx_outliers <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(simulacao), <span class="dv">5</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>simulacao<span class="sc">$</span>z_contaminado[idx_outliers] <span class="ot">&lt;-</span> simulacao<span class="sc">$</span>z_contaminado[idx_outliers] <span class="sc">+</span> <span class="dv">50</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Variogramas</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>vgm_classico <span class="ot">&lt;-</span> gstat<span class="sc">::</span><span class="fu">variogram</span>(z_contaminado <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> simulacao, <span class="at">cressie =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>vgm_classico<span class="sc">$</span>Estimador <span class="ot">&lt;-</span> <span class="st">"Clássico (Matheron)"</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>vgm_robusto <span class="ot">&lt;-</span> gstat<span class="sc">::</span><span class="fu">variogram</span>(z_contaminado <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> simulacao, <span class="at">cressie =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>vgm_robusto<span class="sc">$</span>Estimador <span class="ot">&lt;-</span> <span class="st">"Robusto (Cressie)"</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>vgm_comp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vgm_classico, vgm_robusto)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> vgm_comp, <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma, <span class="at">color =</span> Estimador), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vgm_comp, <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma, <span class="at">color =</span> Estimador), </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(h) <span class="dv">2</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>h<span class="sc">/</span><span class="dv">15</span>)), <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"Modelo Verdadeiro (Gerador)"</span>), </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Clássico (Matheron)"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>, <span class="st">"Robusto (Cressie)"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>)) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">name =</span> <span class="st">""</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Modelo Verdadeiro (Gerador)"</span> <span class="ot">=</span> <span class="st">"dashed"</span>)) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>)) <span class="sc">+</span> </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Distância (h)"</span>, </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(Semivariância <span class="sc">~</span> <span class="fu">gamma</span>(h)), <span class="at">color=</span><span class="st">"Estimador:"</span>) <span class="sc">+</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-estimadores-comparacao" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-estimadores-comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-estimadores-comparacao-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-estimadores-comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.5: Comparação de Robustez: O estimador de Matheron (laranja) é sensível aos outliers, superestimando a variância. O estimador de Cressie (azul) ignora a contaminação e ajusta-se quase perfeitamente ao Modelo Verdadeiro (tracejado).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Na definição teórica, o variograma é uma função contínua calculada para vetores de distância exatos <span class="math inline">\(\mathbf{h}\)</span>. Contudo, a realidade operacional dos levantamentos de campo impõe uma restrição fundamental: as amostras raramente estão dispostas numa grelha regular perfeita. Em dados reais, a probabilidade de encontrar múltiplos pares de pontos separados por uma distância vetorial exata (por exemplo, <span class="math inline">\(\|\mathbf{h}\| = 10.00\)</span> metros a <span class="math inline">\(0^\circ\)</span>) é, para todos os efeitos práticos, nula.</p>
<p>Se tentássemos calcular o estimador <span class="math inline">\(\hat{\gamma}(\mathbf{h})\)</span> exigindo distâncias exatas, obteríamos apenas um par de pontos (ou nenhum) para cada distância única, resultando num gráfico caótico de ruído puro. Para viabilizar a inferência estrutural e garantir robustez estatística, é necessário proceder à regularização dos dados, agrupando os pares de pontos em classes de distância e direção, denominadas Lags (ou passos).</p>
<p>Cada ponto no variograma experimental representa, portanto, não uma distância única, mas a média estatística de todos os pares contidos num intervalo de tolerância <span class="math inline">\([\mathbf{h} - \epsilon, \mathbf{h} + \epsilon]\)</span>. A <a href="#fig-lags-concept" class="quarto-xref">Figura&nbsp;<span>3.6</span></a> ilustra este processo de agrupamento: em torno de um ponto de referência <span class="math inline">\(\mathbf{s}_i\)</span> (a vermelho), definem-se anéis concêntricos com uma espessura definida. Todos os vizinhos que caem dentro de um determinado anel (a azul) são considerados como estando aproximadamente à mesma distância, contribuindo conjuntamente para o cálculo da semivariância média daquele lag.</p>
<p>A definição correta da largura do lag e da tolerância angular constitui um compromisso delicado entre resolução e estabilidade:</p>
<ol type="1">
<li><p><strong>Intervalos demasiado estreitos:</strong> Resultam em classes com poucos pares (<span class="math inline">\(|N(\mathbf{h})|\)</span> baixo). Como a variância do estimador é inversamente proporcional ao número de pares, isto gera um variograma ruidoso, instável e de difícil interpretação.</p></li>
<li><p><strong>Intervalos demasiado largos:</strong> Suavizam excessivamente a estrutura espacial. Ao fazer a média de pares muito distantes entre si, mascara-se o comportamento do variograma nas curtas distâncias, o que pode levar a uma estimativa incorreta do Efeito Pepita e da microestrutura do fenômeno.</p></li>
</ol>
<p><span class="citation" data-cites="journel1976mining">Andre G. Journel e Huijbregts (<a href="references.html#ref-journel1976mining" role="doc-biblioref">1976</a>)</span> propõe, como regra empírica amplamente aceite, que o número de pares por lag não deve ser inferior a 30 para garantir a fiabilidade estatística da estimativa (Teorema do Limite Central). Adicionalmente, recomenda-se que a largura do lag seja coincidente com a distância média entre amostras vizinhas, maximizando assim o aproveitamento da informação disponível.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2,dplyr)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>n_points <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df_points <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>n_points,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(n_points, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">runif</span>(n_points, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>center_pt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>df_points<span class="sc">$</span>dist <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((df_points<span class="sc">$</span>x <span class="sc">-</span> center_pt<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df_points<span class="sc">$</span>y <span class="sc">-</span> center_pt<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>lag_width <span class="ot">&lt;-</span> <span class="fl">2.5</span>   <span class="co"># Largura do Lag</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>n_lags <span class="ot">&lt;-</span> <span class="dv">3</span>        <span class="co"># Número de anéis para desenhar</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>df_points<span class="sc">$</span>lag_group <span class="ot">&lt;-</span> <span class="fu">cut</span>(df_points<span class="sc">$</span>dist, </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                           <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="at">by =</span> lag_width),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>target_lag <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>df_points<span class="sc">$</span>status <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  df_points<span class="sc">$</span>lag_group <span class="sc">==</span> target_lag <span class="sc">~</span> <span class="st">"Pares no Lag Alvo"</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Outros Pares"</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>create_circle <span class="ot">&lt;-</span> <span class="cf">function</span>(r, <span class="at">center_x=</span><span class="dv">0</span>, <span class="at">center_y=</span><span class="dv">0</span>, <span class="at">npoints=</span><span class="dv">100</span>){</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="sc">*</span>pi, <span class="at">length.out =</span> npoints)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> center_x <span class="sc">+</span> r <span class="sc">*</span> <span class="fu">cos</span>(tt), <span class="at">y =</span> center_y <span class="sc">+</span> r <span class="sc">*</span> <span class="fu">sin</span>(tt), <span class="at">r =</span> r)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>circles <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq</span>(lag_width, lag_width<span class="sc">*</span><span class="dv">4</span>, <span class="at">by=</span>lag_width), create_circle))</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>radius_inner <span class="ot">&lt;-</span> (target_lag <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> lag_width</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>radius_outer <span class="ot">&lt;-</span> target_lag <span class="sc">*</span> lag_width</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"path"</span>, <span class="at">x=</span>circles<span class="sc">$</span>x[circles<span class="sc">$</span>r<span class="sc">==</span>radius_outer], <span class="at">y=</span>circles<span class="sc">$</span>y[circles<span class="sc">$</span>r<span class="sc">==</span>radius_outer], <span class="at">color=</span><span class="st">"gray80"</span>) <span class="sc">+</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"path"</span>, <span class="at">x=</span>circles<span class="sc">$</span>x[circles<span class="sc">$</span>r<span class="sc">==</span>radius_inner], <span class="at">y=</span>circles<span class="sc">$</span>y[circles<span class="sc">$</span>r<span class="sc">==</span>radius_inner], <span class="at">color=</span><span class="st">"gray80"</span>) <span class="sc">+</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> circles, <span class="fu">aes</span>(x, y, <span class="at">group =</span> r), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_points, <span class="fu">aes</span>(x, y, <span class="at">color =</span> status, <span class="at">shape =</span> status), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> center_pt, <span class="fu">aes</span>(x, y), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">label =</span> <span class="st">"s_i"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface=</span><span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="sc">-</span>lag_width <span class="sc">*</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">"Lag 1"</span>) <span class="sc">+</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="sc">-</span>lag_width <span class="sc">*</span> <span class="fl">2.5</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Lag"</span>, target_lag, <span class="st">"</span><span class="sc">\n</span><span class="st">(Intervalo Ativo)"</span>)) <span class="sc">+</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> lag_width, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> lag_width <span class="sc">*</span> <span class="dv">2</span>, </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>), <span class="at">ends =</span> <span class="st">"both"</span>)) <span class="sc">+</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> lag_width <span class="sc">*</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">"Largura</span><span class="sc">\n</span><span class="st">do Lag"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pares no Lag Alvo"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Outros Pares"</span> <span class="ot">=</span> <span class="st">"gray70"</span>)) <span class="sc">+</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pares no Lag Alvo"</span> <span class="ot">=</span> <span class="dv">19</span>, <span class="st">"Outros Pares"</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Classificação:"</span>, <span class="at">shape =</span> <span class="st">"Classificação"</span>) <span class="sc">+</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-lags-concept" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lags-concept-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-lags-concept-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lags-concept-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.6: Esquematização do cálculo do Variograma Experimental: Os pontos observados (y) não estão a distâncias exatas, pelo que são agrupados em anéis concêntricos (Lags). Todos os pontos na área azul contribuem para o cálculo da variância média daquele Lag específico.
</figcaption>
</figure>
</div>
</div>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(gstat, sf, ggplot2, sp, patchwork)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Carregar dados exemplo (Meuse - metais pesados)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter para objeto sf</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Variograma Cloud (Todos os pares de pontos possíveis)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostra a dispersão bruta das diferenças ao quadrado</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>v_cloud <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf, <span class="at">cloud =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(v_cloud, <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma)) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distância"</span>, <span class="at">y =</span> <span class="st">"Semivariância"</span>) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Variograma Experimental (Experimental / Binned)</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupa a nuvem em lags (classes de distância) para obter a média</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>v_exp <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf, <span class="at">cutoff =</span> <span class="dv">1500</span>, <span class="at">width =</span> <span class="dv">100</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(v_exp, <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma)) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> np), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="co"># Número de pares</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Números indicam pares por lag"</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distância"</span>, <span class="at">y =</span> <span class="st">"Semivariância"</span>) <span class="sc">+</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>p1 ; p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-variograma-experimental" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-variograma-experimental-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-variograma-experimental" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-variograma-experimental-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-variograma-experimental-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-variograma-experimental-1.png" class="img-fluid figure-img" data-ref-parent="fig-variograma-experimental">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-variograma-experimental-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Variograma Cloud (Bruto)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-variograma-experimental" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-variograma-experimental-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-variograma-experimental-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-variograma-experimental-2.png" class="img-fluid figure-img" data-ref-parent="fig-variograma-experimental">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-variograma-experimental-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Variograma Experimental (Médias)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-variograma-experimental-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.7: Cálculo do Variograma Experimental: Nuvem (Cloud) vs.&nbsp;Experimental (Binned)
</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Saiba mais">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Importante</span>Saiba mais
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para compreender melhor os diferentes tipos de variograma e suas aplicações práticas, recomenda-se a leitura do Capítulo 3 do livro <span class="citation" data-cites="scalon2024analise">Scalon (<a href="references.html#ref-scalon2024analise" role="doc-biblioref">2024</a>)</span>.</p>
</div>
</div>
</section>
<section id="modelagem-do-variograma" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="modelagem-do-variograma"><span class="header-section-number">3.6</span> Modelagem do Variograma</h2>
<p>O cálculo do variograma experimental, conforme detalhado na secção anterior, resulta num conjunto discreto de estimativas pontuais <span class="math inline">\(\hat{\gamma}(\mathbf{h}_k)\)</span> para distâncias de separação específicas. No entanto, o sistema de equações da Krigagem exige o conhecimento do valor da semivariância para qualquer distância contínua <span class="math inline">\(\mathbf{h}\)</span> dentro do domínio de estudo, e não apenas para os intervalos amostrados. Poder-se-ia intuir que uma simples interpolação linear ou spline entre os pontos experimentais seria suficiente para resolver esta lacuna. Contudo, tal procedimento é inválido e perigoso para a inferência.</p>
<p>Para garantir a existência e unicidade da solução do sistema de Krigagem e, crucialmente, para assegurar que a variância de estimativa calculada seja sempre não-negativa (<span class="math inline">\(\sigma_E^2 \ge 0\)</span>), a função utilizada para modelar a dependência espacial deve satisfazer a condição de definição condicionalmente negativa (no caso do variograma) ou definição positiva (no caso da covariância) <span class="citation" data-cites="matheron1971theory cressie1993statistics">(<a href="references.html#ref-matheron1971theory" role="doc-biblioref">George Matheron 1971</a>; <a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>. Funções arbitrárias ou interpolações empíricas raramente satisfazem estas desigualdades. Consequentemente, a prática geoestatística impõe a substituição dos pontos experimentais por um modelo teórico paramétrico <span class="math inline">\(\gamma(\mathbf{h}; \boldsymbol{\theta})\)</span> que seja válido (admissível). O processo de modelagem consiste, portanto, em ajustar uma curva teórica aos dados empíricos, estimando o vetor de parâmetros <span class="math inline">\(\boldsymbol{\theta} = (C_0, C, a)\)</span> que melhor representa a estrutura de continuidade do fenômeno.</p>
<p>Entre a vasta família de funções admissíveis (Entre a vasta família de funções admissíveis (ver <span class="citation" data-cites="banerjee2003hierarchical">Banerjee, Carlin, e Gelfand (<a href="references.html#ref-banerjee2003hierarchical" role="doc-biblioref">2003</a>)</span>, p.&nbsp;27-28), três modelos isotrópicos destacam-se na literatura aplicada devido à sua interpretabilidade: o modelo Esférico, o Exponencial e o Gaussiano <span class="citation" data-cites="wackernagel2003multivariate">(<a href="references.html#ref-wackernagel2003multivariate" role="doc-biblioref">Wackernagel 2003</a>)</span>.</p>
<p><strong>Modelo Esférico</strong></p>
<p>O Modelo Esférico descreve fenômenos com uma transição clara e abrupta entre a dependência espacial e a independência. O seu comportamento caracteriza-se por um crescimento quase linear na origem que se curva progressivamente até atingir o patamar exatamente na distância definida pelo alcance <span class="math inline">\(a\)</span>. Para uma distância escalar <span class="math inline">\(h = \|\mathbf{h}\|\)</span>, é definido por:</p>
<p><span id="eq-modelo_esferico"><span class="math display">\[\gamma(h) = \begin{cases} C_0 + c \left( \frac{3h}{2a} - \frac{1}{2}\left(\frac{h}{a}\right)^3 \right) &amp; \text{se } 0 &lt; h \le a \\ C_0 + c &amp; \text{se } h &gt; a \end{cases} \tag{3.8}\]</span></span></p>
<p>Em contraste, muitos fenômenos ambientais, como a dispersão de poluentes ou propriedades do solo, exibem uma continuidade mais suave e persistente, melhor descrita pelo Modelo Exponencial.</p>
<p><strong>Modelo Exponencial</strong></p>
<p>Diferentemente do modelo esférico, o exponencial é assintótico: ele cresce rapidamente na origem mas nunca atinge o patamar, aproximando-se dele indefinidamente. A sua formulação é dada por</p>
<p><span id="eq-modelo_esponencial"><span class="math display">\[\gamma(h) = C_0 + C(1 - \exp(-h/a)) \tag{3.9}\]</span></span></p>
<p>Devido a esta natureza assintótica, o parâmetro <span class="math inline">\(a\)</span> a <a href="#eq-modelo_esponencial" class="quarto-xref">Eq.&nbsp;<span>3.9</span></a> não representa o alcance geométrico onde a correlação se anula, mas sim um parâmetro de escala. Convenciona-se, portanto, definir o Alcance Prático (<span class="math inline">\(a' \approx 3a\)</span>) como a distância na qual o variograma atinge <span class="math inline">\(95\%\)</span> do valor do patamar.</p>
<p><strong>Modelo Gaussiano</strong></p>
<p>No extremo da continuidade encontra-se o Modelo Gaussiano, utilizado para representar fenômenos extremamente regulares e infinitamente diferenciáveis. A sua característica distintiva é o comportamento parabólico na origem (<span class="math inline">\(h^2\)</span>), indicando uma variação muito suave a curtas distâncias. A equação define-se como</p>
<p><span id="eq-modleo_gaussiano"><span class="math display">\[\gamma(h) = C_0 + c(1 - \exp(-h^2/a^2)), \tag{3.10}\]</span></span></p>
<p>com um alcance prático de aproximadamente <span class="math inline">\(\sqrt{3}a\)</span>. <span class="citation" data-cites="laslett1994kriging">Laslett (<a href="references.html#ref-laslett1994kriging" role="doc-biblioref">1994</a>)</span> e <span class="citation" data-cites="wackernagel2003multivariate">Wackernagel (<a href="references.html#ref-wackernagel2003multivariate" role="doc-biblioref">2003</a>)</span> demonstram que a utilização do modelo Gaussiano sem um efeito pepita (<span class="math inline">\(C_0 = 0\)</span>) pode conduzir a instabilidades numéricas severas na inversão da matriz de krigagem (singularidade) e gerar artefactos irrealistas na predição, devendo a sua aplicação ser sempre acompanhada de uma componente de ruído, ainda que infinitesimal.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>nugget <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sill_total <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># C0 + C</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>alcance_pratico <span class="ot">&lt;-</span> <span class="dv">30</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>gamma_sph <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(h <span class="sc">&lt;=</span> alcance_pratico,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                    nugget <span class="sc">+</span> sill_total <span class="sc">*</span> (<span class="fl">1.5</span> <span class="sc">*</span> (h<span class="sc">/</span>alcance_pratico) <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> (h<span class="sc">/</span>alcance_pratico)<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                    sill_total)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo Exponencial </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>a_exp <span class="ot">&lt;-</span> alcance_pratico <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>gamma_exp <span class="ot">&lt;-</span> nugget <span class="sc">+</span> sill_total <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>h<span class="sc">/</span>a_exp))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo Gaussiano</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>a_gau <span class="ot">&lt;-</span> alcance_pratico <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">3</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>gamma_gau <span class="ot">&lt;-</span> nugget <span class="sc">+</span> sill_total <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>(h<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(a_gau<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>df_modelos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Distancia =</span> h,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Esferico =</span> gamma_sph,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Exponencial =</span> gamma_exp,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Gaussiano =</span> gamma_gau)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df_modelos, <span class="at">cols =</span> <span class="sc">-</span>Distancia, <span class="at">names_to =</span> <span class="st">"Modelo"</span>, <span class="at">values_to =</span> <span class="st">"Gamma"</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Distancia, <span class="at">y =</span> Gamma, <span class="at">color =</span> Modelo, <span class="at">linetype =</span> Modelo)) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> sill_total, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">45</span>, <span class="at">y =</span> sill_total <span class="sc">+</span> <span class="fl">0.3</span>, <span class="at">label =</span> <span class="st">"Patamar (Sill)"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Esferico"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Exponencial"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Gaussiano"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Distância (h)"</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">gamma</span>(h))) <span class="sc">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-modelos-teoricos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-modelos-teoricos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-modelos-teoricos-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-modelos-teoricos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.8: Comparação dos Modelos Teóricos: O Esférico (linear na origem) atinge o patamar abruptamente. O Exponencial sobe rápido mas estabiliza lentamente (assintótico). O Gaussiano (parabólico na origem) representa fenômenos muito suaves.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Para unificar estas abordagens, <span class="citation" data-cites="guttorp2006studies">Guttorp e Gneiting (<a href="references.html#ref-guttorp2006studies" role="doc-biblioref">2006</a>)</span> defendem que modelos da família Matérn devem ser preferidos devido à sua flexibilidade superior. Enquanto outros modelos impõem uma suavidade fixa ao processo, a família Matérn possui um parâmetro de forma <span class="math inline">\(\nu\)</span> (suavidade) que permite aos dados ditar o grau de diferenciabilidade do campo aleatório <span class="math inline">\(Y(\mathbf{s})\)</span>.</p>
<p>Como definido anteriormente, para processos estacionários de segunda ordem, o semivariograma relaciona-se diretamente com a função de covariância através de <span class="math inline">\(\gamma(h) = C(\mathbf{0}) - C(h)\)</span>.</p>
<p>A formulação da família Matérn distingue-se pela introdução de um parâmetro adicional que controla a suavidade do processo estocástico, permitindo que o modelo transite entre as formas exponencial e gaussiana de acordo com a evidência dos dados <span class="citation" data-cites="sahu2022bayesian">(<a href="references.html#ref-sahu2022bayesian" role="doc-biblioref">Sahu 2022</a>)</span>.</p>
<p><span class="math display">\[\gamma(h) = C_0 + C \left[ 1 - \frac{1}{2^{\nu-1}\Gamma(\nu)} \left(\frac{2\sqrt{\nu} \cdot h}{a}\right)^\nu K_\nu\left(\frac{2\sqrt{\nu} \cdot h}{a}\right) \right]\]</span></p>
<p>Onde,</p>
<ul>
<li><p><span class="math inline">\(C\)</span> (Contribuição ou Variância Estrutural) representa a parte do patamar explicada pela continuidade espacial. No limite <span class="math inline">\(h \to \infty\)</span>, o termo de correlação anula-se e o semivariograma estabiliza no patamar total <span class="math inline">\(C_0 + C\)</span>.</p></li>
<li><p><span class="math inline">\(a\)</span> (Alcance) define a escala de distância da dependência. Tal como nos modelos exponencial e gaussiano, este parâmetro dita quão rápido a semivariância cresce em direção ao patamar.</p></li>
<li><p><span class="math inline">\(\nu\)</span> (Parâmetro de suavidade) dita a diferenciabilidade do campo aleatório <span class="math inline">\(Y(\mathbf{s})\)</span>.</p></li>
<li><p><span class="math inline">\(K_\nu(\cdot)\)</span> representa a função de Bessel modificada de segunda espécie de ordem <span class="math inline">\(\nu\)</span>, que garante que o modelo seja válido (positivo definido) em espaços multidimensionais.</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>matern_semivgm <span class="ot">&lt;-</span> <span class="cf">function</span>(h, <span class="at">C0 =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">1</span>, <span class="at">a =</span> <span class="dv">10</span>, <span class="at">nu =</span> <span class="fl">0.5</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (h <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#correlação Matérn</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arg = (2 * sqrt(nu) * h) / a</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  arg <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(nu) <span class="sc">*</span> h) <span class="sc">/</span> a</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  term1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">^</span>(nu <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">gamma</span>(nu))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  term2 <span class="ot">&lt;-</span> (arg)<span class="sc">^</span>nu</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  term3 <span class="ot">&lt;-</span> <span class="fu">besselK</span>(arg, nu)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  correlacao <span class="ot">&lt;-</span> term1 <span class="sc">*</span> term2 <span class="sc">*</span> term3</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gamma(h) = C0 + C * (1 - rho(h))</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(C0 <span class="sc">+</span> C <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> correlacao))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>h_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="at">by =</span> <span class="fl">0.2</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>contribuicao <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>alcance_a <span class="ot">&lt;-</span> <span class="dv">15</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>df_matern <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nu_val <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="dv">10</span>)) {</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  gamma_vals <span class="ot">&lt;-</span> <span class="fu">sapply</span>(h_seq, matern_semivgm, <span class="at">C0 =</span> <span class="dv">0</span>, <span class="at">C =</span> contribuicao, <span class="at">a =</span> alcance_a, <span class="at">nu =</span> nu_val)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  nome_modelo <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    nu_val <span class="sc">==</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"nu = 0.5 (Exponencial)"</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    nu_val <span class="sc">==</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="st">"nu = 1.5 (Matern 3/2)"</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    nu_val <span class="sc">==</span> <span class="dv">10</span>  <span class="sc">~</span> <span class="st">"nu = 10 (Aprox. Gaussiano)"</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  df_matern <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_matern, <span class="fu">data.frame</span>(<span class="at">h =</span> h_seq, <span class="at">gamma =</span> gamma_vals, <span class="at">Modelo =</span> nome_modelo))</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_matern, <span class="fu">aes</span>(<span class="at">x =</span> h, <span class="at">y =</span> gamma, <span class="at">color =</span> Modelo, <span class="at">linetype =</span> Modelo)) <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> contribuicao, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"nu = 0.5 (Exponencial)"</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"nu = 1.5 (Matern 3/2)"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>, </span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"nu = 10 (Aprox. Gaussiano)"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Distância de separação (h)"</span>, </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">gamma</span>(h))) <span class="sc">+</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-matern-comparacao" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-matern-comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-matern-comparacao-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-matern-comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.9: A Família Matérn e a Flexibilidade de Suavidade (nu). O parâmetro nu controla o comportamento na origem: nu=0.5 recupera o modelo Exponencial, enquanto nu elevados aproximam-se do Gaussiano.
</figcaption>
</figure>
</div>
</div>
</div>
<p>A flexibilidade desta família reside no facto de englobar os modelos clássicos como casos particulares. <span class="citation" data-cites="sahu2022bayesian">Sahu (<a href="references.html#ref-sahu2022bayesian" role="doc-biblioref">2022</a>)</span> destaca que quando <span class="math inline">\(\nu = 0.5\)</span>, a função simplifica-se analiticamente para o modelo exponencial, <span class="math inline">\(\gamma(d) = C_0 + C(1 - \exp(-h/a))\)</span>, descrevendo processos contínuos mas rugosos (não diferenciáveis na origem). À medida que <span class="math inline">\(\nu \to \infty\)</span>, a função converge para o modelo Gaussiano, descrevendo processos infinitamente suaves e diferenciáveis <a href="#fig-matern-comparacao" class="quarto-xref">Figura&nbsp;<span>3.9</span></a>.</p>
<p>Esta capacidade de transitar entre o rugoso e o suave permite que os próprios dados informem o grau de regularidade do fenômeno, evitando suposições arbitrárias. Além disso, a modelagem respeita a Primeira lei da geografia de Tobler, assegurando que a semivariância cresça monotonicamente com a distância. Para o caso específico de <span class="math inline">\(\nu = 0.5\)</span>, o alcance prático (onde se atinge <span class="math inline">\(95\%\)</span> do patamar) mantém a relação clássica de <span class="math inline">\(3a\)</span>, facilitando a interpretação dos parâmetros estimados.</p>
</section>
<section id="diagnóstico-e-validação" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="diagnóstico-e-validação"><span class="header-section-number">3.7</span> Diagnóstico e Validação</h2>
<section id="diagnóstico-via-derivada-na-origem-teoria-espectral." class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="diagnóstico-via-derivada-na-origem-teoria-espectral."><span class="header-section-number">3.7.1</span> Diagnóstico via Derivada na Origem (Teoria Espectral).</h3>
<p>A distinção visual entre modelos teóricos, particularmente entre as famílias Exponencial e Gaussiana (ou Matérn com diferentes parâmetros de suavidade), é frequentemente ambígua na presença de ruído experimental. <span class="citation" data-cites="gorsich2000variogram">Gorsich e Genton (<a href="references.html#ref-gorsich2000variogram" role="doc-biblioref">2000</a>)</span> propõem uma metodologia objetiva baseada na análise da derivada do variograma na origem, <span class="math inline">\(\gamma'(0)\)</span>, fundamentada na teoria espectral de campos aleatórios.</p>
<p>Pelo Teorema de Bochner, a função de covariância <span class="math inline">\(C(\mathbf{h})\)</span> de um campo aleatório estacionário e isotrópico em <span class="math inline">\(\mathbb{R}^d\)</span> possui uma representação espectral dada pela transformada de Hankel da densidade espectral <span class="math inline">\(f(\omega)\)</span>. Para a dimensão <span class="math inline">\(d=2\)</span>, tem-se:</p>
<p><span class="math display">\[C(h) = 2\pi \int_0^{\infty} J_0(\omega h) f(\omega) \omega \, d\omega\]</span></p>
<p>Onde <span class="math inline">\(J_0(\cdot)\)</span> é a função de Bessel de primeira espécie de ordem zero. Sabemos que o semivariograma se relaciona com a covariância por <span class="math inline">\(\gamma(h) = C(0) - C(h)\)</span>. Consequentemente, a derivada do semivariograma é o simétrico da derivada da covariância: <span class="math inline">\(\gamma'(h) = -C'(h)\)</span>.</p>
<p>A suavidade do processo estocástico (a existência de derivadas em média quadrática do processo <span class="math inline">\(Y(\mathbf{s})\)</span>) é determinada pela taxa de decaimento da densidade espectral <span class="math inline">\(f(\omega)\)</span> em altas frequências. <span class="citation" data-cites="gorsich2000variogram">Gorsich e Genton (<a href="references.html#ref-gorsich2000variogram" role="doc-biblioref">2000</a>)</span> demonstram que o comportamento de <span class="math inline">\(\gamma'(h)\)</span> quando <span class="math inline">\(h \to 0\)</span> discrimina classes de diferenciabilidade.</p>
<p><strong>Análise Assintótica dos Modelos</strong></p>
<p>1.<strong>Modelo Gaussiano</strong>: A função de covariância é dada por <span class="math inline">\(C(h) = \sigma^2 \exp(-h^2/a^2)\)</span>. A expansão de Taylor de segunda ordem em torno de zero é:</p>
<p><span class="math display">\[C(h) \approx \sigma^2 \left( 1 - \frac{h^2}{a^2} + O(h^4) \right)\]</span></p>
<p>O semivariograma correspondente é <span class="math inline">\(\gamma(h) = \sigma^2 - C(h) \approx \sigma^2 \frac{h^2}{a^2}\)</span>. A derivada em relação a <span class="math inline">\(h\)</span> é: <span class="math inline">\(\gamma'(h) \approx \frac{2\sigma^2 h}{a^2}\)</span>. Tomando o limite na origem: <span class="math inline">\(\lim_{h \to 0} \gamma'(h) = 0\)</span>. Uma derivada nula na origem implica que o processo <span class="math inline">\(Y(\mathbf{s})\)</span> é infinitamente diferenciável em média quadrática, caracterizando uma estrutura espacial extremamente suave.</p>
<ol start="2" type="1">
<li><strong>Modelo Exponencial</strong>: A função de covariância é <span class="math inline">\(C(h) = \sigma^2 \exp(-h/a)\)</span>. A expansão de Taylor de primeira ordem é:</li>
</ol>
<p><span class="math display">\[C(h) \approx \sigma^2 \left( 1 - \frac{h}{a} + O(h^2) \right)\]</span></p>
<p>O semivariograma comporta-se como <span class="math inline">\(\gamma(h) \approx \sigma^2 \frac{h}{a}\)</span>. A derivada é: <span class="math inline">\(\gamma'(h) \approx \frac{\sigma^2}{a}\)</span>. Tomando o limite:<span class="math inline">\(\lim_{h \to 0} \gamma'(h) = \frac{\sigma^2}{a} &gt; 0\)</span>. Uma derivada positiva constante na origem indica que o processo é contínuo em média quadrática, mas não diferenciável.</p>
<p>A aplicação prática deste diagnóstico requer o uso de um estimador não-paramétrico para <span class="math inline">\(\gamma(h)\)</span> (como expansões de Bessel ou splines de suavização) e o cálculo numérico da sua derivada em <span class="math inline">\(h=0\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Permite ver se as curvas de nível formam elipses</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf, <span class="at">map =</span> <span class="cn">TRUE</span>, <span class="at">cutoff =</span> <span class="dv">1000</span>, <span class="at">width =</span> <span class="dv">50</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Mapa de Semivariância"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Variogramas Direcionais</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># alpha = direção (0=Norte, 45=Nordeste, 90=Leste, 135=Sudeste)</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>v_dir <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf, <span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">90</span>, <span class="dv">135</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(v_dir, <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma, <span class="at">color =</span> <span class="fu">factor</span>(dir.hor))) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Variogramas Direcionais"</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Direção (graus):"</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distância"</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Semivariância"</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota: Se as curvas divergirem muito em altura (Patamar) = Anisotropia Zonal</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Se divergirem no alcance (distância onde estabiliza) = Anisotropia Geométrica</span></span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-anisotropia-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-anisotropia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-anisotropia-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-anisotropia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.10: Diagnóstico de Anisotropia: (a) mapa de semivariância e (b) variogramas direcionais
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-anisotropia-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-anisotropia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-anisotropia-2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-anisotropia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.11: Diagnóstico de Anisotropia: (a) mapa de semivariância e (b) variogramas direcionais
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="construção-de-modelos-válidos-via-médias-móveis" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="construção-de-modelos-válidos-via-médias-móveis"><span class="header-section-number">3.8</span> Construção de Modelos Válidos via Médias Móveis</h2>
<p>Uma limitação fundamental na modelagem geoestatística é a necessidade de garantir que a função de variograma escolhida seja condicionalmente negativa definida (ou que a covariância seja positiva definida). O uso de funções arbitrárias pode levar a variâncias de krigagem negativas. Em vez de se restringir a uma lista fixa de modelos paramétricos pré-aprovados (como o Esférico ou Exponencial), <span class="citation" data-cites="ver1998constructing">Ver Hoef e Barry (<a href="references.html#ref-ver1998constructing" role="doc-biblioref">1998</a>)</span> propõem uma abordagem construtiva baseada em médias móveis (convolução) que garante a validade matemática do modelo a priori.</p>
<p>Assuma-se que o processo espacial <span class="math inline">\(Y(\mathbf{s})\)</span> é gerado pela suavização (convolução) de um ruído branco subjacente <span class="math inline">\(W(\mathbf{u})\)</span> através de uma função de ponderação ou kernel <span class="math inline">\(g(\cdot)\)</span> integrável ao quadrado.</p>
<p>Seja <span class="math inline">\(W(\mathbf{u})\)</span> um processo de ruído branco em <span class="math inline">\(\mathbb{R}^d\)</span> tal que <span class="math inline">\(E[dW(\mathbf{u})] = 0\)</span>, <span class="math inline">\(\text{Var}[dW(\mathbf{u})] = d\mathbf{u}\)</span> (ou seja, <span class="math inline">\(\text{Cov}(dW(\mathbf{u}), dW(\mathbf{v})) = 0\)</span> se <span class="math inline">\(\mathbf{u} \neq \mathbf{v}\)</span>)</p>
<p>O processo <span class="math inline">\(Y(\mathbf{s})\)</span> define-se como a integral estocástica:</p>
<p><span class="math display">\[Y(\mathbf{s}) = \int_{\mathbb{R}^d} g(\mathbf{u} - \mathbf{s}) \, dW(\mathbf{u})\]</span></p>
<p>O nosso objetivo é encontrar a expressão teórica do variograma <span class="math inline">\(2\gamma(\mathbf{h})\)</span> resultante deste processo construtivo.</p>
<p><span class="math display">\[2\gamma(\mathbf{h}) = \text{Var}[Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s})] = E\left[ (Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s}))^2 \right]\]</span></p>
<p>Substituímos <span class="math inline">\(Y(\cdot)\)</span> pela sua definição integral:</p>
<p><span class="math display">\[
\begin{aligned}
Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s}) &amp;= \int_{\mathbb{R}^d} g(\mathbf{u} - (\mathbf{s}+\mathbf{h})) \, dW(\mathbf{u}) - \int_{\mathbb{R}^d} g(\mathbf{u} - \mathbf{s}) \, dW(\mathbf{u}) \\
&amp;= \int_{\mathbb{R}^d} \left[ g(\mathbf{u} - \mathbf{s} - \mathbf{h}) - g(\mathbf{u} - \mathbf{s}) \right] \, dW(\mathbf{u})
\end{aligned}
\]</span></p>
<p>Uma propriedade fundamental das integrais estocásticas em relação ao ruído branco (Movimento Browniano) é a Isometria de Ito, que estabelece que a variância da integral estocástica é igual à integral do quadrado da função determinística integranda:</p>
<p><span class="math display">\[
\text{Var}\left[ \int_{\mathbb{R}^d} f(\mathbf{u}) \, dW(\mathbf{u}) \right] = \int_{\mathbb{R}^d} [f(\mathbf{u})]^2 \, d\mathbf{u}
\]</span></p>
<p><span class="math display">\[
2\gamma(\mathbf{h}) = \int_{\mathbb{R}^d} \left[ g(\mathbf{u} - \mathbf{s} - \mathbf{h}) - g(\mathbf{u} - \mathbf{s}) \right]^2 \, d\mathbf{u}
\]</span> Para demonstrar que o variograma depende apenas da separação <span class="math inline">\(\mathbf{h}\)</span> e não da localização <span class="math inline">\(\mathbf{s}\)</span>, fazemos uma mudança de variável.</p>
<p>Seja <span class="math inline">\(\mathbf{x} = \mathbf{u} - \mathbf{s}\)</span>. Então, <span class="math inline">\(d\mathbf{x} = d\mathbf{u}\)</span> e os limites de integração (<span class="math inline">\(\mathbb{R}^d\)</span>) permanecem inalterados.</p>
<p><span class="math inline">\(g(\mathbf{u} - \mathbf{s}) \rightarrow g(\mathbf{x})\)</span> e <span class="math inline">\(g(\mathbf{u} - \mathbf{s} - \mathbf{h}) \rightarrow g(\mathbf{x} - \mathbf{h})\)</span>,</p>
<p><span class="math display">\[2\gamma(\mathbf{h}) = \int_{\mathbb{R}^d} \left[ g(\mathbf{x} - \mathbf{h}) - g(\mathbf{x}) \right]^2 \, d\mathbf{x}\]</span></p>
<p>Esta equação demonstra que o variograma é a autoconvolução da diferença do kernel. A implicação teórica mais poderosa deste resultado é a garantia de validade:</p>
<p><strong>Teorema:</strong> Qualquer função <span class="math inline">\(g(\cdot)\)</span> que seja de quadrado integrável (<span class="math inline">\(\int g(\mathbf{x})^2 d\mathbf{x} &lt; \infty\)</span>) gera automaticamente um modelo de variograma matematicamente válido (condicionalmente negativo definido). Isto elimina a necessidade de verificar a positividade da matriz de covariância a posteriori.</p>
</section>
<section id="sec-anisotropia" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="sec-anisotropia"><span class="header-section-number">3.9</span> Anisotropia</h2>
<p>A hipótese de isotropia assume que a estrutura de dependência espacial do processo estocástico <span class="math inline">\(Y(\mathbf{s})\)</span> depende apenas da distância euclidiana entre os pontos, <span class="math inline">\(\|\mathbf{h}\|\)</span>, e não da direção do vetor de separação <span class="math inline">\(\mathbf{h}\)</span>. Isto implica que as isolinhas (ou isossuperfícies) do variograma <span class="math inline">\(\gamma(\mathbf{h})\)</span> formam círculos (em <span class="math inline">\(\mathbb{R}^2\)</span>) ou esferas (em <span class="math inline">\(\mathbb{R}^3\)</span>).</p>
<p>Contudo, processos físicos geológicos e ambientais raramente são isotrópicos. A sedimentação, o fluxo de águas subterrâneas ou a dispersão eólica de poluentes criam direções preferenciais de continuidade. Quando a variabilidade espacial muda com a direção, o processo é denominado anisotrópico.</p>
<p>A modelagem da anisotropia não requer a criação de novas funções de variograma, mas sim a aplicação de transformações lineares afins sobre o sistema de coordenadas, mapeando o espaço anisotrópico original num espaço isotrópico equivalente. Classificamos a anisotropia em três categorias fundamentais: Geométrica, Zonal e Mista<span class="citation" data-cites="yamamoto2013geoestatistica">(<a href="references.html#ref-yamamoto2013geoestatistica" role="doc-biblioref">Yamamoto e Landim 2013</a>)</span>.</p>
<section id="anisotropia-geométrica" class="level3" data-number="3.9.1">
<h3 data-number="3.9.1" class="anchored" data-anchor-id="anisotropia-geométrica"><span class="header-section-number">3.9.1</span> Anisotropia Geométrica</h3>
<p>A anisotropia geométrica ocorre quando o alcance (<span class="math inline">\(a\)</span>) da dependência espacial varia com a direção, mas o patamar (<span class="math inline">\(C_0 + C\)</span>) permanece constante em todas as direções. As isolinhas de semivariância formam elipses, cujos eixos principais correspondem às direções de maior e menor continuidade.</p>
<p>Seja <span class="math inline">\(\gamma_{iso}(h; a)\)</span> um modelo isotrópico com alcance <span class="math inline">\(a\)</span>. Num processo anisotrópico geométrico em <span class="math inline">\(\mathbb{R}^2\)</span>, definimos:</p>
<p><span class="math inline">\(a_{max}\)</span>: O alcance máximo (direção de maior continuidade).</p>
<p><span class="math inline">\(a_{min}\)</span>: O alcance mínimo (direção de menor variabilidade).</p>
<p><span class="math inline">\(\phi\)</span>: O ângulo de azimute da direção de maior continuidade.</p>
<p>A razão de anisotropia é definida como o escalar <span class="math inline">\(\lambda = a_{max} / a_{min} \ge 1\)</span> (ou o seu inverso, dependendo da convenção de software, aqui usaremos a definição de estiramento).</p>
<p>O objetivo é transformar o vetor de separação original <span class="math inline">\(\mathbf{h} = [h_x, h_y]^T\)</span> num vetor transformado <span class="math inline">\(\mathbf{h}'\)</span> tal que a estrutura se torne isotrópica com alcance padronizado (geralmente <span class="math inline">\(a_{min}\)</span> ou 1). Esta transformação <span class="math inline">\(\mathbf{h}' = \mathbf{A}\mathbf{h}\)</span> compõe-se de uma rotação e um escalonamento.</p>
<ul>
<li>Passo 1: Rotação</li>
</ul>
<p>Alinhamos o sistema de coordenadas com os eixos principais da anisotropia através da matriz de rotação <span class="math inline">\(\mathbf{R}(\phi)\)</span>:</p>
<p><span class="math display">\[\mathbf{R}(\phi) = \begin{bmatrix} \cos\phi &amp; \sin\phi \\ -\sin\phi &amp; \cos\phi \end{bmatrix}\]</span></p>
<ul>
<li>Passo 2: Escalonamento</li>
</ul>
<p>Reduzimos a distância ao longo do eixo maior para que corresponda à escala do eixo menor. A matriz de escalonamento <span class="math inline">\(\mathbf{S}\)</span> é:</p>
<p><span class="math display">\[\mathbf{S} = \begin{bmatrix} 1/\lambda &amp; 0 \\ 0 &amp; 1 \end{bmatrix} \quad \text{onde } \lambda = \frac{a_{max}}{a_{min}}\]</span></p>
<p>Esta operação comprime o eixo maior, transformando a elipse de alcance num círculo de raio <span class="math inline">\(a_{min}\)</span>.</p>
<ul>
<li>Passo 3: Variograma Anisotrópico</li>
</ul>
<p>O vetor transformado é <span class="math inline">\(\mathbf{h}' = \mathbf{S} \mathbf{R}(\phi) \mathbf{h}\)</span>. A matriz de transformação completa <span class="math inline">\(\mathbf{A}\)</span> é:</p>
<p><span class="math display">\[\mathbf{A} = \mathbf{S} \mathbf{R}(\phi) = \begin{bmatrix} \frac{\cos\phi}{\lambda} &amp; \frac{\sin\phi}{\lambda} \\ -\sin\phi &amp; \cos\phi \end{bmatrix}\]</span></p>
<p>O modelo de variograma anisotrópico <span class="math inline">\(\gamma_{aniso}(\mathbf{h})\)</span> é obtido avaliando o modelo isotrópico na norma do vetor transformado:</p>
<p><span class="math display">\[\gamma_{aniso}(\mathbf{h}) = \gamma_{iso}(\|\mathbf{A}\mathbf{h}\|; a_{min})\]</span></p>
<p>Como <span class="math inline">\(\mathbf{A}\)</span> é uma matriz não-singular, a transformação é bijectiva. Uma vez que <span class="math inline">\(\gamma_{iso}\)</span> é uma função condicionalmente negativa definida (CND) em <span class="math inline">\(\mathbb{R}^d\)</span>, a composição <span class="math inline">\(\gamma_{iso}(\|\mathbf{A}\cdot\|)\)</span> preserva a propriedade CND, garantindo que o modelo anisotrópico é válido para a krigagem <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>.</p>
</section>
<section id="anisotropia-zonal" class="level3" data-number="3.9.2">
<h3 data-number="3.9.2" class="anchored" data-anchor-id="anisotropia-zonal"><span class="header-section-number">3.9.2</span> Anisotropia Zonal</h3>
<p>A anisotropia zonal ocorre quando o patamar (variância total) varia consoante a direção. Isto é teoricamente problemático para a hipótese de estacionariedade de segunda ordem, pois implica que a covariância na origem <span class="math inline">\(C(\mathbf{0})\)</span> (a variância do processo) não é única.</p>
<p>Na prática, isto ocorre quando a variabilidade vertical é muito superior à horizontal, de tal forma que o variograma vertical atinge um patamar muito mais alto do que o horizontal, ou o variograma horizontal parece nunca atingir o patamar total do processo.</p>
<p>Para modelar a anisotropia zonal mantendo a validade do modelo, <span class="citation" data-cites="journel1976mining">Andre G. Journel e Huijbregts (<a href="references.html#ref-journel1976mining" role="doc-biblioref">1976</a>)</span> propõem decompor o processo <span class="math inline">\(Y(\mathbf{s})\)</span> na soma de processos independentes (estruturas aninhadas), onde alguns componentes atuam apenas em subespaços do domínio.</p>
<p>Seja <span class="math inline">\(\mathbf{h} = (h_x, h_y, h_z)\)</span>. O modelo é construído como:</p>
<p><span class="math display">\[\gamma(\mathbf{h}) = \gamma_{iso}(\|\mathbf{h}\|) + \gamma_{zonal}(|h_z|)\]</span></p>
<p>Onde:</p>
<p><span class="math inline">\(\gamma_{iso}(\|\mathbf{h}\|)\)</span>: É uma componente isotrópica (ou geometricamente anisotrópica) que contribui para a variabilidade em todas as direções.</p>
<p><span class="math inline">\(\gamma_{zonal}(|h_z|)\)</span>: É uma componente que depende apenas da distância vertical <span class="math inline">\(h_z\)</span>.</p>
<ul>
<li>Na direção vertical (<span class="math inline">\(h_x=0, h_y=0\)</span>), o vetor é <span class="math inline">\(\mathbf{h} = (0,0, h_z)\)</span>. O variograma total é:</li>
</ul>
<p><span class="math display">\[\gamma(0,0, h_z) = \gamma_{iso}(h_z) + \gamma_{zonal}(h_z)\]</span></p>
<p>O patamar nesta direção é a soma dos patamares das duas estruturas: <span class="math inline">\(C_{total} = C_{iso} + C_{zonal}\)</span>.</p>
<ul>
<li>Na direção horizontal (<span class="math inline">\(h_z=0\)</span>), o vetor é <span class="math inline">\(\mathbf{h} = (h_x, h_y, 0)\)</span>. Como <span class="math inline">\(\gamma_{zonal}(0) = 0\)</span> (por definição de variograma na origem), a equação reduz-se a:</li>
</ul>
<p><span class="math display">\[\gamma(h_x, h_y, 0) = \gamma_{iso}(\sqrt{h_x^2 + h_y^2}) + 0\]</span></p>
<p>O patamar aparente na horizontal é apenas <span class="math inline">\(C_{iso}\)</span>.</p>
<p>A componente <span class="math inline">\(\gamma_{zonal}\)</span> possui um alcance horizontal infinito. Modela-se como uma estrutura cujo alcance no plano <span class="math inline">\(xy\)</span> tende a <span class="math inline">\(\infty\)</span>, contribuindo para a variância total apenas quando existe separação vertical. Isto reflete a realidade de camadas sedimentares onde a variação litológica é intensa verticalmente, mas as propriedades persistem lateralmente por longas distâncias.</p>
</section>
<section id="anisotropia-mista-ou-combinada" class="level3" data-number="3.9.3">
<h3 data-number="3.9.3" class="anchored" data-anchor-id="anisotropia-mista-ou-combinada"><span class="header-section-number">3.9.3</span> Anisotropia Mista (ou Combinada)</h3>
<p>A anisotropia mista é a generalização que permite modelar sistemas complexos onde diferentes escalas de variação possuem diferentes direções de continuidade. Por exemplo, a microvariabilidade (curta distância) pode ser isotrópica, enquanto a tendência regional (longa distância) segue uma direção preferencial.</p>
<p>Assume-se que o processo <span class="math inline">\(Y(\mathbf{s})\)</span> é a soma de <span class="math inline">\(K\)</span> componentes ortogonais independentes (escalas espaciais), <span class="math inline">\(Y(\mathbf{s}) = \sum_{k=1}^K Y_k(\mathbf{s})\)</span>.</p>
<p>Pela propriedade de aditividade da variância de variáveis independentes, o variograma total é a soma dos variogramas individuais:</p>
<p><span class="math display">\[\gamma_{total}(\mathbf{h}) = \sum_{k=1}^{K} \gamma_k(\mathbf{h})\]</span></p>
<p>Cada estrutura <span class="math inline">\(\gamma_k(\mathbf{h})\)</span> pode ter a sua própria definição de anisotropia geométrica, com a sua própria matriz de transformação <span class="math inline">\(\mathbf{A}_k\)</span>. A equação geral para a anisotropia mista é (<span class="citation" data-cites="goovaerts1997geostatistics">(<a href="references.html#ref-goovaerts1997geostatistics" role="doc-biblioref">Goovaerts 1997</a>)</span>):</p>
<p><span class="math display">\[\gamma(\mathbf{h}) = C_0 + \sum_{k=1}^{K} C_k \cdot \rho_k\left( \|\mathbf{A}_k \mathbf{h}\| \right)\]</span></p>
<p>Onde:</p>
<p><span class="math inline">\(C_0\)</span> é feito pepita (geralmente isotrópico, pois é ruído); <span class="math inline">\(C_k\)</span> é contribuição da estrutura <span class="math inline">\(k\)</span>; <span class="math inline">\(\rho_k(\cdot)\)</span> é função de correlação básica; <span class="math inline">\(\mathbf{A}_k\)</span> é matriz de transformação específica para a estrutura <span class="math inline">\(k\)</span>.</p>
</section>
</section>
<section id="diagnóstico-da-anisotropia" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="diagnóstico-da-anisotropia"><span class="header-section-number">3.10</span> Diagnóstico da Anisotropia</h2>
<p>A anisotropia em um processo espacial <span class="math inline">\(Y(\mathbf{s})\)</span> manifesta-se quando a estrutura de dependência espacial varia consoante a direção. Como discutido na <a href="#sec-anisotropia" class="quarto-xref"><span>Seção 3.9</span></a>, a modelagem correta da anisotropia é crucial para garantir a precisão da predição espacial (krigagem) e a validade estatística das inferências. O diagnóstico da anisotropia envolve a detecção e a caracterização da dependência direcional, tipicamente através da análise de variogramas direcionais e mapas de variograma.</p>
<section id="variogramas-direcionais" class="level3" data-number="3.10.1">
<h3 data-number="3.10.1" class="anchored" data-anchor-id="variogramas-direcionais"><span class="header-section-number">3.10.1</span> Variogramas Direcionais</h3>
<p>A forma mais comum de diagnosticar a anisotropia é calcular variogramas experimentais <span class="math inline">\(\hat{\gamma}(\mathbf{h})\)</span> para diferentes direções do vetor de separação <span class="math inline">\(\mathbf{h}\)</span>. Em vez de considerar todas as distâncias omnidirecionais, restringimos o cálculo a pares de pontos cuja separação vetorial cai dentro de setores angulares específicos <span class="citation" data-cites="journel1976mining isaaks1989applied">(<a href="references.html#ref-journel1976mining" role="doc-biblioref">Andre G. Journel e Huijbregts 1976</a>; <a href="references.html#ref-isaaks1989applied" role="doc-biblioref">Isaaks, Srivastava, et al. 1989</a>)</span>.</p>
<p>Seja <span class="math inline">\(\theta\)</span> o ângulo de direção (<a href="https://pt.wikipedia.org/wiki/Azimute">azimute</a>) e <span class="math inline">\(\Delta\theta\)</span> a <a href="https://www.gdandtbasics.com/angularity/">tolerância angular</a> (meia-janela). O estimador do variograma direcional para a direção <span class="math inline">\(\theta\)</span> é dado por:</p>
<p><span class="math display">\[\hat{\gamma}(h, \theta) = \frac{1}{2|N(h, \theta)|} \sum_{(\mathbf{s}_i, \mathbf{s}_j) \in N(h, \theta)} (y(\mathbf{s}_i) - y(\mathbf{s}_j))^2\]</span></p>
<p>Onde <span class="math inline">\(N(h, \theta)\)</span> é o conjunto de pares de locais <span class="math inline">\((\mathbf{s}_i, \mathbf{s}_j)\)</span> tal que a distância <span class="math inline">\(\|\mathbf{s}_i - \mathbf{s}_j\| \approx h\)</span> e o ângulo do vetor <span class="math inline">\(\mathbf{s}_i - \mathbf{s}_j\)</span> está em <span class="math inline">\([\theta - \Delta\theta, \theta + \Delta\theta]\)</span>.</p>
<p>Tipicamente, calculam-se variogramas para quatro direções principais: <span class="math inline">\(0^\circ\)</span> (Norte-Sul), <span class="math inline">\(45^\circ\)</span> (Nordeste-Sudoeste), <span class="math inline">\(90^\circ\)</span> (Leste-Oeste) e <span class="math inline">\(135^\circ\)</span> (Sudeste-Noroeste) <span class="citation" data-cites="scalon2024analise">(<a href="references.html#ref-scalon2024analise" role="doc-biblioref">Scalon 2024</a>)</span>. A comparação visual destes variogramas permite identificar o tipo de anisotropia (ver seção <a href="#sec-anisotropia" class="quarto-xref"><span>Seção 3.9</span></a>):</p>
<ul>
<li><p>Anisotropia Geométrica: Se os variogramas atingem o mesmo patamar (<span class="math inline">\(C_0 + C\)</span>) mas com alcances diferentes (<span class="math inline">\(a(\theta)\)</span>), estamos perante uma anisotropia geométrica. O alcance varia com a direção segundo uma elipse.</p></li>
<li><p>Anisotropia Zonal: Se os variogramas estabilizam em patamares diferentes dependendo da direção, ou se numa direção específica o variograma não estabiliza (indicando uma tendência), temos anisotropia zonal.</p></li>
<li><p>Anisotropia mista se ocorre a anisotropia geometrica e zonal.</p></li>
</ul>
<p>Uma ferramenta visual poderosa para detetar anisotropia é o mapa de variograma ou superfície de variograma. Em vez de traçar curvas <span class="math inline">\(\gamma(h)\)</span> para direções discretas, representamos <span class="math inline">\(\hat{\gamma}(\mathbf{h})\)</span> como uma superfície em função das coordenadas do vetor de separação <span class="math inline">\(\mathbf{h} = (h_x, h_y)\)</span> <span class="citation" data-cites="goovaerts1997geostatistics">(<a href="references.html#ref-goovaerts1997geostatistics" role="doc-biblioref">Goovaerts 1997</a>)</span>.</p>
<p>O mapa é construído calculando a semivariância média para células de uma grelha no espaço dos vetores de separação. O centro do mapa corresponde a <span class="math inline">\(\mathbf{h} = (0,0)\)</span> (semivariância zero). As cores ou curvas de nível representam a magnitude de <span class="math inline">\(\gamma(\mathbf{h})\)</span>.</p>
<p><strong>Isotropia:</strong> é o contrario da anisotropia.Aqui, as curvas de nível formam círculos concêntricos em redor da origem.</p>
<ul>
<li><p>Anisotropia Geométrica: As curvas de nível formam elipses. O eixo maior da elipse no mapa de variograma corresponde à direção de menor variabilidade (maior continuidade), que é a direção do alcance máximo (<span class="math inline">\(a_{max}\)</span>). O eixo menor corresponde à direção de maior variabilidade (alcance mínimo <span class="math inline">\(a_{min}\)</span>).</p></li>
<li><p>Anisotropia Zonal: As curvas de nível não fecham ou mostram comportamentos muito distintos em direções ortogonais, indicando diferenças nos patamares.</p></li>
</ul>
<p>Para anisotropia geométrica, pode-se ajustar modelos teóricos aos variogramas direcionais experimentais e plotar os alcances estimados <span class="math inline">\(a(\theta)\)</span> num diagrama polar (<a href="https://en.wikipedia.org/wiki/Wind_rose">Rose Diagram</a>). A forma resultante deve aproximar-se de uma elipse descrita pela equação polar:</p>
<p><span class="math display">\[a(\theta) = \frac{a_{max} a_{min}}{\sqrt{a_{min}^2 \cos^2(\theta - \phi) + a_{max}^2 \sin^2(\theta - \phi)}}\]</span></p>
<p>Onde <span class="math inline">\(\phi\)</span> é o ângulo da direção de maior continuidade (eixo maior). Este diagnóstico permite estimar os parâmetros da transformação de coordenadas (rotação <span class="math inline">\(\phi\)</span> e razão de anisotropia <span class="math inline">\(\lambda = a_{max}/a_{min}\)</span>) necessários para corrigir a anisotropia e aplicar a krigagem num espaço isotrópico equivalente <span class="citation" data-cites="chiles2012geostatistics">(<a href="references.html#ref-chiles2012geostatistics" role="doc-biblioref">Chiles e Delfiner 2012</a>)</span>.</p>
</section>
</section>
<section id="sec-ajuste-diagnostico" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="sec-ajuste-diagnostico"><span class="header-section-number">3.11</span> Ajuste de Modelos de semivariograma</h2>
<p>A inferência da estrutura de dependência espacial é uma etapa crítica na geoestatística. Dado um conjunto de dados observados <span class="math inline">\(\mathbf{y} = (y(\mathbf{s}_1), \dots, y(\mathbf{s}_n))^\top\)</span>, em locais <span class="math inline">\(\mathbf{s}_1, \dots, \mathbf{s}_n\)</span>, o objetivo é estimar o vetor de parâmetros <span class="math inline">\(\boldsymbol{\theta}\)</span> (efeito pepita, patamar, alcance, suavidade) de um modelo de variograma teórico <span class="math inline">\(2\gamma(\mathbf{h}; \boldsymbol{\theta})\)</span> que descreva adequadamente o processo estocástico subjacente.</p>
<section id="mínimos-quadrados-ponderados" class="level3" data-number="3.11.1">
<h3 data-number="3.11.1" class="anchored" data-anchor-id="mínimos-quadrados-ponderados"><span class="header-section-number">3.11.1</span> Mínimos Quadrados Ponderados</h3>
<p>O método de mínimos quadrados ordinários é inadequada para o ajuste de variogramas devido à heterocedasticidade intrínseca dos estimadores. <span class="citation" data-cites="cressie1985fitting">Cressie (<a href="references.html#ref-cressie1985fitting" role="doc-biblioref">1985</a>)</span> formalizou a dedução da variância assintótica do estimador de Matheron, justificando a necessidade de pesos.</p>
<p>Assumindo que o campo aleatório <span class="math inline">\(Y(\mathbf{s})\)</span> é um processo Gaussiano estacionário. Definamos a variável aleatória da diferença entre dois pontos separados pelo vetor <span class="math inline">\(\mathbf{h}\)</span> como <span class="math inline">\(D(\mathbf{h}) = Y(\mathbf{s} + \mathbf{h}) - Y(\mathbf{s})\)</span>, pela hipótese estacionaridade intrínseca, esta diferença tem média zero e variância definida pelo variograma teórico: <span class="math inline">\(D(\mathbf{h}) \sim \mathcal{N}(0, 2\gamma(\mathbf{h}))\)</span>. O estimador de variograma baseia-se no quadrado desta diferença. Vamos padronizar <span class="math inline">\(D(\mathbf{h})\)</span> dividindo pelo desvio padrão <span class="math inline">\(\sqrt{2\gamma(\mathbf{h})}\)</span> para obter uma normal padrão <span class="math inline">\(Y | X \sim \mathcal{N}(0,1)\)</span>:</p>
<p><span class="math display">\[\frac{D(\mathbf{h})}{\sqrt{2\gamma(\mathbf{h})}} \sim \mathcal{N}(0, 1)\]</span></p>
<p>Elevando ambos os lados ao quadrado, obtemos uma variável que segue uma distribuição Qui-quadrado com 1 grau de liberdade (<span class="math inline">\(\chi^2_1\)</span>):</p>
<p><span class="math display">\[\left( \frac{D(\mathbf{h})}{\sqrt{2\gamma(\mathbf{h})}} \right)^2 \sim \chi^2_1 \implies [D(\mathbf{h})]^2 \sim 2\gamma(\mathbf{h}) \cdot \chi^2_1\]</span></p>
<p>Sabemos que a variância de uma variável <span class="math inline">\(\chi^2_1\)</span> é exatamente 2. Usando a propriedade de variância <span class="math inline">\(\text{Var}(kX) = k^2 \text{Var}(X)\)</span>, a variância da diferença quadrática para um único par de pontos é:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Var}\left[ (Y(\mathbf{s}+\mathbf{h}) - Y(\mathbf{s}))^2 \right] &amp;= \text{Var}\left[ 2\gamma(\mathbf{h}) \cdot \chi^2_1 \right] \\
&amp;= [2\gamma(\mathbf{h})]^2 \cdot \text{Var}(\chi^2_1) \\
&amp;= 4[\gamma(\mathbf{h})]^2 \cdot 2 \\
&amp;= 8[\gamma(\mathbf{h})]^2
\end{aligned}
\]</span></p>
<p>O estimador do semivariograma <span class="math inline">\(\hat{\gamma}(\mathbf{h})\)</span> para um lag <span class="math inline">\(\mathbf{h}\)</span> é a média de <span class="math inline">\(N(\mathbf{h})\)</span> diferenças quadráticas, dividida por 2. Assumindo independência aproximada entre os pares (necessário para a derivação dos pesos <span class="citation" data-cites="cressie1985fitting">Cressie (<a href="references.html#ref-cressie1985fitting" role="doc-biblioref">1985</a>)</span>):</p>
<p><span class="math display">\[
\begin{aligned}
\text{Var}[\hat{\gamma}(\mathbf{h})] &amp;= \text{Var}\left[ \frac{1}{2 N(\mathbf{h})} \sum_{i=1}^{N(\mathbf{h})} (Y(\mathbf{s}_i) - Y(\mathbf{s}*j))^2 \right] \\
&amp;= \frac{1}{4 [N(\mathbf{h})]^2} \sum_{i=1}^{N(\mathbf{h})} \text{Var}\left[ (Y(\mathbf{s}_i) - Y(\mathbf{s}_j))^2 \right] \quad \text{(Soma de variâncias)} \\
&amp;= \frac{1}{4 [N(\mathbf{h})]^2} \cdot N(\mathbf{h}) \cdot 8[\gamma(\mathbf{h})]^2 \quad \text{(Substituindo o resultado anterior)} \\
&amp;= \frac{2[\gamma(\mathbf{h})]^2}{N(\mathbf{h})}
\end{aligned}
\]</span></p>
<p>Pelo princípio de Aitken, os pesos ótimos são o inverso da variância (<span class="math inline">\(w_k = 1/\text{Var}_k\)</span>) <span class="citation" data-cites="mcbratney1986choosing cressie1985fitting">(<a href="references.html#ref-mcbratney1986choosing" role="doc-biblioref">McBratney e Webster 1986</a>; <a href="references.html#ref-cressie1985fitting" role="doc-biblioref">Cressie 1985</a>)</span>. Ignorando a constante 2 (que não afeta a minimização) temos, <span class="math inline">\(w_k = \frac{N(\mathbf{h}_k)}{[\gamma(\mathbf{h}_k \boldsymbol{\theta})]^2}\)</span>. Substituindo os pesos na soma dos erros quadráticos, obtemos a função a ser minimizada para encontrar <span class="math inline">\(\boldsymbol{\theta}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\boldsymbol{\theta}}_{WLS} &amp;= \arg \min_{\boldsymbol{\theta}} \sum_{k=1}^{K} w(\mathbf{h}_k) \left[ \hat{\gamma}(\mathbf{h}_k) - \gamma(\mathbf{h}_k; \boldsymbol{\theta}) \right]^2, \quad   w(\mathbf{h}_k) = \frac{|N(\mathbf{h}_k)|}{[\gamma(\mathbf{h}_k; \boldsymbol{\theta})]^2}
\end{aligned}
\]</span></p>
<p>onde <span class="math inline">\(K\)</span> é número total de lags (classes de distância) considerados; <span class="math inline">\(N(\mathbf{h}_k)\)</span> é número de pares de pontos no lag <span class="math inline">\(k\)</span>. <span class="math inline">\(\hat{\gamma}(\mathbf{h}_k)\)</span> é o valor do semivariograma experimental (observado); <span class="math inline">\(\gamma(\mathbf{h}_k; \boldsymbol{\theta})\)</span> é o valor do modelo teórico (predito); <span class="math inline">\([\gamma(\mathbf{h}_k; \boldsymbol{\theta})]^{-2}\)</span> (implícito no denominador) penaliza fortemente erros em distâncias curtas (onde <span class="math inline">\(\gamma\)</span> é pequeno), garantindo que o modelo se ajuste bem na origem, o que é crucial para a Krigagem.</p>
</section>
</section>
<section id="mínimos-quadrados-generalizados-explícitos-glse" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="mínimos-quadrados-generalizados-explícitos-glse"><span class="header-section-number">3.12</span> Mínimos Quadrados Generalizados Explícitos (GLSE)</h2>
<p>O método de mínimos quadrados ponderados (WLS) pressupõe que as estimativas do variograma em diferentes lags são estatisticamente independentes (<span class="math inline">\(\text{Cov}(\hat{\gamma}(\mathbf{h}_i), \hat{\gamma}(\mathbf{h}_j)) = 0\)</span> para <span class="math inline">\(i \neq j\)</span>). Na realidade, como os mesmos dados espaciais são reutilizados para calcular múltiplos lags, existe uma correlação significativa entre eles. <span class="citation" data-cites="genton1998variogram">Genton (<a href="references.html#ref-genton1998variogram" role="doc-biblioref">1998</a>)</span> formalizou o problema como um ajuste de Mínimos Quadrados Generalizados, deduzindo a matriz de covariância completa <span class="math inline">\(\boldsymbol{\Sigma}_{\hat{\gamma}}\)</span> dos estimadores.</p>
<p>Para deduzir a covariância entre dois estimadores do variograma, reescrevemos primeiro o estimador de Matheron em notação matricial. Seja <span class="math inline">\(\mathbf{y}\)</span> o vetor de observações e <span class="math inline">\(\mathbf{A}(\mathbf{h})\)</span> a matriz de incidência espacial para o lag <span class="math inline">\(\mathbf{h}\)</span> (uma matriz esparsa que seleciona os pares de pontos separados por <span class="math inline">\(\mathbf{h}\)</span>). O estimador pode ser expresso como uma forma quadrática:</p>
<p><span class="math display">\[2\hat{\gamma}(\mathbf{h}) = \frac{1}{|N(\mathbf{h})|} \mathbf{y}^\top \mathbf{A}(\mathbf{h}) \mathbf{y}\]</span></p>
<p>A matriz <span class="math inline">\(\mathbf{A}(\mathbf{h})\)</span> é definida tal que <span class="math inline">\(\mathbf{y}^\top \mathbf{A}(\mathbf{h}) \mathbf{y} = \sum_{(\mathbf{s}_i, \mathbf{s}_j) \in N(\mathbf{h})} (y(\mathbf{s}_i) - y(\mathbf{s}_j))^2\)</span>.</p>
<p>Para calcular a covariância entre as estimativas em dois lags distintos, <span class="math inline">\(\mathbf{h}_u\)</span> e <span class="math inline">\(\mathbf{h}_v\)</span>, recorremos a um teorema fundamental para formas quadráticas de vetores Gaussianos. Se <span class="math inline">\(\mathbf{y} \sim \mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma}_y)\)</span>, então a covariância entre duas formas quadráticas <span class="math inline">\(\mathbf{y}^\top \mathbf{A} \mathbf{y}\)</span> e <span class="math inline">\(\mathbf{y}^\top \mathbf{B} \mathbf{y}\)</span> é dada por:</p>
<p><span class="math display">\[\text{Cov}(\mathbf{y}^\top \mathbf{A} \mathbf{y}, \mathbf{y}^\top \mathbf{B} \mathbf{y}) = 2 \text{tr}(\mathbf{A} \boldsymbol{\Sigma}_y \mathbf{B} \boldsymbol{\Sigma}_y) + 4\boldsymbol{\mu}^\top \mathbf{A} \boldsymbol{\Sigma}_y \mathbf{B} \boldsymbol{\mu}\]</span></p>
<p>Assumindo um processo de média zero (ou trabalhando com resíduos), o termo da média anula-se. Aplicando este teorema às matrizes de incidência espacial <span class="math inline">\(\mathbf{A}(\mathbf{h}_u)\)</span> e <span class="math inline">\(\mathbf{A}(\mathbf{h}_v)\)</span>, obtemos a covariância entre os estimadores do variograma (elemento <span class="math inline">\(uv\)</span> da matriz <span class="math inline">\(\boldsymbol{\Sigma}_{\hat{\gamma}}\)</span>):</p>
<p><span class="math display">\[\begin{aligned}
[\boldsymbol{\Sigma}_{\hat{\gamma}}]_{uv} &amp;= \text{Cov}(2\hat{\gamma}(\mathbf{h}_u), 2\hat{\gamma}(\mathbf{h}_v)) \\
&amp;= \text{Cov}\left( \frac{1}{|N(\mathbf{h}_u)|} \mathbf{y}^\top \mathbf{A}(\mathbf{h}_u) \mathbf{y}, \frac{1}{|N(\mathbf{h}_v)|} \mathbf{y}^\top \mathbf{A}(\mathbf{h}_v) \mathbf{y} \right) \\
&amp;= \frac{1}{|N(\mathbf{h}_u)| |N(\mathbf{h}_v)|} \text{Cov}(\mathbf{y}^\top \mathbf{A}(\mathbf{h}_u) \mathbf{y}, \mathbf{y}^\top \mathbf{A}(\mathbf{h}_v) \mathbf{y}) \\
&amp;= \frac{2}{|N(\mathbf{h}_u)| |N(\mathbf{h}_v)|} \text{tr}\left( \mathbf{A}(\mathbf{h}_u) \boldsymbol{\Sigma}_y(\boldsymbol{\theta}) \mathbf{A}(\mathbf{h}_v) \boldsymbol{\Sigma}_y(\boldsymbol{\theta}) \right)
\end{aligned}\]</span></p>
<p>A matriz <span class="math inline">\(\boldsymbol{\Sigma}_{\hat{\gamma}}\)</span> captura explicitamente a interdependência estatística entre os lags, dependendo tanto da geometria da amostragem (via matrizes <span class="math inline">\(\mathbf{A}\)</span>) quanto da estrutura de covariância real dos dados (<span class="math inline">\(\boldsymbol{\Sigma}_y(\boldsymbol{\theta})\)</span>).</p>
<p>A função objetivo a ser minimizada no método GLSE, que leva em conta esta estrutura de correlação completa, é a distância de Mahalanobis entre o vetor de estimativas empíricas <span class="math inline">\(\hat{\boldsymbol{\gamma}}\)</span> e o vetor do modelo teórico <span class="math inline">\(\boldsymbol{\gamma}(\boldsymbol{\theta})\)</span>:</p>
<p><span class="math display">\[\begin{aligned}
\hat{\boldsymbol{\theta}}_{GLSE} &amp;= \arg \min_{\boldsymbol{\theta}} (\hat{\boldsymbol{\gamma}} - \boldsymbol{\gamma}(\boldsymbol{\theta}))^\top [\boldsymbol{\Sigma}_{\hat{\gamma}}(\boldsymbol{\theta})]^{-1} (\hat{\boldsymbol{\gamma}} - \boldsymbol{\gamma}(\boldsymbol{\theta}))
\end{aligned}\]</span></p>
<p>onde <span class="math inline">\(\hat{\boldsymbol{\gamma}}\)</span> é o vetor contendo as estimativas <span class="math inline">\(\hat{\gamma}(\mathbf{h}_k)\)</span> para todos os <span class="math inline">\(K\)</span> lags; <span class="math inline">\(\boldsymbol{\gamma}(\boldsymbol{\theta})\)</span> é o vetor correspondente dos valores teóricos; <span class="math inline">\([\boldsymbol{\Sigma}_{\hat{\gamma}}(\boldsymbol{\theta})]^{-1}\)</span> é a inversa da matriz de covariância dos estimadores, que atua como uma matriz de pesos generalizada, penalizando não apenas a variância (elementos diagonais, como no WLS), mas também a redundância de informação entre lags correlacionados (elementos fora da diagonal). Este método é iterativo, pois a matriz de pesos depende dos próprios parâmetros <span class="math inline">\(\boldsymbol{\theta}\)</span> que estamos a estimar.</p>
<section id="métodos-de-máxima-verossimilhança-ml-e-máxima-verossimilhança-restrita-reml" class="level3" data-number="3.12.1">
<h3 data-number="3.12.1" class="anchored" data-anchor-id="métodos-de-máxima-verossimilhança-ml-e-máxima-verossimilhança-restrita-reml"><span class="header-section-number">3.12.1</span> Métodos de Máxima Verossimilhança (ML) e Máxima Verossimilhança Restrita (REML)</h3>
<p>Enquanto o método dos Mínimos Quadrados Ponderados (WLS) minimiza a distância entre o variograma experimental e o modelo teórico, os métodos baseados em verossimilhança operam diretamente sobre o vetor de dados observados <span class="math inline">\(\mathbf{y(s)}\)</span>, sem a necessidade de calcular estatísticas intermédias (como a semivariância experimental). <span class="citation" data-cites="lark2000estimating">Lark (<a href="references.html#ref-lark2000estimating" role="doc-biblioref">2000</a>)</span> e <span class="citation" data-cites="diggle1998model">Diggle, Tawn, e Moyeed (<a href="references.html#ref-diggle1998model" role="doc-biblioref">1998</a>)</span> argumentam que esta abordagem é teoricamente mais eficiente, especialmente quando os dados são escassos ou a amostragem é irregular, pois utiliza toda a informação contida na distribuição conjunta dos dados.</p>
<p>Assuma-se que o campo aleatório <span class="math inline">\(Y(\mathbf{s})\)</span> segue um modelo linear misto, composto por uma tendência determinística (<span class="math inline">\(\mathbf{X}\boldsymbol{\beta}\)</span> - média ) e um componente estocástico espacialmente correlacionado (<span class="math inline">\(\boldsymbol{\eta}\)</span>). Seja <span class="math inline">\(\mathbf{y} = (y(\mathbf{s}_1), \dots, y(\mathbf{s}_n))^\top\)</span> o vetor de observações:</p>
<p><span class="math display">\[\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\eta}\]</span></p>
<p>onde <span class="math inline">\(\mathbf{X}\)</span> é a matriz de desenho (<span class="math inline">\(n \times p\)</span>) contendo as covariáveis (coordenadas, elevação, etc.); <span class="math inline">\(\boldsymbol{\beta}\)</span> é o vetor (<span class="math inline">\(p \times 1\)</span>) de parâmetros de tendência desconhecidos (efeitos fixos) e, <span class="math inline">\(\boldsymbol{\eta}\)</span> é o vetor de resíduos aleatórios, assumido seguir uma distribuição normal multivariada com média zero e matriz de covariância <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta})\)</span>.</p>
<p>A matriz de covariância <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta})\)</span> é parametrizada pelo vetor <span class="math inline">\(\boldsymbol{\theta}\)</span> (alcance, patamar, efeito pepita) que desejamos estimar. O elemento <span class="math inline">\((i,j)\)</span> desta matriz é dado por:</p>
<p><span class="math display">\[[\mathbf{V}(\boldsymbol{\theta})]_{ij} = \text{Cov}(Y(\mathbf{s}_i), Y(\mathbf{s}_j)) = C(\mathbf{s}_i - \mathbf{s}_j; \boldsymbol{\theta})\]</span></p>
<p>A função de densidade de probabilidade conjunta para o vetor <span class="math inline">\(\mathbf{y(s)}\)</span>, dado os parâmetros <span class="math inline">\(\boldsymbol{\beta}\)</span> e <span class="math inline">\(\boldsymbol{\theta}\)</span>, é:</p>
<p><span class="math display">\[f(\mathbf{y} | \boldsymbol{\beta}, \boldsymbol{\theta}) = (2\pi)^{-n/2} |\mathbf{V}(\boldsymbol{\theta})|^{-1/2} \exp\left( -\frac{1}{2} (\mathbf{y} - \mathbf{X}\boldsymbol{\beta})^\top \mathbf{V}(\boldsymbol{\theta})^{-1} (\mathbf{y} - \mathbf{X}\boldsymbol{\beta}) \right)\]</span></p>
<p>A função de log-verossimilhança (<span class="math inline">\(L_{ML}\)</span>) é o logaritmo natural desta densidade. Para estimar <span class="math inline">\(\boldsymbol{\theta}\)</span>, primeiro perfilamos a verossimilhança em relação a <span class="math inline">\(\boldsymbol{\beta}\)</span>. O estimador de Máxima Verossimilhança para <span class="math inline">\(\boldsymbol{\beta}\)</span>, fixado <span class="math inline">\(\boldsymbol{\theta}\)</span>, é o estimador de Mínimos Quadrados Generalizados (GLS):</p>
<p><span class="math display">\[\hat{\boldsymbol{\beta}}_{GLS} = (\mathbf{X}^\top \mathbf{V}(\boldsymbol{\theta})^{-1} \mathbf{X})^{-1} \mathbf{X}^\top \mathbf{V}(\boldsymbol{\theta})^{-1} \mathbf{y}\]</span></p>
<p>Substituindo <span class="math inline">\(\hat{\boldsymbol{\beta}}_{GLS}\)</span> na equação da densidade, obtemos a verossimilhança perfilada a ser maximizada em relação a <span class="math inline">\(\boldsymbol{\theta}\)</span>:</p>
<p><span class="math display">\[\begin{aligned}
L_{ML}(\boldsymbol{\theta}) &amp;= -\frac{n}{2}\ln(2\pi) - \frac{1}{2}\ln|\mathbf{V}(\boldsymbol{\theta})| - \frac{1}{2}(\mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}_{GLS})^\top \mathbf{V}(\boldsymbol{\theta})^{-1} (\mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}_{GLS})
\end{aligned}\]</span></p>
<p><span class="citation" data-cites="cressie1993statistics">Cressie (<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">1993</a>)</span> e <span class="citation" data-cites="marchant2007robust">Marchant e Lark (<a href="references.html#ref-marchant2007robust" role="doc-biblioref">2007</a>)</span> destacam que existe uma tendência nos dados (<span class="math inline">\(\mu(\mathbf{s}) \neq \text{constante}\)</span>), o estimador de Máxima Verossimilhança (ML) subestima a variância e o variograma, pois assume que os parâmetros da tendência (<span class="math inline">\(\boldsymbol{\beta}\)</span>) são conhecidos, ignorando os graus de liberdade perdidos na sua estimação.</p>
<p>Para corrigir este viés, utiliza-se a Máxima Verossimilhança Restrita (REML).</p>
<p>Seja <span class="math inline">\(\mathbf{K}\)</span> uma matriz de contrastes de dimensão <span class="math inline">\(n \times (n-p)\)</span> tal que suas colunas geram o espaço ortogonal ao espaço das colunas de <span class="math inline">\(\mathbf{X}\)</span>.</p>
<p><span class="math display">\[\mathbf{K}^\top \mathbf{X} = \mathbf{0} \quad \text{e} \quad \text{posto}(\mathbf{K}) = n-p\]</span></p>
<p>Definimos o vetor de contrastes de erro transformados como <span class="math inline">\(\mathbf{w} = \mathbf{K}^\top \mathbf{y}\)</span>. A distribuição de <span class="math inline">\(\mathbf{w}\)</span> depende apenas de <span class="math inline">\(\boldsymbol{\theta}\)</span> e não de <span class="math inline">\(\boldsymbol{\beta}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
E[\mathbf{w}] &amp;= E[\mathbf{K}^\top (\mathbf{X}\boldsymbol{\beta} + \boldsymbol{\eta})] = \mathbf{K}^\top \mathbf{X} \boldsymbol{\beta} + \mathbf{K}^\top E[\boldsymbol{\eta}] = \mathbf{0} \cdot \boldsymbol{\beta} + \mathbf{0} = \mathbf{0} \\
\text{Var}[\mathbf{w}] &amp;= \mathbf{K}^\top \text{Var}[\mathbf{y}] \mathbf{K} = \mathbf{K}^\top \mathbf{V}(\boldsymbol{\theta}) \mathbf{K}
\end{aligned}
\]</span></p>
<p>A log-verossimilhança baseada nestes contrastes (Verossimilhança Restrita) é:</p>
<p><span class="math display">\[L_R(\boldsymbol{\theta}) = -\frac{1}{2} \ln|\mathbf{K}^\top \mathbf{V}(\boldsymbol{\theta}) \mathbf{K}| - \frac{1}{2} \mathbf{w}^\top (\mathbf{K}^\top \mathbf{V}(\boldsymbol{\theta}) \mathbf{K})^{-1} \mathbf{w} + \text{constante}\]</span></p>
<p>A implementação computacional direta desta fórmula é ineficiente devido à necessidade de construir a matriz <span class="math inline">\(\mathbf{K}\)</span>. Contudo, <span class="citation" data-cites="harville1977maximum">Harville (<a href="references.html#ref-harville1977maximum" role="doc-biblioref">1977</a>)</span> provou duas identidades algébricas fundamentais que relacionam os componentes da verossimilhança restrita com as matrizes originais:</p>
<ol type="1">
<li>Identidade do Determinante: <span class="math inline">\(\ln|\mathbf{K}^\top \mathbf{V} \mathbf{K}| = \ln|\mathbf{V}| + \ln|\mathbf{X}^\top \mathbf{V}^{-1} \mathbf{X}| - \ln|\mathbf{X}^\top \mathbf{X}| - 2\ln|\mathbf{K}|\)</span></li>
</ol>
<p>Ignorando os termos que não dependem de <span class="math inline">\(\boldsymbol{\theta}\)</span> (<span class="math inline">\(\mathbf{X}\)</span> e <span class="math inline">\(\mathbf{K}\)</span> são fixos), o termo relevante é <span class="math inline">\(\ln|\mathbf{V}| + \ln|\mathbf{X}^\top \mathbf{V}^{-1} \mathbf{X}|\)</span>.</p>
<ol start="2" type="1">
<li>Identidade da Forma Quadrática: <span class="math inline">\(\mathbf{w}^\top (\mathbf{K}^\top \mathbf{V} \mathbf{K})^{-1} \mathbf{w} = (\mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}_{GLS})^\top \mathbf{V}^{-1} (\mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}_{GLS})\)</span></li>
</ol>
<p>Isto demonstra que a forma quadrática nos contrastes é equivalente à soma ponderada dos quadrados dos resíduos GLS no espaço original.</p>
<p>Substituindo estas identidades na equação de <span class="math inline">\(L_R\)</span>, obtemos a função objetivo do REML apresentada por <span class="citation" data-cites="marchant2007robust">Marchant e Lark (<a href="references.html#ref-marchant2007robust" role="doc-biblioref">2007</a>)</span>:</p>
<p><span id="eq-REML"><span class="math display">\[
\begin{aligned}
L_{REML}(\boldsymbol{\theta}) \propto -\frac{1}{2} \Bigg( &amp; \underbrace{\ln|\mathbf{V}(\boldsymbol{\theta})|}_{\text{Ajuste da Covariância}} + \underbrace{(\mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}_{GLS})^\top \mathbf{V}(\boldsymbol{\theta})^{-1} (\mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}_{GLS})}_{\text{Ajuste aos Resíduos}} + \underbrace{\ln|\mathbf{X}^\top \mathbf{V}(\boldsymbol{\theta})^{-1} \mathbf{X}|}_{\text{Penalidade de Complexidade}} \Bigg)
\end{aligned}
\tag{3.11}\]</span></span></p>
<p>O termo adicional <span class="math inline">\(\ln|\mathbf{X}^\top \mathbf{V}^{-1} \mathbf{X}|\)</span> atua como uma penalidade. Quanto maior a incerteza na estimação da tendência (refletida na variância do estimador <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span>, que é proporcional a <span class="math inline">\((\mathbf{X}^\top \mathbf{V}^{-1} \mathbf{X})^{-1}\)</span>), maior será este termo logarítmico (pois estamos a tomar o log da inversa da variância, ou seja, da precisão/informação). Esta penalidade corrige a subestimação da variância inerente ao método ML, fornecendo estimativas não-viesadas para o variograma.</p>
</section>
<section id="reml-robusto" class="level3" data-number="3.12.2">
<h3 data-number="3.12.2" class="anchored" data-anchor-id="reml-robusto"><span class="header-section-number">3.12.2</span> REML Robusto</h3>
<p>O estimador REML padrão assume que os dados seguem uma distribuição Gaussiana. Consequentemente, a função de log-verossimilhança inclui um termo quadrático (a distância de Mahalanobis dos resíduos) que penaliza desvios em relação à média. Na presença de outliers (valores provenientes de um processo de contaminação com caudas pesadas), este termo quadrático cresce rapidamente, dominando a função de verossimilhança e forçando o modelo a inflacionar a variância (efeito pepita ou patamar) para acomodar os dados anómalos.</p>
<p><span class="citation" data-cites="marchant2007robust">Marchant e Lark (<a href="references.html#ref-marchant2007robust" role="doc-biblioref">2007</a>)</span>, baseando-se no trabalho de <span class="citation" data-cites="richardson1995robust">Richardson e Welsh (<a href="references.html#ref-richardson1995robust" role="doc-biblioref">1995</a>)</span>, propõem o REML Robusto, que substitui a norma <span class="math inline">\(L_2\)</span> (quadrática) por uma função de perda robusta (Huber) aplicada aos resíduos decorrelacionados.</p>
<p>Em dados geoestatísticos, os resíduos não são independentes; são correlacionados pela estrutura espacial <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta})\)</span>. Para aplicar uma função de robustez (que geralmente assume independência), é necessário primeiro decorrelacionar os resíduos. Seja o modelo linear misto <span class="math inline">\(\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\eta}\)</span>, com <span class="math inline">\(\boldsymbol{\eta} \sim N(\mathbf{0}, \mathbf{V}(\boldsymbol{\theta}))\)</span>. Definimos a raiz quadrada inversa da matriz de covariância, <span class="math inline">\(\mathbf{V}^{-1/2}\)</span>, tal que <span class="math inline">\(\mathbf{V}^{-1/2} \mathbf{V} (\mathbf{V}^{-1/2})^T = \mathbf{I}\)</span>.</p>
<p>O vetor de resíduos padronizados e decorrelacionados <span class="math inline">\(\boldsymbol{\epsilon}^*\)</span> é dado por:</p>
<p><span class="math display">\[\boldsymbol{\epsilon}^*(\boldsymbol{\beta}, \boldsymbol{\theta}) = \mathbf{V}(\boldsymbol{\theta})^{-1/2} (\mathbf{y} - \mathbf{X}\boldsymbol{\beta})\]</span></p>
<p>Desta forma, sob a hipótese nula (sem contaminação), <span class="math inline">\(\boldsymbol{\epsilon}^* \sim N(\mathbf{0}, \mathbf{I})\)</span>.</p>
<p>No REML padrão, <span class="math inline">\(\boldsymbol{\beta}\)</span> é estimado por GLS (<span class="math inline">\(\hat{\boldsymbol{\beta}}_{GLS}\)</span>), que minimiza a soma dos quadrados de <span class="math inline">\(\boldsymbol{\epsilon}^*\)</span>. No REML Robusto, <span class="math inline">\(\hat{\boldsymbol{\beta}}_{R}\)</span> é obtido minimizando uma função de perda robusta <span class="math inline">\(\rho_c\)</span> sobre estes resíduos transformados.</p>
<p>Dado um <span class="math inline">\(\boldsymbol{\theta}\)</span> fixo, <span class="math inline">\(\hat{\boldsymbol{\beta}}_{R}\)</span> é o vetor que minimiza:</p>
<p><span class="math display">\[Q_{\beta}(\boldsymbol{\beta}) = \sum_{i=1}^{n} \rho_c \left( [\mathbf{V}^{-1/2} (\mathbf{y} - \mathbf{X}\boldsymbol{\beta})]_i \right)\]</span></p>
<p>Onde <span class="math inline">\(\rho_c(\cdot)\)</span> é a função de Huber (definida abaixo). Esta etapa garante que a estimativa da tendência (média local) não seja “puxada” por valores extremos, fornecendo uma base estável para a estimativa da variância.</p>
<p>A função objetivo a ser minimizada para estimar <span class="math inline">\(\boldsymbol{\theta}\)</span> substitui o termo quadrático da verossimilhança restrita (Robust Estimation of a Location Parameter) pela soma dos escores de Huber dos resíduos decorrelacionados, calculados com base no <span class="math inline">\(\hat{\boldsymbol{\beta}}_{R}\)</span>.</p>
<p>A função objetivo negativa de log-verossimilhança robusta é definida como:</p>
<p><span class="math display">\[L_{Rob}(\boldsymbol{\theta}) = \underbrace{\frac{1}{2}\ln|\mathbf{V}(\boldsymbol{\theta})| + \frac{1}{2}\ln|\mathbf{X}^T \mathbf{V}(\boldsymbol{\theta})^{-1} \mathbf{X}|}_{\text{Penalidades de Complexidade e Viés (Inalteradas)}} + \underbrace{\sum_{i=1}^{n} \rho_c \left( \left[ \mathbf{V}(\boldsymbol{\theta})^{-1/2} (\mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}_{R}) \right]_i \right)}_{\text{Termo de Ajuste Robusto aos Resíduos}}\]</span></p>
<p>onde <span class="math inline">\(\mathbf{V}(\boldsymbol{\theta})^{-1/2}\)</span> garante que a métrica de distância considere a correlação espacial. Um outlier espacial não é apenas um valor alto, mas um valor que difere do que seria esperado dada a sua vizinhança. A decorrelação expõe estes valores. <span class="math inline">\(\hat{\boldsymbol{\beta}}_{R}\)</span> é o estimador robusto da tendência. Se usássemos o GLS padrão aqui, o viés na média propagar-se-ia para a variância. <span class="math inline">\(\rho_c(u)\)</span> (Função de Huber) é uma função híbrida que limita a influência de resíduos grandes. É definida por:</p>
<p><span class="math display">\[
\rho_c(u) = \begin{cases}
\frac{1}{2}u^2 &amp; \text{se } |u| \le c \\
c|u| - \frac{1}{2}c^2 &amp; \text{se } |u| &gt; c
\end{cases}
\]</span></p>
<p><span class="math inline">\(|u| \le c\)</span>, para resíduos pequenos (dados normais), o método comporta-se como o REML padrão (máxima eficiência estatística sob normalidade). <span class="math inline">\(|u| &gt; c\)</span>, para resíduos grandes (outliers), a penalidade cresce linearmente em vez de quadraticamente. Isso significa que a derivada da função de perda (a função de influência <span class="math inline">\(\psi(u)\)</span>) torna-se constante, limitando o peso que uma única observação anômala pode exercer sobre a estimativa dos parâmetros <span class="math inline">\(\boldsymbol{\theta}\)</span>; <span class="math inline">\(c\)</span> define o limiar entre dados normais e anómalos. Valores comuns situam-se entre <span class="math inline">\(1.345\)</span> e <span class="math inline">\(2.0\)</span>. <span class="citation" data-cites="marchant2007robust">Marchant e Lark (<a href="references.html#ref-marchant2007robust" role="doc-biblioref">2007</a>)</span> recomendam testar diferentes valores de <span class="math inline">\(c\)</span> e selecionar aquele que minimiza o erro na validação cruzada, pois o grau de contaminação é desconhecido a priori.</p>
<p>Ao minimizar <span class="math inline">\(L_{Rob}(\boldsymbol{\theta})\)</span>, obtemos estimativas dos parâmetros do variograma (alcance, patamar) que representam a estrutura espacial dominante do processo <span class="math inline">\(Y(\mathbf{s})\)</span>, ignorando as perturbações locais causadas por contaminação.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(gt)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Calcular Variograma Experimental</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>v_exp <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Definir um modelo inicial (Chute inicial)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># psill = patamar parcial, range = alcance, nugget = efeito pepita</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>modelo_inicial <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">psill =</span> <span class="fl">0.5</span>, <span class="at">model =</span> <span class="st">"Sph"</span>, <span class="at">range =</span> <span class="dv">900</span>, <span class="at">nugget =</span> <span class="fl">0.1</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuste Automático (Mínimos Quadrados Ponderados - WLS)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>modelo_ajustado <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(v_exp, <span class="at">model =</span> modelo_inicial)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>modelo_ajustado<span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-ajuste-modelo-1" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ajuste-modelo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">psill</th>
<th style="text-align: right;">range</th>
<th style="text-align: right;">kappa</th>
<th style="text-align: right;">ang1</th>
<th style="text-align: right;">ang2</th>
<th style="text-align: right;">ang3</th>
<th style="text-align: right;">anis1</th>
<th style="text-align: right;">anis2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Nug</td>
<td style="text-align: right;">0.0506602</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sph</td>
<td style="text-align: right;">0.5906056</td>
<td style="text-align: right;">897.0044</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ajuste-modelo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.12: Ajuste do modelo teórico sobre o experimental usando WLS
</figcaption>
</figure>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(modelo_ajustado, <span class="at">maxdist =</span> <span class="fu">max</span>(v_exp<span class="sc">$</span>dist))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> v_exp, <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span>.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Modelo Esférico"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Nugget: "</span>, <span class="fu">round</span>(modelo_ajustado<span class="sc">$</span>psill[<span class="dv">1</span>], <span class="dv">3</span>),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">" | Sill Total: "</span>, <span class="fu">round</span>(<span class="fu">sum</span>(modelo_ajustado<span class="sc">$</span>psill), <span class="dv">3</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">" | Range: "</span>, <span class="fu">round</span>(modelo_ajustado<span class="sc">$</span>range[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distância"</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Semivariância"</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-ajuste-modelo-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ajuste-modelo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-ajuste-modelo-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ajuste-modelo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.13: Ajuste do modelo teórico sobre o experimental usando WLS
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-metodos_predicao" class="level2" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="sec-metodos_predicao"><span class="header-section-number">3.13</span> Métodos de Predição</h2>
<p>A predição espacial é o objetivo central da geoestatística: estimar o valor da variável regionalizada <span class="math inline">\(Y(\mathbf{s}_0)\)</span> num local não amostrado <span class="math inline">\(\mathbf{s}_0 \in D^G\)</span>, baseando-se nos valores observados <span class="math inline">\(\mathbf{y} = (y(\mathbf{s}_1), \dots, y(\mathbf{s}_n))^\top\)</span> em locais vizinhos. O método universalmente consagrado para esta tarefa é a Krigagem (termo cunhado por Matheron em homenagem a D.G. Krige).</p>
<p>A Krigagem é definida como o Melhor Estimador Linear Não Viciado (BLUE - Best Linear Unbiased Estimator) da variável <span class="math inline">\(Y(\mathbf{s}_0)\)</span>. Vamos decompor esta definição para compreender a sua fundamentação teórica <span class="citation" data-cites="cressie1993statistics wackernagel2003multivariate">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>; <a href="references.html#ref-wackernagel2003multivariate" role="doc-biblioref">Wackernagel 2003</a>)</span>.</p>
<ul>
<li>Estimador Linear: O preditor <span class="math inline">\(\hat{Y}(\mathbf{s}_0)\)</span> é uma combinação linear ponderada das observações disponíveis:</li>
</ul>
<p><span class="math display">\[
\hat{Y}(\mathbf{s}_0) = \sum_{i=1}^{n} \lambda_i Y(\mathbf{s}_i) = \boldsymbol{\lambda}^\top \mathbf{Y}
\]</span></p>
<p>onde <span class="math inline">\(\lambda_i\)</span> são os pesos atribuídos a cada observação <span class="math inline">\(Y(\mathbf{s}_i)\)</span> e <span class="math inline">\(\boldsymbol{\lambda} = (\lambda_1, \dots, \lambda_n)^\top\)</span> é o vetor de pesos. O objetivo da krigagem é determinar os pesos ótimos <span class="math inline">\(\lambda_i\)</span>.</p>
<ul>
<li>Não Viciado (Unbiasedness): Exige-se que, em média, o estimador não cometa erros sistemáticos. A esperança do erro de predição deve ser nula:</li>
</ul>
<p><span class="math display">\[
E[\hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0)] = 0 \implies E[\hat{Y}(\mathbf{s}_0)] = E[Y(\mathbf{s}_0)]
\]</span></p>
<p>Substituindo a forma linear:</p>
<p><span class="math display">\[E\left[ \sum_{i=1}^{n} \lambda_i Y(\mathbf{s}_i) \right] = \sum_{i=1}^{n} \lambda_i E[Y(\mathbf{s}_i)] = E[Y(\mathbf{s}_0)]\]</span></p>
<p>Esta condição impõe restrições sobre os pesos <span class="math inline">\(\lambda_i\)</span>, dependendo do modelo assumido para a média <span class="math inline">\(E[Y(\mathbf{s})]\)</span> (média constante, tendência polinomial, etc.).</p>
<ul>
<li>Melhor (Best - Minimum Variance): Entre todos os estimadores lineares não viciados possíveis (aqueles que satisfazem as condições acima), a krigagem escolhe aquele que minimiza a variância do erro de predição (ou variância de estimação).</li>
</ul>
<p>O erro de estimação é <span class="math inline">\(\varepsilon = \hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0)\)</span>. A variância deste erro, que queremos minimizar, é:</p>
<p><span class="math display">\[
\sigma_E^2(\mathbf{s}_0) = \text{Var}(\hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0)) = E\left[ (\hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0))^2 \right]
\]</span></p>
<p>A minimização desta função objetivo quadrática em relação aos pesos <span class="math inline">\(\lambda_i\)</span>, sujeita às restrições de não enviesamento, é realizada através do método dos Multiplicadores de Lagrange, resultando no Sistema de Krigagem.</p>
<p>Para minimizar a variância do erro sob restrições lineares, construímos a função de Lagrange. A forma geral do sistema depende das suposições sobre a média <span class="math inline">\(\mu(\mathbf{s})\)</span>. Contudo, a estrutura fundamental deriva da expansão da variância do erro em termos da covariância espacial <span class="math inline">\(C(\mathbf{h})\)</span> ou do variograma <span class="math inline">\(\gamma(\mathbf{h})\)</span>.</p>
<p><span id="eq-varerro"><span class="math display">\[
\begin{aligned}
\sigma_E^2 &amp;= \text{Var}\left( \sum_{i=1}^n \lambda_i Y(\mathbf{s}_i) - Y(\mathbf{s}_0) \right) \\
&amp;= \text{Var}\left( \sum_{i=1}^n \lambda_i Y(\mathbf{s}_i) \right) + \text{Var}(Y(\mathbf{s}_0)) - 2\text{Cov}\left( \sum_{i=1}^n \lambda_i Y(\mathbf{s}_i), Y(\mathbf{s}_0) \right) \\
&amp;= \sum_{i=1}^n \sum_{j=1}^n \lambda_i \lambda_j C(\mathbf{s}_i, \mathbf{s}_j) + C(0) - 2 \sum_{i=1}^n \lambda_i C(\mathbf{s}_i, \mathbf{s}_0)
\end{aligned}
\tag{3.12}\]</span></span> onde <span class="math inline">\(C(\mathbf{s}_i, \mathbf{s}_j) = \text{Cov}(Y(\mathbf{s}_i), Y(\mathbf{s}_j))\)</span> é a covariância entre dados, e <span class="math inline">\(C(0) = \sigma^2\)</span> é a variância a priori do processo <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>.</p>
<p>A minimização desta expressão (com restrições) conduz a um sistema de equações lineares da forma <span class="math inline">\(\mathbf{A}\mathbf{x} = \mathbf{b}\)</span>, onde:</p>
<ul>
<li><p><span class="math inline">\(\mathbf{A}\)</span>: Matriz de covariâncias (ou variogramas) entre as observações amostrais (redundância de informação).</p></li>
<li><p><span class="math inline">\(\mathbf{x}\)</span>: Vetor das incógnitas (os pesos <span class="math inline">\(\lambda_i\)</span> e os multiplicadores de Lagrange).</p></li>
<li><p><span class="math inline">\(\mathbf{b}\)</span>: Vetor de covariâncias (ou variogramas) entre as observações e o ponto a estimar <span class="math inline">\(\mathbf{s}_0\)</span> (proximidade da informação).</p></li>
</ul>
<section id="krigagem-simples-ks" class="level3" data-number="3.13.1">
<h3 data-number="3.13.1" class="anchored" data-anchor-id="krigagem-simples-ks"><span class="header-section-number">3.13.1</span> Krigagem Simples (KS)</h3>
<p>A Krigagem Simples (KS) é a forma mais básica, assumindo que a média do processo <span class="math inline">\(E[Y(\mathbf{s})] = \mu\)</span> é conhecida e constante em todo o domínio <span class="citation" data-cites="journel1976mining">(<a href="references.html#ref-journel1976mining" role="doc-biblioref">Andre G. Journel e Huijbregts 1976</a>)</span>. Como a média <span class="math inline">\(\mu\)</span> é conhecida, o estimador baseia-se nos resíduos em relação à média:</p>
<p><span class="math display">\[\hat{Y}_{KS}(\mathbf{s}_0) = \mu + \sum_{i=1}^n \lambda_i (Y(\mathbf{s}_i) - \mu)\]</span></p>
<p><strong>Não enviesamento</strong></p>
<p>O estimador é não viciado por construção para quaisquer pesos <span class="math inline">\(\lambda_i\)</span>, pois <span class="math inline">\(E[Y(\mathbf{s}_i) - \mu] = 0\)</span>.</p>
<p><span class="math display">\[E[\hat{Y}_{KS}(\mathbf{s}_0) - Y(\mathbf{s}_0)] = \mu + \sum \lambda_i E[Y(\mathbf{s}_i) - \mu] - E[Y(\mathbf{s}_0)] = \mu + 0 - \mu = 0\]</span> Portanto, não existem restrições de soma de pesos (sem multiplicadores de Lagrange).</p>
<p><strong>Variância mínima</strong></p>
<p>Para minimizar <span class="math inline">\(\sigma_E^2\)</span> derivamos <a href="#eq-varerro" class="quarto-xref">Eq.&nbsp;<span>3.12</span></a> em relação a cada peso <span class="math inline">\(\lambda_k\)</span> (para <span class="math inline">\(k=1,\ldots, n\)</span>) e igualamos a zero:</p>
<ul>
<li>Derivada do termo linear:</li>
</ul>
<p><span class="math display">\[
  \frac{\partial}{\partial \lambda_k} \left( -2 \sum_{i=1}^n \lambda_i C(\mathbf{s}_i, \mathbf{s}_0) \right) = -2 C(\mathbf{s}_k, \mathbf{s}_0)
\]</span></p>
<ul>
<li>Derivada do termo quadrático (dupla soma):</li>
</ul>
<p>Aqui, a derivada gera dois termos idênticos devido à simetria da covariância e à regra do produto:</p>
<p><span class="math display">\[
  \frac{\partial}{\partial \lambda_k} \left( \sum_{i=1}^n \sum_{j=1}^n \lambda_i \lambda_j C(\mathbf{s}_i, \mathbf{s}_j) \right)   = \sum_{j=1}^n \lambda_j C(\mathbf{s}_k, \mathbf{s}_j) + \sum_{i=1}^n \lambda_i C(\mathbf{s}_i, \mathbf{s}_k)
\]</span> Como <span class="math inline">\(C(\mathbf{s}_i, \mathbf{s}_k) = C(\mathbf{s}_k, \mathbf{s}_i)\)</span>, as duas somas são iguais.</p>
<ul>
<li>A derivada de <span class="math inline">\(C(\mathbf{s}_0, \mathbf{s}_0)\)</span> (constante) é zero.</li>
</ul>
<p>Assim, temos:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial \sigma_E^2}{\partial \lambda_k} &amp;= \sum_{j=1}^n \lambda_j C(\mathbf{s}_k, \mathbf{s}_j) + \sum_{i=1}^n \lambda_i C(\mathbf{s}_i, \mathbf{s}_k) - 2C(\mathbf{s}_k, \mathbf{s}_0) = 0\\
&amp;\text{Como as duas somas são idênticas, podemos combiná-las}\\
2 \sum_{j=1}^n \lambda_j C_{kj} - 2C_{k0} &amp;= 0 \implies \sum_{j=1}^n \lambda_j C_{kj} = C_{k0}, \quad \forall k=1,\dots,n
\end{aligned}
\]</span></p>
<p>Em notação matricial: <span class="math inline">\(\mathbf{\Sigma} \boldsymbol{\lambda} = \mathbf{c}\)</span>, onde <span class="math inline">\(\mathbf{\Sigma}\)</span> é a matriz de covariância dados-dados e <span class="math inline">\(\mathbf{c}\)</span> é o vetor de covariância dados-alvo. A solução é: <span class="math inline">\(\boldsymbol{\lambda} = \mathbf{\Sigma}^{-1} \mathbf{c}\)</span>.</p>
<p>A Krigagem Simples é raramente usada na prática pois o conhecimento exato da média global <span class="math inline">\(\mu\)</span> é incomum. No entanto, é o fundamento teórico para métodos mais avançados como a Krigagem Gaussiana e Simulação condicional.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(stars, gstat, ggplot2, sf, patchwork, viridis)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse.area) </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>area_sf <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">as.matrix</span>(meuse.area))) <span class="sc">|&gt;</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="dv">28992</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Criar Grid de Predição </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Precisamos definir ONDE queremos estimar</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(area_sf) <span class="sc">|&gt;</span>       </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_stars</span>(<span class="at">dx =</span> <span class="dv">40</span>, <span class="at">dy =</span> <span class="dv">40</span>) <span class="sc">|&gt;</span>     <span class="co"># Define a resolução</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crop</span>(area_sf)                     <span class="co"># RECORTA usando o polígono</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajuste do Variograma</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>v_ord <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>m_ord <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(v_ord, <span class="fu">vgm</span>(<span class="fl">0.6</span>, <span class="st">"Sph"</span>, <span class="dv">900</span>, <span class="fl">0.05</span>))</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>media_conhecida <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">log</span>(meuse<span class="sc">$</span>zinc))</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Krigagem Simples</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado terá duas camadas: var1.pred e var1.var</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> <span class="fu">krige</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">locations =</span> meuse_sf, </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">newdata =</span> grid_pred, </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">model =</span> m_ord, </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">beta =</span> media_conhecida, <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa de Predição</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>ks_masked <span class="ot">&lt;-</span> ks[area_sf]</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> ks_masked, <span class="fu">aes</span>(<span class="at">fill =</span> var1.pred)) <span class="sc">+</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> area_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa de Variância (Erro)</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="co"># A variável de erro se chama 'var1.var'</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> ks_masked, <span class="fu">aes</span>(<span class="at">fill =</span> var1.var)) <span class="sc">+</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_sf</span>(<span class="at">data =</span> area_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># Contorno</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span> </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Var"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>p1; p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-krigagem_simples" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krigagem_simples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_simples" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krigagem_simples-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_simples-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_simples-1.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_simples">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_simples-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Predição
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_simples" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krigagem_simples-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_simples-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_simples-2.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_simples">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_simples-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Variância de krigagem
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krigagem_simples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.14: Krigagem simples
</figcaption>
</figure>
</div>
</section>
<section id="krigagem-ordinária-ko" class="level3" data-number="3.13.2">
<h3 data-number="3.13.2" class="anchored" data-anchor-id="krigagem-ordinária-ko"><span class="header-section-number">3.13.2</span> Krigagem Ordinária (KO)</h3>
<p>A Krigagem Ordinária (KO) assume que a média é constante (<span class="math inline">\(E[Y(\mathbf{s})] = \mu\)</span>) mas desconhecida <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>. O modelo deve estimar a média implicitamente localmente, adaptando-se a flutuações locais do nível da variável.</p>
<p>O estimador é uma combinação linear direta:</p>
<p><span class="math display">\[\hat{Y}_{KO}(\mathbf{s}_0) = \sum_{i=1}^n \lambda_i Y(\mathbf{s}_i)\]</span></p>
<p>Para garantir o não enviesamento sem conhecer <span class="math inline">\(\mu\)</span>:</p>
<p><span id="eq-restrição"><span class="math display">\[E[\hat{Y}_{KO}(\mathbf{s}_0)] = \sum \lambda_i E[Y(\mathbf{s}_i)] = \mu \sum \lambda_i = \mu \implies \sum_{i=1}^n \lambda_i = 1 \tag{3.13}\]</span></span></p>
<p>Para que o erro seja zero para qualquer <span class="math inline">\(\mu\)</span>, é necessário impor a restrição <span class="math inline">\(\sum_{i=1}^n \lambda_i = 1\)</span>.</p>
<p>A esperança na <a href="#eq-restrição" class="quarto-xref">Eq.&nbsp;<span>3.13</span></a> pode ser rescrita por:</p>
<p><span class="math display">\[E[\hat{Y}_{KO} - Y_0] = \sum \lambda_i E[Y_i] - E[Y_0] = \mu \sum \lambda_i - \mu = \mu \left( \sum_{i=1}^n \lambda_i - 1 \right)\]</span></p>
<p>Como nosso problema agora não é simplesmente encontrar o mínimo de $ _E^2(_1, …, _n)$, e sim, encontrar o mínimo sujeito a uma restrição, isto é,</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \underset{\lambda_1, \dots, \lambda_n}{\text{minimizar}}
&amp; &amp; \sigma_E^2(\lambda_1, ..., \lambda_n) \\
&amp; \text{sujeito a}
&amp; &amp; \sum_{i=1}^n \lambda_i - 1 = 0
\end{aligned}
\]</span> temos que somos obrigados a introduzir uma nova variável, o multiplicador <span class="math inline">\(\nu\)</span>, e criamos a função Lagrangiana <span class="math inline">\(L\)</span>, que combina a função objetivo original e a restrição. O fator 2 é pura conveniência algébrica, pois cancela o 2 que surgirá das derivadas, simplificando as equações finais.</p>
<p>O <a href="https://pt.wikipedia.org/wiki/Multiplicadores_de_Lagrange">Multiplicador de Lagrange</a> é a ferramenta matemática usada para transformar um problema de otimização com restrições em um problema de otimização sem restrições, facilitando a solução. Assim, temos:</p>
<p><span class="math display">\[
\begin{aligned}
L(\boldsymbol{\lambda}, \nu) &amp;= \sigma_E^2 + 2\nu \left( \sum_{i=1}^n \lambda_i - 1 \right)\\
L(\boldsymbol{\lambda}, \nu) &amp;= \sum_i \sum_j \lambda_i \lambda_j C_{ij} + C(0) - 2 \sum_i \lambda_i C_{i0} + 2\nu \left( \sum_i \lambda_i - 1 \right)
\end{aligned}
\]</span></p>
<p>Derivando em relação a <span class="math inline">\(\lambda_k\)</span> e <span class="math inline">\(\nu\)</span> obtemos:</p>
<ul>
<li><p><span class="math inline">\(\frac{\partial L}{\partial \lambda_k} = 2 \sum_{j=1}^n \lambda_j C_{kj} - 2 C_{k0} + 2\nu = 0 \implies \sum_{j=1}^n \lambda_j C_{kj} + \nu = C_{k0}\)</span></p></li>
<li><p><span class="math inline">\(\frac{\partial L}{\partial \nu} = 2 \left( \sum_{i=1}^n \lambda_i - 1 \right) = 0 \implies \sum_{i=1}^n \lambda_i = 1\)</span></p></li>
</ul>
<p>Isto resulta num sistema de Krigagem Ordinária equações:</p>
<p>O sistema de <span class="math inline">\((n+1)\)</span> equações resultante (em termos de covariograma <span class="math inline">\(C(\cdot)\)</span>) é:</p>
<p><span class="math display">\[\begin{cases}
\sum_{j=1}^n \lambda_j  C_{kj} + \nu = C_{k0}, &amp; i=1, \dots, n \\
\sum_{j=1}^n \lambda_j = 1
\end{cases}\]</span></p>
<p>Em notação matricial <span class="math inline">\(\mathbf{A}_{KO} \mathbf{x}_{KO} = \mathbf{b}_{KO}\)</span>:</p>
<p><span class="math display">\[
\begin{bmatrix}
C_{11} &amp; \dots &amp; C_{1n} &amp; 1 \\
\vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
C_{n1} &amp; \dots &amp; C_{nn} &amp; 1 \\
1 &amp; \dots &amp; 1 &amp; 0
\end{bmatrix}
\begin{bmatrix}
\lambda_1 \\ \vdots \\ \lambda_n \\ \nu
\end{bmatrix}
=
\begin{bmatrix}
C_{10} \\ \vdots \\ C_{n0} \\ 1
\end{bmatrix}
\]</span> A Krigagem Ordinária é robusta a tendências locais (drift) se a vizinhança de krigagem for restrita, pois reestima a média localmente em cada janela de busca.</p>
<p><strong>Variância de Krigagem</strong></p>
<p>Para obter a variância de krigagem ordinária <span class="math inline">\(\sigma_{KO}^2\)</span>, substituímos a relação de otimalidade (<span class="math inline">\(\sum \lambda_j C_{ij} = C_{i0} - \nu\)</span>) na expressão original da variância do erro:</p>
<p><span class="math display">\[
\begin{aligned}
\sigma_{KO}^2 &amp;= \sum_{i=1}^n \lambda_i \underbrace{\left( \sum_{j=1}^n \lambda_j C_{ij} \right)}_{C_{i0} - \nu} + C(0) - 2 \sum_{i=1}^n \lambda_i C_{i0} \\
&amp;= \sum_{i=1}^n \lambda_i (C_{i0} - \nu) + C(0) - 2 \sum_{i=1}^n \lambda_i C_{i0} \\
&amp;= \sum_{i=1}^n \lambda_i C_{i0} - \nu \underbrace{\sum_{i=1}^n \lambda_i}_{1} + C(0) - 2 \sum_{i=1}^n \lambda_i C_{i0} \\
&amp;= C(0) - \sum_{i=1}^n \lambda_i C_{i0} - \nu
\end{aligned}
\]</span></p>
<p>Em termos de variograma (<span class="math inline">\(\gamma (h)\)</span>), e usando a relação <span class="math inline">\(C(h) = C(0) - \gamma(h)\)</span>, a expressão equivalente é <span class="citation" data-cites="journel1976mining">(<a href="references.html#ref-journel1976mining" role="doc-biblioref">Andre G. Journel e Huijbregts 1976</a>)</span>:</p>
<p><span class="math display">\[\sigma_{KO}^2 = \sum_{i=1}^n \lambda_i \gamma(\mathbf{s}_i - \mathbf{s}_0) + \nu - \gamma(\mathbf{0})\]</span></p>
<p>Note-se que <span class="math inline">\(\nu\)</span> é o multiplicador de Lagrange, que pode ser interpretado como o custo em variância de não conhecermos a média verdadeira.</p>
<p>Se assumirmos que <span class="math inline">\(\gamma(\mathbf{0}) = 0\)</span> (o variograma teórico na origem é nulo, o efeito pepita <span class="math inline">\(C_0\)</span> é o limite quando <span class="math inline">\(h \to 0\)</span>), a expressão simplifica-se. Em termos matriciais:</p>
<p><span class="math display">\[\sigma_{KO}^2(\mathbf{s}_0) = \mathbf{b}_{KO}^\top \mathbf{x}_{KO} = \sum_{i=1}^n \lambda_i \gamma_{i0} + \nu\]</span></p>
<p>A variância de krigagem depende apenas da configuração geométrica das amostras e do modelo de variograma, mas não depende dos valores observados <span class="math inline">\(y(\mathbf{s}_i)\)</span> (propriedade de homocedasticidade da krigagem linear sob normalidade). O mapa de variância de krigagem reflete a densidade da amostragem:</p>
<ul>
<li><p>É zero nos locais amostrados (se não houver efeito pepita/erro de medição e usarmos krigagem exata).</p></li>
<li><p>Aumenta à medida que nos afastamos dos pontos de dados.</p></li>
<li><p>Depende da estrutura espacial: modelos com maior efeito pepita ou menor alcance resultam em maior incerteza de predição.</p></li>
</ul>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(stars, gstat, ggplot2, sf, patchwork, viridis, sp)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse.area) </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>area_sf <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">as.matrix</span>(meuse.area))) <span class="sc">|&gt;</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="dv">28992</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Criar Grid de Predição </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Precisamos definir ONDE queremos estimar</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(area_sf) <span class="sc">|&gt;</span>       </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_stars</span>(<span class="at">dx =</span> <span class="dv">40</span>, <span class="at">dy =</span> <span class="dv">40</span>) <span class="sc">|&gt;</span>     </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crop</span>(area_sf)                     </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Krigagem</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo_ajustado &lt;- vgm(0.5, "Sph", 900, 0.1)</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>krigagem <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">locations =</span> meuse_sf,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata   =</span> grid_pred,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">model     =</span> modelo_ajustado, <span class="at">debug.level =</span> <span class="dv">0</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co"># var1.pred = Valor Estimado </span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co"># var1.var = Variância de Krigagem (Erro)</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa 1: Predição</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> krigagem, <span class="fu">aes</span>(<span class="at">fill =</span> var1.pred)) <span class="sc">+</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> area_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># Contorno</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>, <span class="at">name =</span> <span class="st">"Log(Zinc)"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa 2: Variância (Erro)</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> krigagem, <span class="fu">aes</span>(<span class="at">fill =</span> var1.var)) <span class="sc">+</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> area_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>, <span class="at">name =</span> <span class="st">"Variância"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="co">#para colocar coordenadas</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>p1 ; p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-krigagem" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krigagem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krigagem-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem-1.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Predição
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krigagem-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem-2.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Variância de krigagem
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krigagem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.15: Krigagem Ordinária
</figcaption>
</figure>
</div>
</section>
<section id="krigagem-universal-ku" class="level3" data-number="3.13.3">
<h3 data-number="3.13.3" class="anchored" data-anchor-id="krigagem-universal-ku"><span class="header-section-number">3.13.3</span> Krigagem Universal (KU)</h3>
<p>Quando a média do processo não é constante, mas apresenta uma tendência sistemática (drift) que pode ser modelada como uma função determinística das coordenadas (ex: <span class="math inline">\(E[Y(\mathbf{s})] = \mu(\mathbf{s}) = \beta_0 + \beta_1 x + \beta_2 y\)</span>), utilizamos a Krigagem Universal (KU) <span class="citation" data-cites="matheron1971theory">(<a href="references.html#ref-matheron1971theory" role="doc-biblioref">George Matheron 1971</a>)</span>.</p>
<p>Assumimos que a média é uma combinação linear de <span class="math inline">\(L+1\)</span> funções de base conhecidas <span class="math inline">\(f_l(\mathbf{s})\)</span> (monómios):</p>
<p><span class="math display">\[\mu(\mathbf{s}) = \sum_{l=0}^L a_l f_l(\mathbf{s}), \quad \text{com } f_0(\mathbf{s}) \equiv 1\]</span> Isto pode ser reescrito como: <span class="math display">\[
\begin{aligned}
&amp;Y(\mathbf{s}) = \mu(\mathbf{s}) + \delta(\mathbf{s}), \quad \text{com } E[\delta(\mathbf{s})] = 0, \quad \text{Cov}(\delta(\mathbf{s}_i), \delta(\mathbf{s}_j)) = C(\mathbf{s}_i, \mathbf{s}_j)\\
&amp;\mu(\mathbf{s}) = \sum_{l=0}^{L} a_l f_l(\mathbf{s}), \quad f_0(\mathbf{s}) \equiv 1\\
&amp;\hat{Y}(\mathbf{s}_0) = \sum_{i=1}^n \lambda_i Y(\mathbf{s}_i)
\end{aligned}
\]</span> <strong>Condição de não enviesamento:</strong></p>
<p><span class="math display">\[
\begin{aligned}
E[\hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0)] &amp;= \sum_{i=1}^n \lambda_i \mu(\mathbf{s}_i) - \mu(\mathbf{s}_0)\\
&amp;= \sum_{i=1}^n \lambda_i \sum_{l=0}^L a_l f_l(\mathbf{s}_i) - \sum_{l=0}^L a_l f_l(\mathbf{s}_0)\\
&amp;= \sum_{l=0}^L a_l \left[ \sum_{i=1}^n \lambda_i f_l(\mathbf{s}_i) - f_l(\mathbf{s}_0) \right] \overset{!}{=} 0
\end{aligned}
\]</span></p>
<p>Como isto deve ser verdade para quaisquer coeficientes <span class="math inline">\(a_l\)</span> desconhecidos, os termos entre parênteses devem ser zero individualmente. Isto gera <span class="math inline">\(L+1\)</span> restrições:</p>
<p><span class="math display">\[\sum_{i=1}^n \lambda_i f_l(\mathbf{s}_i) = f_l(\mathbf{s}_0), \quad \text{para } l=0, \dots, L\]</span></p>
<p><strong>Variância do erro:</strong></p>
<p><span class="math display">\[
\begin{aligned}
\sigma_E^2 &amp;= \text{Var}\left(\hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0)\right)\\
&amp;= \text{Var}\left(\sum_{i=1}^n \lambda_i \delta(\mathbf{s}_i) - \delta(\mathbf{s}_0)\right)\\
&amp;= \sum_{i=1}^n \sum_{j=1}^n \lambda_i \lambda_j C(\mathbf{s}_i, \mathbf{s}_j) - 2\sum_{i=1}^n \lambda_i C(\mathbf{s}_i, \mathbf{s}_0) + C(\mathbf{s}_0, \mathbf{s}_0)
\end{aligned}
\]</span></p>
<p>De igual modo como feito na KO, introduzimos <span class="math inline">\(L+1\)</span> multiplicadores de Lagrange <span class="math inline">\(\nu_l\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
L(\boldsymbol{\lambda}, \boldsymbol{\nu}) &amp;= \sigma_E^2 - 2\sum_{l=0}^L \nu_l \left(\sum_{i=1}^n \lambda_i f_l(\mathbf{s}_i) - f_l(\mathbf{s}_0)\right)\\
&amp;= \sum_{i=1}^n\sum_{j=1}^n \lambda_i\lambda_j C_{ij} - 2\sum_{i=1}^n \lambda_i C_{i0} + C_{00} - 2\sum_{l=0}^L \nu_l\left(\sum_{i=1}^n \lambda_i f_{il} - f_{0l}\right)
\end{aligned}
\]</span> Para procedermos com a minimização da variância, novamente calculamos as derivadas em relação a <span class="math inline">\(\lambda_i\)</span> e <span class="math inline">\(\nu_l\)</span> :</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \lambda_k} &amp;= \frac{\partial}{\partial \lambda_k}\left(\sum_{i=1}^n\sum_{j=1}^n \lambda_i\lambda_j C_{ij}\right) - 2C_{k0} - 2\sum_{l=0}^L \nu_l f_{kl}\\
&amp;= \sum_{j=1}^n \lambda_j C_{kj} + \sum_{i=1}^n \lambda_i C_{ik} - 2C_{k0} - 2\sum_{l=0}^L \nu_l f_{kl}\\
2\sum_{j=1}^n \lambda_j C_{kj} - 2C_{k0} - 2\sum_{l=0}^L \nu_l f_{kl} &amp;=  0\\
\sum_{j=1}^n \lambda_j C_{kj} - \sum_{l=0}^L \nu_l f_l(\mathbf{s}_k) &amp;= C_{k0}, \quad k = 1,\dots,n
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \nu_l} = -2\left(\sum_{i=1}^n \lambda_i f_l(\mathbf{s}_i) - f_l(\mathbf{s}_0)\right) &amp;= 0\\
\sum_{i=1}^n \lambda_i f_l(\mathbf{s}_i) &amp;= f_l(\mathbf{s}_0), \quad l = 0,\dots,L
\end{aligned}
\]</span></p>
<p>Para a notação matricial definimos:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbf{C}_{nn} = [C_{ij}]_{n\times n}, \quad \mathbf{F}_{n\times(L+1)} = [f_l(\mathbf{s}_i)]\\
&amp;\mathbf{c}_{n0} = [C_{i0}]_{n\times 1}, \quad \mathbf{f}_{L0} = [f_l(\mathbf{s}_0)]_{(L+1)\times 1}\\
&amp;\boldsymbol{\lambda} = [\lambda_1, \dots, \lambda_n]^\top, \quad \boldsymbol{\nu} = [\nu_0, \dots, \nu_L]^\top
\end{aligned}
\]</span> e obtemos:</p>
<p><span class="math display">\[
\begin{bmatrix}
\mathbf{C}_{nn} &amp; -\mathbf{F} \\
-\mathbf{F}^\top &amp; \mathbf{0}
\end{bmatrix}
\begin{bmatrix}
\boldsymbol{\lambda} \\ \boldsymbol{\nu}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{c}_{n0} \\ -\mathbf{f}_{L0}
\end{bmatrix}
\]</span> É comum alguns autores definem <span class="math inline">\(\mu_l = -\nu_l\)</span>, obtendo:</p>
<p><span class="math display">\[
\begin{bmatrix}
\mathbf{C}_{nn} &amp; \mathbf{F} \\
\mathbf{F}^\top &amp; \mathbf{0}
\end{bmatrix}
\begin{bmatrix}
\boldsymbol{\lambda} \\ \boldsymbol{\mu}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{c}_{n0} \\ \mathbf{f}_{L0}
\end{bmatrix}
\]</span></p>
<p>Onde <span class="math inline">\(\mathbf{F}\)</span> contém os valores das funções de deriva nos pontos amostrais.</p>
<p>A variância mínima é dada por:</p>
<p><span class="math display">\[
\sigma_{\min}^2 = C_{00} - \sum_{i=1}^n \lambda_i C_{i0} + \sum_{l=0}^L \nu_l f_l(\mathbf{s}_0)
\]</span></p>
<p>A matriz <span class="math inline">\(\mathbf{C}_{nn}\)</span> deve representar a covariância dos resíduos <span class="math inline">\(\delta(\mathbf{s})\)</span>, não dos dados originais <span class="math inline">\(Y(\mathbf{s})\)</span>. Como os resíduos são desconhecidos, na prática estima-se frequentemente o variograma na direção ortogonal à tendência ou usa-se REML para estimar o variograma dos resíduos diretamente.</p>
<p>Quando <span class="math inline">\(L=0\)</span> (apenas <span class="math inline">\(f_0(\mathbf{s})=1\)</span>), recupera-se o sistema da KO com um multiplicador <span class="math inline">\(\nu_0\)</span>.</p>
<div id="fig-krigagem_Universal" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krigagem_Universal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_Universal" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krigagem_Universal-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_Universal-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_Universal-1.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_Universal">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_Universal-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Predição
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_Universal" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-krigagem_Universal-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_Universal-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_Universal-2.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_Universal">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_Universal-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Variância de krigagem
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krigagem_Universal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.16: Krigagem Universal
</figcaption>
</figure>
</div>
</section>
<section id="krigagem-com-deriva-externa-ked" class="level3" data-number="3.13.4">
<h3 data-number="3.13.4" class="anchored" data-anchor-id="krigagem-com-deriva-externa-ked"><span class="header-section-number">3.13.4</span> Krigagem com Deriva Externa (KED)</h3>
<p>A Krigagem com Deriva Externa (KED) é uma variante da Krigagem Universal onde a tendência <span class="math inline">\(\mu(\mathbf{s})\)</span> não é modelada por coordenadas, mas sim por uma ou mais variáveis auxiliares (covariáveis) <span class="math inline">\(x_k(\mathbf{s})\)</span> conhecidas exaustivamente em todo o domínio (ex: um Modelo Digital de Elevação para interpolar temperatura ou precipitação) <span class="citation" data-cites="goovaerts1997geostatistics">(<a href="references.html#ref-goovaerts1997geostatistics" role="doc-biblioref">Goovaerts 1997</a>)</span>.</p>
<p>O modelo para a média é: <span class="math inline">\(E[Y(\mathbf{s})] = a_0 + a_1 x_1(\mathbf{s})\)</span></p>
<p><span class="math display">\[
\begin{aligned}
&amp;Y(\mathbf{s}) = \mu(\mathbf{s}) + \delta(\mathbf{s}), \quad \text{com } E[\delta(\mathbf{s})] = 0, \quad \text{Cov}(\delta(\mathbf{s}_i), \delta(\mathbf{s}_j)) = C(\mathbf{s}_i, \mathbf{s}_j)\\
&amp;\mu(\mathbf{s}) = a_0 + a_1 x(\mathbf{s}) \quad \text{(modelo linear com covariável } x\text{)}\\
&amp;\hat{Y}(\mathbf{s}_0) = \sum_{i=1}^n \lambda_i Y(\mathbf{s}_i)
\end{aligned}
\]</span> <strong>Condição de não enviesamento:</strong></p>
<p><span class="math display">\[
\begin{aligned}
E[\hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0)] &amp;= \sum_{i=1}^n \lambda_i \mu(\mathbf{s}_i) - \mu(\mathbf{s}_0)\\
&amp;= \sum_{i=1}^n \lambda_i (a_0 + a_1 x(\mathbf{s}_i)) - (a_0 + a_1 x(\mathbf{s}_0))\\
&amp;= a_0\left(\sum_{i=1}^n \lambda_i - 1\right) + a_1\left(\sum_{i=1}^n \lambda_i x(\mathbf{s}_i) - x(\mathbf{s}_0)\right) \overset{!}{=} 0
\end{aligned}
\]</span> Para que valha para quaisquer <span class="math inline">\(a_0, a_1\)</span> desconhecidos é necessário que:</p>
<p><span class="math display">\[
\sum_{i=1}^n \lambda_i = 1 \quad \text{e} \quad \sum_{i=1}^n \lambda_i x(\mathbf{s}_i) = x(\mathbf{s}_0)
\]</span></p>
<p><strong>Variância do erro</strong></p>
<p><span class="math display">\[
\begin{aligned}
\sigma_E^2 &amp;= \text{Var}\left(\hat{Y}(\mathbf{s}_0) - Y(\mathbf{s}_0)\right)\\
&amp;= \text{Var}\left(\sum_{i=1}^n \lambda_i \delta(\mathbf{s}_i) - \delta(\mathbf{s}_0)\right)\\
&amp;= \sum_{i=1}^n\sum_{j=1}^n \lambda_i\lambda_j C_{ij} - 2\sum_{i=1}^n \lambda_i C_{i0} + C_{00}
\end{aligned}
\]</span> Novamente, introduzindo multiplicadores <span class="math inline">\(\nu_0\)</span> e <span class="math inline">\(\nu_1\)</span> e para minimizar derivamos derivamos:</p>
<p><span class="math display">\[
\begin{aligned}
L(\boldsymbol{\lambda}, \nu_0, \nu_1) &amp;= \sigma_E^2 - 2\nu_0\left(\sum_{i=1}^n \lambda_i - 1\right) - 2\nu_1\left(\sum_{i=1}^n \lambda_i x(\mathbf{s}_i) - x(\mathbf{s}_0)\right)\\
&amp;= \sum_{i=1}^n\sum_{j=1}^n \lambda_i\lambda_j C_{ij} - 2\sum_{i=1}^n \lambda_i C_{i0} + C_{00} - 2\nu_0\left(\sum_{i=1}^n \lambda_i - 1\right) - 2\nu_1\left(\sum_{i=1}^n \lambda_i x_i - x_0\right)
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \lambda_k} &amp;= \frac{\partial}{\partial \lambda_k}\left(\sum_{i=1}^n\sum_{j=1}^n \lambda_i\lambda_j C_{ij}\right) - 2C_{k0} - 2\nu_0 - 2\nu_1 x_k\\
&amp;= \sum_{j=1}^n \lambda_j C_{kj} + \sum_{i=1}^n \lambda_i C_{ik} - 2C_{k0} - 2\nu_0 - 2\nu_1 x_k\\
&amp;= 2\sum_{j=1}^n \lambda_j C_{kj} - 2C_{k0} - 2\nu_0 - 2\nu_1 x_k = 0\\
\sum_{j=1}^n \lambda_j C_{kj} - \nu_0 - \nu_1 x_k &amp;= C_{k0}, \quad k = 1,\dots,n
\end{aligned}
\]</span> <span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \nu_0} &amp;= -2\left(\sum_{i=1}^n \lambda_i - 1\right) = 0 \quad \Rightarrow \quad \sum_{i=1}^n \lambda_i = 1\\
\frac{\partial L}{\partial \nu_1} &amp;= -2\left(\sum_{i=1}^n \lambda_i x_i - x_0\right) = 0 \quad \Rightarrow \quad \sum_{i=1}^n \lambda_i x_i = x_0
\end{aligned}
\]</span> Novamente definimos:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbf{C}_{nn} = [C_{ij}]_{n\times n}, \quad \mathbf{X} = [1 \ x_i]_{n\times 2}, \quad \mathbf{c}_{n0} = [C_{i0}]_{n\times 1}\\
&amp;\mathbf{x}_0 = \begin{bmatrix} 1 \\ x_0 \end{bmatrix}_{2\times 1}, \quad \boldsymbol{\lambda} = [\lambda_1, \dots, \lambda_n]^\top, \quad \boldsymbol{\nu} = [\nu_0, \nu_1]^\top
\end{aligned}
\]</span> para obter o sistema:</p>
<p><span class="math display">\[
\begin{bmatrix}
\mathbf{C}_{nn} &amp; -\mathbf{X} \\
-\mathbf{X}^\top &amp; \mathbf{0}
\end{bmatrix}
\begin{bmatrix}
\boldsymbol{\lambda} \\ \boldsymbol{\nu}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{c}_{n0} \\ -\mathbf{z}_0
\end{bmatrix}
\]</span></p>
<p>Alternativamente, com <span class="math inline">\(\boldsymbol{\mu} = -\boldsymbol{\nu}\)</span>:</p>
<p><span class="math display">\[
\begin{bmatrix}
\mathbf{C}_{nn} &amp; \mathbf{X} \\
\mathbf{X}^\top &amp; \mathbf{0}
\end{bmatrix}
\begin{bmatrix}
\boldsymbol{\lambda} \\ \boldsymbol{\mu}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{c}_{n0} \\ \mathbf{x}_0
\end{bmatrix}
\]</span> <strong>Variância mínima da krigagem:</strong></p>
<p><span class="math display">\[
\sigma_{\text{KED}}^2 = C_{00} - \sum_{i=1}^n \lambda_i C_{i0} + \nu_0 + \nu_1 x_0
\]</span> A KED é um caso particular da KU onde as funções de base são substituídas por covariáveis conhecidas. Para p covariáveis:</p>
<p><span class="math display">\[
\mu(\mathbf{s}) = a_0 + \sum_{k=1}^p a_k x_k(\mathbf{s}) \Rightarrow \sum_{i=1}^n \lambda_i x_k(\mathbf{s}_i) = x_k(\mathbf{s}_0), \ k=0,\dots,p
\]</span> com <span class="math inline">\(x_0(\mathbf{s}) \equiv 1\)</span>.</p>
<p>Uma vantagem da KED é que ela incorpora eficientemente informação auxiliar correlacionada com a variável primária, melhorando a precisão da interpolação quando a covariável captura padrões de larga escala. Note que esta covariável deve ser conhecida em todos os pontos (amostrados e não amostrados). Covariância <span class="math inline">\(C\)</span> deve representar a dependência espacial dos resíduos após remover o efeito da covariável</p>
<div id="fig-krigagem_KDE" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krigagem_KDE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_KDE" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-krigagem_KDE-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_KDE-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_KDE-1.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_KDE">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_KDE-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Variograma
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_KDE" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-krigagem_KDE-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_KDE-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_KDE-2.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_KDE">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_KDE-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Predição
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_KDE" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-krigagem_KDE-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_KDE-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_KDE-3.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_KDE">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_KDE-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Variância de krigagem
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krigagem_KDE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.17: Krigagem com deriva externa
</figcaption>
</figure>
</div>
</section>
<section id="co-krigagem" class="level3" data-number="3.13.5">
<h3 data-number="3.13.5" class="anchored" data-anchor-id="co-krigagem"><span class="header-section-number">3.13.5</span> Co-Krigagem</h3>
<p>A Co-Krigagem (CK) é a extensão multivariada da krigagem. Utiliza-se quando queremos estimar uma variável primária <span class="math inline">\(Y_1(\mathbf{s}_0)\)</span> utilizando a correlação espacial não só com as suas próprias amostras, mas também com amostras de uma ou mais variáveis secundárias <span class="math inline">\(Y_2(\mathbf{s}), \dots, Y_k(\mathbf{s})\)</span>, que estão correlacionadas espacialmente com <span class="math inline">\(Y_1\)</span> (co-regionalização) <span class="citation" data-cites="ver1998constructing wackernagel2003multivariate">(<a href="references.html#ref-ver1998constructing" role="doc-biblioref">Ver Hoef e Barry 1998</a>; <a href="references.html#ref-wackernagel2003multivariate" role="doc-biblioref">Wackernagel 2003</a>)</span>. Assim, temos:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;Y_1(\mathbf{s}) = \mu_1 + \delta_1(\mathbf{s}), \quad E[\delta_1(\mathbf{s})] = 0 \\
&amp;Y_2(\mathbf{s}) = \mu_2 + \delta_2(\mathbf{s}), \quad E[\delta_2(\mathbf{s})] = 0 \\
&amp;\text{Cov}(\delta_a(\mathbf{s}_i), \delta_b(\mathbf{s}_j)) = C_{ab}(\mathbf{s}_i, \mathbf{s}_j), \quad a,b = 1,2\\
&amp;\hat{Y}_1(\mathbf{s}_0) = \sum_{i=1}^{n_1} \lambda_{1i} Y_1(\mathbf{s}_{1i}) + \sum_{j=1}^{n_2} \lambda_{2j} Y_2(\mathbf{s}_{2j})
\end{aligned}
\]</span></p>
<p><strong>Condição de não enviesamento:</strong></p>
<p><span class="math display">\[
\begin{aligned}
E[\hat{Y}_1(\mathbf{s}_0) - Y_1(\mathbf{s}_0)] &amp;= \sum_{i=1}^{n_1} \lambda_{1i} \mu_1 + \sum_{j=1}^{n_2} \lambda_{2j} \mu_2 - \mu_1 \\
&amp;= \mu_1\left(\sum_{i=1}^{n_1} \lambda_{1i} - 1\right) + \mu_2 \sum_{j=1}^{n_2} \lambda_{2j} \overset{!}{=} 0
\end{aligned}
\]</span> Como sempre para que valha para quaisquer <span class="math inline">\(\mu_1, \mu_2\)</span> desconhecidos, definimos:</p>
<p><span class="math display">\[
\sum_{i=1}^{n_1} \lambda_{1i} = 1 \quad \text{e} \quad \sum_{j=1}^{n_2} \lambda_{2j} = 0
\]</span></p>
<p><strong>Variância do erro:</strong></p>
<p><span class="math display">\[
\begin{aligned}
\sigma_E^2 &amp;= \text{Var}\left(\hat{Y}_1(\mathbf{s}_0) - Y_1(\mathbf{s}_0)\right) \\
&amp;= \text{Var}\left(\sum_{i=1}^{n_1} \lambda_{1i} \delta_1(\mathbf{s}_{1i}) + \sum_{j=1}^{n_2} \lambda_{2j} \delta_2(\mathbf{s}_{2j}) - \delta_1(\mathbf{s}_0)\right) \\
&amp;= \sum_{i=1}^{n_1}\sum_{k=1}^{n_1} \lambda_{1i}\lambda_{1k} C_{11}(\mathbf{s}_{1i}, \mathbf{s}_{1k}) \\
&amp;\quad + \sum_{j=1}^{n_2}\sum_{l=1}^{n_2} \lambda_{2j}\lambda_{2l} C_{22}(\mathbf{s}_{2j}, \mathbf{s}_{2l}) \\
&amp;\quad + 2\sum_{i=1}^{n_1}\sum_{j=1}^{n_2} \lambda_{1i}\lambda_{2j} C_{12}(\mathbf{s}_{1i}, \mathbf{s}_{2j}) \\
&amp;\quad - 2\sum_{i=1}^{n_1} \lambda_{1i} C_{11}(\mathbf{s}_{1i}, \mathbf{s}_0) - 2\sum_{j=1}^{n_2} \lambda_{2j} C_{12}(\mathbf{s}_{2j}, \mathbf{s}_0) \\
&amp;\quad + C_{11}(\mathbf{s}_0, \mathbf{s}_0)
\end{aligned}
\]</span> Definindo o Langrangiano temos:</p>
<p><span class="math display">\[
\begin{aligned}
L(\boldsymbol{\lambda}_1, \boldsymbol{\lambda}_2, \nu_1, \nu_2) &amp;= \sigma_E^2 - 2\nu_1\left(\sum_{i=1}^{n_1} \lambda_{1i} - 1\right) - 2\nu_2\sum_{j=1}^{n_2} \lambda_{2j}
\end{aligned}
\]</span> cujas derivadas são:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \lambda_{1i}} = 2\sum_{k=1}^{n_1} \lambda_{1k} C_{11}(\mathbf{s}_{1i}, \mathbf{s}_{1k}) + 2\sum_{j=1}^{n_2} \lambda_{2j} C_{12}(\mathbf{s}_{1i}, \mathbf{s}_{2j}) - 2C_{11}(\mathbf{s}_{1i}, \mathbf{s}_0) - 2\nu_1 &amp;= 0\\
\sum_{k=1}^{n_1} \lambda_{1k} C_{11}(\mathbf{s}_{1i}, \mathbf{s}_{1k}) + \sum_{j=1}^{n_2} \lambda_{2j} C_{12}(\mathbf{s}_{1i}, \mathbf{s}_{2j}) - \nu_1 &amp;= C_{11}(\mathbf{s}_{1i}, \mathbf{s}_0)
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \lambda_{2j}} = 2\sum_{l=1}^{n_2} \lambda_{2l} C_{22}(\mathbf{s}_{2j}, \mathbf{s}_{2l}) + 2\sum_{i=1}^{n_1} \lambda_{1i} C_{12}(\mathbf{s}_{1i}, \mathbf{s}_{2j}) - 2C_{12}(\mathbf{s}_{2j}, \mathbf{s}_0) - 2\nu_2 &amp;= 0\\
\sum_{l=1}^{n_2} \lambda_{2l} C_{22}(\mathbf{s}_{2j}, \mathbf{s}_{2l}) + \sum_{i=1}^{n_1} \lambda_{1i} C_{12}(\mathbf{s}_{1i}, \mathbf{s}_{2j}) - \nu_2 &amp;= C_{12}(\mathbf{s}_{2j}, \mathbf{s}_0)
\end{aligned}
\]</span> <span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \nu_1} &amp;= -2\left(\sum_{i=1}^{n_1} \lambda_{1i} - 1\right) = 0 \quad \Rightarrow \quad\sum_{i=1}^{n_1} \lambda_{1i} = 1 \\
\frac{\partial L}{\partial \nu_2} &amp;= -2\sum_{j=1}^{n_2} \lambda_{2j} = 0 \quad \Rightarrow \quad \sum_{j=1}^{n_2} \lambda_{2j} = 0
\end{aligned}
\]</span></p>
<p>Novamente, definimos:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbf{C}_{11} = [C_{11}(\mathbf{s}_{1i}, \mathbf{s}_{1k})]_{n_1 \times n_1}, \quad
\mathbf{C}_{22} = [C_{22}(\mathbf{s}_{2j}, \mathbf{s}_{2l})]_{n_2 \times n_2} \\
&amp;\mathbf{C}_{12} = [C_{12}(\mathbf{s}_{1i}, \mathbf{s}_{2j})]_{n_1 \times n_2}, \quad
\mathbf{C}_{21} = \mathbf{C}_{12}^\top \\
&amp;\mathbf{c}_{10} = [C_{11}(\mathbf{s}_{1i}, \mathbf{s}_0)]_{n_1 \times 1}, \quad \quad
\mathbf{c}_{20} = [C_{12}(\mathbf{s}_{2j}, \mathbf{s}_0)]_{n_2 \times 1} \\
&amp;\mathbf{1}_{n_1} = [1, \dots, 1]^\top_{n_1 \times 1}, \quad \quad \quad \:
\mathbf{1}_{n_2} = [1, \dots, 1]^\top_{n_2 \times 1} \\
&amp;\boldsymbol{\lambda}_1 = [\lambda_{11}, \dots, \lambda_{1n_1}]^\top, \quad \quad \:\:
\boldsymbol{\lambda}_2 = [\lambda_{21}, \dots, \lambda_{2n_2}]^\top
\end{aligned}
\]</span> para obter o seguinte sistema:</p>
<p><span class="math display">\[
\begin{bmatrix}
\mathbf{C}_{11} &amp; \mathbf{C}_{12} &amp; -\mathbf{1}_{n_1} &amp; \mathbf{0}_{n_1} \\
\mathbf{C}_{21} &amp; \mathbf{C}_{22} &amp; \mathbf{0}_{n_2} &amp; -\mathbf{1}_{n_2} \\
\mathbf{1}_{n_1}^\top &amp; \mathbf{0}_{n_2}^\top &amp; 0 &amp; 0 \\
\mathbf{0}_{n_1}^\top &amp; \mathbf{1}_{n_2}^\top &amp; 0 &amp; 0
\end{bmatrix}
\begin{bmatrix}
\boldsymbol{\lambda}_1 \\ \boldsymbol{\lambda}_2 \\ \nu_1 \\ \nu_2
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{c}_{10} \\ \mathbf{c}_{20} \\ 1 \\ 0
\end{bmatrix}
\]</span> <strong>Variância mínima da co-krigagem:</strong></p>
<p><span class="math display">\[
\sigma_{\text{CK}}^2 = C_{11}(\mathbf{s}_0, \mathbf{s}_0) - \left(\sum_{i=1}^{n_1} \lambda_{1i} C_{11}(\mathbf{s}_{1i}, \mathbf{s}_0) + \sum_{j=1}^{n_2} \lambda_{2j} C_{12}(\mathbf{s}_{2j}, \mathbf{s}_0)\right) + \nu_1
\]</span></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Importante
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Para garantir que a matriz de covariâncias cruzadas seja positiva definida, as covariâncias devem ser modeladas como:</li>
</ul>
<p><span class="math display">\[
C_{ab}(\mathbf{h}) = \sum_{k=1}^K B_{ab}^k \rho_k(\mathbf{h})
\]</span> onde <span class="math inline">\(\rho_k(\mathbf{h})\)</span> são funções de correlação básicas e <span class="math inline">\([B_{ab}^k]\)</span> são matrizes de coregionalização definidas não-negativas.</p>
<ul>
<li><p>Como descrito nas seções anteriores em geral, <span class="math inline">\(C_{12}(\mathbf{h}) = C_{21}(-\mathbf{h})\)</span>. Para processos estacionários, <span class="math inline">\(C_{12}(\mathbf{h}) = C_{21}(\mathbf{h})\)</span> se a covariância cruzada é simétrica.</p></li>
<li><p>Quando as variáveis secundárias estão disponíveis apenas nos mesmos locais que a primária (ou em grades finas), simplificações são possíveis.</p></li>
<li><p>A abordagem condicional de <span class="citation" data-cites="cressie2016multivariate">Cressie e Zammit-Mangion (<a href="references.html#ref-cressie2016multivariate" role="doc-biblioref">2016</a>)</span> oferece uma alternativa flexível para construir modelos de covariância multivariados válidos e assimétricos. <span class="citation" data-cites="cressie2016multivariate">Cressie e Zammit-Mangion (<a href="references.html#ref-cressie2016multivariate" role="doc-biblioref">2016</a>)</span> modela a distribuição conjunta condicionando <span class="math inline">\(Y_1\)</span> a <span class="math inline">\(Y_2\)</span>, evitando a necessidade de modelar explicitamente a covariância cruzada:</p></li>
</ul>
<p><span class="math display">\[Y_1(\mathbf{s}) = \mu_1(\mathbf{s}) + \beta(\mathbf{s})[Y_2(\mathbf{s}) - \mu_2(\mathbf{s})] + \delta(\mathbf{s})\]</span> onde <span class="math inline">\(\beta(\mathbf{s})\)</span> é um coeficiente espacialmente variante.</p>
</div>
</div>
<div id="fig-krigagem_co" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krigagem_co-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_co" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-krigagem_co-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_co-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_co-1.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_co">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_co-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Variograma 1
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_co" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-krigagem_co-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_co-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_co-2.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_co">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_co-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Variograma 2
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_co" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-krigagem_co-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_co-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_co-3.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_co">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_co-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Predição
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-krigagem_co" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-krigagem_co-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-krigagem_co-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_co-4.png" class="img-fluid figure-img" data-ref-parent="fig-krigagem_co">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-krigagem_co-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Variância de krigagem
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krigagem_co-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.18: Co-Krigagem
</figcaption>
</figure>
</div>
</section>
</section>
<section id="avaliação-da-performance-preditiva" class="level2" data-number="3.14">
<h2 data-number="3.14" class="anchored" data-anchor-id="avaliação-da-performance-preditiva"><span class="header-section-number">3.14</span> Avaliação da Performance Preditiva</h2>
<p>Uma vez ajustado o modelo de variograma e realizada a krigagem, é fundamental verificar se as predições são precisas e se a incerteza (variância de krigagem) está bem calibrada. Para tal, recorre-se a métodos de reamostragem e estatísticas de consistência, sendo a validação cruzada (leave-one-out) a mais usada.</p>
<section id="validação-cruzada" class="level3" data-number="3.14.1">
<h3 data-number="3.14.1" class="anchored" data-anchor-id="validação-cruzada"><span class="header-section-number">3.14.1</span> Validação Cruzada</h3>
<p>A validação cruzada <a href="https://en.wikipedia.org/wiki/Cross-validation_statistics">leave-one-out</a> é o método padrão para verificar a consistência entre a incerteza predita pelo modelo (variância de krigagem) e o erro real de predição. A estatística para este diagnóstico é a Razão de Desvio Quadrático Médio (MSDR - Mean Squared Deviation Ratio), discutida em profundidade por <span class="citation" data-cites="mcbratney1986choosing">McBratney e Webster (<a href="references.html#ref-mcbratney1986choosing" role="doc-biblioref">1986</a>)</span> e <span class="citation" data-cites="lark2000estimating">Lark (<a href="references.html#ref-lark2000estimating" role="doc-biblioref">2000</a>)</span>.</p>
<p>Seja <span class="math inline">\(Y(\mathbf{s}_i)\)</span> o valor observado no local <span class="math inline">\(\mathbf{s}_i\)</span>. Retiramos este ponto do conjunto de dados e realizamos a krigagem usando os <span class="math inline">\(n-1\)</span> vizinhos restantes para obter a estimativa <span class="math inline">\(\hat{Y}_{-i}(\mathbf{s}_i)\)</span> e a variância de krigagem associada <span class="math inline">\(\sigma_E^2(\mathbf{s}_i)\)</span>.</p>
<p><strong>Erro de predição</strong></p>
<p>Definimos o erro de predição (resíduo) como: <span class="math display">\[\varepsilon_i = Y(\mathbf{s}_i) - \hat{Y}_{-i}(\mathbf{s}_i)\]</span></p>
<p>Sob a hipótese nula de que o modelo de variograma <span class="math inline">\(\gamma(\mathbf{h}; \boldsymbol{\theta})\)</span> e as premissas de estacionariedade estão corretos, o estimador de krigagem é não-viesado e a variância do erro é exata. Se assumirmos adicionalmente que o processo é Gaussiano:</p>
<p><span class="math display">\[\varepsilon_i \sim \mathcal{N}(0, \sigma_E^2(\mathbf{s}_i))\]</span></p>
<p>Para avaliar a validade da variância, padronizamos o erro dividindo-o pelo desvio padrão estimado (variância de krigagem). Definimos o resíduo padronizado <span class="math inline">\(\theta_i\)</span>:</p>
<p><span class="math display">\[\theta_i = \frac{Y(\mathbf{s}_i) - \hat{Y}_{-i}(\mathbf{s}_i)}{\sigma_k(\mathbf{s}_i)}\]</span></p>
<p>Dada a distribuição de <span class="math inline">\(\varepsilon_i\)</span>, a variável <span class="math inline">\(\theta_i\)</span> deve seguir uma distribuição normal padrão, <span class="math inline">\(\theta_i \sim \mathcal{N}(0, 1)\)</span>. Consequentemente, o quadrado do resíduo padronizado segue uma distribuição Qui-quadrado com 1 grau de liberdade:</p>
<p><span class="math display">\[\theta_i^2 \sim \chi^2_{(1)}\]</span></p>
<p>A esperança de uma variável <span class="math inline">\(\chi^2_{(1)}\)</span> é igual aos seus graus de liberdade. Portanto, o valor esperado teórico para o quadrado do erro padronizado é:</p>
<p><span class="math display">\[E[\theta_i^2] = \text{Var}(\theta_i) + (E[\theta_i])^2 = 1 + 0 = 1\]</span></p>
<p>A MSDR é definida como a média amostral dos quadrados dos resíduos padronizados sobre todos os pontos de validação <span class="math inline">\(n\)</span>:</p>
<p><span class="math display">\[\text{MSDR} = \frac{1}{n} \sum_{i=1}^n \theta_i^2 = \frac{1}{n} \sum_{i=1}^n \frac{[Y(\mathbf{s}_i) - \hat{Y}_{-i}(\mathbf{s}_i)]^2}{\sigma_E^2(\mathbf{s}_i)}\]</span></p>
<p>A análise do valor de MSDR permite diagnosticar a calibração da incerteza do modelo:</p>
<ol type="1">
<li><strong>Consistência (</strong><span class="math inline">\(\text{MSDR} \approx 1\)</span>):</li>
</ol>
<p>A variância média dos erros reais (numerador) é aproximadamente igual à variância média predita pela krigagem (denominador). O modelo descreve corretamente a variabilidade espacial.</p>
<ol start="2" type="1">
<li><strong>Subestimação da Incerteza (</strong><span class="math inline">\(\text{MSDR} &gt; 1\)</span>):</li>
</ol>
<p><span class="math display">\[\frac{1}{n}\sum \varepsilon_i^2 &gt; \frac{1}{n}\sum \sigma_E^2\]</span></p>
<p>O erro real é sistematicamente maior do que o modelo prevê. Isso ocorre frequentemente quando o variograma subestima o efeito pepita ou a variância total (patamar), ou quando há outliers não modelados.</p>
<ol start="3" type="1">
<li><strong>Superestimação da Incerteza (</strong><span class="math inline">\(\text{MSDR} &lt; 1\)</span>):</li>
</ol>
<p><span class="math display">\[\frac{1}{n}\sum \varepsilon_i^2 &lt; \frac{1}{n}\sum \sigma_E^2\]</span></p>
<p>A variância de krigagem é maior do que o erro efetivo. O modelo assume uma variabilidade espacial ou um ruído (pepita) superior ao que realmente existe nos dados. O modelo é “pessimista” ou conservador.</p>
<p>Com base na fundamentação teórica de Journel &amp; Huijbregts (1978), Cressie (1993), Goovaerts (1997) e Chilès &amp; Delfiner (1999), apresento a secção detalhada sobre Anisotropia, mantendo o rigor matemático e a dedução das transformações lineares necessárias para a modelagem.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(stars, gstat, ggplot2, sf, patchwork, viridis, dplyr, tibble, gt)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>v_ord <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>m_ord <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(v_ord, <span class="fu">vgm</span>(<span class="fl">0.6</span>, <span class="st">"Exp"</span>, <span class="dv">800</span>, <span class="fl">0.05</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Executar Validação Cruzada (Leave-One-Out)</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># A função krige.cv faz o loop automaticamente.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">krige.cv</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">locations =</span> meuse_sf, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model =</span> m_ord, <span class="at">debug.level =</span> <span class="dv">0</span>); </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>cv_results<span class="sc">|&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()<span class="sc">|&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 6%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">var1.pred</th>
<th style="text-align: right;">var1.var</th>
<th style="text-align: right;">observed</th>
<th style="text-align: right;">residual</th>
<th style="text-align: right;">zscore</th>
<th style="text-align: right;">fold</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6.833605</td>
<td style="text-align: right;">0.1614145</td>
<td style="text-align: right;">6.929517</td>
<td style="text-align: right;">0.0959118</td>
<td style="text-align: right;">0.2387267</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">POINT (181072 333611)</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.786747</td>
<td style="text-align: right;">0.1604868</td>
<td style="text-align: right;">7.039660</td>
<td style="text-align: right;">0.2529135</td>
<td style="text-align: right;">0.6313240</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">POINT (181025 333558)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6.291128</td>
<td style="text-align: right;">0.1836067</td>
<td style="text-align: right;">6.461468</td>
<td style="text-align: right;">0.1703405</td>
<td style="text-align: right;">0.3975334</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">POINT (181165 333537)</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.051561</td>
<td style="text-align: right;">0.2405948</td>
<td style="text-align: right;">5.549076</td>
<td style="text-align: right;">-0.5024847</td>
<td style="text-align: right;">-1.0244238</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">POINT (181298 333484)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5.576407</td>
<td style="text-align: right;">0.1717014</td>
<td style="text-align: right;">5.594711</td>
<td style="text-align: right;">0.0183041</td>
<td style="text-align: right;">0.0441734</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">POINT (181307 333330)</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.455516</td>
<td style="text-align: right;">0.2381790</td>
<td style="text-align: right;">5.638355</td>
<td style="text-align: right;">0.1828387</td>
<td style="text-align: right;">0.3746419</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">POINT (181390 333260)</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estatísticas de Diagnóstico</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># MSDR (Razão de Desvio Quadrático Médio)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>msdr <span class="ot">&lt;-</span> <span class="fu">mean</span>(cv_results<span class="sc">$</span>zscore<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ME (Erro Médio) - Deve ser próximo de 0 (viés)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">mean</span>(cv_results<span class="sc">$</span>residual)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE (Raiz do Erro Quadrático Médio)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(cv_results<span class="sc">$</span>residual<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Indicador =</span> <span class="fu">c</span>(<span class="st">"Mean Error (Viés)"</span>, </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"RMSE (Precisão)"</span>, </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"MSDR (Calibração)"</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">round</span>(<span class="fu">c</span>(me, rmse, msdr), <span class="dv">4</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">|&gt;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Indicador</th>
<th style="text-align: right;">Valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mean Error (Viés)</td>
<td style="text-align: right;">0.0021</td>
</tr>
<tr class="even">
<td style="text-align: left;">RMSE (Precisão)</td>
<td style="text-align: right;">0.3935</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MSDR (Calibração)</td>
<td style="text-align: right;">0.8657</td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretação automática simples</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(msdr <span class="sc">&gt;</span> <span class="fl">1.1</span>) {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"MSDR &gt; 1: Subestimação da incerteza (Variograma muito 'otimista' ou outliers).</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(msdr <span class="sc">&lt;</span> <span class="fl">0.9</span>) {</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"MSDR &lt; 1: Superestimação da incerteza (Variograma muito 'pessimista').</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"MSDR ~ 1: Incerteza bem calibrada.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MSDR &lt; 1: Superestimação da incerteza (Variograma muito 'pessimista').</code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cv_results, <span class="fu">aes</span>(<span class="at">x =</span> observed, <span class="at">y =</span> var1.pred)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Acurácia: Observado vs Predito"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"RMSE:"</span>, <span class="fu">round</span>(rmse, <span class="dv">3</span>)),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Log(Zinc) Observado"</span>, <span class="at">y =</span> <span class="st">"Log(Zinc) Predito"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Histograma dos Z-Scores (Deve parecer uma Normal(0,1))</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cv_results, <span class="fu">aes</span>(<span class="at">x =</span> zscore)) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Calibração: Z-Scores"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"MSDR:"</span>, <span class="fu">round</span>(msdr, <span class="dv">3</span>), <span class="st">"(Ideal = 1.0)"</span>),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduo Padronizado"</span>, <span class="at">y =</span> <span class="st">"Densidade"</span>) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Com base na sua solicitação, elaborei esta seção detalhada sobre Krigagem Indicatriz. Mantive a notação rigorosa <span class="math inline">\(Y(\mathbf{s})\)</span>, integrei a evolução histórica e matemática com base nos documentos fornecidos (de 1983 a 2025) e diferenciei o método das abordagens lineares anteriores.</p>
</section>
</section>
<section id="krigagem-indicatriz-ik" class="level2" data-number="3.15">
<h2 data-number="3.15" class="anchored" data-anchor-id="krigagem-indicatriz-ik"><span class="header-section-number">3.15</span> Krigagem Indicatriz (IK)</h2>
<p>As técnicas de krigagem discutidas anteriormente (Simples, Ordinária, Universal) são classificadas como estimadores lineares. Elas são ótimas para estimar o valor esperado da variável <span class="math inline">\(Y(\mathbf{s}_0)\)</span> sob a condição de que a distribuição dos dados seja razoavelmente simétrica (dados normais) e livre de outliers extremos. No entanto, em geociências e estudos ambientais, frequentemente lidamos com distribuições altamente assimétricas (ex: concentrações de ouro ou poluentes) onde a média não é uma boa medida de tendência central e a variância de krigagem não reflete a verdadeira incerteza local, pois é independente dos valores dos dados (propriedade da homocedasticidade) <span class="citation" data-cites="journel1983nonparametric">(<a href="references.html#ref-journel1983nonparametric" role="doc-biblioref">André G. Journel 1983</a>)</span>.</p>
<p>A Krigagem Indicatriz (IK), introduzida por <span class="citation" data-cites="journel1983nonparametric">André G. Journel (<a href="references.html#ref-journel1983nonparametric" role="doc-biblioref">1983</a>)</span>, representa uma mudança de paradigma: em vez de estimar o valor da variável <span class="math inline">\(Y(\mathbf{s}_0)\)</span> diretamente, estimamos a Função de Distribuição Cumulativa Condicional (ccdf) local em <span class="math inline">\(\mathbf{s}_0\)</span>.</p>
<p>A importância fundamental da IK em relação à KO ou KS reside na sua natureza não-paramétrica. Ela não assume normalidade dos dados e é robusta a outliers, pois transforma os dados em binários (0 ou 1) baseados em limiares de corte (<em>cut-offs</em>). Um valor extremamente alto não explode a estimativa, pois é tratado apenas como acima do corte <span class="citation" data-cites="carvalho2017overview">(<a href="references.html#ref-carvalho2017overview" role="doc-biblioref">Carvalho e Deutsch 2017</a>)</span>.</p>
<p><strong>Transformada Indicadora e a ccdf</strong></p>
<p>Seja <span class="math inline">\(Y(\mathbf{s})\)</span> uma variável regionalizada e <span class="math inline">\(y_k\)</span> um valor de corte (threshold) escolhido. A transformada indicadora <span class="math inline">\(I(\mathbf{s}; y_k)\)</span> é definida como uma variável binária:</p>
<p><span class="math display">\[
I(\mathbf{s}; z_k) = \begin{cases}
1, &amp; \text{se } Y(\mathbf{s}) \le y_k \\
0, &amp; \text{se } Y(\mathbf{s}) &gt; y_k
\end{cases}
\]</span></p>
<p>Para variáveis categóricas (como espécies biológicas ou litologia), a definição muda para uma igualdade estrita (<span class="math inline">\(= y_k\)</span>), conforme descrito por <span class="citation" data-cites="guimaraes2012use">Guimaraes et al. (<a href="references.html#ref-guimaraes2012use" role="doc-biblioref">2012</a>)</span>.</p>
<p>A propriedade estatística que fundamenta a IK é que a esperança da variável indicadora é igual à probabilidade cumulativa:</p>
<p><span class="math display">\[E[I(\mathbf{s}; y_k)] = 1 \cdot P(Y(\mathbf{s}) \le y_k) + 0 \cdot P(Y(\mathbf{s}) &gt; y_k) = P(Y(\mathbf{s}) \le y_k) = F(y_k)\]</span></p>
<p>Portanto, ao estimar o valor esperado do indicador num local não amostrado <span class="math inline">\(\mathbf{s}_0\)</span>, estamos estimando a probabilidade de que a variável real seja menor ou igual ao corte <span class="math inline">\(y_k\)</span>, condicionada aos dados vizinhos <span class="math inline">\((n)\)</span>. Esta é a ccdf local:</p>
<p><span class="math display">\[\hat{F}(u; y_k | (n)) = E^*[I(\mathbf{s}_0; y_k) | (n)] = \text{Prob}^* \{ Y(\mathbf{s}_0) \le y_k | (n) \}\]</span></p>
<p><strong>Estimador e o Sistema de Krigagem Indicatriz</strong></p>
<p>A estimativa da probabilidade para um corte <span class="math inline">\(y_k\)</span> é uma combinação linear dos indicadores observados nos locais <span class="math inline">\(\mathbf{s}_i\)</span>:</p>
<p><span class="math display">\[\hat{I}(\mathbf{s}_0; y_k) = \sum_{i=1}^{n} \lambda_i(y_k) I(\mathbf{s}_i; y_k)\]</span></p>
<p>Note que os pesos <span class="math inline">\(\lambda_i(y_k)\)</span> dependem do corte <span class="math inline">\(y_k\)</span>. Isso significa que a estrutura de continuidade espacial (variograma) pode mudar para diferentes teores. O ouro de alto teor pode ter uma continuidade espacial muito menor (alcance curto) do que o ouro de baixo teor (alcance longo). Esta flexibilidade é uma vantagem crucial sobre a Krigagem Ordinária, que assume um único variograma para todo o processo <span class="citation" data-cites="mohammadpour2019geochemical">(<a href="references.html#ref-mohammadpour2019geochemical" role="doc-biblioref">Mohammadpour et al. 2019</a>)</span>.</p>
<p>O sistema de equações para obter os pesos é idêntico ao da Krigagem Ordinária, mas aplicado aos dados transformados e ao Variograma Indicador <span class="math inline">\(\gamma_I(\mathbf{h}; z_k)\)</span>:</p>
<p><span class="math display">\[\gamma_I(\mathbf{h}; y_k) = \frac{1}{2} E \left[ \{ I(\mathbf{s} + \mathbf{h}; y_k) - I(\mathbf{s}; y_k) \}^2 \right]\]</span></p>
<p>O sistema <span class="math inline">\(\mathbf{A}_{IK} \mathbf{x}_{IK} = \mathbf{b}_{IK}\)</span> para cada corte <span class="math inline">\(y_k\)</span> é:</p>
<p><span class="math display">\[
\begin{cases}
\sum_{j=1}^n \lambda_j(z_k) \gamma_I(\mathbf{s}_i - \mathbf{s}_j; z_k) + \nu(z_k) = \gamma_I(\mathbf{s}_i - \mathbf{s}_0; z_k), &amp; i=1, \dots, n \\
\sum_{j=1}^n \lambda_j(z_k) = 1
\end{cases}
\]</span></p>
<p><span class="citation" data-cites="myers1994spatial">Myers (<a href="references.html#ref-myers1994spatial" role="doc-biblioref">1994</a>)</span> classifica a IK como uma extensão não-linear que evita as premissas fortes de distribuição bivariada exigidas pela <a href="https://www.teses.usp.br/teses/disponiveis/11/11134/tde-12052003-151635/publico/maria.pdf">Krigagem Disjuntiva</a>, embora exija a hipótese de estacionariedade forte para a inferência da ccdf.</p>
<p><strong>Soft Kriging: Incorporando Incertezas</strong></p>
<p>Uma generalização poderosa da IK é a capacidade de incorporar dados imprecisos ou qualitativos, conhecidos como <em>Soft Data</em>. <span class="citation" data-cites="journel1986constrained">Andre G. Journel (<a href="references.html#ref-journel1986constrained" role="doc-biblioref">1986</a>)</span> formalizou o conceito de <em>Soft Kriging</em>.</p>
<p>Enquanto um dado exato em <span class="math inline">\(\mathbf{s}_i\)</span> é codificado como um degrau abrupto na ccdf (0 ou 1), um dado suave (ex: o valor está entre <span class="math inline">\(a\)</span> e <span class="math inline">\(b\)</span>) pode ser codificado como uma probabilidade <span class="math inline">\(y(\mathbf{s}_i; y_k) \in [0, 1]\)</span>. O estimador se torna:</p>
<p><span class="math display">\[\hat{I}(\mathbf{s}_0; y_k) = \sum_{i \in \text{hard}} \lambda_i I(\mathbf{s}_i; y_k) + \sum_{j \in \text{soft}} \nu_j y(\mathbf{s}_j; y_k)\]</span></p>
<p><span class="citation" data-cites="ungaro2008arsenic">Ungaro et al. (<a href="references.html#ref-ungaro2008arsenic" role="doc-biblioref">2008</a>)</span> expandem este conceito utilizando <em>Simple Indicator Kriging with Varying Local Means (SIK-VLM)</em>, onde a média local varia conforme mapas de solo auxiliares, permitindo distinguir anomalias naturais de contaminação antrópica.</p>
<p><strong>Estatísticas E-type e Risco</strong></p>
<p>A IK resulta em um conjunto de probabilidades discretas para <span class="math inline">\(K\)</span> cortes: <span class="math inline">\(\hat{F}(y_1), \hat{F}(y_2), \dots, \hat{F}(y_K)\)</span>. Para obter uma estimativa de valor (teor) único para o local <span class="math inline">\(\mathbf{s}_0\)</span>, calculamos a esperança da ccdf, conhecida como estimativa <em>E-type</em>:</p>
<p><span class="math display">\[\hat{Y}_{E\text{-type}}(\mathbf{s}_0) \approx \sum_{k=0}^{K} \bar{y}_k \left[ \hat{F}(y_{k+1}) - \hat{F}(y_k) \right]\]</span></p>
<p>Onde <span class="math inline">\(\bar{y}_k\)</span> é a média da classe entre os cortes <span class="math inline">\(y_k\)</span> e <span class="math inline">\(y_{k+1}\)</span>. <span class="citation" data-cites="carvalho2017overview">Carvalho e Deutsch (<a href="references.html#ref-carvalho2017overview" role="doc-biblioref">2017</a>)</span> destaca a importância de modelar corretamente as caudas da distribuição (abaixo do primeiro corte e acima do último), sugerindo ajustes hiperbólicos para evitar subestimativa de valores extremos.</p>
<p>Além da média, a IK permite quantificar o risco de decisão. <span class="citation" data-cites="juang1998simple">Juang e Lee (<a href="references.html#ref-juang1998simple" role="doc-biblioref">1998</a>)</span> desenvolvem as equações para calcular a probabilidade de Falso Positivo (<span class="math inline">\(\alpha\)</span>, classificar como perigoso o que é seguro) e Falso Negativo (<span class="math inline">\(\beta\)</span>, classificar como seguro o que é perigoso), cruciais para remediação ambiental.</p>
<p><strong>Desafios e Desenvolvimentos Recentes</strong></p>
<ul>
<li><p>Como as krigagens são independentes para cada corte, pode ocorrer que <span class="math inline">\(P(Y \le 10) &lt; P(Y \le 5)\)</span>, o que é matematicamente impossível. Algoritmos de correção (médias ascendentes/descendentes) são aplicados a posteriori <span class="citation" data-cites="DeutschJournel1997">(<a href="references.html#ref-DeutschJournel1997" role="doc-biblioref">Deutsch e Journel 1997</a>)</span>.</p></li>
<li><p>Para reduzir o esforço computacional, <span class="citation" data-cites="hill1998comparison">Hill (<a href="references.html#ref-hill1998comparison" role="doc-biblioref">1998</a>)</span> propõem a <em>Median Indicator Kriging</em>, assumindo que o variograma da mediana é representativo para todos os cortes. Embora eficiente, <span class="citation" data-cites="mohammadpour2019geochemical">Mohammadpour et al. (<a href="references.html#ref-mohammadpour2019geochemical" role="doc-biblioref">2019</a>)</span> argumentam que para anomalias sutis, deve-se usar variogramas específicos definidos por modelos Multifractais (FMIK) para separar corretamente as populações geológicas.</p></li>
<li><p>O avanço mais recente, proposto por <span class="citation" data-cites="ji2025ordered">Ji et al. (<a href="references.html#ref-ji2025ordered" role="doc-biblioref">2025</a>)</span>, introduz a <em>Ordered Indicator Kriging</em> com parâmetros de campo. Este método adapta a anisotropia da krigagem localmente baseada na estrutura geológica (dobras, falhas) e na lógica deposicional (proximal-distal), superando a limitação de estacionaridade da IK em ambientes complexos.</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(stars, gstat, ggplot2, sf, viridis, dplyr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse.grid)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Preparação dos Dados</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir o corte (Threshold). Vamos usar o 3º quartil do Zinco como "perigo".</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(meuse<span class="sc">$</span>zinc, <span class="fl">0.75</span>) </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>meuse<span class="sc">$</span>zinc_ind <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(meuse<span class="sc">$</span>zinc <span class="sc">&gt;</span> threshold, <span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># 1 se perigoso, 0 se seguro</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>grid_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse.grid, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>grid_stars <span class="ot">&lt;-</span> <span class="fu">st_rasterize</span>(grid_sf, <span class="at">dx =</span> <span class="dv">40</span>, <span class="at">dy =</span> <span class="dv">40</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Variograma Indicador</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>v_ind <span class="ot">&lt;-</span> <span class="fu">variogram</span>(zinc_ind <span class="sc">~</span> <span class="dv">1</span>, meuse_sf)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>m_ind <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(v_ind, <span class="fu">vgm</span>(<span class="fl">0.15</span>, <span class="st">"Exp"</span>, <span class="dv">600</span>, <span class="fl">0.05</span>))</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(v_ind, m_ind, <span class="at">main =</span> <span class="st">"Variograma Indicador (Zinco &gt; Q75)"</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Krigagem Indicatriz (Ordinária)</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado (var1.pred) será a PROBABILIDADE de ser 1 (acima do corte)</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>ik <span class="ot">&lt;-</span> <span class="fu">krige</span>(zinc_ind <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">locations =</span> meuse_sf, </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">newdata =</span> grid_stars, </span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">model =</span> m_ind, <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>ik<span class="sc">$</span>probabilidade <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(ik<span class="sc">$</span>var1.pred, <span class="dv">0</span>), <span class="dv">1</span>)</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> ik, <span class="fu">aes</span>(<span class="at">fill =</span> probabilidade)) <span class="sc">+</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> meuse_sf, <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">as.factor</span>(zinc_ind)), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Prob. &gt; Corte"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>), <span class="at">name =</span> <span class="st">"Dados Reais"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"&lt;= Corte"</span>, <span class="st">"&gt; Corte"</span>))<span class="sc">+</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>,</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Probabilidade do teor de Zinco exceder o limiar de 75%"</span>,</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>), <span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-krigagem_indicatriz-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krigagem_indicatriz-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_indicatriz-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krigagem_indicatriz-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.19: Krigagem Indicatriz
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-krigagem_indicatriz-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-krigagem_indicatriz-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-krigagem_indicatriz-2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-krigagem_indicatriz-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.20: Krigagem Indicatriz
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="desafios-computacionais-e-a-abordagem-spde" class="level2" data-number="3.16">
<h2 data-number="3.16" class="anchored" data-anchor-id="desafios-computacionais-e-a-abordagem-spde"><span class="header-section-number">3.16</span> Desafios Computacionais e a Abordagem SPDE</h2>
<p>Imagine que você é um climatologista modelando a temperatura da superfície do mar no Atlântico Norte usando dados de satélite. Você tem <span class="math inline">\(n = 100.000\)</span> pontos de observação <span class="math inline">\(\mathbf{s}_1, \dots, \mathbf{s}_n\)</span> e deseja prever a temperatura em locais não medidos e entender a variabilidade espacial.</p>
<p>Na geoestatística, assumimos que o vetor de temperaturas observadas <span class="math inline">\(\mathbf{y}\)</span> é uma realização de um Campo Aleatório Gaussiano (GRF) <span class="math inline">\(x(\mathbf{s})\)</span>. A dependência espacial é regida por uma Matriz de Covariância densa <span class="math inline">\(\mathbf{\Sigma}\)</span>, onde o elemento <span class="math inline">\(\Sigma_{ij}\)</span> descreve a correlação entre <span class="math inline">\(\mathbf{s}_i\)</span> e <span class="math inline">\(\mathbf{s}_j\)</span>.</p>
<p>Um Campo Aleatório Gaussiano (GRF - Gaussian Random Field), denotado por <span class="math inline">\(\{x(\mathbf{s}) : \mathbf{s} \in D^G \subset \mathbb{R}^d\}\)</span>, é um processo estocástico onde, para qualquer conjunto finito de locais <span class="math inline">\(\{\mathbf{s}_1, \dots, \mathbf{s}_n\}\)</span>, o vetor <span class="math inline">\(\mathbf{x} = (x(\mathbf{s}_1), \dots, x(\mathbf{s}_n))^\top\)</span> segue uma distribuição Normal Multivariada:</p>
<p><span class="math display">\[\mathbf{x} \sim \mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma})\]</span></p>
<p>Onde <span class="math inline">\(\boldsymbol{\mu}\)</span> é o vetor de médias e <span class="math inline">\(\boldsymbol{\Sigma}\)</span> é a matriz de covariância, cujos elementos são dados por uma função de covariância definida positiva <span class="math inline">\(C(\cdot)\)</span>:</p>
<p><span class="math display">\[\Sigma_{ij} = \text{Cov}(x(\mathbf{s}_i), x(\mathbf{s}_j)) = C(\|\mathbf{s}_i - \mathbf{s}_j\|)\]</span></p>
<p>A função <span class="math inline">\(C\)</span> é função de covariância da Matérn, que controla a variância e a suavidade do campo. Note que ao longo do texto descrevemos funções de semivariograma, mas poderiamos ter o feito para funções de covariância.</p>
<p>Para estimar parâmetros (como o alcance da correlação) via Máxima Verossimilhança, precisamos calcular a log-verossimilhança:</p>
<p><span class="math display">\[\log L(\theta) \propto -\frac{1}{2} \log |\mathbf{\Sigma}| - \frac{1}{2} \mathbf{y}^\top \mathbf{\Sigma}^{-1} \mathbf{y}\]</span></p>
<p>Isso exige calcular o determinante <span class="math inline">\(|\mathbf{\Sigma}|\)</span> e a inversa <span class="math inline">\(\mathbf{\Sigma}^{-1}\)</span>. O método padrão é a Fatoração de Cholesky (<span class="math inline">\(\mathbf{\Sigma} = \mathbf{L}\mathbf{L}^\top\)</span>), que decompõe a matriz <span class="math inline">\(\boldsymbol{\Sigma}\)</span> em um produto <span class="math inline">\(\boldsymbol{\Sigma} = \mathbf{L}\mathbf{L}^\top\)</span>, onde <span class="math inline">\(\mathbf{L}\)</span> é uma matriz triangular inferior única com elementos diagonais estritamente positivos.</p>
<p>A matriz <span class="math inline">\(\mathbf{\Sigma}\)</span> é densa. Em processos espaciais, tudo se correlaciona com tudo (Primeira Lei da Geografia), mesmo que a correlação seja ínfima a longas distâncias.</p>
<p>O problema é que a matriz <span class="math inline">\(\boldsymbol{\Sigma}\)</span> é densa (quase todos os elementos são não-nulos, pois a correlação decai com a distância mas nunca é exatamente zero). Portanto, <span class="math inline">\(\Sigma_{ij} \neq 0\)</span> para quase todos os pares. Como consequência, o custo computacional da fatoração de Cholesky para uma matriz densa seja de ordem <span class="math inline">\(\mathcal{O}(n^3)\)</span> e o custo de armazenamento (memória) de ordem <span class="math inline">\(\mathcal{O}(n^2)\)</span>. Para <span class="math inline">\(n=100.000\)</span>, isso exige da ordem de <span class="math inline">\(10^{15}\)</span> operações e cerca de 80 GB de RAM apenas para armazenar a matriz em precisão dupla. Isso torna a geoestatística clássica computacionalmente proibitiva para grandes conjuntos de dados <span class="citation" data-cites="abdulah2023large">(<a href="references.html#ref-abdulah2023large" role="doc-biblioref">Abdulah et al. 2023</a>)</span>.</p>
<p>A solução reside na mudança de paradigma: modelar a Precisão (dependência local) em vez da Covariância (dependência global).</p>
<ul>
<li><p>Covariância (<span class="math inline">\(\mathbf{\Sigma}\)</span>) descreve a correlação marginal. Se o ponto A afeta B, e B afeta C, então A está correlacionado com C. O grafo de dependência é completo (denso).</p></li>
<li><p>Precisão (<span class="math inline">\(\mathbf{Q} = \mathbf{\Sigma}^{-1}\)</span>) descreve a correlação condicional. Se fixarmos o valor de B, A e C tornam-se independentes (propriedade de Markov). Em um Campo Aleatório de Markov Gaussiano (GMRF), um ponto só interage com seus vizinhos imediatos. A matriz é esparsa (cheia de zeros).</p></li>
</ul>
<p>Para construir uma matriz esparsa <span class="math inline">\(\mathbf{Q}\)</span> que corresponda a um modelo de covariância contínuo e válido, recorre-se a abordagem <em>Stochastic Partial Differential Equation</em> ( SPDE ou Equação Diferencial Parcial Estocástica).</p>
<section id="equação-diferencial-parcial-estocástica-spde" class="level3" data-number="3.16.1">
<h3 data-number="3.16.1" class="anchored" data-anchor-id="equação-diferencial-parcial-estocástica-spde"><span class="header-section-number">3.16.1</span> Equação Diferencial Parcial Estocástica (SPDE)</h3>
<p>Uma SPDE é uma equação diferencial onde um ou mais termos são processos estocásticos. No contexto da geoestatística, usamos uma SPDE linear para descrever como o campo <span class="math inline">\(x(\mathbf{s})\)</span> é gerado a partir de um ruído branco.</p>
<p><span class="citation" data-cites="whittle1954stationary">Whittle (<a href="references.html#ref-whittle1954stationary" role="doc-biblioref">1954</a>)</span> provou um campo aleatório Gaussiano estacionário <span class="math inline">\(x(\mathbf{s})\)</span> em <span class="math inline">\(\mathbb{R}^d\)</span> com função de covariância Matérn é a solução estacionária da seguinte Equação Diferencial Parcial Estocástica (SPDE) linear fracionária impulsionada por um ruído branco Gaussiano:</p>
<p><span id="eq-SPDE"><span class="math display">\[(\kappa^2 - \Delta)^{\alpha/2} (\tau x(\mathbf{s})) = \mathcal{W}(\mathbf{s}), \quad \mathbf{s} \in \mathbb{R}^d \tag{3.14}\]</span></span></p>
<p>Onde:</p>
<ul>
<li><p><span class="math inline">\(\Delta\)</span> (Laplaciano) é operador diferencial definido como <span class="math inline">\(\Delta = \sum_{i=1}^d \frac{\partial^2}{\partial s_i^2}\)</span>. Mede a concavidade local.</p></li>
<li><p><span class="math inline">\(\mathcal{W}(\mathbf{s})\)</span> (Ruído Branco Espacial) é um processo estocástico Gaussiano com média zero e densidade espectral constante <span class="math inline">\(S_{\mathcal{W}}(\boldsymbol{\omega}) = 1\)</span> em todas as frequências. Para quaisquer funções de teste <span class="math inline">\(f, g \in L^2(\mathbb{R}^d)\)</span>, a covariância é dada pelo produto interno: <span class="math inline">\(\text{Cov}(\langle f, \mathcal{W} \rangle, \langle g, \mathcal{W} \rangle) = \int f(\mathbf{s})g(\mathbf{s}) d\mathbf{s}\)</span>.</p></li>
<li><p><span class="math inline">\(\kappa\)</span> é parâmetro de escala espacial (<span class="math inline">\(&gt;0\)</span>). Controla o decaimento da correlação. Relacionado ao Alcance (<span class="math inline">\(\rho\)</span>) por <span class="math inline">\(\rho = \sqrt{8\nu}/\kappa\)</span>.</p></li>
<li><p><span class="math inline">\(\alpha\)</span> é parâmetro de suavidade que determina a ordem da equação diferencial. Relacionado ao parâmetro <span class="math inline">\(\nu\)</span> da Matérn por <span class="math inline">\(\alpha = \nu + d/2\)</span></p></li>
</ul>
<p><span class="math inline">\(\tau\)</span> é parâmetro de escala da variância. Controla a magnitude das flutuações. Relacionado à variância marginal <span class="math inline">\(\sigma^2\)</span>.</p>
<p>Para provar que a solução da equação acima realmente gera uma covariância Matérn, utilizamos a análise espectral no domínio da frequência <span class="citation" data-cites="lindgren2011explicit">(<a href="references.html#ref-lindgren2011explicit" role="doc-biblioref">Lindgren, Rue, e Lindström 2011</a>)</span>. Que fundamenta-se na transformada de Fourier <span class="math inline">\(\mathcal{F}\)</span>, que consiste em converter uma função do domínio espacial <span class="math inline">\(\mathbf{s}\)</span> para o domínio da frequência <span class="math inline">\(\boldsymbol{\omega}\)</span>. Uma propriedade crucial é como ela afeta o operador Laplaciano:</p>
<p><span class="math display">\[\mathcal{F}(\Delta f(\mathbf{s})) = -\|\boldsymbol{\omega}\|^2 \hat{f}(\boldsymbol{\omega})\]</span></p>
<p>Aplicando a transformada de Fourier em ambos os lados da SPDE (<a href="#eq-SPDE" class="quarto-xref">Eq.&nbsp;<span>3.14</span></a>), temos:</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal{F}\left[ (\kappa^2 - \Delta)^{\alpha/2} (\tau x(\mathbf{s})) \right] &amp;= \mathcal{F}[\mathcal{W}(\mathbf{s})] \\
\tau (\kappa^2 - \mathcal{F}[\Delta])^{\alpha/2} \hat{x}(\boldsymbol{\omega}) &amp;= \hat{\mathcal{W}}(\boldsymbol{\omega}) \\
\tau (\kappa^2 + \|\boldsymbol{\omega}\|^2)^{\alpha/2} \hat{x}(\boldsymbol{\omega}) &amp;= \hat{\mathcal{W}}(\boldsymbol{\omega})
\end{aligned}
\]</span></p>
<p>Isolamos <span class="math inline">\(\hat{x}(\boldsymbol{\omega})\)</span> para encontrar a função de transferência do sistema:</p>
<p><span class="math display">\[\hat{x}(\boldsymbol{\omega}) = \frac{1}{\tau (\kappa^2 + \|\boldsymbol{\omega}\|^2)^{\alpha/2}} \hat{\mathcal{W}}(\boldsymbol{\omega})\]</span></p>
<p>A densidade espectral de potência <span class="math inline">\(S_x(\boldsymbol{\omega})\)</span> do campo <span class="math inline">\(x\)</span> é dada pelo quadrado do módulo da função de transferência multiplicado pela densidade espectral do ruído de entrada (que é 1):</p>
<p><span class="math display">\[\begin{aligned}
S_x(\boldsymbol{\omega}) &amp;= \left| \frac{1}{\tau (\kappa^2 + \|\boldsymbol{\omega}\|^2)^{\alpha/2}} \right|^2 \cdot S_{\mathcal{W}}(\boldsymbol{\omega}) \\
S_x(\boldsymbol{\omega}) &amp;= \frac{1}{\tau^2 (\kappa^2 + \|\boldsymbol{\omega}\|^2)^{\alpha}}
\end{aligned}\]</span></p>
<p>Este resultado, <span class="math inline">\(S_x(\boldsymbol{\omega}) \propto (\kappa^2 + \|\boldsymbol{\omega}\|^2)^{-\alpha}\)</span>, é exatamente a definição da densidade espectral de um campo isotrópico com covariância da classe Matérn em <span class="math inline">\(\mathbb{R}^d\)</span>, com parâmetro de suavidade <span class="math inline">\(\nu = \alpha - d/2\)</span> <span class="citation" data-cites="lindgren2022spde">Lindgren, Bolin, e Rue (<a href="references.html#ref-lindgren2022spde" role="doc-biblioref">2022</a>)</span>.</p>
<p><strong>Discretização via Método de Elementos Finitos</strong></p>
<p>A SPDE é uma equação definida no contínuo. Para implementá-la computacionalmente e obter a almejada esparsidade, precisamos discretizar o domínio espacial <span class="math inline">\(D^G\)</span>. <span class="citation" data-cites="lindgren2011explicit">Lindgren, Rue, e Lindström (<a href="references.html#ref-lindgren2011explicit" role="doc-biblioref">2011</a>)</span> propõem o uso do Método de Elementos Finitos (FEM), uma técnica numérica para encontrar soluções aproximadas de equações diferenciais parciais. O método consiste em subdividir um domínio contínuo em um conjunto de subdomínios discretos (elementos, formando uma malha) e aproximar a solução da equação como uma combinação linear de funções de base simples definidas nesses elementos <span class="citation" data-cites="cressie2022basis">(<a href="references.html#ref-cressie2022basis" role="doc-biblioref">Cressie, Sainsbury-Dale, e Zammit-Mangion 2022</a>)</span>.</p>
<p><strong>A Malha e as Funções de Base</strong></p>
<p>Subdividimos o domínio <span class="math inline">\(D^G\)</span> em uma malha (<em>mesh</em>) de triângulos não sobrepostos. Seja <span class="math inline">\(V\)</span> o número de vértices (nós) da malha. Definimos uma aproximação do campo contínuo <span class="math inline">\(x(\mathbf{s})\)</span> como:</p>
<p><span class="math display">\[x(\mathbf{s}) \approx \sum_{k=1}^V w_k \psi_k(\mathbf{s})\]</span></p>
<p>Onde:</p>
<ul>
<li><p><span class="math inline">\(w_k\)</span> são pesos aleatórios (Gaussianos) associados a cada vértice <span class="math inline">\(k\)</span>. O objetivo da inferência passa a ser encontrar a distribuição conjunta do vetor de pesos <span class="math inline">\(\mathbf{w} = (w_1, \dots, w_V)^\top\)</span>.</p></li>
<li><p><span class="math inline">\(\psi_k(\mathbf{s})\)</span> são funções de base determinísticas, lineares por partes. A função <span class="math inline">\(\psi_k\)</span> vale 1 no vértice <span class="math inline">\(k\)</span>, decai linearmente para 0 nos vértices vizinhos e é identicamente nula em todo o restante do domínio. Esta propriedade de suporte compacto é crucial para a esparsidade.</p></li>
</ul>
<p>Não podemos substituir a aproximação diretamente na SPDE <span class="math inline">\((\kappa^2 - \Delta)x = \mathcal{W}\)</span> (assumindo <span class="math inline">\(\alpha=2\)</span> para simplificar, o que equivale a <span class="math inline">\(\nu=1\)</span> em 2D), pois a segunda derivada <span class="math inline">\(\Delta\)</span> de funções lineares por partes resulta em funções indefinidas (Deltas de Dirac) nas arestas dos triângulos.</p>
<p>Para contornar isso, usamos a formulação fraca (ou variacional): multiplicamos a SPDE por uma função de teste (escolhemos a própria base <span class="math inline">\(\psi_i\)</span>) e integramos sobre o domínio <span class="math inline">\(\Omega\)</span>:</p>
<p><span class="math display">\[\int_{\Omega} \psi_i(\mathbf{s}) (\kappa^2 - \Delta) x(\mathbf{s}) \, d\mathbf{s} = \frac{1}{\tau} \int_{\Omega} \psi_i(\mathbf{s}) \mathcal{W}(\mathbf{s}) \, d\mathbf{s}, \quad \text{para } i=1,\dots,V\]</span></p>
<p>Para resolver o termo com o Laplaciano (<span class="math inline">\(\int \psi_i \Delta x\)</span>), aplicamos a Primeira Identidade de Green, que é a generalização da integração por partes para dimensões superiores. Assumindo condições de fronteira de Neumann (derivada normal nula na borda do domínio), a identidade transfere uma derivada do campo <span class="math inline">\(x\)</span> para a função de teste <span class="math inline">\(\psi_i\)</span>:</p>
<p><span class="math display">\[-\int_{\Omega} \psi_i \Delta x \, d\mathbf{s} = \int_{\Omega} \nabla \psi_i \cdot \nabla x \, d\mathbf{s}\]</span></p>
<p>Substituindo a expansão <span class="math inline">\(x(\mathbf{s}) = \sum_{j=1}^V w_j \psi_j(\mathbf{s})\)</span> na equação integral:</p>
<p><span class="math display">\[
\begin{aligned}
\int_{\Omega} \psi_i \left[ \kappa^2 \sum_j w_j \psi_j \right] d\mathbf{s} + \int_{\Omega} \nabla \psi_i \cdot \left[ \sum_j w_j \nabla \psi_j \right] d\mathbf{s} &amp;= \frac{1}{\tau} \int_{\Omega} \psi_i \mathcal{W} d\mathbf{s} \\
\sum_{j=1}^V w_j \underbrace{\int_{\Omega} \kappa^2 \psi_i \psi_j d\mathbf{s}}_{\text{Termo dependente de C}} + \sum_{j=1}^V w_j \underbrace{\int_{\Omega} \nabla \psi_i \cdot \nabla \psi_j d\mathbf{s}}_{\text{Termo dependente de G}} &amp;= \frac{1}{\tau} \int_{\Omega} \psi_i \mathcal{W} d\mathbf{s}
\end{aligned}
\]</span></p>
<p>Isso nos permite definir as matrizes esparsas fundamentais que dependem apenas da geometria da malha:</p>
<ul>
<li><p>Matriz de Massa (<span class="math inline">\(\mathbf{C}\)</span>): <span class="math inline">\(C_{ij} = \int_{\Omega} \psi_i(\mathbf{s}) \psi_j(\mathbf{s}) \, d\mathbf{s} = \langle \psi_i, \psi_j \rangle\)</span>.</p></li>
<li><p>Matriz de Rigidez (<span class="math inline">\(\mathbf{G}\)</span>): <span class="math inline">\(G_{ij} = \int_{\Omega} \nabla \psi_i(\mathbf{s}) \cdot \nabla \psi_j(\mathbf{s}) \, d\mathbf{s} = \langle \nabla \psi_i, \nabla \psi_j \rangle\)</span>.</p></li>
</ul>
<p>A equação matricial resultante para o vetor de pesos <span class="math inline">\(\mathbf{w}\)</span> é:</p>
<p><span class="math display">\[(\kappa^2 \mathbf{C} + \mathbf{G}) \mathbf{w} = \tilde{\mathbf{W}}\]</span></p>
<p>onde <span class="math inline">\(\tilde{\mathbf{W}}\)</span> é um vetor Gaussiano com média zero. Pela propriedade do ruído branco espacial, a matriz de covariância de <span class="math inline">\(\tilde{\mathbf{W}}\)</span> é igual à matriz de massa <span class="math inline">\(\mathbf{C}\)</span> (pois <span class="math inline">\(\text{Cov}(\int f \mathcal{W}, \int g \mathcal{W}) = \int fg\)</span>).</p>
<p>Nosso objetivo final é encontrar a matriz de precisão <span class="math inline">\(\mathbf{Q}\)</span> dos pesos <span class="math inline">\(\mathbf{w}\)</span>. Da equação linear derivada acima, definimos a matriz do sistema como <span class="math inline">\(\mathbf{K} = \kappa^2 \mathbf{C} + \mathbf{G}\)</span>. Temos então: <span class="math inline">\(\mathbf{K}\mathbf{w} = \tilde{\mathbf{W}}\)</span></p>
<p>A matriz de covariância de <span class="math inline">\(\mathbf{w}\)</span>, denotada por <span class="math inline">\(\boldsymbol{\Sigma}_w\)</span>, é dada por:</p>
<p><span class="math display">\[
\begin{aligned}
\boldsymbol{\Sigma}_w &amp;= \text{Var}(\mathbf{w}) \\
&amp;= \text{Var}(\mathbf{K}^{-1}\tilde{\mathbf{W}}) \\
&amp;= \mathbf{K}^{-1} \text{Var}(\tilde{\mathbf{W}}) \mathbf{K}^{-T} \quad \text{(Propriedade da variância linear)} \\
&amp;= \mathbf{K}^{-1} \mathbf{C} \mathbf{K}^{-T} \quad \text{(Pois Var}(\tilde{\mathbf{W}}) = \mathbf{C})
\end{aligned}
\]</span></p>
<p>A matriz de precisão <span class="math inline">\(\mathbf{Q}\)</span> é, por definição, a inversa da matriz de covariância:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{Q} &amp;= \boldsymbol{\Sigma}_w^{-1} \\
&amp;= (\mathbf{K}^{-1} \mathbf{C} \mathbf{K}^{-T})^{-1} \\
&amp;= \mathbf{K}^T \mathbf{C}^{-1} \mathbf{K}
\end{aligned}
\]</span></p>
<p>As matrizes <span class="math inline">\(\mathbf{K}\)</span> e <span class="math inline">\(\mathbf{C}\)</span> são esparsas, pois as funções de base <span class="math inline">\(\psi_i\)</span> e <span class="math inline">\(\psi_j\)</span> só se sobrepoem se os vértices <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span> forem vizinhos na malha. Se não forem vizinhos, as integrais são zero. No entanto, a inversa de uma matriz esparsa (<span class="math inline">\(\mathbf{C}^{-1}\)</span>) é, em geral, densa. Se usássemos <span class="math inline">\(\mathbf{C}^{-1}\)</span> na fórmula acima, <span class="math inline">\(\mathbf{Q}\)</span> se tornaria densa, destruindo todo o benefício computacional da abordagem.</p>
<p>Para resolver isso, <span class="citation" data-cites="lindgren2011explicit">Lindgren, Rue, e Lindström (<a href="references.html#ref-lindgren2011explicit" role="doc-biblioref">2011</a>)</span> utilizam a técnica de <a href="https://en.wikipedia.org/wiki/Lumped-element_model">Mass Lumping</a> (comum em métodos numéricos): substituímos a matriz de massa consistente <span class="math inline">\(\mathbf{C}\)</span> por uma matriz diagonal <span class="math inline">\(\tilde{\mathbf{C}}\)</span>, onde os elementos diagonais são a soma das linhas de <span class="math inline">\(\mathbf{C}\)</span>:</p>
<p><span class="math display">\[\tilde{C}_{ii} = \sum_j C_{ij} = \int_{\Omega} \psi_i(\mathbf{s}) d\mathbf{s}\]</span></p>
<p>Como a inversa de uma matriz diagonal é trivial e também diagonal (portanto, esparsa), podemos calcular a precisão final preservando a esparsidade. Substituindo <span class="math inline">\(\mathbf{K} = \kappa^2 \mathbf{C} + \mathbf{G}\)</span> e usando a aproximação diagonal <span class="math inline">\(\tilde{\mathbf{C}}\)</span>, obtemos a matriz de precisão explícita para <span class="math inline">\(\alpha=2\)</span>:</p>
<p><span class="math display">\[\mathbf{Q}_{\text{SPDE}} = \tau^2 (\kappa^2 \tilde{\mathbf{C}} + \mathbf{G})^T \tilde{\mathbf{C}}^{-1} (\kappa^2 \tilde{\mathbf{C}} + \mathbf{G})\]</span></p>
<p>A matriz <span class="math inline">\(\mathbf{Q}_{\text{SPDE}}\)</span> é construída apenas por somas e multiplicações de matrizes esparsas e diagonais. Portanto, <span class="math inline">\(\mathbf{Q}_{\text{SPDE}}\)</span> é esparsa. Esta esparsidade permite o uso de algoritmos eficientes de fatoração de Cholesky esparsa, reduzindo a complexidade computacional de <span class="math inline">\(\mathcal{O}(n^3)\)</span> para aproximadamente <span class="math inline">\(\mathcal{O}(n^{3/2})\)</span> em problemas espaciais 2D. Isso viabiliza a análise bayesiana (via INLA) <span class="citation" data-cites="bakka2018spatial lindgren2015bayesian">(<a href="references.html#ref-bakka2018spatial" role="doc-biblioref">Bakka et al. 2018</a>; <a href="references.html#ref-lindgren2015bayesian" role="doc-biblioref">Lindgren e Rue 2015</a>)</span> ou a estimação de máxima verossimilhança (via ExaGeoStatR) para grandes conjuntos de dados geoestatísticos (Big Data) que eram anteriormente intratáveis <span class="citation" data-cites="abdulah2023large">(<a href="references.html#ref-abdulah2023large" role="doc-biblioref">Abdulah et al. 2023</a>)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, ggplot2)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>fronteira <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>pontos <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(fronteira, <span class="at">size =</span> <span class="dv">30</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>borda_externa <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(<span class="fu">st_sfc</span>(fronteira), <span class="at">dist =</span> <span class="dv">2</span>) </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>pontos_borda <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(<span class="fu">st_cast</span>(borda_externa, <span class="st">"LINESTRING"</span>), <span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>todos_pontos <span class="ot">&lt;-</span> <span class="fu">c</span>(pontos, pontos_borda)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>malha <span class="ot">&lt;-</span> <span class="fu">st_triangulate</span>(<span class="fu">st_combine</span>(todos_pontos)) <span class="sc">|&gt;</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_collection_extract</span>(<span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> malha, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"grey60"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> fronteira, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pontos, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"(1) Triângulos cinza sao elementos finitos; (2) pontos vermelhos </span><span class="sc">\n</span><span class="st">são dados observados; (3) linha azul é o domínio de estudo"</span>) <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"grey40"</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-spde-mesh" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spde-mesh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-spde-mesh-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spde-mesh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.21: Conceito de Malha (Mesh) para SPDE. A precisão é maior onde há dados e menor nas bordas.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Aprofundamento Teórico e Prático">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Importante</span>Aprofundamento Teórico e Prático
</div>
</div>
<div class="callout-body-container callout-body">
<p>Além dos métodos abordados aqui, existem diversas variantes de Krigagem desenvolvidas para lidar com características específicas dos dados. Entre elas destacam-se: a Krigagem Lognormal (aplicada aos logaritmos dos dados); a Krigagem Multi-Gaussiana (aplicada após a transformação normal score), que é uma generalização da lognormal; a Krigagem de Postos (<em>Rank Kriging</em>, baseada na transformação uniforme); Krigagem Disjuntiva, entre outras. Para maior detalhes e aplicações, recomenda-se a leitura do capítulo 4 de <span class="citation" data-cites="DeutschJournel1997">Deutsch e Journel (<a href="references.html#ref-DeutschJournel1997" role="doc-biblioref">1997</a>)</span>.</p>
<p>Muitas vezes, a aplicação correta de transformações nos dados é suficiente para resolver problemas de estacionaridade ou não-normalidade. Aos interessados neste tópico, recomenda-se a leitura do capítulo 3 de <span class="citation" data-cites="yamamoto2013geoestatistica">Yamamoto e Landim (<a href="references.html#ref-yamamoto2013geoestatistica" role="doc-biblioref">2013</a>)</span>.</p>
<p>Por fim, para uma visão histórica completa da geoestatística e um guia prático de ferramentas computacionais, sugere-se o capítulo 3 de <span class="citation" data-cites="scalon2024analise">Scalon (<a href="references.html#ref-scalon2024analise" role="doc-biblioref">2024</a>)</span>. A obra abrange o uso do <code>R/RStudio</code>, análise exploratória, outros tipos de semivariogramas, validação de modelos e inclui um tutorial detalhado sobre o pacote <code>geoR</code>.</p>
</div>
</div>
</section>
</section>
<section id="algumas-aplicações-da-geoestatística-por-área" class="level2" data-number="3.17">
<h2 data-number="3.17" class="anchored" data-anchor-id="algumas-aplicações-da-geoestatística-por-área"><span class="header-section-number">3.17</span> Algumas aplicações da Geoestatística por área</h2>
<section id="geociências-e-engenharia-de-recursos" class="level3" data-number="3.17.1">
<h3 data-number="3.17.1" class="anchored" data-anchor-id="geociências-e-engenharia-de-recursos"><span class="header-section-number">3.17.1</span> Geociências e Engenharia de Recursos</h3>
<ul>
<li><p><strong>Mineração e Avaliação de Reservas</strong></p>
<p>A metodologia é aplicada para a estimativa de recursos e reservas recuperáveis. A Krigagem indicadora, permite modelar a distribuição local de incerteza, calculando a probabilidade de um bloco exceder um teor de corte econômico. Isso fundamenta o planejamento de lavra e a análise de seletividade.</p>
<blockquote class="blockquote">
<p><strong>Referência:</strong> JOURNEL, A. G. Nonparametric estimation of spatial distributions. <em>Mathematical Geology</em>, v. 15, n.&nbsp;3, p.&nbsp;445–468, 1983.</p>
</blockquote></li>
<li><p><strong>Engenharia de Reservatórios (Petróleo e Gás)</strong></p>
<p>A caracterização de reservatórios exige a reprodução de heterogeneidades complexas (como canais fluviais meandrantes) que impactam o fluxo de fluidos. A indústria utiliza a Estatística de Múltiplos Pontos (MPS), que substitui o variograma por “imagens de treinamento” para simular estruturas curvilíneas e conectividade de fácies, essenciais para a simulação de fluxo.</p>
<blockquote class="blockquote">
<p><strong>Referência:</strong> STREBELLE, S. Conditional simulation of complex geological structures using multiple-point statistics. <em>Mathematical Geology</em>, v. 34, n.&nbsp;1, p.&nbsp;1–21, 2002.</p>
</blockquote></li>
</ul>
</section>
<section id="ciências-agrárias-e-ambientais" class="level3" data-number="3.17.2">
<h3 data-number="3.17.2" class="anchored" data-anchor-id="ciências-agrárias-e-ambientais"><span class="header-section-number">3.17.2</span> 2. Ciências Agrárias e Ambientais</h3>
<p>O foco deste domínio é a otimização de recursos (insumos) e o monitoramento de variáveis contínuas em superfície.</p>
<ul>
<li><p><strong>Agricultura de Precisão e Ciência do Solo</strong></p>
<p>A geoestatística quantifica a dependência espacial de atributos físico-químicos do solo para definir zonas de manejo. A análise da razão <em>nugget/sill</em> no variograma classifica a estabilidade da estrutura espacial, orientando a interpolação para aplicação de insumos à taxa variável (VRT), o que maximiza a eficiência agronômica e reduz o impacto ambiental.</p>
<blockquote class="blockquote">
<p><strong>Referência:</strong> CAMBARDELLA, C. A. et al.&nbsp;Field-scale variability of soil properties in central Iowa soils. <em>Geoderma</em>, v. 60, n.&nbsp;1-4, p.&nbsp;150–170, 1994.</p>
</blockquote></li>
<li><p><strong>Climatologia e Hidrologia</strong></p>
<p>Em redes de monitoramento esparsas, técnicas multivariadas como a Krigagem com Deriva Externa (KED) são empregadas para interpolar precipitação e temperatura. O método incorpora modelos digitais de elevação (DEM) como covariáveis exaustivas, corrigindo tendências orográficas e aumentando significativamente a precisão das estimativas hidrológicas.</p>
<blockquote class="blockquote">
<p><strong>Referência:</strong> GOOVAERTS, P. Geostatistical approaches for incorporating elevation into the spatial interpolation of rainfall. <em>Journal of Hydrology</em>, v. 228, n.&nbsp;1-2, p.&nbsp;113–129, 2000.</p>
</blockquote></li>
</ul>
</section>
<section id="saúde-pública-e-ciências-sociais" class="level3" data-number="3.17.3">
<h3 data-number="3.17.3" class="anchored" data-anchor-id="saúde-pública-e-ciências-sociais"><span class="header-section-number">3.17.3</span> 3. Saúde Pública e Ciências Sociais</h3>
<p>A aplicação centra-se na detecção de <em>clusters</em> e no mapeamento de risco em populações.</p>
<ul>
<li><p><strong>Epidemiologia</strong></p>
<p>A Geoestatística é usada para o mapeamento de doenças tropicais (ex: Malária). Esta abordagem acopla processos Gaussianos a Modelos Lineares Generalizados Mistos (GLMM), permitindo inferir superfícies de probabilidade de infecção em locais não amostrados, servindo de base para políticas da Organização Mundial da Saúde (OMS).</p>
<blockquote class="blockquote">
<p><strong>Referência 1:</strong> DIGGLE, P. J.; TAWN, J. A.; MOYCEED, R. A. Model-based geostatistics. <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em>, v. 47, n.&nbsp;3, p.&nbsp;299–350, 1998.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Referência 2:</strong> Artigos da Professora Paula Moraga e referências neles existentes</p>
</blockquote></li>
</ul>
</section>
<section id="energias-renováveis" class="level3" data-number="3.17.4">
<h3 data-number="3.17.4" class="anchored" data-anchor-id="energias-renováveis"><span class="header-section-number">3.17.4</span> 4. Energias Renováveis</h3>
<ul>
<li><p><strong>Previsão de Potencial Eólico e Solar</strong></p>
<p>A viabilidade de parques energéticos depende da mitigação da intermitência climática. Modelos geoestatísticos são utilizados para prever a disponibilidade de irradiância solar e velocidade do vento, integrando dados de satélite e estações terrestres para garantir a estabilidade da rede elétrica.</p></li>
</ul>
</section>
</section>
<section id="pacote-gstat" class="level2" data-number="3.18">
<h2 data-number="3.18" class="anchored" data-anchor-id="pacote-gstat"><span class="header-section-number">3.18</span> Pacote gstat</h2>
<p>O pacote <code>gstat</code> <span class="citation" data-cites="pebesma2004multivariable graler2016spatio">(<a href="references.html#ref-pebesma2004multivariable" role="doc-biblioref">Pebesma 2004</a>; <a href="references.html#ref-graler2016spatio" role="doc-biblioref">Gräler, Pebesma, e Heuvelink 2016</a>)</span> é de autoria do professor <a href="https://scholar.google.com/citations?user=d6jdqdQAAAAJ&amp;hl=en">Edzer Pebesma</a>, junto com o pacote <code>geoR</code> <span class="citation" data-cites="geoR ribeiro2006geor">(<a href="references.html#ref-geoR" role="doc-biblioref">Paulo Justiniano Ribeiro Jr e Diggle 2025</a>; <a href="references.html#ref-ribeiro2006geor" role="doc-biblioref">Paulo J. Ribeiro Jr e Diggle 2006</a>)</span> da autoria dos professores <a href="https://scholar.google.com/citations?user=-Odk2HgAAAAJ&amp;hl=pt-BR">Paulo Justiniano Ribeiro Jr</a> e <a href="https://scholar.google.com/citations?user=GcTKrPIAAAAJ&amp;hl=en">Peter J. Diggle</a> se estabeleceram como a pacotes de referência no ambiente <code>R</code> para a modelagem geoestatística. Aqui é descrito apenas o pacote <code>gstat</code>. Aos interressados na descrição completa do pacote <code>geoR</code> sugere-se o capítulo 3 de <span class="citation" data-cites="scalon2024analise">Scalon (<a href="references.html#ref-scalon2024analise" role="doc-biblioref">2024</a>)</span>.</p>
<p>Embora suas raízes estejam no antigo pacote <code>sp</code>, as versões contemporâneas do gstat integram-se nativamente com os pacotes <code>sf</code> (<em>Simple Features</em>) e <code>stars</code> (<em>Spatiotemporal Arrays</em>), permitindo um fluxo de trabalho moderno e computacionalmente eficiente.</p>
<p>Utilizaremos o conjunto de dados meuse (concentração de metais pesados na planície de inundação do rio Meuse, Holanda) para demonstração.</p>
<p><strong>Preparação do Ambiente e Dados</strong></p>
<p>Para a execução de rotinas geoestatísticas, dois componentes geométricos são imprescindíveis:</p>
<ol type="1">
<li><p>Dados Observados (Suporte Pontual): As amostras coletadas em campo.</p></li>
<li><p>Malha de Predição (Suporte de Área/Grade): O domínio espacial discretizado onde as estimativas serão realizadas.</p></li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(gstat, sf, stars, ggplot2, viridis, dplyr,gt, gridExtra)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Carregamento e conversão dos dados amostrais</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># O CRS 28992 refere-se à projeção holandesa Amersfoort / RD New, vc nos seus dados usaraa crs=4326</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(meuse_sf)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 155
Columns: 13
$ cadmium  &lt;dbl&gt; 11.7, 8.6, 6.5, 2.6, 2.8, 3.0, 3.2, 2.8, 2.4, 1.6, 1.4, 1.8, …
$ copper   &lt;dbl&gt; 85, 81, 68, 81, 48, 61, 31, 29, 37, 24, 25, 25, 93, 31, 27, 8…
$ lead     &lt;dbl&gt; 299, 277, 199, 116, 117, 137, 132, 150, 133, 80, 86, 97, 285,…
$ zinc     &lt;dbl&gt; 1022, 1141, 640, 257, 269, 281, 346, 406, 347, 183, 189, 251,…
$ elev     &lt;dbl&gt; 7.909, 6.983, 7.800, 7.655, 7.480, 7.791, 8.217, 8.490, 8.668…
$ dist     &lt;dbl&gt; 0.00135803, 0.01222430, 0.10302900, 0.19009400, 0.27709000, 0…
$ om       &lt;dbl&gt; 13.6, 14.0, 13.0, 8.0, 8.7, 7.8, 9.2, 9.5, 10.6, 6.3, 6.4, 9.…
$ ffreq    &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ soil     &lt;fct&gt; 1, 1, 1, 2, 2, 2, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ lime     &lt;fct&gt; 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1…
$ landuse  &lt;fct&gt; Ah, Ah, Ah, Ga, Ah, Ga, Ah, Ab, Ab, W, Fh, Ag, W, Ah, Ah, W, …
$ dist.m   &lt;dbl&gt; 50, 30, 150, 270, 380, 470, 240, 120, 240, 420, 400, 300, 20,…
$ geometry &lt;POINT [m]&gt; POINT (181072 333611), POINT (181025 333558), POINT (18…</code></pre>
</div>
</div>
<p><strong>Criação da Malha de Predição (Grid)</strong></p>
<p>A krigagem precisa de locais para onde serão feitas as predições. Para tal criaremos uma grade regular (<code>raster</code>) baseada nos limites da área.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O pacote traz um polígono 'meuse.area', vamos convertê-lo para sf</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse.area)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>limite_sf <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">as.matrix</span>(meuse.area))) <span class="sc">|&gt;</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="dv">28992</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>() <span class="co">#provavelmente vc terá um arquivo shapfile, use arquivo .shp</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Gerar a Grade Regular (Rasterização Vetorial)</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># st_make_grid cria a geometria. 'cellsize' define a resolução (ex: 40x40 metros)</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>grid_vetorial <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(limite_sf, <span class="at">cellsize =</span> <span class="dv">40</span>, <span class="at">what =</span> <span class="st">"centers"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(limite_sf) <span class="co"># Recorta a grade para ficar apenas dentro do polígono</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Conversão para STARS (Mais eficiente para o gstat)</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>grid_stars <span class="ot">&lt;-</span> <span class="fu">st_as_stars</span>(<span class="fu">st_bbox</span>(limite_sf), <span class="at">dx =</span> <span class="dv">40</span>, <span class="at">dy =</span> <span class="dv">40</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>grid_stars <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(grid_stars, limite_sf) <span class="co"># Mascara o que está fora do limite</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_vetorial, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span> <span class="co"># vc pode trocar 'grid_vetorial' por 'grid_stars'</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> meuse_sf, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span><span class="co"># e aqui trocar 'geom_sf' por geom_stars(data=grid_stars)</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>limite_sf, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Domínio de Predição (Grade) e Amostras (Vermelho)"</span>) <span class="sc">+</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Análise exploratória espacial</strong></p>
<p>Antes de modelar, é necessário verificar a existência de dependência espacial.</p>
<p><code>hscat:</code> Gráficos de Dispersão Defasados</p>
<p>A função <code>hscat</code> (<code>h-scatterplots</code>) confronta o valor de <span class="math inline">\(Z(s)\)</span> com <span class="math inline">\(Z(s+h)\)</span>. Se houver estrutura espacial, espera-se que, para distâncias (<span class="math inline">\(h\)</span>) pequenas, os pontos se alinhem à diagonal (alta correlação). Conforme <span class="math inline">\(h\)</span> aumenta, a nuvem deve se dispersar.</p>
<ul>
<li><p><code>formula:</code> Define a variável e/ou variável resposta (<code>ex: log(zinc) ~ 1</code>) (recomenda-se transformação logarítmica para dados assimétricos de concentração).</p></li>
<li><p><code>data:</code> O objeto espacial contendo as observações.</p></li>
<li><p><code>breaks:</code> Vetor numérico definindo os limites dos intervalos de distância (lags).</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hscat</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>meuse_sf, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">400</span>, <span class="dv">800</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-hscat" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hscat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-hscat-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hscat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.22: Dispersão espacial do log(Zinco) em diferentes lags
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Modelagem da Covariância</strong></p>
<p>A etapa central da geoestatística é a determinação da função de semivariância <span class="math inline">\(\gamma(h)\)</span>, que quantifica a dissimilaridade espacial.</p>
<ul>
<li>O Variograma Experimental: <code>variogram</code></li>
</ul>
<p>A função <code>variogram</code> calcula a semivariância média para classes de distância discretas a partir dos dados observados.</p>
<ol type="1">
<li><p>Sintaxe: <code>variogram(object, locations, ...)</code></p></li>
<li><p>Argumentos:</p></li>
</ol>
<ul>
<li><p><code>formula:</code> Para Krigagem Ordinária, utiliza-se <code>z ~ 1</code> (média constante). Para Krigagem Universal, define-se a tendência, ex:<code>z ~ x + y</code>, para as demais krigagens consulte a seção <a href="#sec-metodos_predicao" class="quarto-xref"><span>Seção 3.13</span></a>.</p></li>
<li><p><code>cutoff:</code> A distância máxima de investigação. Por convenção, limita-se a 1/3 da diagonal da área de estudo para garantir representatividade amostral nos lags.</p></li>
<li><p><code>width:</code> A largura do intervalo de classe (tamanho do lag).</p></li>
<li><p><code>cloud:</code> Se TRUE, retorna a nuvem variográfica (semivariância de todos os pares individuais), útil para detecção de outliers.</p></li>
<li><p><code>map:</code> Se TRUE, gera um mapa variográfico para inspeção de anisotropia.</p></li>
<li><p><code>alpha:</code> Direção em graus (ex: c(0, 45, 90, 135)) para investigar anisotropia.</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variograma Omnidirecional (Isotrópico)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>v_exp <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse_sf, <span class="at">cutoff =</span> <span class="dv">1200</span>, <span class="at">width =</span> <span class="dv">100</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(v_exp, <span class="at">main =</span> <span class="st">"Semivariograma Experimental"</span>, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Distância (m)"</span>, <span class="at">ylab =</span> <span class="st">"Semivariância"</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Definição do Modelo Teórico</strong>: <code>vgm</code></p>
<p>O variograma experimental fornece pontos discretos. A krigagem exige uma função contínua e positiva definida. A função <code>vgm</code> estrutura este modelo.</p>
<ul>
<li><p><code>psill</code>: Patamar parcial (variância estrutural).</p></li>
<li><p><code>model</code>: Família da curva.</p>
<ul>
<li><p>“Sph” (Esférico): Crescimento linear na origem, atinge patamar definido.</p></li>
<li><p>“Exp” (Exponencial): Crescimento abrupto, atinge patamar assintoticamente.</p></li>
<li><p>“Gau” (Gaussiano): Suave na origem (parabólico), indica alta continuidade.</p></li>
</ul></li>
<li><p><code>range:</code> Alcance.</p></li>
<li><p><code>nugget:</code> Efeito pepita (erro na origem).</p></li>
</ul>
<p>Para visualizar as famílias disponíveis, utiliza-se <code>show.vgms()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definição inicial baseada na inspeção visual do gráfico anterior</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>modelo_inicial <span class="ot">&lt;-</span> <span class="fu">vgm</span>(<span class="at">psill =</span> <span class="fl">0.6</span>, <span class="at">model =</span> <span class="st">"Sph"</span>, <span class="at">range =</span> <span class="dv">800</span>, <span class="at">nugget =</span> <span class="fl">0.05</span>) </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#range 800 porque parece se estabilizar nele</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># no mesmo lugar que se estabiliza range 800, temos uma patamar (psill) de ~ 0.6 a 0.7</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#começa meio como linha reta obliquo, então aparenta ser esférico (Sph)</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># se olhar para onde se interceta o eixo y parece ser ~0.05 esse é efeito pepita (nugget)</span></span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>:: {.callout-important title=“Correção da Anisotropia Geométrica”}</p>
<p>Para corrigir a anisotropia geométrica no gstat, utilizamos o argumento anis dentro da função de modelagem do variograma:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vgm</span>(<span class="at">psill =</span> <span class="cn">NA</span>, model, <span class="at">range =</span> <span class="cn">NA</span>, nugget, add.to, anis, <span class="at">kappa =</span> <span class="fl">0.5</span>, ..., covtable, <span class="at">Err =</span> <span class="dv">0</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
<p>A correção é feita seguindo estes passos:</p>
<ol type="1">
<li><p>Construímos variogramas para diferentes direções (geralmente <span class="math inline">\(0^\circ\)</span>, <span class="math inline">\(45^\circ\)</span>, <span class="math inline">\(90^\circ\)</span> e <span class="math inline">\(135^\circ\)</span>).</p></li>
<li><p>Eixo Maior (Ângulo): Identificamos a direção que apresenta o maior alcance (e não o maior patamar, pois na anisotropia geométrica o patamar é assumido como constante). O ângulo dessa direção (medido em graus a partir do Norte, no sentido horário) será o primeiro valor de <code>anis</code>.</p></li>
<li><p>Razão de Anisotropia (<span class="math inline">\(\lambda\)</span>): Calculamos a razão entre o menor alcance (da direção perpendicular) e o maior alcance. <span class="math display">\[\lambda = \frac{\text{alcance menor}}{\text{alcance maior}}\]</span></p></li>
</ol>
<p><strong>Nota</strong>: No geoR é <span class="math inline">\(\lambda = \frac{\text{alcance maior}}{\text{alcance menor}}\)</span></p>
<p>O argumento final será preenchido como <code>anis = c(ângulo, razão)</code>. Por exemplo, se o maior alcance for 100m na direção <span class="math inline">\(45^\circ\)</span> e o menor for 50m, usamos anis = c(45, 0.5), onde <span class="math inline">\(0.5=50 \text{m /100 m}\)</span>. Isso encolhe o modelo na direção de menor continuidade para que ele se ajuste à realidade dos dados.</p>
<p>Maiores detalhes sobre este ajuste podem ser consultados na seção <a href="#sec-anisotropia" class="quarto-xref"><span>Seção 3.9</span></a> .</p>
<p>:::</p>
<p><strong>Ajuste de Parâmetros</strong>: <code>fit.variogram</code></p>
<p>A função <code>fit.variogram</code> ajusta os parâmetros do modelo teórico (<code>vgm</code>) aos pontos experimentais (<code>v_exp</code>) utilizando Mínimos Quadrados Ponderados (WLS). O método pondera mais fortemente os lags iniciais (menores distâncias), que contêm mais pares de pontos e são cruciais para a interpolação.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>modelo_ajustado <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(v_exp, modelo_inicial)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>modelo_ajustado<span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-var-fit-1" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-var-fit-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">psill</th>
<th style="text-align: right;">range</th>
<th style="text-align: right;">kappa</th>
<th style="text-align: right;">ang1</th>
<th style="text-align: right;">ang2</th>
<th style="text-align: right;">ang3</th>
<th style="text-align: right;">anis1</th>
<th style="text-align: right;">anis2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Nug</td>
<td style="text-align: right;">0.0635564</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sph</td>
<td style="text-align: right;">0.6042690</td>
<td style="text-align: right;">979.887</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-var-fit-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.23: Ajuste do modelo teórico
</figcaption>
</figure>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(v_exp, modelo_ajustado)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-var-fit-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-var-fit-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-var-fit-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-var-fit-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.24: Ajuste do modelo teórico
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Extração de Valores</strong>: <code>variogramLine</code></p>
<p>Se desejar reproduzir a curva teórica no ggplot2, esta função gera os dados da linha.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>linha_teorica <span class="ot">&lt;-</span> <span class="fu">variogramLine</span>(modelo_ajustado, <span class="at">maxdist =</span> <span class="dv">1200</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(linha_teorica) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">dist</th>
<th style="text-align: right;">gamma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.001200</td>
<td style="text-align: right;">0.0635575</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.031345</td>
<td style="text-align: right;">0.0691354</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12.061489</td>
<td style="text-align: right;">0.0747128</td>
</tr>
<tr class="even">
<td style="text-align: right;">18.091634</td>
<td style="text-align: right;">0.0802894</td>
</tr>
<tr class="odd">
<td style="text-align: right;">24.121779</td>
<td style="text-align: right;">0.0858648</td>
</tr>
<tr class="even">
<td style="text-align: right;">30.151924</td>
<td style="text-align: right;">0.0914384</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Krigagem: Interpolação espacial</strong>: <code>krige</code></p>
<p>A função <code>krige</code> seleciona automaticamente o método adequado (Simples, Ordinária, Universal) baseando-se nos argumentos fornecidos.</p>
<ul>
<li><p>Sintaxe: <code>krige(formula, locations, newdata, model)</code></p></li>
<li><p>Argumentos:</p>
<ul>
<li><p><code>formula:</code> log(zinc) ~ 1 indica ausência de variáveis explicativas exógenas (apenas intercepto).</p></li>
<li><p><code>locations:</code> Objeto <code>sf</code> com os dados observados.</p></li>
<li><p><code>newdata</code>: Objeto <code>sf</code> ou <code>stars</code> com os locais de predição.</p></li>
<li><p><code>model:</code> O modelo de variograma ajustado.</p></li>
<li><p><code>block:</code> (Opcional) Se fornecido um vetor, ex: c(40, 40), realiza Krigagem de Bloco, estimando o valor médio dentro da célula, resultando em mapas mais suaves e menor variância de predição.</p></li>
</ul></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Execução da Krigagem Ordinária</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>krigagem_ord <span class="ot">&lt;-</span> <span class="fu">krige</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">locations =</span> meuse_sf,  <span class="co"># Dados</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newdata =</span>grid_vetorial ,  <span class="co"># Grade de destino, vc poderia usar tambem grid_stars</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">model =</span> modelo_ajustado, <span class="at">debug.level =</span> <span class="dv">0</span>) <span class="co"># Modelo espacial</span></span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>O objeto resultante (krigagem_ord) contém duas variáveis fundamentais:</p>
<ul>
<li><p><code>var1.pred:</code> O valor predito (estimativa).</p></li>
<li><p><code>var1.var:</code> A variância da krigagem (incerteza da estimativa).</p></li>
</ul>
<p><strong>Visualização de Mapas de Predição e Incerteza</strong></p>
<p>A apresentação correta dos resultados exige a exibição da estimativa juntamente com sua incerteza associada.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(stars)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>krigagem_raster <span class="ot">&lt;-</span> <span class="fu">st_rasterize</span>(krigagem_ord) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crop</span>( limite_sf)  <span class="co">#corta apenas a area do shapfile</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> krigagem_raster, <span class="fu">aes</span>(<span class="at">fill =</span> var1.pred, <span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>, <span class="at">name =</span> <span class="st">"log(Zn)"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> limite_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predição (Superfície Raster)"</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> krigagem_raster, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">sqrt</span>(var1.var), <span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>, <span class="at">name =</span> <span class="st">"SD"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> limite_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Incerteza (Desvio Padrão)"</span>) <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>()) <span class="co">#remove os eixos x e y (veja no da esquerda existem porque não removemos)</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>g1; g2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-kriging-maps-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kriging-maps-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-kriging-maps-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kriging-maps-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.25: Mapas de Predição e Incerteza (Desvio Padrão)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-kriging-maps-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kriging-maps-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-kriging-maps-2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kriging-maps-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.26: Mapas de Predição e Incerteza (Desvio Padrão)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>Alternativamente poderia fazer:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># st_bbox pega os limites da área</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(limite_sf) <span class="co"># onde limite_sf é seu shapfile</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar objeto stars vazio com resolução de 40m</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>grid_raster <span class="ot">&lt;-</span> <span class="fu">st_as_stars</span>(bb, <span class="at">dx =</span> <span class="dv">40</span>, <span class="at">dy =</span> <span class="dv">40</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recortar (Crop) o raster usando o polígono limite</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>grid_raster <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(grid_raster, limite_sf)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>krigagem_direta <span class="ot">&lt;-</span> <span class="fu">krige</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">locations =</span> meuse_sf, </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> grid_raster, </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">model =</span> modelo_ajustado, <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> krigagem_direta, <span class="fu">aes</span>(<span class="at">fill =</span> var1.pred)) <span class="sc">+</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"log(Zn)"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> limite_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Krigagem Ordinária"</span>) <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="co"># Remove espaços em branco extras nas margens</span></span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Validação Cruzada:</strong> <code>krige.cv</code></p>
<p>Para aferir a qualidade preditiva do modelo, utiliza-se a função <code>krige.cv</code>. Esta função executa o procedimento <code>leave-one-out</code> (ou k-fold), que remove um ponto, estima-o com os vizinhos, compara o real com o estimado, repete para todos.</p>
<ul>
<li><p>Sintaxe: <code>krige.cv(formula, locations, model, nfold, ...)</code></p></li>
<li><p>Argumentos:</p>
<ul>
<li><code>nfold:</code> Se omitido ou igual ao número de observações, faz <code>leave-one-out</code>. Se definido (ex: 5 ou 10), faz validação cruzada em k-partes.</li>
</ul></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>validacao <span class="ot">&lt;-</span> <span class="fu">krige.cv</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">locations =</span> meuse_sf, <span class="at">model =</span> modelo_ajustado, <span class="at">debug.level =</span> <span class="dv">0</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><strong>Extração de Métricas de Diagnóstico</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resíduo = Observado - Predito</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Z-score = Resíduo / Desvio Padrão da Krigagem</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> validacao <span class="sc">|&gt;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ME =</span> <span class="fu">mean</span>(residual),              <span class="co"># Erro Médio (Viés): Ideal -&gt; 0</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residual<span class="sc">^</span><span class="dv">2</span>)),    <span class="co"># Acurácia: Ideal -&gt; Baixo</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">MSNE =</span> <span class="fu">mean</span>(zscore),              <span class="co"># Viés Normalizado: Ideal -&gt; 0</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSNE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(zscore<span class="sc">^</span><span class="dv">2</span>))      <span class="co"># Consistência da Variância: Ideal -&gt; 1</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>metricas<span class="sc">|&gt;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">ME</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">MSNE</th>
<th style="text-align: right;">RMSNE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-0.0004748</td>
<td style="text-align: right;">0.3978521</td>
<td style="text-align: right;">-0.0003306</td>
<td style="text-align: right;">0.8972854</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Simulação Estocástica</strong></p>
<p>A Krigagem suaviza a realidade. Para aplicações que exigem a reprodução da textura real da variabilidade (ex: fluxo em meios porosos, análise de risco ambiental), utiliza-se simulação.</p>
<p>Basta adicionar o argumento <code>nsim</code> e definir <code>nmax</code> (para Simulação Sequencial Gaussiana local).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nsim = 4 gera quatro mapas possíveis da realidade</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>simulacoes <span class="ot">&lt;-</span> <span class="fu">krige</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">locations =</span> meuse_sf, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> grid_stars, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> modelo_ajustado, </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nsim =</span> <span class="dv">4</span>, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nmax =</span> <span class="dv">30</span>, <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>dados_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">merge</span>(simulacoes))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">merge</span>(simulacoes)) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="at">data=</span>dados_df,<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y,<span class="at">z=</span>var1),<span class="at">color=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="fl">0.2</span>,<span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span> <span class="co">#linhas de contorno (isolines)</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>attributes) <span class="sc">+</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> limite_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"inferno"</span>, <span class="at">name =</span> <span class="st">"log(Zn)"</span>, <span class="at">na.value =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Simulação com Curvas de Nível"</span>)<span class="sc">+</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-sim-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.27: Cenários equiprováveis (Realizações)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="pacote-automap" class="level2" data-number="3.19">
<h2 data-number="3.19" class="anchored" data-anchor-id="pacote-automap"><span class="header-section-number">3.19</span> Pacote automap</h2>
<p>Enquanto no pacote <code>gstat</code> o usuário deve fornecer estimativas iniciais (chutes) para os parâmetros do variograma <code>(patamar, alcance e efeito pepita)</code> e testar manualmente diferentes funções de covariância <code>(Esférico, Exponencial, Matérn, etc.)</code>, o pacote <code>automap</code> foi desenvolvido para automatizar essas etapas de ajuste e krigagem.</p>
<p>Baseado na metodologia descrita por <span class="citation" data-cites="automap">Hiemstra et al. (<a href="references.html#ref-automap" role="doc-biblioref">2008</a>)</span>, o pacote é ideal para situações onde se deseja realizar interpolação espacial sem a necessidade de definir manualmente os parâmetros iniciais, ou quando é necessário processar múltiplos conjuntos de dados em lote. O pacote estima os valores iniciais a partir dos dados e itera sobre diferentes modelos para encontrar o melhor ajuste baseado na menor soma dos quadrados dos resíduos.</p>
<p><strong>Ajuste Automático do Variograma</strong>: <code>autofitVariogram</code></p>
<p>Esta função elimina a necessidade de tentativa e erro manual. Ao contrário da função <code>fit.variogram</code> do <code>gstat</code>, que exige parâmetros iniciais, a <code>autofitVariogram</code> calcula esses valores automaticamente: o alcance inicial é definido como 0,10 vezes a diagonal da área dos dados (<code>bounding box</code>), o <code>efeito pepita</code> inicial é o mínimo da semivariância amostral, e o <code>patamar</code> é uma média entre o máximo e a mediana da semivariância . O algoritmo então ajusta e testa automaticamente os modelos Esférico, Exponencial, Gaussiano e Stein (Matérn), retornando aquele com o melhor ajuste estatístico . No canto inferior direito mostra o modelo ajustado e respetivos parâmetros.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(automap, sf, gstat)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>variograma_auto <span class="ot">&lt;-</span> <span class="fu">autofitVariogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">input_data =</span> <span class="fu">as</span>(meuse_sf, <span class="st">"Spatial"</span>))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(variograma_auto)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpolação Automática</strong>: <code>autoKrige</code></p>
<p>A função <code>autoKrige</code> é chama internamente a <code>autofitVariogram</code> para ajustar o modelo e, em seguida, utiliza esse modelo otimizado para realizar a predição espacial nos novos locais . Isso resolve o problema de ter que passar manualmente os parâmetros do variograma para a função de krigagem. Ela suporta Krigagem Ordinária (padrão), Universal (inserindo covariáveis na fórmula) e Krigagem de Bloco .</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(stars, sp)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meuse.grid)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>meuse_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>meuse_grid_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(meuse.grid, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">28992</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>meuse_grid_stars <span class="ot">&lt;-</span> <span class="fu">st_rasterize</span>(meuse_grid_sf, <span class="at">dx =</span> <span class="dv">40</span>, <span class="at">dy =</span> <span class="dv">40</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>krigagem <span class="ot">&lt;-</span> <span class="fu">autoKrige</span>(<span class="fu">log</span>(zinc)<span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">input_data =</span> meuse_sf, </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">new_data =</span> meuse_grid_stars, <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(krigagem)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Extraindo o resultado para plotar com ggplot</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(patchwork)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>resultado_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(krigagem<span class="sc">$</span>krige_output)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resultado_sf) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> var1.pred), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># color=NA é crucial aqui</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Log(Zn)"</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predição"</span>) <span class="sc">+</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resultado_sf) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">sqrt</span>(var1.var)), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"cividis"</span>, <span class="at">name =</span> <span class="st">"SD"</span>) <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Erro Padrão"</span>) <span class="sc">+</span> </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Validação Cruzada Automática</strong>: <code>autoKrige.cv</code></p>
<p>Para garantir que a automação não comprometeu a qualidade da predição, a função <code>autoKrige.cv</code> realiza a validação cruzada. Ela ajusta o variograma automaticamente e aplica a validação (<code>leave-one-out ou k-fold</code>) usando a função <code>krige.cv</code> do <code>gstat</code>. Isso permite verificar rapidamente se a estratégia automática está gerando resíduos aceitáveis sem a necessidade de configurar loops manuais de validação.</p>
<p>Para avaliar a qualidade do modelo ajustado automaticamente, utiliza-se a autoKrige.cv. Esta função ajusta o variograma aos dados e, em seguida, utiliza a função krige.cv do gstat para realizar a validação cruzada (cross-validation)7. Ela suporta tanto o método leave-one-out quanto o k-fold (validar subconjuntos de dados) através do argumento nfold8.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validação cruzada automática (10-fold) para KO</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>cv_ordinaria <span class="ot">&lt;-</span> <span class="fu">autoKrige.cv</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">input_data =</span> <span class="fu">as</span>(meuse_sf, <span class="st">"Spatial"</span>),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nfold =</span> <span class="dv">10</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Validação cruzada automática para Krigagem Universal (usando distância como covariável)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>cv_universal <span class="ot">&lt;-</span> <span class="fu">autoKrige.cv</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="fu">sqrt</span>(dist),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">input_data =</span> <span class="fu">as</span>(meuse_sf, <span class="st">"Spatial"</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nfold =</span> <span class="dv">10</span>, <span class="at">debug.level =</span> <span class="dv">0</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumo dos resíduos</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_ordinaria<span class="sc">$</span>krige.cv_output)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPointsDataFrame
Coordinates:
             min    max
coords.x1 178605 181390
coords.x2 329714 333611
Is projected: TRUE 
proj4string :
[+proj=sterea +lat_0=52.1561605555556 +lon_0=5.38763888888889
+k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs]
Number of points: 155
Data attributes:
   var1.pred        var1.var         observed        residual        
 Min.   :4.891   Min.   :0.1151   Min.   :4.727   Min.   :-0.969586  
 1st Qu.:5.369   1st Qu.:0.1564   1st Qu.:5.288   1st Qu.:-0.199327  
 Median :5.862   Median :0.1808   Median :5.787   Median :-0.002832  
 Mean   :5.882   Mean   :0.1895   Mean   :5.886   Mean   : 0.004181  
 3rd Qu.:6.347   3rd Qu.:0.2017   3rd Qu.:6.514   3rd Qu.: 0.218404  
 Max.   :7.265   Max.   :0.5400   Max.   :7.517   Max.   : 1.387144  
     zscore               fold       
 Min.   :-2.251356   Min.   : 1.000  
 1st Qu.:-0.467268   1st Qu.: 4.000  
 Median :-0.006538   Median : 6.000  
 Mean   : 0.010897   Mean   : 5.768  
 3rd Qu.: 0.515972   3rd Qu.: 8.000  
 Max.   : 3.108253   Max.   :10.000  </code></pre>
</div>
</div>
<p><strong>Comparação de Modelos</strong>: <code>compare.cv</code></p>
<p>Dado que a escolha entre Krigagem Ordinária e Universal pode ser difícil, a função <code>compare.cv</code> permite comparar diretamente os resultados de múltiplas validações cruzadas. Ela gera diagnósticos estatísticos (como RMSE e Correlação) e gráficos espaciais de bolhas (<code>bubble plots</code>) para identificar visualmente qual abordagem automática produziu menores erros. O argumento <code>plot.diff</code> destaca onde um modelo supera o outro.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>comparacao <span class="ot">&lt;-</span> <span class="fu">compare.cv</span>(cv_ordinaria, cv_universal,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Ordinária"</span>, <span class="st">"Universal"</span>),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bubbleplots =</span> <span class="cn">TRUE</span>, <span class="co"># Gera os gráficos na janela de plotagem</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plot.diff =</span> <span class="cn">FALSE</span>)   </span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geostat_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparacao<span class="sc">$</span>spatial)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>comparacao1 <span class="ot">&lt;-</span> <span class="fu">compare.cv</span>(cv_ordinaria, cv_universal,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Ordinária"</span>, <span class="st">"Universal"</span>),</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bubbleplots =</span> <span class="cn">FALSE</span>, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plot.diff =</span> <span class="cn">FALSE</span>)   </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>comparacao1 <span class="sc">|&gt;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Ordinária</th>
<th style="text-align: left;">Universal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mean_error</td>
<td style="text-align: left;">0.004181</td>
<td style="text-align: left;">0.001329</td>
</tr>
<tr class="even">
<td style="text-align: left;">me_mean</td>
<td style="text-align: left;">0.0007103</td>
<td style="text-align: left;">0.0002258</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MAE</td>
<td style="text-align: left;">0.2933</td>
<td style="text-align: left;">0.2709</td>
</tr>
<tr class="even">
<td style="text-align: left;">MSE</td>
<td style="text-align: left;">0.1551</td>
<td style="text-align: left;">0.1442</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MSNE</td>
<td style="text-align: left;">0.8247</td>
<td style="text-align: left;">1.088</td>
</tr>
<tr class="even">
<td style="text-align: left;">cor_obspred</td>
<td style="text-align: left;">0.8378</td>
<td style="text-align: left;">0.8499</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cor_predres</td>
<td style="text-align: left;">0.06733</td>
<td style="text-align: left;">-0.0531</td>
</tr>
<tr class="even">
<td style="text-align: left;">RMSE</td>
<td style="text-align: left;">0.3938</td>
<td style="text-align: left;">0.3797</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RMSE_sd</td>
<td style="text-align: left;">0.5455</td>
<td style="text-align: left;">0.526</td>
</tr>
<tr class="even">
<td style="text-align: left;">URMSE</td>
<td style="text-align: left;">0.3938</td>
<td style="text-align: left;">0.3797</td>
</tr>
<tr class="odd">
<td style="text-align: left;">iqr</td>
<td style="text-align: left;">0.4177</td>
<td style="text-align: left;">0.3999</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Intervalos de Predição de Posição</strong>: <code>posPredictionInterval</code></p>
<p>Esta função oferece uma ferramenta prática para tomada de decisão baseada na incerteza da krigagem automática. Ela calcula a posição do intervalo de predição (padrão 95%) em relação a um valor limite (cutoff). O mapa resultante classifica as áreas como potencialmente acima, potencialmente abaixo ou indistinguível do limite, facilitando a interpretação de riscos sem exigir cálculos manuais de intervalos de confiança.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extrair os resultados da krigagem e remover NA</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>resultado_pontos <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(krigagem<span class="sc">$</span>krige_output, <span class="at">as_points =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>resultado_limpo <span class="ot">&lt;-</span> resultado_pontos[<span class="sc">!</span><span class="fu">is.na</span>(resultado_pontos<span class="sc">$</span>var1.pred), ]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>krigagem_pontos <span class="ot">&lt;-</span> krigagem</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>krigagem_pontos<span class="sc">$</span>krige_output <span class="ot">&lt;-</span> resultado_limpo</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>intervalos <span class="ot">&lt;-</span> <span class="fu">posPredictionInterval</span>(krigagem_pontos, </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">p =</span> <span class="dv">95</span>, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">value =</span> <span class="fl">6.0</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(intervalos, <span class="at">main =</span> <span class="st">"Classificação vs Limiar (6.0)"</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-pospi" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pospi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geostat_files/figure-html/fig-pospi-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pospi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.28: Áreas estatisticamente acima ou abaixo do limiar (Log(Zn) = 6.0)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="pacote-geor" class="level2" data-number="3.20">
<h2 data-number="3.20" class="anchored" data-anchor-id="pacote-geor"><span class="header-section-number">3.20</span> Pacote geoR</h2>
<p>Veja no capítulo 3 de <span class="citation" data-cites="scalon2024analise">Scalon (<a href="references.html#ref-scalon2024analise" role="doc-biblioref">2024</a>)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-abdulah2023large" class="csl-entry" role="listitem">
Abdulah, Sameh, Yuxiao Li, Jian Cao, Hatem Ltaief, David E Keyes, Marc G Genton, e Ying Sun. 2023. <span>“Large-scale environmental data science with ExaGeoStatR”</span>. <em>Environmetrics</em> 34 (1): e2770.
</div>
<div id="ref-bakka2018spatial" class="csl-entry" role="listitem">
Bakka, Haakon, Håvard Rue, Geir-Arne Fuglstad, Andrea Riebler, David Bolin, Janine Illian, Elias Krainski, Daniel Simpson, e Finn Lindgren. 2018. <span>“Spatial modeling with R-INLA: A review”</span>. <em>Wiley Interdisciplinary Reviews: Computational Statistics</em> 10 (6): e1443.
</div>
<div id="ref-banerjee2003hierarchical" class="csl-entry" role="listitem">
Banerjee, Sudipto, Bradley P Carlin, e Alan E Gelfand. 2003. <em>Hierarchical modeling and analysis for spatial data</em>. Chapman; Hall/CRC.
</div>
<div id="ref-carvalho2017overview" class="csl-entry" role="listitem">
Carvalho, Dhaniel, e CV Deutsch. 2017. <span>“An overview of multiple indicator kriging”</span>. <em>Geostatistics Lessons</em> 7.
</div>
<div id="ref-chiles2012geostatistics" class="csl-entry" role="listitem">
Chiles, Jean-Paul, e Pierre Delfiner. 2012. <em>Geostatistics: modeling spatial uncertainty</em>. John Wiley &amp; Sons.
</div>
<div id="ref-cressie1985fitting" class="csl-entry" role="listitem">
Cressie, Noel. 1985. <span>“Fitting variogram models by weighted least squares”</span>. <em>Journal of the international Association for mathematical Geology</em> 17 (5): 563–86.
</div>
<div id="ref-cressie1989geostatistics" class="csl-entry" role="listitem">
———. 1989. <span>“Geostatistics”</span>. <em>The American Statistician</em> 43 (4): 197–202.
</div>
<div id="ref-cressie1990origins" class="csl-entry" role="listitem">
———. 1990. <span>“The origins of kriging”</span>. <em>Mathematical geology</em> 22 (3): 239–52.
</div>
<div id="ref-cressie1991geostatistical" class="csl-entry" role="listitem">
———. 1991. <span>“Geostatistical analysis of spatial data”</span>. <em>Spatial statistics and digital image analysis</em> 1991: 87–108.
</div>
<div id="ref-cressie1993statistics" class="csl-entry" role="listitem">
———. 1993. <em>Statistics for spatial data</em>. John Wiley &amp; Sons.
</div>
<div id="ref-cressie1980robust" class="csl-entry" role="listitem">
Cressie, Noel, e Douglas M Hawkins. 1980. <span>“Robust estimation of the variogram: I”</span>. <em>Journal of the international Association for Mathematical Geology</em> 12 (2): 115–25.
</div>
<div id="ref-cressie2022spatial" class="csl-entry" role="listitem">
Cressie, Noel, e Matthew T Moores. 2022. <span>“Spatial statistics”</span>. Em <em>Encyclopedia of mathematical geosciences</em>, 1–11. Springer.
</div>
<div id="ref-cressie2022basis" class="csl-entry" role="listitem">
Cressie, Noel, Matthew Sainsbury-Dale, e Andrew Zammit-Mangion. 2022. <span>“Basis-function models in spatial statistics”</span>. <em>Annual Review of Statistics and Its Application</em> 9 (1): 373–400.
</div>
<div id="ref-cressie2016multivariate" class="csl-entry" role="listitem">
Cressie, Noel, e Andrew Zammit-Mangion. 2016. <span>“Multivariate spatial covariance models: a conditional approach”</span>. <em>Biometrika</em> 103 (4): 915–35.
</div>
<div id="ref-DeutschJournel1997" class="csl-entry" role="listitem">
Deutsch, Clayton V., e André G. Journel. 1997. <em>GSLIB: Geostatistical Software Library and User’s Guide</em>. 2º ed. New York: Oxford University Press.
</div>
<div id="ref-diggle1998model" class="csl-entry" role="listitem">
Diggle, Peter J, Jonathan A Tawn, e Rana A Moyeed. 1998. <span>“Model-based geostatistics”</span>. <em>Journal of the Royal Statistical Society Series C: Applied Statistics</em> 47 (3): 299–350.
</div>
<div id="ref-ecker2003geostatistics" class="csl-entry" role="listitem">
Ecker, Mark D. 2003. <span>“Geostatistics: past, present and future”</span>. <em>Encyclopedia of Life Support Systems (EOLSS)</em>, 50614–506.
</div>
<div id="ref-genton1998variogram" class="csl-entry" role="listitem">
Genton, Marc G. 1998. <span>“Variogram fitting by generalized least squares using an explicit formula for the covariance structure”</span>. <em>Mathematical Geology</em> 30 (4): 323–45.
</div>
<div id="ref-goovaerts1997geostatistics" class="csl-entry" role="listitem">
Goovaerts, Pierre. 1997. <em>Geostatistics for natural resources evaluation</em>. Oxford university press.
</div>
<div id="ref-gorsich2000variogram" class="csl-entry" role="listitem">
Gorsich, David J, e Marc G Genton. 2000. <span>“Variogram model selection via nonparametric derivative estimation”</span>. <em>Mathematical geology</em> 32 (3): 249–70.
</div>
<div id="ref-graler2016spatio" class="csl-entry" role="listitem">
Gräler, Benedikt, Edzer Pebesma, e Gerard Heuvelink. 2016. <span>“Spatio-temporal interpolation using gstat”</span>.
</div>
<div id="ref-guimaraes2012use" class="csl-entry" role="listitem">
Guimaraes, Ricardo JPS, Corina C Freitas, Luciano V Dutra, Carlos A Felgueiras, Sandra C Drummond, Sandra HC Tibiriçá, Guilherme Oliveira, e Omar S Carvalho. 2012. <span>“Use of indicator kriging to investigate schistosomiasis in minas gerais state, Brazil”</span>. <em>Journal of Tropical Medicine</em> 2012 (1): 837428.
</div>
<div id="ref-guttorp2006studies" class="csl-entry" role="listitem">
Guttorp, Peter, e Tilmann Gneiting. 2006. <span>“Studies in the history of probability and statistics XLIX on the Mat<span>é</span>rn correlation family”</span>. <em>Biometrika</em> 93 (4): 989–95.
</div>
<div id="ref-harville1977maximum" class="csl-entry" role="listitem">
Harville, David A. 1977. <span>“Maximum likelihood approaches to variance component estimation and to related problems”</span>. <em>Journal of the American statistical association</em> 72 (358): 320–38.
</div>
<div id="ref-automap" class="csl-entry" role="listitem">
Hiemstra, P. H., E. J. Pebesma, C. J. W. Twenh"ofel, e G. B. M. Heuvelink. 2008. <span>“Real-time automatic interpolation of ambient gamma dose rates from the Dutch Radioactivity Monitoring Network”</span>. <em>Computers &amp; Geosciences</em>.
</div>
<div id="ref-hill1998comparison" class="csl-entry" role="listitem">
Hill, Donna. 1998. <span>“Comparison of median indicator kriging with full indicator kriging in the analysis of spatial data”</span>.
</div>
<div id="ref-isaaks1989applied" class="csl-entry" role="listitem">
Isaaks, Edward H, R Mohan Srivastava, et al. 1989. <span>“Applied geostatistics”</span>.
</div>
<div id="ref-ji2025ordered" class="csl-entry" role="listitem">
Ji, Guangjun, Zizhao Cai, Keyan Xiao, Yan Lu, e Qian Wang. 2025. <span>“Ordered Indicator Kriging Interpolation Method with Field Variogram Parameters for Discrete Variables in the Aquifers of Quaternary Loose Sediments”</span>. <em>Water</em> 17 (21): 3116.
</div>
<div id="ref-journel1986constrained" class="csl-entry" role="listitem">
Journel, Andre G. 1986. <span>“Constrained interpolation and qualitative information—the soft kriging approach”</span>. <em>Mathematical Geology</em> 18 (3): 269–86.
</div>
<div id="ref-journel1976mining" class="csl-entry" role="listitem">
Journel, Andre G, e Charles J Huijbregts. 1976. <span>“Mining geostatistics”</span>.
</div>
<div id="ref-journel1983nonparametric" class="csl-entry" role="listitem">
Journel, André G. 1983. <span>“Nonparametric estimation of spatial distributions”</span>. <em>Journal of the International Association for Mathematical Geology</em> 15 (3): 445–68.
</div>
<div id="ref-juang1998simple" class="csl-entry" role="listitem">
Juang, Kai-Wei, e Dar-Yuan Lee. 1998. <span>“Simple indicator kriging for estimating the probability of incorrectly delineating hazardous areas in a contaminated site”</span>. <em>Environmental Science &amp; Technology</em> 32 (17): 2487–93.
</div>
<div id="ref-krige2005genesis" class="csl-entry" role="listitem">
Krige, Danie, e Wynand Kleingeld. 2005. <span>“The genesis of geostatistics in gold and diamond industries”</span>. Em <em>Space, Structure and Randomness: Contributions in Honor of Georges Matheron in the Field of Geostatistics, Random Sets and Mathematical Morphology</em>, 5–16. Springer.
</div>
<div id="ref-lark2000estimating" class="csl-entry" role="listitem">
Lark, RM. 2000. <span>“Estimating variograms of soil properties by the method-of-moments and maximum likelihood”</span>. <em>European Journal of Soil Science</em> 51 (4): 717–28.
</div>
<div id="ref-laslett1994kriging" class="csl-entry" role="listitem">
Laslett, Geoffrey M. 1994. <span>“Kriging and splines: an empirical comparison of their predictive performance in some applications”</span>. <em>Journal of the American Statistical Association</em> 89 (426): 391–400.
</div>
<div id="ref-lindgren2022spde" class="csl-entry" role="listitem">
Lindgren, Finn, David Bolin, e Håvard Rue. 2022. <span>“The SPDE approach for Gaussian and non-Gaussian fields: 10 years and still running”</span>. <em>Spatial Statistics</em> 50: 100599.
</div>
<div id="ref-lindgren2015bayesian" class="csl-entry" role="listitem">
Lindgren, Finn, e Håvard Rue. 2015. <span>“Bayesian spatial modelling with R-INLA”</span>. <em>Journal of statistical software</em> 63: 1–25.
</div>
<div id="ref-lindgren2011explicit" class="csl-entry" role="listitem">
Lindgren, Finn, Håvard Rue, e Johan Lindström. 2011. <span>“An explicit link between Gaussian fields and Gaussian Markov random fields: the stochastic partial differential equation approach”</span>. <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 73 (4): 423–98.
</div>
<div id="ref-marchant2007robust" class="csl-entry" role="listitem">
Marchant, BP, e RM Lark. 2007. <span>“Robust estimation of the variogram by residual maximum likelihood”</span>. <em>Geoderma</em> 140 (1-2): 62–72.
</div>
<div id="ref-matheron1963principles" class="csl-entry" role="listitem">
Matheron, G. 1963. <span>“" Principles of geostatistics", Economic Geology, 58, pp 1246-1266”</span>.
</div>
<div id="ref-matheron1971theory" class="csl-entry" role="listitem">
Matheron, George. 1971. <span>“The theory of regionalised variables and its applications”</span>. <em>Les Cahiers du Centre de Morphologie Math<span>é</span>matique</em> 5: 212.
</div>
<div id="ref-mcbratney1986choosing" class="csl-entry" role="listitem">
McBratney, AB, e R Webster. 1986. <span>“Choosing functions for semi-variograms of soil properties and fitting them to sampling estimates”</span>. <em>Journal of soil Science</em> 37 (4): 617–39.
</div>
<div id="ref-mohammadpour2019geochemical" class="csl-entry" role="listitem">
Mohammadpour, Mahyadin, Abbas Bahroudi, Maysam Abedi, Gholamreza Rahimipour, Golnaz Jozanikohan, e Farzaneh Mami Khalifani. 2019. <span>“Geochemical distribution mapping by combining number-size multifractal model and multiple indicator kriging”</span>. <em>Journal of Geochemical Exploration</em> 200: 13–26.
</div>
<div id="ref-myers1994spatial" class="csl-entry" role="listitem">
Myers, Donald E. 1994. <span>“Spatial interpolation: an overview”</span>. <em>Geoderma</em> 62 (1-3): 17–28.
</div>
<div id="ref-nhancololo2024comparison" class="csl-entry" role="listitem">
Nhancololo, A. M., Wélson A. Oliveira, Fernandes A. C. Pereira, Bruno Montoani Silva, e João Domingos Scalon. 2024. <span>“Comparison between the laboratory method and the Stolf penetrometer in soil density analysis: a study using geostatistical approaches”</span>. <em>Sigmae</em> 13 (1): 63–78. <a href="https://doi.org/10.29327/2520355.13.1-7">https://doi.org/10.29327/2520355.13.1-7</a>.
</div>
<div id="ref-oliver2014tutorial" class="csl-entry" role="listitem">
Oliver, MA, e R Webster. 2014. <span>“A tutorial guide to geostatistics: Computing and modelling variograms and kriging”</span>. <em>Catena</em> 113: 56–69.
</div>
<div id="ref-pebesma2004multivariable" class="csl-entry" role="listitem">
Pebesma, Edzer J. 2004. <span>“Multivariable geostatistics in S: the gstat package”</span>. <em>Computers &amp; geosciences</em> 30 (7): 683–91.
</div>
<div id="ref-ribeiro2006geor" class="csl-entry" role="listitem">
Ribeiro Jr, Paulo J, e Peter J Diggle. 2006. <span>“geoR: Package for Geostatistical Data Analysis an illustrative session”</span>. <em>Artificial Intelligence</em> 1: 1–24.
</div>
<div id="ref-geoR" class="csl-entry" role="listitem">
Ribeiro Jr, Paulo Justiniano, e Peter Diggle. 2025. <em>geoR: Analysis of Geostatistical Data</em>. <a href="https://doi.org/10.32614/CRAN.package.geoR">https://doi.org/10.32614/CRAN.package.geoR</a>.
</div>
<div id="ref-richardson1995robust" class="csl-entry" role="listitem">
Richardson, Alice M, e Alan H Welsh. 1995. <span>“Robust restricted maximum likelihood in mixed linear models”</span>. <em>Biometrics</em>, 1429–39.
</div>
<div id="ref-sahu2022bayesian" class="csl-entry" role="listitem">
Sahu, Sujit. 2022. <em>Bayesian modeling of spatio-temporal data with R</em>. Chapman; Hall/CRC.
</div>
<div id="ref-scalon2024analise" class="csl-entry" role="listitem">
Scalon, João Domingos. 2024. <em>Análise de Dados Espaciais com Aplicações em R</em>. Lavras: Ed. UFLA.
</div>
<div id="ref-ungaro2008arsenic" class="csl-entry" role="listitem">
Ungaro, F, F Ragazzi, R Cappellin, e P Giandon. 2008. <span>“Arsenic concentration in the soils of the Brenta Plain (Northern Italy): mapping the probability of exceeding contamination thresholds”</span>. <em>Journal of Geochemical Exploration</em> 96 (2-3): 117–31.
</div>
<div id="ref-ver1998constructing" class="csl-entry" role="listitem">
Ver Hoef, Jay M, e Ronald Paul Barry. 1998. <span>“Constructing and fitting models for cokriging and multivariable spatial prediction”</span>. <em>Journal of Statistical Planning and Inference</em> 69 (2): 275–94.
</div>
<div id="ref-wackernagel2003multivariate" class="csl-entry" role="listitem">
Wackernagel, Hans. 2003. <em>Multivariate geostatistics: an introduction with applications</em>. Springer Science &amp; Business Media.
</div>
<div id="ref-whittle1954stationary" class="csl-entry" role="listitem">
Whittle, Peter. 1954. <span>“On stationary processes in the plane”</span>. <em>Biometrika</em>, 434–49.
</div>
<div id="ref-yamamoto2013geoestatistica" class="csl-entry" role="listitem">
Yamamoto, Jorge Kazuo, e Paulo M. Barbosa Landim. 2013. <em>Geoestatística: conceitos e aplicações</em>. São Paulo: Oficina de Textos.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiada");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiada");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./fundEstspatial.html" class="pagination-link" aria-label="Fundamentos da Estatística Espacial">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fundamentos da Estatística Espacial</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lattice_data.html" class="pagination-link" aria-label="Dados de Área">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dados de Área</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright Cursos de Verão IME-USP 2025, Alex Monito Nhancololo</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Nhancololo/Introducao-a-Estatistica-Espacial">
      <i class="bi bi-github" role="img" aria-label="Código Fonte">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/almonha">
      <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://nhancololo.github.io/">
      <i class="bi bi-globe" role="img" aria-label="Website Pessoal">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>