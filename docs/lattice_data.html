<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR" xml:lang="pt-BR"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Dados de Área</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./point_process.html" rel="next">
<link href="./geostat.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6d088c4ce919446e15da3b20ce9bdb36.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lattice_data.html">Dados de Área (Lattice)</a></li><li class="breadcrumb-item"><a href="./lattice_data.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dados de Área</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
        <div class="sidebar-tools-collapse">
    <div class="dropdown">
      <a href="" title="Baixar" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Baixar"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-collapse-item" href="./Introducao-a-Estatistica-Espacial-Verao-IME-USP-2026.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Baixar PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-collapse-item" href="./Introducao-a-Estatistica-Espacial-Verao-IME-USP-2026.epub">
              <i class="bi bi-journal pe-1"></i>
            Baixar ePub
            </a>
          </li>
      </ul>
    </div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Introdução ao R/Rstudio</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução ao R/RStudio</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Fundamentos da Estatística Espacial</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fundEstspatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fundamentos da Estatística Espacial</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Geostatística</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./geostat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geoestatística</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Dados de Área (Lattice)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lattice_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dados de Área</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Processos Pontuais</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./point_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Processos Pontuais</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Espaço-Temporal</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatiotemporal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelagem Espaço-Temporal</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências Bibliográficas</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#sec-lattice" id="toc-sec-lattice" class="nav-link active" data-scroll-target="#sec-lattice"><span class="header-section-number">4.1</span> Representação espacial e construção de estruturas de vizinhança</a>
  <ul class="collapse">
  <li><a href="#critérios-de-vizinhança" id="toc-critérios-de-vizinhança" class="nav-link" data-scroll-target="#critérios-de-vizinhança"><span class="header-section-number">4.1.1</span> Critérios de Vizinhança</a></li>
  <li><a href="#sec-matriz_pesos" id="toc-sec-matriz_pesos" class="nav-link" data-scroll-target="#sec-matriz_pesos"><span class="header-section-number">4.1.2</span> Matriz de pesos espaciais (<span class="math inline">\(\mathbf{W}\)</span>) e normalização</a></li>
  <li><a href="#críticas-e-escolha-da-matriz-mathbfw" id="toc-críticas-e-escolha-da-matriz-mathbfw" class="nav-link" data-scroll-target="#críticas-e-escolha-da-matriz-mathbfw"><span class="header-section-number">4.1.3</span> Críticas e escolha da matriz <span class="math inline">\(\mathbf{W}\)</span></a></li>
  </ul></li>
  <li><a href="#implicações-estatísticas-da-discretização-espacial" id="toc-implicações-estatísticas-da-discretização-espacial" class="nav-link" data-scroll-target="#implicações-estatísticas-da-discretização-espacial"><span class="header-section-number">4.2</span> Implicações estatísticas da discretização espacial</a></li>
  <li><a href="#sec-esda" id="toc-sec-esda" class="nav-link" data-scroll-target="#sec-esda"><span class="header-section-number">4.3</span> Análise exploratória em dados de área</a>
  <ul class="collapse">
  <li><a href="#estatísticas-globais-de-autocorrelação" id="toc-estatísticas-globais-de-autocorrelação" class="nav-link" data-scroll-target="#estatísticas-globais-de-autocorrelação"><span class="header-section-number">4.3.1</span> Estatísticas globais de autocorrelação</a></li>
  <li><a href="#suporte-das-estatísticas-i-e-c" id="toc-suporte-das-estatísticas-i-e-c" class="nav-link" data-scroll-target="#suporte-das-estatísticas-i-e-c"><span class="header-section-number">4.3.2</span> Suporte das estatísticas <span class="math inline">\(I\)</span> e <span class="math inline">\(c\)</span></a></li>
  <li><a href="#estatísticas-locais" id="toc-estatísticas-locais" class="nav-link" data-scroll-target="#estatísticas-locais"><span class="header-section-number">4.3.3</span> Estatísticas Locais</a></li>
  </ul></li>
  <li><a href="#sec-risco" id="toc-sec-risco" class="nav-link" data-scroll-target="#sec-risco"><span class="header-section-number">4.4</span> Riscos e Suavização</a></li>
  <li><a href="#diagnóstico-de-dependência-espacial" id="toc-diagnóstico-de-dependência-espacial" class="nav-link" data-scroll-target="#diagnóstico-de-dependência-espacial"><span class="header-section-number">4.5</span> Diagnóstico de dependência espacial</a></li>
  <li><a href="#sec-gmrf" id="toc-sec-gmrf" class="nav-link" data-scroll-target="#sec-gmrf"><span class="header-section-number">4.6</span> Fundamentos probabilísticos: GMRF, matrizes de precisão e operadores Laplacianos discretos</a></li>
  <li><a href="#sec-modelos_classicos" id="toc-sec-modelos_classicos" class="nav-link" data-scroll-target="#sec-modelos_classicos"><span class="header-section-number">4.7</span> Modelos mais comuns em dados de área: CAR, ICAR, SAR e BYM</a>
  <ul class="collapse">
  <li><a href="#sec-car" id="toc-sec-car" class="nav-link" data-scroll-target="#sec-car"><span class="header-section-number">4.7.1</span> Modelo Condicional Autorregressivo (CAR)</a></li>
  </ul></li>
  <li><a href="#modelo-car-intrínseco-icar" id="toc-modelo-car-intrínseco-icar" class="nav-link" data-scroll-target="#modelo-car-intrínseco-icar"><span class="header-section-number">4.8</span> Modelo CAR Intrínseco (ICAR)</a>
  <ul class="collapse">
  <li><a href="#sec-icar" id="toc-sec-icar" class="nav-link" data-scroll-target="#sec-icar"><span class="header-section-number">4.8.1</span> Modelo Condicional Autorregressivo Intrínseco (ICAR)</a></li>
  </ul></li>
  <li><a href="#sec-SAR" id="toc-sec-SAR" class="nav-link" data-scroll-target="#sec-SAR"><span class="header-section-number">4.9</span> Modelos Simultâneos Autorregressivos (SAR)</a></li>
  <li><a href="#sec-BYM" id="toc-sec-BYM" class="nav-link" data-scroll-target="#sec-BYM"><span class="header-section-number">4.10</span> O Modelo BYM (Besag-York-Mollié) e sua reparametrização (BYM2)</a>
  <ul class="collapse">
  <li><a href="#modelo-bym" id="toc-modelo-bym" class="nav-link" data-scroll-target="#modelo-bym"><span class="header-section-number">4.10.1</span> Modelo BYM</a></li>
  <li><a href="#modelo-bym2" id="toc-modelo-bym2" class="nav-link" data-scroll-target="#modelo-bym2"><span class="header-section-number">4.10.2</span> Modelo BYM2</a></li>
  </ul></li>
  <li><a href="#priors-de-penalização-de-complexidade-pc-priors" id="toc-priors-de-penalização-de-complexidade-pc-priors" class="nav-link" data-scroll-target="#priors-de-penalização-de-complexidade-pc-priors"><span class="header-section-number">4.11</span> Priors de Penalização de Complexidade (PC Priors)</a></li>
  <li><a href="#estatística-espacial-vs.-econometria-espacial" id="toc-estatística-espacial-vs.-econometria-espacial" class="nav-link" data-scroll-target="#estatística-espacial-vs.-econometria-espacial"><span class="header-section-number">4.12</span> Estatística Espacial vs.&nbsp;Econometria Espacial</a></li>
  <li><a href="#modelos-espaciais-econométricos-para-dados-de-área" id="toc-modelos-espaciais-econométricos-para-dados-de-área" class="nav-link" data-scroll-target="#modelos-espaciais-econométricos-para-dados-de-área"><span class="header-section-number">4.13</span> Modelos Espaciais Econométricos para Dados de Área</a>
  <ul class="collapse">
  <li><a href="#modelo-de-defasagem-espacial-sar-spatial-autoregressive-model" id="toc-modelo-de-defasagem-espacial-sar-spatial-autoregressive-model" class="nav-link" data-scroll-target="#modelo-de-defasagem-espacial-sar-spatial-autoregressive-model"><span class="header-section-number">4.13.1</span> Modelo de Defasagem Espacial (SAR – <em>Spatial Autoregressive Model</em>)</a></li>
  <li><a href="#modelo-de-erro-espacial-sem---spatial-error-model" id="toc-modelo-de-erro-espacial-sem---spatial-error-model" class="nav-link" data-scroll-target="#modelo-de-erro-espacial-sem---spatial-error-model"><span class="header-section-number">4.13.2</span> Modelo de Erro Espacial (SEM - <em>Spatial Error Model</em>)</a></li>
  <li><a href="#modelo-de-defasagem-espacial-de-x-slx-spatial-lag-of-x" id="toc-modelo-de-defasagem-espacial-de-x-slx-spatial-lag-of-x" class="nav-link" data-scroll-target="#modelo-de-defasagem-espacial-de-x-slx-spatial-lag-of-x"><span class="header-section-number">4.13.3</span> Modelo de Defasagem Espacial de X (SLX – <em>Spatial Lag of X</em>)</a></li>
  <li><a href="#modelo-espacial-de-durbin-sdm-spatial-durbin-model" id="toc-modelo-espacial-de-durbin-sdm-spatial-durbin-model" class="nav-link" data-scroll-target="#modelo-espacial-de-durbin-sdm-spatial-durbin-model"><span class="header-section-number">4.13.4</span> Modelo Espacial de Durbin (SDM – <em>Spatial Durbin Model</em>)</a></li>
  <li><a href="#modelo-espacial-de-durbin-com-erro-sdem-spatial-durbin-error-model" id="toc-modelo-espacial-de-durbin-com-erro-sdem-spatial-durbin-error-model" class="nav-link" data-scroll-target="#modelo-espacial-de-durbin-com-erro-sdem-spatial-durbin-error-model"><span class="header-section-number">4.13.5</span> Modelo Espacial de Durbin com Erro (SDEM – <em>Spatial Durbin Error Model</em>)</a></li>
  <li><a href="#modelo-autorregressivo-espacial-com-erros-autorregressivos-sarar-spatial-autoregressive-with-autoregressive-disturbances" id="toc-modelo-autorregressivo-espacial-com-erros-autorregressivos-sarar-spatial-autoregressive-with-autoregressive-disturbances" class="nav-link" data-scroll-target="#modelo-autorregressivo-espacial-com-erros-autorregressivos-sarar-spatial-autoregressive-with-autoregressive-disturbances"><span class="header-section-number">4.13.6</span> Modelo Autorregressivo Espacial com Erros Autorregressivos (SARAR-<em>Spatial Autoregressive with Autoregressive Disturbances</em>)</a></li>
  <li><a href="#modelo-de-média-móvel-espacial-sma-spatial-moving-average" id="toc-modelo-de-média-móvel-espacial-sma-spatial-moving-average" class="nav-link" data-scroll-target="#modelo-de-média-móvel-espacial-sma-spatial-moving-average"><span class="header-section-number">4.13.7</span> Modelo de Média Móvel Espacial (SMA – <em>Spatial Moving Average</em>)</a></li>
  </ul></li>
  <li><a href="#modelos-espaciais-para-respostas-limitadas-e-discretas" id="toc-modelos-espaciais-para-respostas-limitadas-e-discretas" class="nav-link" data-scroll-target="#modelos-espaciais-para-respostas-limitadas-e-discretas"><span class="header-section-number">4.14</span> Modelos espaciais para respostas limitadas e discretas</a>
  <ul class="collapse">
  <li><a href="#modelo-probit-espacial" id="toc-modelo-probit-espacial" class="nav-link" data-scroll-target="#modelo-probit-espacial"><span class="header-section-number">4.14.1</span> Modelo Probit Espacial</a></li>
  <li><a href="#modelo-probit-ordenado-espacial" id="toc-modelo-probit-ordenado-espacial" class="nav-link" data-scroll-target="#modelo-probit-ordenado-espacial"><span class="header-section-number">4.14.2</span> Modelo Probit Ordenado Espacial</a></li>
  <li><a href="#modelo-tobit-espacial-spatial-tobit-model" id="toc-modelo-tobit-espacial-spatial-tobit-model" class="nav-link" data-scroll-target="#modelo-tobit-espacial-spatial-tobit-model"><span class="header-section-number">4.14.3</span> Modelo Tobit Espacial (<em>Spatial Tobit Model</em>)</a></li>
  </ul></li>
  <li><a href="#modelos-locais-e-não-estacionários" id="toc-modelos-locais-e-não-estacionários" class="nav-link" data-scroll-target="#modelos-locais-e-não-estacionários"><span class="header-section-number">4.15</span> Modelos locais e não estacionários</a>
  <ul class="collapse">
  <li><a href="#regressão-geograficamente-ponderada-gwr" id="toc-regressão-geograficamente-ponderada-gwr" class="nav-link" data-scroll-target="#regressão-geograficamente-ponderada-gwr"><span class="header-section-number">4.15.1</span> Regressão Geograficamente Ponderada (GWR)</a></li>
  <li><a href="#regressão-geograficamente-ponderada-multiescalar-mgwr" id="toc-regressão-geograficamente-ponderada-multiescalar-mgwr" class="nav-link" data-scroll-target="#regressão-geograficamente-ponderada-multiescalar-mgwr"><span class="header-section-number">4.15.2</span> Regressão Geograficamente Ponderada Multiescalar (MGWR)</a></li>
  </ul></li>
  <li><a href="#pacote-gwmodel" id="toc-pacote-gwmodel" class="nav-link" data-scroll-target="#pacote-gwmodel"><span class="header-section-number">4.16</span> Pacote GWmodel</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lattice_data.html">Dados de Área (Lattice)</a></li><li class="breadcrumb-item"><a href="./lattice_data.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dados de Área</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-dados_area" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dados de Área</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>A análise de dados de área (ou <em>lattice data</em>) lida com processos estocásticos cujo domínio espacial é fixo, discreto e contável. Denotamos esse domínio por <span class="math inline">\(D^L\)</span>. Enquanto na geoestatística (<span class="quarto-unresolved-ref">?sec-geoest</span>) o suporte é contínuo, permitindo observações em qualquer localização <span class="math inline">\(\mathbf{s} \in D^G\)</span>, nos dados de área as observações estão ancoradas em unidades espaciais predefinidas e não sobrepostas, como regiões administrativas, células de uma grelha ou zonas censitárias.</p>
<p>Seja <span class="math inline">\(\{D_i\}_{i=1}^{n}\)</span> uma coleção finita de <span class="math inline">\(n\)</span> unidades espaciais (por exemplo, municípios, distritos ou pixels). Os dados de área são definidos como uma coleção de variáveis aleatórias indexadas por essas unidades: <span class="math inline">\(\{Y(\mathbf{s}_i): \mathbf{s}_i \in D^L\}\)</span>, onde <span class="math inline">\(D^L = \{\mathbf{s}_1, \dots, \mathbf{s}_n\}\)</span> é um subconjunto fixo e contável do espaço Euclidiano <span class="math inline">\(\mathbb{R}^d\)</span> <span class="citation" data-cites="cressie2022spatial">(<a href="references.html#ref-cressie2022spatial" role="doc-biblioref">Cressie e Moores 2022</a>)</span>. A incerteza reside exclusivamente no valor do atributo <span class="math inline">\(Y(\mathbf{s}_i)\)</span>, e não na localização <span class="math inline">\(\mathbf{s}_i\)</span> (que é fixa e conhecida), diferenciando-se dos processos pontuais (<span class="quarto-unresolved-ref">?sec-proc_pont</span>). Para as <span class="math inline">\(n\)</span> regiões, o vetor de observações é <span class="math inline">\(\mathbf{y} = (y_1, \dots, y_n)^\top\)</span>, onde <span class="math inline">\(y_i \equiv y(\mathbf{s}_i)\)</span>.</p>
<p>Conforme destacado por <span class="citation" data-cites="besag1974spatial">Besag (<a href="references.html#ref-besag1974spatial" role="doc-biblioref">1974</a>)</span>, a dependência espacial neste contexto não é necessariamente governada por uma métrica de distância Euclidiana contínua, como na geoestatística (<span class="quarto-unresolved-ref">?sec-geoest</span>), mas sim pela topologia ou estrutura de vizinhança definida entre as unidades discretas <span class="math inline">\(\{D_i\}\)</span>.</p>
<p>A questão inferencial central também se desloca. Em vez de interpolar (prever) um valor em um local não observado <span class="math inline">\(s_0\)</span> (krigagem, <span class="quarto-unresolved-ref">?sec-geoest</span>), o foco passa a ser compreender e quantificar como o valor observado na unidade <span class="math inline">\(D_i\)</span> é influenciado pelos valores nas unidades vizinhas <span class="math inline">\(\{D_j\}\)</span> (interação espacial). Por simplicidade, as unidades são frequentemente denotadas apenas por seus índices <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span>.</p>
<p>Uma característica fundamental dos dados de área é a agregação. O valor observado <span class="math inline">\(y_i\)</span> na unidade <span class="math inline">\(i\)</span> é tipicamente o resultado da integração (ou média) de um processo contínuo latente <span class="math inline">\(Y(\mathbf{s})\)</span> sobre a área geográfica <span class="math inline">\(A_i\)</span> daquela unidade. Formalmente, se <span class="math inline">\(Y(\mathbf{s})\)</span> representa, por exemplo, densidade ou intensidade, então:</p>
<p><span class="math display">\[
y_i = \int_{A_i} Y(\mathbf{s}) \, d\mathbf{s} \: \text{(para contagens ou volumes)}, \: \text{ ou }
y_i = \frac{1}{|A_i|} \int_{A_i} Y(\mathbf{s}) \, d\mathbf{s} \: \text{(para médias ou intensidades)},
\]</span> onde <span class="math inline">\(|A_i|\)</span> é a área da região <span class="math inline">\(i\)</span>.</p>
<p>Esta natureza agregada implica que a inferência estatística é condicional à partição específica do espaço (<span class="math inline">\(A_1 \cup \dots \cup A_n\)</span>). Alterar essa partição (escala ou limites) pode alterar as propriedades estatísticas (média, variância, correlação) dos dados. Este fenômeno é conhecido como o Problema da Unidade de Área Modificável (<a href="https://en.wikipedia.org/wiki/Modifiable_areal_unit_problem">MAUP</a>) <span class="citation" data-cites="openshaw1984modifiable">(<a href="references.html#ref-openshaw1984modifiable" role="doc-biblioref">Openshaw 1984</a>)</span>. Estatisticamente, a agregação introduz uma heterocedasticidade intrínseca: unidades com áreas <span class="math inline">\(|A_i|\)</span> ou populações-base diferentes terão variâncias de amostragem distintas, um aspecto que deve ser cuidadosamente considerado na modelagem da matriz de covariância <span class="math inline">\(\mathbf{\Sigma}\)</span>.</p>
<section id="sec-lattice" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-lattice"><span class="header-section-number">4.1</span> Representação espacial e construção de estruturas de vizinhança</h2>
<p>A representação dos dados de área pode se dar em estruturas regulares (grelhas ou <em>grids</em>) ou irregulares (divisões políticas ou administrativas, <span class="quarto-unresolved-ref">?sec-grid</span>). <em>Grids</em> regulares são comuns em análise de imagens, sensoriamento remoto e dados climáticos, onde cada célula (pixel) tem uma forma e tamanho constantes, facilitando a computação e a definição de vizinhança. Polígonos irregulares, que representam entidades como municípios ou distritos, são comuns em ciências sociais e saúde pública. A heterogeneidade no tamanho e forma dessas regiões introduz desafios adicionais, como a já mencionada variância desigual e a definição não trivial de proximidade <span class="citation" data-cites="cressie1989spatial">(<a href="references.html#ref-cressie1989spatial" role="doc-biblioref">Cressie e Chan 1989</a>)</span>.</p>
<p>Para modelar a dependência espacial, é fundamental definir formalmente como as unidades se relacionam. Essa relação baseia-se na matriz de pesos espaciais ou matriz de vizinhança:</p>
<p><span class="math display">\[
\mathbf{W}_{n \times n} =
\begin{bmatrix}
w_{11} &amp; w_{12} &amp; \cdots &amp; w_{1n} \\
w_{21} &amp; w_{22} &amp; \cdots &amp; w_{2n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
w_{n1} &amp; w_{n2} &amp; \cdots &amp; w_{nn}
\end{bmatrix},
\]</span></p>
<p>onde cada elemento <span class="math inline">\(w_{ij}\)</span> quantifica a conexão espacial entre a unidade <span class="math inline">\(j\)</span> e unidade <span class="math inline">\(i\)</span>. Por convenção, assume-se que <span class="math inline">\(w_{ii} = 0\)</span>, impedindo que uma unidade seja vizinha de si <span class="citation" data-cites="anselin2001spatial">(<a href="references.html#ref-anselin2001spatial" role="doc-biblioref">Anselin 2001</a>)</span>. Note ainda que é comum descrever a vizinhança entre unidades <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span> se existe, simplesmente <span class="math inline">\(i\sim j\)</span>, para referir que <span class="math inline">\(w_{ij} \neq 0\)</span> <span class="citation" data-cites="BesagKooperberg1995">(<a href="references.html#ref-BesagKooperberg1995" role="doc-biblioref">Besag e Kooperberg 1995</a>)</span>.</p>
<p>A construção de <span class="math inline">\(\mathbf{W}\)</span> envolve duas etapas conceituais distintas: 1) a definição da topologia ou critério de vizinhança (quem é vizinho de quem); e 2) a ponderação (a intensidade atribuída a cada conexão). Enquanto a primeira é predominantemente geométrica, a segunda frequentemente envolve uma operação de normalização, crucial para a estabilidade numérica e interpretabilidade dos modelos.</p>
<p>Diferente das séries temporais, onde a dependência é unidirecional e sequencial (o passado influencia o futuro), nos dados de área a dependência é multidirecional e simultânea. A unidade <span class="math inline">\(i\)</span> influencia <span class="math inline">\(j\)</span>, que influencia <span class="math inline">\(k\)</span>, que pode, por sua vez, influenciar <span class="math inline">\(i\)</span> novamente através de outras conexões, criando um sistema de <a href="https://en.wikipedia.org/wiki/Feedback">feedback</a> espacial.</p>
<section id="critérios-de-vizinhança" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="critérios-de-vizinhança"><span class="header-section-number">4.1.1</span> Critérios de Vizinhança</h3>
<p>A definição operacional de proximidade ou vizinhança é um passo fundamental e teórico. <span class="citation" data-cites="anselin2002under">Anselin (<a href="references.html#ref-anselin2002under" role="doc-biblioref">2002</a>)</span> discutem os critérios mais comuns:</p>
<ol type="1">
<li><p><strong>Contiguidade (Adjacência):</strong> Baseia-se no compartilhamento de fronteiras (ver <span class="quarto-unresolved-ref">?sec-dependencia</span>).</p>
<ul>
<li><p>Torre (<em>Rook</em>): As unidades <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span> são vizinhas se compartilham um segmento de fronteira (<a href="https://pt.wikipedia.org/wiki/Aresta">aresta</a>). Formalmente, <span class="math inline">\(\text{dim}(\partial A_i \cap \partial A_j) = 1\)</span>.</p></li>
<li><p>Rainha (<em>Queen</em>): As unidades <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span> são vizinhas se compartilham qualquer ponto de fronteira, seja um <a href="https://pt.wikipedia.org/wiki/V%C3%A9rtice">vértice</a> ou uma aresta. Formalmente, <span class="math inline">\(A_i \cap \partial A_j \neq \emptyset\)</span>. Este critério é mais abrangente e é particularmente útil para malhas irregulares, pois evita que unidades que se tocam apenas em um canto (como municípios separados por um rio que se encontram em uma <a href="https://pt.wikipedia.org/wiki/Conflu%C3%AAncia">confluência</a>) sejam consideradas desconectadas. Por exemplo, ao estudar a propagação de um fenômeno social entre municípios, dois que são separados por um rio mas cujos centros urbanos estão próximos na confluência podem ter intensa interação. Usar o critério <em>Rook</em> os trataria como isolados, enquanto o critério <em>Queen</em> capturaria essa potencial conexão, resultando em uma matriz de conectividade mais robusta e evitando subestimar a dependência espacial.</p></li>
</ul></li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, ggplot2, patchwork, dplyr, geodata)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Baixar dados dos EUA (Nível 1 = Estados)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>usa_sf <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tenta baixar direto</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  usa_vect <span class="ot">&lt;-</span> geodata<span class="sc">::</span><span class="fu">gadm</span>(<span class="at">country =</span> <span class="st">"USA"</span>, <span class="at">level =</span> <span class="dv">1</span>, <span class="at">path =</span> <span class="fu">tempdir</span>(), <span class="at">version=</span><span class="st">"latest"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(usa_vect)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Erro ao baixar dados, gadm está com problemas, baixa direto no site: https://gadm.org/maps.html."</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># FILTRAR apenas Utah, Colorado, Arizona, New Mexico</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>four_corners <span class="ot">&lt;-</span> usa_sf <span class="sc">%&gt;%</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Utah"</span>, <span class="st">"Colorado"</span>, <span class="st">"Arizona"</span>, <span class="st">"New Mexico"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair centroides para o grafo</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(four_corners))) <span class="co">#suppressWarnings() era para tirar</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>coords_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(coords)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen (Rainha)</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#identificar quais polígonos são vizinhos e constroir lista de vizinhos</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>nb_queen <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(four_corners, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#criar segmentos de reta ligando os centroides das áreas vizinhas</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>nb_lines_queen <span class="ot">&lt;-</span> <span class="fu">nb2lines</span>(nb_queen, <span class="at">coords =</span> coords, <span class="at">as_sf =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(nb_lines_queen) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(four_corners) <span class="co"># atribuir a nb_lines_queen CRS igual do four_corners</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Rook (Torre)</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>nb_rook <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(four_corners, <span class="at">queen =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>nb_lines_rook <span class="ot">&lt;-</span> <span class="fu">nb2lines</span>(nb_rook, <span class="at">coords =</span> coords, <span class="at">as_sf =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(nb_lines_rook) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(four_corners)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>theme_comp <span class="ot">&lt;-</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legedn.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>p_queen <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> four_corners, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"gray20"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nb_lines_queen, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Conexão (Queen)"</span>), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> coords_df, <span class="fu">aes</span>(X, Y), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> four_corners, <span class="fu">aes</span>(<span class="at">label =</span> NAME_1), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">nudge_x=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"steelblue"</span>, <span class="at">name =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Critério Rainha (Queen)"</span>, </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Utah, Colorado, Arizona, New Mexico</span><span class="sc">\n</span><span class="st"> tem 1 ponto em comum"</span>) <span class="sc">+</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  theme_comp</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Rook</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>p_rook <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> four_corners, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"gray20"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nb_lines_rook, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Conexão (Rook)"</span>), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> coords_df, <span class="fu">aes</span>(X, Y), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> four_corners, <span class="fu">aes</span>(<span class="at">label =</span> NAME_1), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">nudge_x=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"firebrick"</span>, <span class="at">name =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Critério Torre (Rook)"</span>, </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Utah e New Mexico; Colorado e Arizona</span><span class="sc">\n</span><span class="st"> śo tem 1 ponto em comum"</span>) <span class="sc">+</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  theme_comp</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>p_queen <span class="sc">+</span> p_rook</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-vizinhanca-usa-fourcorners" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vizinhanca-usa-fourcorners-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-vizinhanca-usa-fourcorners-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vizinhanca-usa-fourcorners-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.1: Comparação das Estruturas de Vizinhança Queen (Rainha) e Rook (Torre) entre Utah, Colorado, Arizona, New Mexico (Estados Unidos)
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p><strong>Baseado em distância:</strong></p>
<ul>
<li><span class="math inline">\(k\)</span>-Vizinhos mais próximos (<span class="math inline">\(k\)</span>-NN): Define como vizinhos de <span class="math inline">\(i\)</span>, as <span class="math inline">\(k\)</span> unidades cujos centroides (ou outro ponto representativo) estão mais próximos, segundo a distância euclidiana. Garante que cada unidade tenha exatamente <span class="math inline">\(k\)</span> vizinhos, criando uma matriz esparsa e evitando ilhas de desconexão <span class="citation" data-cites="anselin2001spatial">(<a href="references.html#ref-anselin2001spatial" role="doc-biblioref">Anselin 2001</a>)</span>.</li>
</ul></li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, ggplot2, geobr, dplyr, patchwork)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Baixar mapa municipal de Mato Grosso (MT)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>mt_sf <span class="ot">&lt;-</span> <span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MT"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>coords_mt <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mt_sf)))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>theme_map <span class="ot">&lt;-</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular os k=4 vizinhos mais próximos</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>knn_nb <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(coords_mt, <span class="at">k =</span> k)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>nb_knn <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(knn_nb)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter para linhas espaciais para plotar</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>lines_knn <span class="ot">&lt;-</span> <span class="fu">nb2lines</span>(nb_knn, <span class="at">coords =</span> coords_mt, <span class="at">as_sf =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(lines_knn) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(mt_sf)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mt_sf, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lines_knn, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(coords_mt), <span class="fu">aes</span>(X, Y), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"k-Vizinhos Mais Próximos (k="</span>, k, <span class="st">")"</span>),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Cada município conecta-se aos 4 centroides mais próximos"</span>) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  theme_map</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-knn-mt" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-knn-mt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-knn-mt-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-knn-mt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.2: Vizinhança k-NN (k=4) em Mato Grosso.
</figcaption>
</figure>
</div>
</div>
</div>
<pre><code>-   Limiar de distância (*Threshold*): $w_{ij} = 1$ se $d_{ij} \le d_{\max}$, e $0$ caso contrário, onde $d_{ij}$ é a distância entre centroides.</code></pre>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para precisão, vamos projetar para SIRGAS 2000 / Brazil Polyconic (EPSG 5880) para usar metros.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mt_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mt_sf, <span class="dv">5880</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>coords_proj <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mt_proj))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir raio de 120 km (120000 metros)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dist_nb <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords_proj, <span class="dv">0</span>, <span class="dv">120000</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter para linhas</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>lines_dist <span class="ot">&lt;-</span> <span class="fu">nb2lines</span>(dist_nb, <span class="at">coords =</span> coords_proj, <span class="at">as_sf =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(lines_dist) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(mt_proj)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mt_proj, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lines_dist, <span class="at">color =</span> <span class="st">"darkorange"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(coords_proj), <span class="fu">aes</span>(X, Y), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Limiar de Distância Fixa (120 km)"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Conexões apenas se d &lt; 120km (Note as ilhas isoladas)"</span>) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  theme_map</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-dist-threshold" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dist-threshold-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-dist-threshold-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dist-threshold-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.3: Vizinhança por Limiar de Distância (120km).
</figcaption>
</figure>
</div>
</div>
</div>
<pre><code>-   Decaimento por distância: Atribui pesos que decrescem com a distância, ex: $w_{ij} = d_{ij}^{-\alpha}$ ou $w_{ij} = \exp(-\beta d_{ij})$. Atribui maior influência a unidades mais próximas.</code></pre>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar Cuiabá</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>id_cuiaba <span class="ot">&lt;-</span> <span class="fu">which</span>(mt_sf<span class="sc">$</span>name_muni <span class="sc">==</span> <span class="st">"Cuiabá"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular distâncias de Cuiabá para TODOS os outros municípios</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>nb_all <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords_proj, <span class="dv">0</span>, <span class="dv">900000</span>) <span class="co"># Raio grande para pegar quase todo estado</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>dists <span class="ot">&lt;-</span> <span class="fu">nbdists</span>(nb_all, coords_proj)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular Pesos (Inverso da Distância: 1/d)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>weights_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dists, <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(x<span class="sc">/</span><span class="dv">1000</span>)) <span class="co"># /1000 para km</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar dados apenas para Cuiabá para visualização</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>vizinhos_cuiaba <span class="ot">&lt;-</span> nb_all[[id_cuiaba]]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>pesos_cuiaba <span class="ot">&lt;-</span> weights_list[[id_cuiaba]]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar linhas saindo de Cuiabá</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>lines_cuiaba <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(vizinhos_cuiaba))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vizinhos_cuiaba)) {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  dest_idx <span class="ot">&lt;-</span> vizinhos_cuiaba[i]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  lines_cuiaba[[i]] <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(coords_proj[id_cuiaba,], coords_proj[dest_idx,]))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>sf_decay <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">peso =</span> pesos_cuiaba, <span class="at">geometry =</span> <span class="fu">st_sfc</span>(lines_cuiaba), <span class="at">crs =</span> <span class="dv">5880</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mt_proj, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sf_decay, <span class="fu">aes</span>(<span class="at">color =</span> peso, <span class="at">linewidth =</span> peso), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>coords_proj[id_cuiaba,<span class="dv">1</span>], <span class="at">y=</span>coords_proj[id_cuiaba,<span class="dv">2</span>]), <span class="at">color=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">name =</span> <span class="st">"Peso (1/d)"</span>) <span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linewidth</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">2</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Decaimento por Distância (Foco: Cuiabá)"</span>,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"A espessura e cor indicam a força da influência"</span>) <span class="sc">+</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  theme_map</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-distance-decay" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-distance-decay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-distance-decay-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-distance-decay-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.4: Decaimento por Distância Inversa a partir de Cuiabá.
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><strong>Vizinhança econômica ou social:</strong> <span class="citation" data-cites="harris2011search">Harris, Moffat, e Kravtsova (<a href="references.html#ref-harris2011search" role="doc-biblioref">2011</a>)</span> argumentam que a contiguidade física pode ser insuficiente ou enganosa em muitos contextos. Em estudos regionais, a conexão funcional frequentemente supera a proximidade geográfica. Por exemplo, no Brasil, um município do agronegócio no Centro-Oeste (ex.: <a href="https://pt.wikipedia.org/wiki/Sorriso">Sorriso/MT</a>) pode estar economicamente mais conectado aos <a href="https://pt.wikipedia.org/wiki/Porto_de_Santos">portos de Santos (SP)</a> ou <a href="https://pt.wikipedia.org/wiki/Paranagu%C3%A1">Paranaguá (PR)</a> por onde escoa sua produção do que aos municípios geograficamente adjacentes em seu próprio estado que possuem economias de base diferente. Da mesma forma, para análises de mercado de trabalho ou inovação, a <a href="https://pt.wikipedia.org/wiki/Regi%C3%A3o_Metropolitana_de_S%C3%A3o_Paulo">região metropolitana de São Paulo</a> pode ter uma interação mais intensa com polos tecnológicos como <a href="https://pt.wikipedia.org/wiki/Regi%C3%A3o_Metropolitana_de_Campinas">Campinas</a> ou até com outros centros globais do que com municípios vizinhos de baixa intensidade tecnológica. Matrizes baseadas em fluxos (comerciais, migratórios, de passageiros), similaridade socioeconômica (<a href="https://pt.wikipedia.org/wiki/Produto_interno_bruto">PIB</a> per capita, estrutura produtiva) ou redes de infraestrutura (rodovias, linhas de voo) são, portanto, alternativas teóricas mais ricas e adequadas a fenômenos específicos.</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar mapa do Brasil (Estados)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>br_states <span class="ot">&lt;-</span> <span class="fu">read_state</span>(<span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordenadas aproximadas das cidades de interesse</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (Sorriso-MT, Santos-SP, Paranaguá-PR)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>cidades_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"Sorriso (MT)"</span>, <span class="st">"Porto de Santos (SP)"</span>, <span class="st">"Porto de Paranaguá (PR)"</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">12.5427</span>, <span class="sc">-</span><span class="fl">23.9618</span>, <span class="sc">-</span><span class="fl">25.5205</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">55.7211</span>, <span class="sc">-</span><span class="fl">46.3322</span>, <span class="sc">-</span><span class="fl">48.5095</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">tipo =</span> <span class="fu">c</span>(<span class="st">"Origem"</span>, <span class="st">"Destino"</span>, <span class="st">"Destino"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>cidades_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(cidades_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar conexões (Arcos)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>sorriso_coords <span class="ot">&lt;-</span> <span class="fu">subset</span>(cidades_df, cidade <span class="sc">==</span> <span class="st">"Sorriso (MT)"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>destinos <span class="ot">&lt;-</span> <span class="fu">subset</span>(cidades_df, tipo <span class="sc">==</span> <span class="st">"Destino"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>conexoes <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(destinos), <span class="cf">function</span>(i) {</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sorriso_coords<span class="sc">$</span>lon, sorriso_coords<span class="sc">$</span>lat),</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(destinos<span class="sc">$</span>lon[i], destinos<span class="sc">$</span>lat[i])</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>conexoes_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">geometry =</span> <span class="fu">st_sfc</span>(conexoes), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> br_states, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Destacar Estados envolvidos</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">subset</span>(br_states, abbrev_state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MT"</span>, <span class="st">"SP"</span>, <span class="st">"PR"</span>)), </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"gray85"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Linhas de Fluxo (Curvas para indicar movimento/distância)</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> sorriso_coords<span class="sc">$</span>lon, <span class="at">y1 =</span> sorriso_coords<span class="sc">$</span>lat,</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x2 =</span> destinos<span class="sc">$</span>lon, <span class="at">y2 =</span> destinos<span class="sc">$</span>lat),</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y1, <span class="at">xend =</span> x2, <span class="at">yend =</span> y2),</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">curvature =</span> <span class="fl">0.2</span>, </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>             <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.03</span>, <span class="st">"npc"</span>))) <span class="sc">+</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> cidades_df, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">color =</span> tipo), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> cidades_df, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">label =</span> cidade), </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x=</span><span class="dv">8</span>, <span class="at">nudge_y=</span><span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co">#usei nudge pra mover legenda</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vizinhança Econômica (Fluxo de Commodities)"</span>,</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"A conexão funcional supera a proximidade geográfica"</span>) <span class="sc">+</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-vizinhanca-economica" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vizinhanca-economica-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-vizinhanca-economica-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vizinhanca-economica-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.5: Vizinhança Econômica/Funcional: O Agronegócio conectando Sorriso-MT aos Portos.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-matriz_pesos" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="sec-matriz_pesos"><span class="header-section-number">4.1.2</span> Matriz de pesos espaciais (<span class="math inline">\(\mathbf{W}\)</span>) e normalização</h3>
<p>A matriz binária de adjacência <span class="math inline">\(\mathbf{W} = [w_{ij}]_{n \times n}\)</span> (com elementos 0 ou 1) é frequentemente transformada em uma matriz de pesos para refletir a intensidade relativa das conexões. A escolha dos pesos é exógena ao modelo (ou seja, deve ser definida a priori com base em teoria ou no desenho do estudo) e tem implicações na estimação e interpretação <span class="citation" data-cites="kelejian2017spatial">(<a href="references.html#ref-kelejian2017spatial" role="doc-biblioref">H. Kelejian e Piras 2017</a>)</span>.</p>
<p>A necessidade de normalização surge por razões estatísticas e de interpretação. Em modelos autorregressivos espaciais (por serem vistos mais adiante), o parâmetro de dependência <span class="math inline">\(\rho\)</span> deve geralmente estar em um intervalo que garanta a invertibilidade da matriz <span class="math inline">\(( \mathbf{I} - \rho \mathbf{W} )\)</span>. Se <span class="math inline">\(\mathbf{W}\)</span> não for normalizada, os autovalores podem ser muito grandes ou desiguais, restringindo o espaço paramétrico válido para <span class="math inline">\(\rho\)</span> a um intervalo desconhecido e difícil de interpretar. A normalização estabiliza o comportamento numérico do modelo.</p>
<ul>
<li><strong>Normalização por linha (<em>row-standardization</em>)</strong></li>
</ul>
<p>É a abordagem mais comum. Cada peso é dividido pela soma da linha correspondente:</p>
<p><span class="math display">\[ w_{ij}^{r} = \frac{w_{ij}}{\sum_{j=1}^n w_{ij}}.\]</span></p>
<p>O resultado é que cada linha de <span class="math inline">\(\mathbf{W}^{r}\)</span> soma 1. A operação <span class="math inline">\(\mathbf{W}^{r}\mathbf{y}\)</span> gera uma defasagem espacial (<a href="https://en.wikipedia.org/wiki/Spatial_weight_matrix">spatial lag</a>) que é interpretado como a média ponderada dos valores dos vizinhos de cada unidade. Esta normalização equaliza a capacidade de receber influência de cada unidade, independentemente do seu número de vizinhos. Garante também que o maior autovalor de <span class="math inline">\(\mathbf{W}^{r}\)</span> seja 1, facilitando a definição do intervalo <span class="math inline">\((-1, 1)\)</span> para <span class="math inline">\(\rho\)</span> em modelos SAR.</p>
<p>Exemplo: Considere uma matriz de vizinhança/adjacência binária <span class="math inline">\(\mathbf{W}\)</span> para quatro unidades/estados (A, B, C, D), onde estado A é vizinho de B e C; B é vizinha apenas de A; C é vizinho apenas de A e, D é isolado.</p>
<p>A normalização por linha transforma a matriz da seguinte forma:</p>
<p><span class="math display">\[
\mathbf{W} =
\begin{array}{c|cccc}
&amp; A &amp; B &amp; C &amp; D \\
\hline
A &amp; 0 &amp; 1 &amp; 1 &amp; 0 \\
B &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
C &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
D &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{array}
\quad \rightarrow \quad
\mathbf{W}^{r} =
\begin{array}{c|cccc}
&amp; A &amp; B &amp; C &amp; D \\
\hline
A &amp; 0 &amp; 0.5 &amp; 0.5 &amp; 0 \\
B &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
C &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
D &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{array}
\]</span></p>
<p>Cada unidade recebe uma influência total igual a 1 de seus vizinhos. A unidade A (com dois vizinhos) recebe 50% de sua influência de B e 50% de C. B e C (cada um com um único vizinho) recebem 100% de sua influência de A. D não recebe influência. A defasagem espacial para a unidade A, <span class="math inline">\((\mathbf{W}^{r}\mathbf{y})_A\)</span>, é <span class="math inline">\(0.5 \cdot y_B + 0.5 \cdot y_C\)</span>, a média simples dos valores de seus vizinhos.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, geobr, dplyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar mapa do estado de Sergipe </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>se_sf <span class="ot">&lt;-</span> <span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"SE"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar vizinhança (Queen)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(se_sf, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar Matriz Binária (0 e 1)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Necessária para os cálculos manuais de Coluna, Espectral e CAR</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>W_binaria <span class="ot">&lt;-</span> <span class="fu">nb2mat</span>(nb, <span class="at">style =</span> <span class="st">"B"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Dimensão da Matriz W:"</span>, <span class="fu">nrow</span>(W_binaria), <span class="st">"x"</span>, <span class="fu">ncol</span>(W_binaria))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dimensão da Matriz W: 75 x 75"</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalização por linha, style = "W"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lw_row <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair a matriz de pesos para verificação</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>W_row <span class="ot">&lt;-</span> <span class="fu">listw2mat</span>(lw_row)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A soma dos pesos de cada linha deve ser 1 (para quem tem vizinhos)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>soma_linhas <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(W_row)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(soma_linhas)) <span class="co"># Deve mostrar 1, 1, 1... (por baixo), </span></span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1 2 3 4 5 6 
1 1 1 1 1 1 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#os de cima sao indices que identificam Municipios</span></span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ul>
<li><strong>Normalização por Coluna (<em>Column-Standardization</em>)</strong></li>
</ul>
<p>Cada peso é dividido pela soma da coluna correspondente:</p>
<p><span class="math display">\[ w_{ij}^{c} = \frac{w_{ij}}{\sum_{i=1}^n w_{ij}}.\]</span></p>
<p>Esta abordagem equaliza a capacidade de emitir influência de cada unidade. Enquanto a normalização por linha controla o impacto recebido, a normalização por coluna controla o impacto causado.</p>
<p>Exemplo: Usando a mesma matriz <span class="math inline">\(\mathbf{W}\)</span> definida anteriormente, a normalização por coluna resulta em:</p>
<p><span class="math display">\[
\mathbf{W} =
\begin{array}{c|cccc}
&amp; A &amp; B &amp; C &amp; D \\
\hline
A &amp; 0 &amp; 1 &amp; 1 &amp; 0 \\
B &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
C &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
D &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{array}
\quad \rightarrow \quad
\mathbf{W}^{c} =
\begin{array}{c|cccc}
&amp; A &amp; B &amp; C &amp; D \\
\hline
A &amp; 0 &amp; 1 &amp; 1 &amp; 0 \\
B &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 \\
C &amp; 0.5 &amp; 0 &amp; 0 &amp; 0 \\
D &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{array}
\]</span></p>
<p>A influência total que cada unidade emite é normalizada para 1. A unidade A é alvo da influência de B e C; portanto, a coluna A (influência emitida para A) soma 2 (vinda de B e C). Cada conexão para A recebe peso <span class="math inline">\(1/2\)</span>. A unidade B emite influência apenas para A (coluna B soma 1), logo, a conexão de A para B recebe peso 1. Assim, a defasagem espacial agora é um vetor onde o valor para cada unidade é a soma dos valores das unidades que ela influencia, ponderada pela intensidade. Para a unidade A, <span class="math inline">\((\mathbf{W}^{c}\mathbf{y})_A = 1 \cdot y_B + 1 \cdot y_C\)</span>. Esta abordagem é menos comum, mas pode ser relevante em modelos de difusão ou análise de redes, onde o <a href="https://en.wikipedia.org/wiki/Directed_graph">out-degree</a> (influência emitida) é um objeto de interesse central.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular a soma de cada coluna da matriz binária</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>col_somas <span class="ot">&lt;-</span> <span class="fu">colSums</span>(W_binaria)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Proteção contra divisão por zero (caso haja ilhas)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>col_somas[col_somas <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividir cada elemento pela soma da sua coluna</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A função sweep aplica a operação na MARGIN=2 (colunas)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>W_col <span class="ot">&lt;-</span> <span class="fu">sweep</span>(W_binaria, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">STATS =</span> col_somas, <span class="at">FUN =</span> <span class="st">"/"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># A soma da primeira coluna deve ser 1</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Soma da Coluna 1:"</span>, <span class="fu">sum</span>(W_col[,<span class="dv">1</span>]))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Soma da Coluna 1: 1"</code></pre>
</div>
</div>
<ul>
<li><strong>Normalização espectral (ou por autovalor máximo):</strong> Para preservar as proporções relativas originais entre os pesos (especialmente importante em matrizes baseadas em distância), normaliza-se toda a matriz por seu autovalor de maior módulo, <span class="math inline">\(\lambda_{max}\)</span>:</li>
</ul>
<p><span class="math display">\[ \mathbf{W}^{spectral} = \frac{\mathbf{W}^0}{\lambda_{max}}.\]</span></p>
<p>Esta abordagem mantém a simetria da matriz (se originalmente simétrica) e preserva o significado físico original dos pesos (ex., um decaimento por distância). É recomendada por autores como <span class="citation" data-cites="kelejian2010specification">H. H. Kelejian e Prucha (<a href="references.html#ref-kelejian2010specification" role="doc-biblioref">2010</a>)</span> e <span class="citation" data-cites="elhorst2014spatial">Elhorst et al. (<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">2014</a>)</span> para evitar distorções na estrutura de dependência.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular autovalores da matriz binária</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>autovalores <span class="ot">&lt;-</span> <span class="fu">eigen</span>(W_binaria, <span class="at">only.values =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>values</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Encontrar o maior autovalor absoluto (Raio Espectral)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>lambda_max <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(autovalores))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizar a matriz</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>W_spec <span class="ot">&lt;-</span> W_binaria <span class="sc">/</span> lambda_max</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># O maior autovalor da nova matriz deve ser 1</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Novo Lambda Max:"</span>, <span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">eigen</span>(W_spec, <span class="at">only.values=</span><span class="cn">TRUE</span>)<span class="sc">$</span>values))))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Novo Lambda Max: 1"</code></pre>
</div>
</div>
<ul>
<li><strong>Normalização de variância escalar (para modelos CAR):</strong> Em modelos autorregressivos condicionais (CAR) bayesianos, busca-se frequentemente uma matriz simétrica para definir uma matriz de precisão válida. Uma normalização comum é:</li>
</ul>
<p><span class="math display">\[\mathbf{W}^{CAR} = \mathbf{D}^{-1/2} \mathbf{W} \mathbf{D}^{-1/2},\]</span></p>
<p>onde <span class="math inline">\(\mathbf{D}\)</span> é uma matriz diagonal com <span class="math inline">\(d_{ii} = \sum_j w_{ij}\)</span>. Esta forma estabiliza a variância e preserva a simetria.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fórmula: D^(-1/2) * W * D^(-1/2)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter número de vizinhos (D) de cada área</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>num_vizinhos <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(W_binaria)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular a matriz diagonal inversa da raiz quadrada (D^-1/2)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Se vizinhos = 0, mantemos 0 para evitar Infinito</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>inv_sqrt_D <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(num_vizinhos <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(num_vizinhos), <span class="dv">0</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>M_diag <span class="ot">&lt;-</span> <span class="fu">diag</span>(inv_sqrt_D)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiplicação Matricial (%*%)</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>W_car <span class="ot">&lt;-</span> M_diag <span class="sc">%*%</span> W_binaria <span class="sc">%*%</span> M_diag</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar o canto da matriz (Note que ela é simétrica)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(W_car[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">3</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2] [,3] [,4] [,5]
[1,] 0.000 0.192    0    0    0
[2,] 0.192 0.000    0    0    0
[3,] 0.000 0.000    0    0    0
[4,] 0.000 0.000    0    0    0
[5,] 0.000 0.000    0    0    0</code></pre>
</div>
</div>
</section>
<section id="críticas-e-escolha-da-matriz-mathbfw" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="críticas-e-escolha-da-matriz-mathbfw"><span class="header-section-number">4.1.3</span> Críticas e escolha da matriz <span class="math inline">\(\mathbf{W}\)</span></h3>
<p>A escolha de <span class="math inline">\(\mathbf{W}\)</span> é frequentemente o ponto mais subjetivo e crítico da modelagem espacial. <span class="citation" data-cites="kelejian2017spatial">H. Kelejian e Piras (<a href="references.html#ref-kelejian2017spatial" role="doc-biblioref">2017</a>)</span> e <span class="citation" data-cites="elhorst2014spatial">Elhorst et al. (<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">2014</a>)</span> apresentam críticas à aplicação da normalização por linha:</p>
<ol type="1">
<li><p>Perda da interpretação de distância: Se <span class="math inline">\(\mathbf{W}\)</span> é baseada no inverso da distância (<span class="math inline">\(w_{ij} = d_{ij}^{-\alpha}\)</span>), a normalização por linha destrói a estrutura de decaimento absoluto. Uma unidade central com muitos vizinhos próximos (<span class="math inline">\(\sum_j w_{ij}\)</span> grande) terá seus pesos reduzidos drasticamente, enquanto uma unidade periférica com poucos vizinhos distantes (<span class="math inline">\(\sum_j w_{ij}\)</span> pequeno) terá seus pesos inflacionados.</p></li>
<li><p>Indução de assimetria: Uma matriz de contiguidade ou distância é frequentemente simétrica (<span class="math inline">\(w_{ij} = w_{ji}\)</span>). A normalização por linha gera uma matriz assimétrica (<span class="math inline">\(w_{ij}^{r} \neq w_{ji}^{r}\)</span>), o que pode ser contra-intuitivo para noções de vizinhança e complica a interpretação em alguns modelos.</p></li>
<li><p>A Falácia da seleção por <span class="math inline">\(R^2\)</span>: Uma prática comum é escolher a matriz <span class="math inline">\(\mathbf{W}\)</span> (ou seu critério de construção) que maximiza uma medida de ajuste como o <span class="math inline">\(R^2\)</span> ou a verossimilhança do modelo. <span class="citation" data-cites="kelejian2017spatial">H. Kelejian e Piras (<a href="references.html#ref-kelejian2017spatial" role="doc-biblioref">2017</a>)</span> demonstram analiticamente que este procedimento é enviesado. Eles provam que o <span class="math inline">\(R^2\)</span> é maximizado quando os pesos se aproximam de uma matriz de pesos uniformes. Nesse cenário, o parâmetro espacial <span class="math inline">\(\hat{\rho}\)</span> absorve toda a variação, e os coeficientes das covariáveis <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> colapsam para zero, produzindo um modelo sem poder explicativo real.</p></li>
</ol>
<p>Assim, a seleção de <span class="math inline">\(\mathbf{W}\)</span> deve ser guiada pela teoria substantiva do fenômeno em estudo. Quando várias especificações são plausíveis, pode-se usar:</p>
<ul>
<li>Critérios de seleção de modelo: Como proposto por <span class="citation" data-cites="zhang2018spatial">Zhang e Yu (<a href="references.html#ref-zhang2018spatial" role="doc-biblioref">2018</a>)</span>, que adaptam um critério do tipo <span class="math inline">\(C_p\)</span> de <a href="https://en.wikipedia.org/wiki/Mallows%27s_Cp">Mallows</a> para selecionar a matriz dentro de um conjunto candidato, visando minimizar o erro de previsão. Em sua forma clássica, o <span class="math inline">\(C_p\)</span> de Mallows fornece uma estimativa do erro quadrático médio de previsão para um modelo de regressão com <span class="math inline">\(p\)</span> parâmetros <span class="citation" data-cites="Mallows1973 mallows1995more">(<a href="references.html#ref-Mallows1973" role="doc-biblioref">Colin L. Mallows 1973</a>; <a href="references.html#ref-mallows1995more" role="doc-biblioref">Cohn L. Mallows 1995</a>)</span>. Sua expressão é dada por:</li>
</ul>
<p><span class="math display">\[
C_p = \frac{\text{SSE}_p}{\hat{\sigma}^2} - n + 2p,
\]</span></p>
<p>onde = <span class="math inline">\(\text{SSE}_p\)</span> é a soma dos quadrados dos resíduos do modelo candidato; <span class="math inline">\(\hat{\sigma}^2\)</span> é uma estimativa não viciada da variância do erro do modelo mais completo (ou do modelo considerado verdadeiro); <span class="math inline">\(n\)</span> é o número de observações e, <span class="math inline">\(p\)</span> é o número de parâmetros do modelo (incluindo o intercepto), que atua como penalização pela complexidade.</p>
<p>Um valor menor de <span class="math inline">\(C_p\)</span> indica um melhor equilíbrio entre qualidade de ajuste (SSE baixo) e parcimônia (penalidade <span class="math inline">\(p\)</span> baixa), guiando a seleção do modelo.</p>
<p><span class="citation" data-cites="zhang2018spatial">Zhang e Yu (<a href="references.html#ref-zhang2018spatial" role="doc-biblioref">2018</a>)</span> estende este princípio para modelos de defasagem espacial (SAR). A ideia central é tratar cada matriz candidata <span class="math inline">\(\mathbf{W}_k\)</span> como um modelo distinto. Para um SAR da forma <span class="math inline">\(\mathbf{y} = \rho_k \mathbf{W}_k \mathbf{y} + \mathbf{X} \boldsymbol{\beta}_k + \boldsymbol{\varepsilon}_k\)</span>, uma estatística <span class="math inline">\(C_p\)</span> adaptada é derivada.</p>
<p>Essa adaptação considera que a complexidade efetiva do modelo espacial não depende apenas do número de covariáveis em <span class="math inline">\(\mathbf{X}\)</span>, mas também da estrutura de dependência induzida por <span class="math inline">\(\mathbf{W}_k\)</span> e do parâmetro espacial <span class="math inline">\(\rho_k\)</span>. O <a href="https://pt.wikipedia.org/wiki/Tra%C3%A7o_(%C3%A1lgebra_linear)">traço da matriz</a> de <a href="https://pt.wikipedia.org/wiki/Proje%C3%A7%C3%A3o_(%C3%A1lgebra_linear)">projeção</a> (ou <em>hat matrix</em>) do modelo SAR, <span class="math inline">\(\text{tr}(\mathbf{H}_k)\)</span>, que generaliza o número de parâmetros <span class="math inline">\(p\)</span>, é tipicamente utilizado na penalização. A estatística resultante pode ser aproximada por:</p>
<p><span class="math display">\[
C_p(\mathbf{W}_k) \approx \frac{\text{SSE}_k}{\hat{\sigma}^2} - n + 2 \, \text{tr}(\mathbf{H}_k),
\]</span></p>
<p>onde <span class="math inline">\(\text{SSE}_k\)</span> e <span class="math inline">\(\text{tr}(\mathbf{H}_k)\)</span> são calculados para o modelo estimado com a matriz <span class="math inline">\(\mathbf{W}_k\)</span>. A matriz <span class="math inline">\(\mathbf{W}_k\)</span> que minimiza <span class="math inline">\(C_p(\mathbf{W}_k)\)</span> no conjunto candidato é então selecionada.</p>
<p><span class="citation" data-cites="zhang2018spatial">Zhang e Yu (<a href="references.html#ref-zhang2018spatial" role="doc-biblioref">2018</a>)</span> demonstra que este procedimento é assintoticamente ótimo no sentido de minimizar o erro quadrático médio de previsão, mesmo que a verdadeira matriz de pesos (geradora dos dados) não esteja incluída no conjunto <span class="math inline">\(\{\mathbf{W}_1, \ldots, \mathbf{W}_K\}\)</span>.</p>
<ul>
<li>Média de modelos: Uma evolução natural deste paradigma é reconhecer a incerteza inerente à escolha de uma única matriz. Em vez de selecionar um único <span class="math inline">\(\mathbf{W}_k\)</span>, a abordagem de média de modelos combina as previsões de todos os modelos candidatos, atribuindo-lhes pesos que refletem seu suporte empírico. <span class="citation" data-cites="miao2025spatial">Miao et al. (<a href="references.html#ref-miao2025spatial" role="doc-biblioref">2025</a>)</span> estendem esta lógica para modelos espaciais multivariados (MSAR). Eles propõem estimar pesos <span class="math inline">\(\pi_k\)</span> para cada modelo (cada um com sua matriz <span class="math inline">\(\mathbf{W}_k\)</span>) de modo a minimizar o risco de predição. A previsão final é uma média ponderada:</li>
</ul>
<p><span class="math display">\[
\hat{\mathbf{y}}^* = \sum_{k=1}^K \pi_k \, \hat{\mathbf{y}}_k,
\]</span></p>
<p>onde <span class="math inline">\(\hat{\mathbf{y}}_k\)</span> é a previsão do modelo com matriz <span class="math inline">\(\mathbf{W}_k\)</span>. Esta estratégia geralmente produz previsões mais robustas e estáveis do que qualquer modelo individual, pois incorpora a incerteza sobre a estrutura de dependência espacial correta.</p>
</section>
</section>
<section id="implicações-estatísticas-da-discretização-espacial" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="implicações-estatísticas-da-discretização-espacial"><span class="header-section-number">4.2</span> Implicações estatísticas da discretização espacial</h2>
<p>A agregação de um processo contínuo em unidades de área discretas introduz desafios inferenciais profundos que vão além do MAUP.</p>
<ol type="1">
<li><p>O MAUP possui duas dimensões <span class="citation" data-cites="openshaw1984modifiable">Openshaw (<a href="references.html#ref-openshaw1984modifiable" role="doc-biblioref">1984</a>)</span> . O efeito de escala refere-se à mudança nos resultados ao se alterar o nível de agregação (ex.: de bairros para municípios). O efeito de zoneamento refere-se à mudança nos resultados ao se redesenhar os limites das unidades no mesmo nível de agregação. Ambos podem alterar ou até inverter o sinal de correlações e parâmetros espaciais, pois a discretização atua como um filtro não linear na estrutura de covariância do processo subjacente.</p></li>
<li><p>Em dados de contagem (ex.: casos de doença), a variabilidade observada é uma combinação da variação do processo espacial latente de risco (<span class="math inline">\(Y(\mathbf{s})\)</span>) e da variação inerente ao mecanismo de amostragem (ex.: distribuição de Poisson). Em áreas com populações pequenas, a flutuação amostral pode dominar, criando padrões espúrios. <span class="citation" data-cites="cressie1989spatial">Cressie e Chan (<a href="references.html#ref-cressie1989spatial" role="doc-biblioref">1989</a>)</span> mostram, no estudo da Síndrome da Morte Súbita Infantil (SIDS), como a heterogeneidade do tamanho da população-base pode gerar autocorrelação espacial aparente. Modelos hierárquicos que incorporam um offset populacional ou usam distribuições como a Binomial negativa são essenciais para separar esses efeitos.</p></li>
<li><p>A agregação tende a alisar a variação local de um processo contínuo, podendo atenuar <em>hotspots</em> reais. Além disso, como alertado por <span class="citation" data-cites="reich2006effects">Reich, Hodges, e Zadnik (<a href="references.html#ref-reich2006effects" role="doc-biblioref">2006</a>)</span>, a inclusão de termos de dependência espacial (como um processo CAR ou SAR) para capturar correlação nos resíduos pode introduzir colinearidade com as covariáveis fixas do modelo, inflando a variância das estimativas dos coeficientes <span class="math inline">\(\boldsymbol{\beta}\)</span> e complicando a inferência.</p></li>
<li><p>A estrutura de dependência inferida é altamente condicional à matriz <span class="math inline">\(\mathbf{W}\)</span> especificada. Duas observações fisicamente próximas, mas separadas por uma fronteira administrativa que não é considerada no critério de vizinhança, serão modeladas como independentes. Portanto, a dependência espacial estimada é, em grande parte, uma função da discretização e da definição de vizinhança adotada, e não apenas uma propriedade intrínseca do fenômeno <span class="citation" data-cites="hodges2010adding">(<a href="references.html#ref-hodges2010adding" role="doc-biblioref">Hodges e Reich 2010</a>)</span>.</p></li>
</ol>
</section>
<section id="sec-esda" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-esda"><span class="header-section-number">4.3</span> Análise exploratória em dados de área</h2>
<p>A Análise Exploratória de Dados Espaciais (ESDA – <a href="https://cran.r-project.org/web/packages/geostan/vignettes/measuring-sa.html">Exploratory Spatial Data Analysis</a>) é definida por <span class="citation" data-cites="anselin1995local">Anselin (<a href="references.html#ref-anselin1995local" role="doc-biblioref">1995</a>)</span> como um conjunto de técnicas destinadas a: (i) descrever e visualizar distribuições espaciais; (ii) identificar localizações atípicas (<em>spatial outliers</em>); (iii) detectar padrões de associação espacial (<em>clusters</em>); e (iv) sugerir regimes de heterogeneidade espacial. Diferentemente da estatística descritiva clássica, a ESDA não assume independência entre as observações. O seu objetivo central é, justamente, quantificar a natureza e a intensidade da dependência espacial, que é definida pela estrutura de vizinhança <span class="math inline">\(\mathbf{W}=[w_{ij}]_{n \times n}\)</span> (ver <a href="#sec-lattice" class="quarto-xref"><span>Seção 4.1</span></a>). A ESDA é uma extensão da Análise Exploratória de Dados (EDA) para o contexto espacial, mantendo seu caráter visual e robusto, mas com a adição fundamental do mapa como ferramenta central para responder a perguntas como “onde estão esses casos no mapa?” ou “quais áreas nesta sub-região atendem a critérios específicos de atributo?” <span class="citation" data-cites="haining1998exploratory">R. H. Haining, Wise, e Ma (<a href="references.html#ref-haining1998exploratory" role="doc-biblioref">1998</a>)</span> .</p>
<p>Em dados de área (<em>lattice</em>), onde <span class="math inline">\(y_i\)</span> representa um valor agregado na unidade discreta <span class="math inline">\(i\)</span>, a análise divide-se fundamentalmente em duas categorias: indicadores globais (que resumem o padrão de todo o mapa num único escalar) e indicadores locais (que decompõem a estrutura de dependência para cada <span class="math inline">\(i\)</span>-unidade individualmente). A implementação prática da ESDA frequentemente ocorre em ambientes de Sistemas de Informação Geográfica (GIS), que integram capacidades de visualização cartográfica, gestão de dados e análise estatística interativa, como exemplificado pelo sistema SAGE descrito por <span class="citation" data-cites="haining1998exploratory">R. H. Haining, Wise, e Ma (<a href="references.html#ref-haining1998exploratory" role="doc-biblioref">1998</a>)</span>. Este capítulo, assim como feito nos outros capítulos, usaremos o <code>R/Rstudio</code>.</p>
<section id="estatísticas-globais-de-autocorrelação" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="estatísticas-globais-de-autocorrelação"><span class="header-section-number">4.3.1</span> Estatísticas globais de autocorrelação</h3>
<p>As estatísticas globais testam a hipótese nula de aleatoriedade espacial completa (CSR - <em>Complete Spatial Randomness</em>). Sob <span class="math inline">\(H_0\)</span>, os valores <span class="math inline">\(\{y_i\}\)</span> são distribuídos aleatoriamente pelas localizações fixas, sem respeitar a topologia definida por <span class="math inline">\(\mathbf{W}\)</span>.</p>
<p><strong>Índice I de Moran</strong></p>
<p>O Índice de Moran (<span class="math inline">\(I\)</span>) é a medida de autocorrelação espacial mais amplamente utilizada, introduzida formalmente por <span class="citation" data-cites="moran1950notes">Moran (<a href="references.html#ref-moran1950notes" role="doc-biblioref">1950</a>)</span> . A sua estrutura é análoga ao coeficiente de <a href="https://pt.wikipedia.org/wiki/Coeficiente_de_correla%C3%A7%C3%A3o_de_Pearson">correlação de Pearson</a>, mas ponderada pela matriz de pesos espaciais. Para um vetor de observações <span class="math inline">\(\mathbf{y} = (y_1, \dots, y_n)^\top\)</span> com <span class="math inline">\(n\)</span> unidades:</p>
<p><span id="eq-moran"><span class="math display">\[
I = \frac{n}{S_0} \cdot \frac{\sum_{i=1}^n \sum_{j=1}^n w_{ij} (y_i - \bar{y})(y_j - \bar{y})}{\sum_{i=1}^n (y_i - \bar{y})^2} = \frac{n}{S_0} \cdot \frac{\mathbf{z}^\top \mathbf{W} \mathbf{z}}{\mathbf{z}^\top \mathbf{z}},
\tag{4.1}\]</span></span></p>
<p>onde <span class="math inline">\(\mathbf{z} = (y_1 - \bar{y}, \dots, y_n - \bar{y})^\top\)</span> é o vetor dos desvios em relação à média <span class="math inline">\(\bar{y}\)</span>, <span class="math inline">\(w_{ij}\)</span> são os elementos da matriz de pesos espaciais <span class="math inline">\(\mathbf{W}\)</span> (tipicamente normalizada por linha, ver <a href="#sec-matriz_pesos" class="quarto-xref"><span>Seção 4.1.2</span></a>), e <span class="math inline">\(S_0 = \sum_{i=1}^n \sum_{j=1}^n w_{ij}\)</span> é a soma de todos os pesos (que iguala <span class="math inline">\(n\)</span> no caso de normalização por linha).</p>
<p>O valor esperado de <span class="math inline">\(I\)</span> sob <span class="math inline">\(H_0\)</span> é <span class="math inline">\(E[I] = -1/(n-1)\)</span>, que tende a zero quando <span class="math inline">\(n\)</span> aumenta.</p>
<ul>
<li><p><span class="math inline">\(I &gt; E[I]\)</span>: Indica autocorrelação espacial positiva (agrupamento de valores semelhantes no espaço).</p></li>
<li><p><span class="math inline">\(I &lt; E[I]\)</span>: Indica autocorrelação espacial negativa (dispersão perfeita ou padrão de xadrez).</p></li>
</ul>
<p>A inferência é geralmente realizada através de uma abordagem de permutação condicional (Monte Carlo), uma vez que a aproximação à normalidade depende de pressupostos assintóticos que podem não se verificar em matrizes de pesos irregulares, como discutido por <span class="citation" data-cites="getis1995cliff">Getis (<a href="references.html#ref-getis1995cliff" role="doc-biblioref">1995</a>)</span>.</p>
<p><strong>Propriedades estatísticas do Índice de Moran</strong></p>
<p>Embora “não exista” um teste uniformemente mais poderoso (UMP) para autocorrelação espacial em todos os cenários, <span class="citation" data-cites="tiefelsdorf2000modelling">Tiefelsdorf (<a href="references.html#ref-tiefelsdorf2000modelling" role="doc-biblioref">2000</a>)</span> demonstrou que o <span class="math inline">\(I\)</span> de Moran é um teste Localmente Melhor Invariante (LBI). Isso significa que, na vizinhança da hipótese nula (<span class="math inline">\(\rho \approx 0\)</span>), a função de poder do <span class="math inline">\(I\)</span> de Moran possui a inclinação mais acentuada em comparação a outros testes. Isso torna o <span class="math inline">\(I\)</span> de Moran a ferramenta mais sensível para detectar pequenos desvios da aleatoriedade, sendo eficaz tanto contra hipóteses alternativas de processos autorregressivos (AR) quanto de médias móveis (MA)18.</p>
<p><span class="citation" data-cites="burridge1980cliff">Burridge (<a href="references.html#ref-burridge1980cliff" role="doc-biblioref">1980</a>)</span> provou que o <span class="math inline">\(I\)</span> de Moran é assintoticamente equivalente a um teste de Multiplicador de Lagrange (LM) para processos gaussianos. A estatística LM, calculada a partir da função de verossimilhança restrita, é proporcional ao valor de <span class="math inline">\(I\)</span>, compartilhando assim as propriedades de eficiência computacional dos testes LM, que exigem estimação apenas sob a hipótese nula e são mais conservadores que os testes de Razão de Verossimilhança (LR).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, ggplot2, patchwork, dplyr, geobr)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Carregar dados: Malha de Minas Gerais (MG)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>mg_sf <span class="ot">&lt;-</span> <span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#simulando dados</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_sf))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>mg_sf<span class="sc">$</span>indicador <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>]) <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_sf), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">15</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir Vizinhança e Pesos</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Vizinhança Queen</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_sf, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># normalizar por linha (style W)</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>) <span class="co">#recomendo usar sempre zero.policy = TRUE</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Cálculo do Índice de Moran</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Teste Rápido para variavel de interresse "indicador"</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>moran_analitico <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_sf<span class="sc">$</span>indicador, <span class="at">listw=</span>lw, <span class="at">randomisation =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_analitico)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mg_sf$indicador  
weights: lw    

Moran I statistic standard deviate = 29.13, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.6193722870     -0.0011737089      0.0004537973 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Teste Monte Carlo (Robusto)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Simula 999 permutações aleatórias</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>moran_mc <span class="ot">&lt;-</span> <span class="fu">moran.mc</span>(mg_sf<span class="sc">$</span>indicador, <span class="at">listw=</span>lw, <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_mc)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  mg_sf$indicador 
weights: lw  
number of simulations + 1: 1000 

statistic = 0.61937, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>Como normalizamos a matriz <span class="math inline">\(\mathbf{W}\)</span> por linha, o intervalo do índice de Moran é limitado, tipicamente variando entre -1 e 1.</p>
<p>O valor da estatística I de Moran calculado foi de aproximadamente 0,619. Este valor positivo e de magnitude elevada indica uma forte autocorrelação espacial positiva, sugerindo que municípios com indicador socioeconômico alto tendem a estar geograficamente agrupados com outros de indicador alto (neste caso, no Sul), enquanto municípios com indicador baixo formam aglomerados com seus vizinhos de indicador baixo (neste caso, no Norte).</p>
<p>Para validar se este agrupamento é meramente fruto do acaso, compara-se o valor observado com o valor esperado sob a hipótese nula de aleatoriedade espacial completa (Expectation), que neste caso é -0,0012 (calculado como <span class="math inline">\(-1/(n-1) = -1/(853-1) \approx -0,0012\)</span>). A diferença substancial entre o valor observado (Statistic <span class="math inline">\(\approx 0,62\)</span>) e o esperado (-0,0012) fornece a evidência primária de que o processo gerador dos dados não é aleatório. A confirmação estatística desta observação na abordagem analítica é dada pelo desvio padrão padronizado (standard deviate ou Z-score) de 29,13. Este valor é extremamente alto muito além do corte crítico de 1,96 para 95% de confiança resultando em um valor-p virtualmente nulo (<span class="math inline">\(&lt; 2.2e-16\)</span>). Isso nos permite rejeitar a hipótese nula com um nível de confiança de 95% (considerando que fixamos nível de significância em 5%) e confirmar a existência de dependência espacial significativa.</p>
<p>A abordagem via simulação de Monte Carlo fortalece essa conclusão, sendo tecnicamente preferível por não depender de pressupostos de normalidade distributiva dos dados. O resultado mostra que, ao realizar 999 permutações aleatórias dos valores do indicador pelo mapa de Minas Gerais, a estatística observada nos dados originais (statistic = 0,61937) foi superior a absolutamente todas as simulações geradas, ocupando a posição máxima (observed rank) de 1000. Isso resulta em um pseudo valor-p de 0,001, indicando que a probabilidade de se obter um padrão espacial tão ou mais organizado quanto este por mero acaso é de apenas 1 em 1000. Portanto, conclui-se que a variável analisada apresenta dependência espacial positiva significativa.</p>
<p><strong>Índice C de Geary</strong></p>
<p>Proposto por <a href="https://en.wikipedia.org/wiki/Roy_C._Geary">Robert Charles Geary</a> e desenvolvido por <span class="citation" data-cites="cliff1981spatial">Cliff e Ord (<a href="references.html#ref-cliff1981spatial" role="doc-biblioref">1981</a>)</span>, este indicador (<span class="math inline">\(c\)</span>) foca na dissimilaridade quadrática entre vizinhos, em vez da covariância (produto cruzado):</p>
<p><span class="math display">\[
c = \frac{(n-1)}{2 S_0} \cdot \frac{\sum_{i=1}^n \sum_{j=1}^n w_{ij} (y_i - y_j)^2}{\sum_{i=1}^n (y_i - \bar{y})^2}.
\]</span></p>
<p>Enquanto o <span class="math inline">\(I\)</span> de Moran é uma medida de covariância global, o <span class="math inline">\(c\)</span> de Geary assemelha-se ao variograma da geoestatística (<span class="quarto-unresolved-ref">?sec-variograma</span>), medindo a variância local das diferenças.</p>
<ul>
<li><p><span class="math inline">\(0 &lt; c &lt; 1\)</span>: Autocorrelação positiva (vizinhos são similares, diferenças ao quadrado são pequenas).</p></li>
<li><p><span class="math inline">\(c &gt; 1\)</span>: Autocorrelação negativa (vizinhos são dissimilares).</p></li>
<li><p><span class="math inline">\(c \approx 1\)</span>: Ausência de autocorrelação espacial.</p></li>
</ul>
<p><span class="citation" data-cites="anselin2001spatial">Anselin (<a href="references.html#ref-anselin2001spatial" role="doc-biblioref">2001</a>)</span> nota que o <span class="math inline">\(I\)</span> de Moran é mais sensível a tendências globais e <em>clusters</em>, enquanto o <span class="math inline">\(c\)</span> de Geary é mais sensível a diferenças locais e <em>outliers</em> espaciais.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggspatial)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Cálculo do Índice C de Geary</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Teste Analítico</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>geary_analitico <span class="ot">&lt;-</span> <span class="fu">geary.test</span>(mg_sf<span class="sc">$</span>indicador, <span class="at">listw=</span>lw, <span class="at">randomisation =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Teste Monte Carlo</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>geary_mc <span class="ot">&lt;-</span> <span class="fu">geary.mc</span>(mg_sf<span class="sc">$</span>indicador, <span class="at">listw=</span>lw, <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(geary_analitico)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  mg_sf$indicador 
weights: lw   

Geary C statistic standard deviate = 26.149, p-value &lt; 2.2e-16
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
      0.377124962       1.000000000       0.000567393 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(geary_mc)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  mg_sf$indicador 
weights: lw  
number of simulations + 1: 1000 

statistic = 0.37712, observed rank = 1, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos o Geary Local (localC) para ver onde vizinhos diferem muito.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores altos no mapa indicam vizinhos muito diferentes (outliers locais).</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>mg_sf<span class="sc">$</span>geary_local <span class="ot">&lt;-</span> <span class="fu">localC</span>(mg_sf<span class="sc">$</span>indicador, <span class="at">listw=</span>lw)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa da Variável Original</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_sf) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> indicador), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">name =</span> <span class="st">"Valor"</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Variável Original"</span>, <span class="at">subtitle =</span> <span class="st">"Padrão Norte-Sul"</span>) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>, <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>, </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa de Geary Local</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_sf) <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> geary_local), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"cividis"</span>, <span class="at">name =</span> <span class="st">"Local C"</span>) <span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Dissimilaridade Local (Geary)"</span>, </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Áreas claras = Vizinhos muito diferentes"</span>) <span class="sc">+</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span> </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>, <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>, </span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-geary-global" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-geary-global-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-geary-global-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-geary-global-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.6: Índice C de Geary: Teste Global e Mapa de Dissimilaridade Local.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>A análise do Índice C de Geary confirma a existência de autocorrelação espacial positiva fort. O valor estatístico observado (<em>Geary C statistic 0,377</em>) situa-se substancialmente abaixo do valor esperado sob a hipótese de aleatoriedade espacial (<em>Expectation = 1,0</em>). Como <span class="math inline">\(0&lt;c&lt;1\)</span>, conclui-se que a variância local (diferença entre vizinhos) é muito menor do que a variância global, ou seja, vizinhos tendem a ser parecidos.</p>
<p>A significância estatística deste padrão é atestada pelo elevado desvio padrão padronizado (<em>standard deviate = 26,15</em>), que resulta em um valor-p baixo (<em>p-value &lt; 2.2e-16</em>). Isso permite rejeitar a hipótese nula com um nível de confiança de 95% e confirmar que a similaridade entre as unidades espaciais não é aleatória.</p>
<p>A validação via Monte Carlo reforça o resultado obtido. A estatística observada (<em>statistic = 0,377</em>) foi mais extrema (menor) do que todas as 999 permutações aleatórias geradas, ocupando a primeira posição no ranking de dissimilaridade (<em>observed rank = 1</em>). Isso gera um pseudo valor-p significativo (<em>p-value = 0,001</em>), confirmando que a probabilidade de tal padrão de aglomeração surgir ao acaso é desprezível (1 em 1000).</p>
</section>
<section id="suporte-das-estatísticas-i-e-c" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="suporte-das-estatísticas-i-e-c"><span class="header-section-number">4.3.2</span> Suporte das estatísticas <span class="math inline">\(I\)</span> e <span class="math inline">\(c\)</span></h3>
<p>É comum assumir incorretamente que o Índice de Moran varia estritamente no intervalo <span class="math inline">\([-1, 1]\)</span>, tal como o coeficiente de correlação de Pearson. No entanto, o suporte (intervalo de valores possíveis) das estatísticas de autocorrelação espacial não é fixo <span class="citation" data-cites="scalon2024analise">(<a href="references.html#ref-scalon2024analise" role="doc-biblioref">Scalon 2024</a>)</span>; ele é intrinsecamente dependente da topologia da rede definida por <span class="math inline">\(\mathbf{W}=[w_{ij}]_{n \times n}\)</span> (matriz de pesos ou vizinhança) e pode ultrapassar esses limites dependendo da geometria dos vizinhos.</p>
<p><strong>Suporte do Índice de Moran</strong></p>
<p><span class="citation" data-cites="de1984extreme">Jong, Sprenger, e Veen (<a href="references.html#ref-de1984extreme" role="doc-biblioref">1984</a>)</span> discutem este problema abordando-o através da álgebra matricial. Eles demonstram que os valores extremos (limites mínimo e máximo) de <span class="math inline">\(I\)</span> correspondem aos autovalores da matriz de pesos, sujeitos à restrição de que os dados são centrados na média (<span class="math inline">\(\mathbf{z}^\top \mathbf{1} = 0\)</span>, ver <a href="#eq-moran" class="quarto-xref">Eq.&nbsp;<span>4.1</span></a>).</p>
<p>Para uma dada matriz de pesos <span class="math inline">\(\mathbf{W}\)</span>, os limites inferior (<span class="math inline">\(I_{min}\)</span>) e superior (<span class="math inline">\(I_{max}\)</span>), necessários para definir o suporte do índice de Moran são dados por:</p>
<p><span class="math display">\[
I_{min} = \frac{n}{S_0} \lambda_{min} \quad \text{e} \quad I_{max} = \frac{n}{S_0} \lambda_{max}
\]</span></p>
<p>Onde <span class="math inline">\(\lambda_{min}\)</span> e <span class="math inline">\(\lambda_{max}\)</span> são, respectivamente, o menor e o maior autovalor da matriz de pesos projetada no subespaço ortogonal ao vetor constante.</p>
<p>Se <span class="math inline">\(\mathbf{W}\)</span> for simétrica, estes são simplesmente os autovalores extremos (menor e maior autovalor) de <span class="math inline">\(\mathbf{W}\)</span> (excluindo o autovalor trivial associado à média constante). Caso <span class="math inline">\(\mathbf{W}\)</span> seja assimétrica (comum em vizinhança por <span class="math inline">\(k\)</span>-vizinhos), os autovalores são calculados a partir da parte simétrica da matriz, <span class="math inline">\(\mathbf{S} = \frac{1}{2}(\mathbf{W} + \mathbf{W}^\top)\)</span>.</p>
<p><strong>Extremos do Índice de Geary</strong></p>
<p>De forma análoga, <span class="citation" data-cites="de1984extreme">Jong, Sprenger, e Veen (<a href="references.html#ref-de1984extreme" role="doc-biblioref">1984</a>)</span> derivaram os limites para a estatística <span class="math inline">\(c\)</span> de Geary reformulando o seu numerador como uma forma quadrática. Os valores extremos são definidos como:</p>
<p><span class="math display">\[
c_{min} = \frac{n-1}{2 S_0} \gamma_{min} \quad \text{e} \quad c_{max} = \frac{n-1}{2 S_0} \gamma_{max}
\]</span></p>
<p>Neste caso, <span class="math inline">\(\gamma_{min}\)</span> e <span class="math inline">\(\gamma_{max}\)</span> representam os autovalores extremos (menor e maior autovalor) de uma matriz auxiliar <span class="math inline">\(\mathbf{B}\)</span>, cujos elementos <span class="math inline">\(b_{ij}\)</span> são construídos combinando a estrutura de conectividade com os totais marginais dos pesos6:</p>
<p><span class="math display">\[
b_{ij} = (R_i + K_j)\delta_{ij} - 2w_{ij}
\]</span></p>
<p>Sendo <span class="math inline">\(R_i\)</span> a soma da linha <span class="math inline">\(i\)</span> de <span class="math inline">\(\mathbf{W}\)</span>, <span class="math inline">\(K_j\)</span> a soma da coluna <span class="math inline">\(j\)</span>, e <span class="math inline">\(\delta_{ij}\)</span> o delta de Kronecker (1 se <span class="math inline">\(i=j\)</span>, 0 caso contrário).</p>
<p>O cálculo destes limites exatos é crucial para a validação estatística. Se utilizarmos uma aproximação teórica (como a distribuição Normal) que atribua probabilidade a valores fora do intervalo <span class="math inline">\([I_{min}, I_{max}]\)</span>, estaremos cometendo um erro de especificação, atribuindo probabilidade a eventos impossíveis para aquela configuração espacial específica. Além disso, <span class="citation" data-cites="de1984extreme">Jong, Sprenger, e Veen (<a href="references.html#ref-de1984extreme" role="doc-biblioref">1984</a>)</span> notam que a simetria desses limites fornece informação sobre a estrutura da rede; por exemplo, grafos do tipo estrela possuem limites muito distintos de reticulados regulares (grids), o que afeta a interpretação da magnitude da autocorrelação.</p>
</section>
<section id="estatísticas-locais" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="estatísticas-locais"><span class="header-section-number">4.3.3</span> Estatísticas Locais</h3>
<p>A dependência espacial raramente é estacionária sobre todo o domínio <span class="math inline">\(D^L\)</span>. <span class="citation" data-cites="anselin1995local">Anselin (<a href="references.html#ref-anselin1995local" role="doc-biblioref">1995</a>)</span> introduziu o conceito de LISA (<em>Local Indicators of Spatial Association</em>) para decompor a estatística global em contribuições individuais <span class="math inline">\(I_i\)</span>, satisfazendo duas propriedades:</p>
<ol type="1">
<li><p>O indicador <span class="math inline">\(I_i\)</span> permite avaliar a significância do padrão espacial local em torno da unidade <span class="math inline">\(i\)</span>.</p></li>
<li><p>A soma dos indicadores locais é proporcional à estatística global (ex: <span class="math inline">\(\sum_i I_i \propto I\)</span>).</p></li>
</ol>
<p><strong>Índice I de Moran local</strong></p>
<p>O Moran local (<span class="math inline">\(I_i\)</span>) avalia a correlação entre o valor de uma unidade e a média dos seus vizinhos (o <em>spatial lag</em>) <a href="#fig-IndiceMoranLocal" class="quarto-xref">Figura&nbsp;<span>4.7</span></a>. É definido como:</p>
<p><span class="math display">\[
I_i = \frac{(y_i - \bar{y})}{S^2} \cdot \sum_{j=1}^n w_{ij} (y_j - \bar{y}),
\]</span></p>
<p>onde <span class="math inline">\(S^2 = \sum_{j=1}^n (y_j - \bar{y})^2 / n\)</span> é a variância amostral.</p>
<p>Esta estatística é a base para o mapa de clusters LISA, que classifica cada localidade estatisticamente significativa em quatro quadrantes, baseados no sinal de <span class="math inline">\(z_i = (y_i - \bar{y})\)</span> (valor local) e do seu defasamento espacial (<em>spatial lag</em>) <span class="math inline">\(\sum_j w_{ij} (y_j - \bar{y})\)</span> (valor dos vizinhos):</p>
<ol type="1">
<li><p>Alto-Alto (High-High | HH): Este quadrante (superior direito) representa o regime de associação espacial positiva onde uma unidade com valor acima da média é circundada por vizinhos que também possuem valores altos. Estatisticamente, identifica-se aqui a formação de clusters (agrupamentos) de alta intensidade, conhecidos como <em>hot spots</em>. A sua presença sugere fortes fenômenos de contágio ou transbordamento (<em>spillover</em>), indicando que os fatores que elevam a variável numa localidade estão também presentes e ativos na sua vizinhança imediata.</p></li>
<li><p>Baixo-Baixo (Low-Low | LL): Define-se pelo agrupamento de uma unidade com valor abaixo da média cercada por <span class="math inline">\(j\)</span> vizinhos que compartilham essa característica de baixa intensidade. Este padrão, denominado <em>cold spot</em>, indica também autocorrelação espacial positiva, mas na direção oposta aos <em>hot spots</em>. Podendo refletir barreiras geográficas à difusão de um fenômeno ou áreas estruturalmente desfavorecidas (ou protegidas, dependendo se a variável é benéfica ou maléfica) em bloco.</p></li>
<li><p>Alto-Baixo (High-Low | HL): Caracteriza-se por uma unidade com valor alto que está isolada em meio a uma vizinhança de valores predominantemente baixos, configurando um outlier espacial. Este padrão de autocorrelação negativa sugere que o processo gerador de dados na unidade central é distinto do seu entorno. Frequentemente indica vulnerabilidades locais específicas, erros de medição, ou um surto localizado que, por algum motivo de contenção, não transbordou para as regiões adjacentes.</p></li>
<li><p>Baixo-Alto (Low-High | LH): Refere-se a uma unidade com valor abaixo da média que está cercada por vizinhos com valores altos. Como um outlier espacial inverso, esta configuração indica autocorrelação negativa. Pode sinalizar a eficácia de políticas de contenção locais (resiliência), subnotificação de dados em relação aos vizinhos, ou características intrínsecas que tornam a unidade impermeável à influência do seu entorno de alta intensidade.</p></li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,sf,spdep,geobr,patchwork, ggtext, ggspatial)  </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cálculo do Moran Local</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>loc_m <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(mg_sf<span class="sc">$</span>indicador, <span class="at">listw=</span>lw)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar dados para plotagem</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>mg_sf<span class="sc">$</span>z_score <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(mg_sf<span class="sc">$</span>indicador)) </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>mg_sf<span class="sc">$</span>lag_z   <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_sf<span class="sc">$</span>z_score)    </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>mg_sf<span class="sc">$</span>p_value <span class="ot">&lt;-</span> loc_m[, <span class="dv">5</span>] <span class="co"># P-valor do teste local</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Classificação dos Quadrantes</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>sig_level <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>mg_sf <span class="ot">&lt;-</span> mg_sf <span class="sc">%&gt;%</span> </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quadrante =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    p_value <span class="sc">&gt;</span> sig_level <span class="sc">~</span> <span class="st">"NS"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    z_score <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"HH"</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    z_score <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"LL"</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    z_score <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"HL"</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    z_score <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"LH"</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quadrante =</span> <span class="fu">factor</span>(quadrante, </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"HH"</span>, <span class="st">"LL"</span>, <span class="st">"HL"</span>, <span class="st">"LH"</span>, <span class="st">"NS"</span>),</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Alto-Alto (HH)"</span>, <span class="st">"Baixo-Baixo (LL)"</span>, </span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Alto-Baixo (HL)"</span>, <span class="st">"Baixo-Alto (LH)"</span>, </span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Não Significativo"</span>)))</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Cores</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>cores_lisa <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alto-Alto (HH)"</span> <span class="ot">=</span> <span class="st">"#FF0000"</span>,    </span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Baixo-Baixo (LL)"</span> <span class="ot">=</span> <span class="st">"#0000FF"</span>, </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alto-Baixo (HL)"</span> <span class="ot">=</span> <span class="st">"#FFA500"</span>,  </span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Baixo-Alto (LH)"</span> <span class="ot">=</span> <span class="st">"#87CEFA"</span>,  </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Não Significativo"</span> <span class="ot">=</span> <span class="st">"#eeeeee"</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>g_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_sf) <span class="sc">+</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> quadrante), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cores_lisa) <span class="sc">+</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. LISA"</span>,</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Identificação de regimes locais (p &lt; 0.05)"</span>, </span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill=</span><span class="st">"Legenda"</span>) <span class="sc">+</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))<span class="sc">+</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>g_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_sf, <span class="fu">aes</span>(<span class="at">x =</span> z_score, <span class="at">y =</span> lag_z)) <span class="sc">+</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> quadrante), <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Linha de regressão (Moran Global)</span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Anotações dos Quadrantes</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">"HH"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fontface=</span><span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">label =</span> <span class="st">"LL"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">fontface=</span><span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">label =</span> <span class="st">"HL"</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">fontface=</span><span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"LH"</span>, <span class="at">color =</span> <span class="st">"#87CEFA"</span>, <span class="at">fontface=</span><span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cores_lisa) <span class="sc">+</span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Diagrama de Dispersão"</span>,</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"I de Moran Global:"</span>, <span class="fu">round</span>(<span class="fu">moran.test</span>(mg_sf<span class="sc">$</span>indicador, lw)<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>)),</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor Padronizado (y)"</span>,</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Defasagem Espacial (Wy)"</span>) <span class="sc">+</span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>g_map <span class="sc">+</span> g_scatter</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-IndiceMoranLocal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-IndiceMoranLocal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-IndiceMoranLocal-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-IndiceMoranLocal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.7: Clusters Espaciais LISA (Local Moran) para Minas Gerais
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>Os resultados (<a href="#fig-IndiceMoranLocal" class="quarto-xref">Figura&nbsp;<span>4.7</span></a>) confirmam e localizam a intensa polarização espacial sugerida pelas estatísticas globais. O mapa de LISA (<a href="#fig-IndiceMoranLocal" class="quarto-xref">Figura&nbsp;<span>4.7</span></a> A) decompõe a dependência, evidenciando um aglomerado do tipo Alto-Alto (HH) na porção sul do estado (em vermelho), onde municípios com altos valores do indicador estão circundados por vizinhos com valores igualmente elevados. Em contrapartida, observa-se um vasto aglomerado do tipo Baixo-Baixo (LL) dominando as regiões Norte e Nordeste (em azul), caracterizando um regime espacial de valores baixos cercados por vizinhos também com baixos valores.</p>
<p>O Diagrama de dispersão de Moran (<a href="#fig-IndiceMoranLocal" class="quarto-xref">Figura&nbsp;<span>4.7</span></a> B) mostra a quase totalidade das observações significativas (pontos coloridos) se concentra nos quadrantes de associação positiva (HH e LL). A escassez de pontos nos quadrantes de transição ou outliers espaciais (HL e LH) reflete a alta continuidade do fenômeno e a existência de fronteiras nítidas entre os regimes. A inclinação da reta de regressão, correspondente ao I de Moran Global de 0,619, atesta que o valor de um município é um forte preditor positivo da média de seus vizinhos, validando estatisticamente o gradiente Norte-Sul presente nos dados.</p>
<p><strong>Estatísticas Getis-Ord (</strong><span class="math inline">\(G_i\)</span> e <span class="math inline">\(G_i^*\)</span>)</p>
<p>Desenvolvidas por <span class="citation" data-cites="getis1992analysis">Getis e Ord (<a href="references.html#ref-getis1992analysis" role="doc-biblioref">1992</a>)</span> e <span class="citation" data-cites="Getis2010SpatialAutocorrelation">Getis (<a href="references.html#ref-Getis2010SpatialAutocorrelation" role="doc-biblioref">2010</a>)</span>, estas estatísticas focam especificamente na deteção de agrupamentos de valores altos ou baixos baseados em distância, sem a componente de covariância negativa do Moran.</p>
<ul>
<li><p><span class="math inline">\(G_i\)</span> (sem auto-inclusão): Mede a concentração de valores na vizinhança, excluindo <span class="math inline">\(y_i\)</span>.</p></li>
<li><p><span class="math inline">\(G_i^*\)</span> (com auto-inclusão): Mede a concentração incluindo o valor da própria unidade <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
G_i^* = \frac{\sum_{j=1}^n w_{ij} y_j}{\sum_{j=1}^n y_j},
\]</span></p></li>
</ul>
<p>onde <span class="math inline">\(\mathbf{W}\)</span> é tipicamente uma matriz de pesos baseada em distância binária (1 se <span class="math inline">\(d_{ij} &lt; d_{\max}\)</span>, 0 caso contrário).</p>
<p>Um valor de <span class="math inline">\(G_i^*\)</span> significativamente positivo (Z-score alto) indica um <em>hot spot</em> (agrupamento de valores altos); um valor significativamente negativo indica um <em>cold spot</em>. Diferentemente do Moran local, o <span class="math inline">\(G_i^*\)</span> não distingue um outlier espacial de um cluster fraco, sendo uma medida pura de intensidade local.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, sf, spdep, geobr, ggspatial)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Cálculo do Getis-Ord Gi*</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A função retorna os Z-scores (desvios padrão)</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>gi_star <span class="ot">&lt;-</span> <span class="fu">localG</span>(mg_sf<span class="sc">$</span>indicador, <span class="at">listw=</span>lw)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar ao mapa</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>mg_sf<span class="sc">$</span>gi_zscore <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(gi_star)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Classificação para o Mapa (Níveis de Confiança)</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseado na distribuição Normal Padrão</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>mg_sf<span class="sc">$</span>classificacao <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  mg_sf<span class="sc">$</span>gi_zscore <span class="sc">&gt;=</span> <span class="fl">1.96</span>  <span class="sc">~</span> <span class="st">"Hot Spot (95%)"</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  mg_sf<span class="sc">$</span>gi_zscore <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1.96</span> <span class="sc">~</span> <span class="st">"Cold Spot (95%)"</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Não Significativo"</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>cores_gi <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Hot Spot (95%)"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cold Spot (95%)"</span> <span class="ot">=</span> <span class="st">"#2c7bb6"</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Não Significativo"</span> <span class="ot">=</span> <span class="st">"gray90"</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mg_sf) <span class="sc">+</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> classificacao), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cores_gi, <span class="at">name =</span> <span class="st">"Intensidade (Gi*)"</span>) <span class="sc">+</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Análise de Hot Spots (Getis-Ord Gi*)"</span>,</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Identificação de aglomerados de alta e baixa intensidade"</span>) <span class="sc">+</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-GetisOrd-MG" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-GetisOrd-MG-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-GetisOrd-MG-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GetisOrd-MG-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.8: Análise de Hot Spots (Getis-Ord Gi*) para Minas Gerais.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>O mapa (<a href="#fig-GetisOrd-MG" class="quarto-xref">Figura&nbsp;<span>4.8</span></a>) de análise de <em>Hot Spots (Getis-Ord Gi</em>) mostra uma clara polarização na distribuição espacial dos valores de intensidade em Minas Gerais. Observa-se a formação de um aglomerado significativo de alta intensidade (<em>Hot Spot</em>), representado em vermelho, concentrado na região sul do estado. Essa área indica uma aglomeração de municípios com valores elevados cercados por vizinhos também com valores elevados, sugerindo uma zona de maior atividade ou ocorrência do fenômeno analisado com 95% de confiança.</p>
<p>Em contrapartida, a região norte e nordeste do estado é caracterizada por um aglomerado de baixa intensidade (<em>Cold Spot</em>), representado em azul. Essa configuração espacial aponta para uma área onde predominam municípios com valores baixos, rodeados por outros de características similares, indicando uma depressão ou menor intensidade do fenômeno nesta porção do território. As áreas em cinza, classificadas como “Não Significativo”, representam regiões de transição ou de aleatoriedade espacial, onde não se verifica um padrão de aglomeração significativo nem para altas nem para baixas intensidades.</p>
</section>
</section>
<section id="sec-risco" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sec-risco"><span class="header-section-number">4.4</span> Riscos e Suavização</h2>
<p>A visualização de dados de área brutos, especialmente taxas (ex: incidência de doenças), sofre de instabilidade intrínseca da variância, um problema amplamente discutido por <span class="citation" data-cites="cressie1989spatial">Cressie e Chan (<a href="references.html#ref-cressie1989spatial" role="doc-biblioref">1989</a>)</span> na análise de SIDS (Síndrome de Morte Súbita Infantil).</p>
<p><strong>Mapas de risco e razão padronizada (SMR)</strong></p>
<p>Para dados de contagem <span class="math inline">\(O_i\)</span> (observados) com uma população em risco <span class="math inline">\(P_i\)</span>, a taxa bruta é <span class="math inline">\(r_i = O_i / P_i\)</span>. Em epidemiologia, utiliza-se frequentemente a razão de morbidade/mortalidade padronizada (SMR - <em>Standardized Mortality/Morbidity Ratio</em>):</p>
<p><span class="math display">\[
\text{SMR}_i = \frac{O_i}{E_i},
\]</span></p>
<p>onde <span class="math inline">\(E_i = P_i \cdot \bar{r}\)</span> é o número esperado de casos sob a hipótese de uma taxa constante global <span class="math inline">\(\bar{r} = \sum_i O_i / \sum_i P_i\)</span>.</p>
<p>Em áreas com população <span class="math inline">\(P_i\)</span> pequena, a variância da taxa <span class="math inline">\(r_i\)</span> é altíssima. Um único caso adicional pode duplicar a taxa, criando <em>outliers</em> espúrios que dominam visualmente o mapa coroplético.</p>
<p>Para mitigar a instabilidade, utiliza-se a suavização Bayesiana empírica, onde a taxa estimada <span class="math inline">\(\theta_i\)</span> é uma média ponderada entre a taxa local (instável) e a média global (estável) ou a média da vizinhança local <span class="citation" data-cites="banerjee2016spatial">(<a href="references.html#ref-banerjee2016spatial" role="doc-biblioref">Banerjee 2016</a>)</span>.</p>
<p><span class="math display">\[
\hat{\theta}_i^{EB} = \gamma_i \, r_i + (1 - \gamma_i) \, \bar{r}.
\]</span></p>
<p>O peso <span class="math inline">\(\gamma_i \in [0, 1]\)</span> depende da população <span class="math inline">\(P_i\)</span>: áreas populosas têm <span class="math inline">\(\gamma_i \approx 1\)</span> (confia-se no dado local), áreas despovoadas têm <span class="math inline">\(\gamma_i \approx 0\)</span> (o valor é encolhido em direção à média). <span class="citation" data-cites="besag1993spatial">Besag e Green (<a href="references.html#ref-besag1993spatial" role="doc-biblioref">1993</a>)</span> estendem isto para modelos hierárquicos completos (<a href="https://sites.stat.columbia.edu/gelman/research/published/bym_article_SSTEproof.pdf">BYM</a>), utilizando a estrutura de vizinhança <span class="math inline">\(\mathbf{W}\)</span> para suavizar localmente.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, sf, spdep, geobr, patchwork, viridis, ggspatial)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>mg_sf <span class="ot">&lt;-</span> <span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Vamos simulação de um dataframe de dados brutos (Como viria do DATASUS)</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cenário: Incidência de uma doença rara.</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># O usuário teria uma tabela com: ID do Município, População em Risco, Nº de Casos.</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Simular População (ni):</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>populacao_simulada <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">rlnorm</span>(<span class="fu">nrow</span>(mg_sf), <span class="at">meanlog =</span> <span class="dv">9</span>, <span class="at">sdlog =</span> <span class="fl">1.2</span>))</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Definir um Risco Latente (Verdadeiro, mas desconhecido):</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_sf))</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>padrao_norte_sul <span class="ot">&lt;-</span> (coords[,<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">min</span>(coords[,<span class="dv">2</span>])) <span class="sc">/</span> (<span class="fu">max</span>(coords[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="fu">min</span>(coords[,<span class="dv">2</span>]))</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>risco_real <span class="ot">&lt;-</span> <span class="fl">0.0005</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (padrao_norte_sul <span class="sc">*</span> <span class="dv">2</span>)) <span class="co"># Risco varia de 0.05% a 0.15%</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular Nº de Casos (yi):</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Os casos são uma realização de um processo de Poisson: Casos ~ Poisson(Pop * Risco)</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>casos_simulados <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="fu">nrow</span>(mg_sf), <span class="at">lambda =</span> populacao_simulada <span class="sc">*</span> risco_real)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="co"># D) Unir ao mapa </span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>mg_dados <span class="ot">&lt;-</span> mg_sf <span class="sc">%&gt;%</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">populacao =</span> populacao_simulada,  </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos =</span> casos_simulados          <span class="co">#Óbitos ou Doentes</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Cálculo das Taxas </span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Passo 1: Calcular Taxa Bruta (Incidência por 10.000 habitantes)</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>mg_dados <span class="ot">&lt;-</span> mg_dados <span class="sc">%&gt;%</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">taxa_bruta =</span> (casos <span class="sc">/</span> populacao) <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Passo 2: Suavização Bayesiana Empírica Local </span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co"># A função EBlocal precisa dos CASOS (ri) e da POPULAÇÃO (ni)</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>eb_resultado <span class="ot">&lt;-</span> <span class="fu">EBlocal</span>(<span class="at">ri =</span> mg_dados<span class="sc">$</span>casos, </span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ni =</span> mg_dados<span class="sc">$</span>populacao, </span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nb =</span> nb, </span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>                        <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionamos a taxa suavizada ao mapa (multiplicando por 10k para ficar na mesma escala)</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>taxa_suavizada <span class="ot">&lt;-</span> eb_resultado<span class="sc">$</span>est <span class="sc">*</span> <span class="dv">10000</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir limites iguais para garantir que as cores representem os mesmos valores</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>escala_limites <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">c</span>(mg_dados<span class="sc">$</span>taxa_bruta, mg_dados<span class="sc">$</span>taxa_suavizada), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> taxa_bruta), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">limits =</span> escala_limites, <span class="at">name =</span> <span class="st">"Taxa/10k"</span>) <span class="sc">+</span></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Taxa Bruta (Dados Observados)"</span>,</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Ruído excessivo em municípios pequenos"</span>) <span class="sc">+</span></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))<span class="sc">+</span></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> taxa_suavizada), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">limits =</span> escala_limites, <span class="at">name =</span> <span class="st">"Taxa/10k"</span>) <span class="sc">+</span></span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Taxa Suavizada (Empirical Bayes)"</span>,</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Padrão espacial real recuperado"</span>) <span class="sc">+</span></span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)) <span class="sc">+</span></span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-suavizacao-eb-pratica" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-suavizacao-eb-pratica-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-suavizacao-eb-pratica-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-suavizacao-eb-pratica-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.9: Comparação: (A) Taxa Bruta Instável vs.&nbsp;(B) Taxa Suavizada (Empirical Bayes Local).
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>A análise comparativa entre as taxas brutas (<a href="#fig-suavizacao-eb-pratica" class="quarto-xref">Figura&nbsp;<span>4.9</span></a> A) e as taxas suavizadas por meio do método Bayesiano Empírico Local (<a href="#fig-suavizacao-eb-pratica" class="quarto-xref">Figura&nbsp;<span>4.9</span></a> B) evidencia a eficácia deste último na correção de distorções estatísticas. O mapa das taxas brutas (<a href="#fig-suavizacao-eb-pratica" class="quarto-xref">Figura&nbsp;<span>4.9</span></a> A) apresenta um padrão ruidoso e fragmentado, com valores extremos (muito altos ou muito baixos) dispersos aleatoriamente, refletindo a instabilidade das estimativas em municípios com pequenas populações.</p>
<p>Em contraste, o mapa das taxas suavizadas (<a href="#fig-suavizacao-eb-pratica" class="quarto-xref">Figura&nbsp;<span>4.9</span></a> B) mostra com clareza a estrutura espacial subjacente do fenômeno, destacando um gradiente norte-sul consistente. Ao incorporar informações da vizinhança, o método Bayesiano Empírico estabiliza as estimativas, permitindo a identificação de padrões geográficos reais que estavam obscurecidos pelo ruído nos dados brutos.</p>
</section>
<section id="diagnóstico-de-dependência-espacial" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="diagnóstico-de-dependência-espacial"><span class="header-section-number">4.5</span> Diagnóstico de dependência espacial</h2>
<p>A ESDA não se aplica apenas aos dados brutos (<span class="math inline">\(\mathbf{y}\)</span>), mas é crucial no diagnóstico de modelos de regressão. Como alertado por <span class="citation" data-cites="cressie1989spatial">Cressie e Chan (<a href="references.html#ref-cressie1989spatial" role="doc-biblioref">1989</a>)</span>, a detecção de autocorrelação espacial em <span class="math inline">\(\mathbf{y}\)</span> não implica necessariamente um processo espacial intrínseco (como contágio); pode ser resultado de heterogeneidade não observada ou variáveis omitidas que possuem padrão espacial.</p>
<p>O procedimento padrão, detalhado por <span class="citation" data-cites="anselin2001spatial">Anselin (<a href="references.html#ref-anselin2001spatial" role="doc-biblioref">2001</a>)</span>, envolve:</p>
<ol type="1">
<li><p>Ajustar um modelo de regressão (mínimos quadrados ordinários-OLS): <span class="math inline">\(\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\varepsilon}, : \mathbf{y} \| \mathbf{X} \sim N(\mathbf{\mu}, \Sigma)\)</span>.</p></li>
<li><p>Calcular os resíduos <span class="math inline">\(\hat{\boldsymbol{\varepsilon}} = \mathbf{y} - \mathbf{X}\hat{\boldsymbol{\beta}}\)</span>.</p></li>
<li><p>Aplicar o teste <span class="math inline">\(I\)</span> de Moran sobre os resíduos <span class="math inline">\(\hat{\boldsymbol{\varepsilon}}\)</span> utilizando uma matriz <span class="math inline">\(\mathbf{W}\)</span> escolhida.</p></li>
</ol>
<p>Se <span class="math inline">\(I\)</span> for significativo, o pressuposto de independência dos erros é violado. No entanto, <span class="citation" data-cites="zhang2018spatial">Zhang e Yu (<a href="references.html#ref-zhang2018spatial" role="doc-biblioref">2018</a>)</span> demonstram que a validade deste diagnóstico depende criticamente da escolha correta de <span class="math inline">\(\mathbf{W}\)</span>. O uso de uma matriz incorreta pode falhar em detetar a dependência residual ou indicar falsamente a necessidade de um modelo espacial.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, ggplot2, patchwork, viridis)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> <span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar uma variável explicativa X aleatória (sem padrão espacial)</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajuste do Modelo de Regressão Linear (OLS)</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>modelo_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair os resíduos do modelo</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>residuos <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_ols)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Teste I de Moran nos Resíduos</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Necessário recriar a lista de pesos (W)</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Função para resíduos de regressão (lm.morantest)</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>moran_residuos <span class="ot">&lt;-</span> <span class="fu">lm.morantest</span>(modelo_ols, lw, <span class="at">alternative =</span> <span class="st">"two.sided"</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_residuos)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Global Moran I for regression residuals

data:  
model: lm(formula = taxa_bruta ~ variavel_x, data = mg_dados)
weights: lw

Moran I statistic standard deviate = 9.3389, p-value &lt; 2.2e-16
alternative hypothesis: two.sided
sample estimates:
Observed Moran I      Expectation         Variance 
    0.1977385849    -0.0011812437     0.0004536919 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> residuos), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">name =</span> <span class="st">"Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Mapa dos Resíduos OLS"</span>, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Padrão visível (não aleatório)"</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>residuos_z <span class="ot">&lt;-</span> <span class="fu">scale</span>(mg_dados<span class="sc">$</span>residuos)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>lag_residuos <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>residuos_z)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> residuos_z, <span class="at">y =</span> lag_residuos)) <span class="sc">+</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Moran dos Resíduos"</span>,</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"I de Moran ="</span>, <span class="fu">round</span>(moran_residuos<span class="sc">$</span>statistic, <span class="dv">3</span>)),</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos (Z)"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial dos Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-diagnostico-residuos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diagnostico-residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-diagnostico-residuos-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diagnostico-residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.10: Diagnóstico de Resíduos: (A) Mapa dos Resíduos e (B) Diagrama de Moran dos Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>A análise dos resíduos do modelo de regressão linear clássico aponta para a violação do pressuposto de independência dos resíduos. A estatística I de Moran observada nos resíduos foi de aproximadamente 0,198, um valor substancialmente superior à esperança matemática sob aleatoriedade (-0,001). A magnitude dessa dependência é confirmada pelo desvio padrão padronizado de 9,34, resultando em um valor-p baixo (&lt; 2.2e-16), o que nos leva a rejeitar a hipótese nula de ausência de autocorrelação espacial com alto grau de confiança.</p>
<p>Visualmente, essa dependência é observada na <a href="#fig-diagnostico-residuos" class="quarto-xref">Figura&nbsp;<span>4.10</span></a>. <a href="#fig-diagnostico-residuos" class="quarto-xref">Figura&nbsp;<span>4.10</span></a> A), a distribuição espacial dos resíduos não se assemelha a um ruído branco aleatório; ao contrário, observam-se nítidos aglomerados de resíduos positivos (em vermelho) e negativos (em azul), indicando que o modelo subestima ou superestima sistematicamente os valores em regiões vizinhas. <a href="#fig-diagnostico-residuos" class="quarto-xref">Figura&nbsp;<span>4.10</span></a> B) reforça esse diagnóstico através da inclinação positiva da reta de regressão entre os resíduos e sua defasagem espacial. Essa estrutura remanescente nos erros sugere que a variável explicativa aleatória introduzida foi incapaz de capturar o padrão espacial da variável resposta, transferindo essa estrutura não modelada para o termo de erro.</p>
<p>Como próximo passo, é o pesquisador abandonaria o estimador de Mínimos Quadrados Ordinários, cujos testes de significância tornaram-se inválidos, e adotar modelos de regressão espacial que incorporem explicitamente a estrutura de dependência na matriz de covariância ou na média.</p>
<p><strong>Limitações da ESDA</strong></p>
<ol type="1">
<li><p>Os valores das estatísticas de Moran ou Geary podem mudar drasticamente com a alteração da escala de agregação ou do desenho das zonas. Um cluster identificado a nível municipal pode desaparecer a nível estadual (MAUP).</p></li>
<li><p>O cálculo de estatísticas locais (LISA) envolve a realização de <span class="math inline">\(n\)</span> testes de hipótese simultâneos. Sem correção (como Bonferroni ou <a href="https://en.wikipedia.org/wiki/False_discovery_rate">False Discovery Rate</a>), a probabilidade de encontrar clusters falsos positivos (erro Tipo I) aumenta com o tamanho da amostra.</p></li>
<li><p>A descoberta de estrutura espacial nos resíduos via ESDA pode levar à inclusão de termos espaciais (CAR/SAR) que competem com as covariáveis fixas pela explicação da variância (colinearidade espacial), enviesando a inferência sobre os efeitos causais.</p></li>
<li><p>Unidades na periferia do mapa têm menos vizinhos (efeito da borda), o que distorce o cálculo dos momentos das estatísticas locais e globais, exigindo correções ou simulações de Monte Carlo para inferência válida <span class="citation" data-cites="besag1975statistical">(<a href="references.html#ref-besag1975statistical" role="doc-biblioref">Besag 1975</a>)</span>.</p></li>
</ol>
</section>
<section id="sec-gmrf" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="sec-gmrf"><span class="header-section-number">4.6</span> Fundamentos probabilísticos: GMRF, matrizes de precisão e operadores Laplacianos discretos</h2>
<p>Esta seção estabelece a ponte formal entre a teoria dos processos estocásticos contínuos e a implementação computacional eficiente em dados de área, fundamentando-se na estrutura probabilística dos Campos Aleatórios de Markov.</p>
<p><strong>Campos Aleatórios Gaussianos: GRF vs.&nbsp;GMRF</strong></p>
<p>Um campo aleatório Gaussiano (GRF - <a href="https://en.wikipedia.org/wiki/Gaussian_random_field">Gaussian Random Field</a>) é um processo estocástico <span class="math inline">\(\{Y(\mathbf{s}): \mathbf{s} \in D\}\)</span> tal que, para qualquer conjunto finito de localizações <span class="math inline">\(\{\mathbf{s}_1, \dots, \mathbf{s}_n\}\)</span>, o vetor <span class="math inline">\((Y(\mathbf{s}_1), \dots, Y(\mathbf{s}_n))^\top\)</span> segue uma distribuição normal multivariada <span class="citation" data-cites="cressie2022spatial">(<a href="references.html#ref-cressie2022spatial" role="doc-biblioref">Cressie e Moores 2022</a>)</span>. A distinção fundamental na modelagem espacial reside em como essa estrutura de dependência é parametrizada:</p>
<ol type="1">
<li><p>GRF Padrão (Geoestatística): Especificado por sua função de média <span class="math inline">\(\mu(\mathbf{s})\)</span> e sua função de covariância <span class="math inline">\(C(\mathbf{s}_i, \mathbf{s}_j) = \text{Cov}(Y(\mathbf{s}_i), Y(\mathbf{s}_j))\)</span>. Isto gera uma matriz de covariância <span class="math inline">\(\mathbf{\Sigma}\)</span> densa, onde cada par de locais possui uma correlação teoricamente não nula, definida por uma função de decaimento (ex.: exponencial, Matérn). O custo computacional para inferência (como cálculo da verossimilhança) é <span class="math inline">\(\mathcal{O}(n^3)\)</span> devido à necessidade de fatorar uma matriz <span class="math inline">\(n \times n\)</span> densa.</p></li>
<li><p>Campo aleatório de Markov Gaussiano (GMRF): É um GRF definido sobre um domínio discreto <span class="math inline">\(D^L\)</span> (um grafo ou <em>lattice</em>), especificado diretamente pela sua matriz de precisão <span class="math inline">\(\mathbf{Q} = \mathbf{\Sigma}^{-1}\)</span>. A propriedade que define um GMRF é a independência condicional espacial <span class="citation" data-cites="RueHeld2005 rue2009approximate">(<a href="references.html#ref-RueHeld2005" role="doc-biblioref">Håvard Rue e Held 2005</a>; <a href="references.html#ref-rue2009approximate" role="doc-biblioref">Håvard Rue, Martino, e Chopin 2009</a>)</span>:</p></li>
</ol>
<p><span class="math display">\[
Y_i \perp Y_j \mid \mathbf{Y}_{-ij} \iff Q_{ij} = 0 \quad \text{para} \quad i \neq j.
\]</span></p>
<p>Ou seja, dadas as observações de todos os outros locais, <span class="math inline">\(Y_i\)</span> e <span class="math inline">\(Y_j\)</span> são independentes se e somente se não forem vizinhos no grafo (ou se a estrutura de dependência direta for modelada como nula). Esta é a formalização probabilística da propriedade de Markov: o valor em um local depende apenas dos valores em seus vizinhos diretos.</p>
<p><strong>Propriedade de Markov em grafos e esparsidade da matriz de precisão</strong></p>
<p>A propriedade de Markov espacial formaliza a noção intuitiva de vizinhança. Seja <span class="math inline">\(\mathcal{G} = (\mathcal{V}, \mathcal{E})\)</span> o grafo que representa o domínio espacial discreto, onde <span class="math inline">\(\mathcal{V}=\{1, \dots, n\}\)</span> são os vértices (unidades de área) e <span class="math inline">\(\mathcal{E}\)</span> são as arestas que definem vizinhanças. Um vetor aleatório <span class="math inline">\(\mathbf{Y} = (Y_1, \dots, Y_n)^\top\)</span> é um GMRF em relação a <span class="math inline">\(\mathcal{G}\)</span> se:</p>
<p><span class="math display">\[
p(Y_i \mid \mathbf{Y}_{-i}) = p(Y_i \mid \mathbf{Y}_{\partial i}),
\]</span></p>
<p>onde <span class="math inline">\(\partial i = \{j: (i, j) \in \mathcal{E}\}\)</span> é o conjunto de vizinhos de <span class="math inline">\(i\)</span>. Esta propriedade local é equivalente à esparsidade da matriz de precisão <span class="math inline">\(\mathbf{Q}\)</span>: <span class="math inline">\(Q_{ij} = 0\)</span> para todo par <span class="math inline">\((i, j)\)</span> tal que <span class="math inline">\(j \notin \partial i\)</span> e <span class="math inline">\(j \neq i\)</span>.</p>
<p>Exemplo: Considere 5 regiões onde cada região é vizinha apenas da anterior e da seguinte (assumindo que as regiões estão em fila única). A matriz de precisão teria a forma:</p>
<p><span class="math display">\[
\mathbf{Q} =
\begin{bmatrix}
* &amp; * &amp; 0 &amp; 0 &amp; 0 \\
* &amp; * &amp; * &amp; 0 &amp; 0 \\
0 &amp; * &amp; * &amp; * &amp; 0 \\
0 &amp; 0 &amp; * &amp; * &amp; * \\
0 &amp; 0 &amp; 0 &amp; * &amp; *
\end{bmatrix},
\]</span></p>
<p>onde <code>*</code> denota um elemento não nulo. Para dados de área bidimensionais com vizinhança por contiguidade, cada região tem tipicamente entre 4 e 8 vizinhos, resultando em uma matriz <span class="math inline">\(\mathbf{Q}\)</span> com <span class="math inline">\(\mathcal{O}(n)\)</span> elementos não nulos, em contraste com os <span class="math inline">\(\mathcal{O}(n^2)\)</span> de uma matriz densa. Esta esparsidade permite o uso de algoritmos numéricos de álgebra linear esparsa (como a fatoração de Cholesky esparsa), reduzindo o custo computacional da inferência de <span class="math inline">\(\mathcal{O}(n^3)\)</span> para aproximadamente <span class="math inline">\(\mathcal{O}(n^{3/2})\)</span> em domínios 2D, viabilizando métodos como a inferência Bayesiana aproximada via <a href="https://www.r-inla.org/">INLA</a> <span class="citation" data-cites="rue2009approximate">(<a href="references.html#ref-rue2009approximate" role="doc-biblioref">Håvard Rue, Martino, e Chopin 2009</a>)</span>.</p>
<p><strong>O Laplaciano do grafo</strong></p>
<p>A estrutura da matriz de precisão <span class="math inline">\(\mathbf{Q}\)</span> em modelos espaciais está intrinsecamente ligada ao conceito de Laplaciano discreto. O operador Laplaciano contínuo <span class="math inline">\(\nabla^2\)</span> mede a divergência do gradiente, ou a curvatura local de uma função. Num grafo, seu análogo mede a diferença entre o valor num nó e a média dos valores dos seus vizinhos, atuando como um quantificador de suavidade ou rugosidade local do campo.</p>
<p>A matriz Laplaciana <span class="math inline">\(\mathbf{L}\)</span> de um grafo não direcionado é definida como <span class="math inline">\(\mathbf{L} = \mathbf{D} - \mathbf{W},\)</span> onde <span class="math inline">\(\mathbf{W}=[w_{ij}]_{n \times n}\)</span> é a matriz de adjacência/vizinhança (com <span class="math inline">\(w_{ij}=1\)</span> se <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span> são vizinhos) e <span class="math inline">\(\mathbf{D}\)</span> é a matriz diagonal dos graus (com <span class="math inline">\(D_{ii} = \sum_j w_{ij}\)</span>, o número de vizinhos de <span class="math inline">\(i\)</span>). Para um vetor <span class="math inline">\(\mathbf{y} = (y_1, \dots, y_n)^\top\)</span>, a forma quadrática associada ao Laplaciano é:</p>
<p><span class="math display">\[\mathbf{y}^\top \mathbf{L} \mathbf{y} = \sum_{(i,j) \in \mathcal{E}} (y_i - y_j)^2.\]</span></p>
<p>Esta equação demonstra que <span class="math inline">\(\mathbf{y}^\top \mathbf{L} \mathbf{y}\)</span> é uma soma de diferenças quadráticas entre todos os pares de vizinhos. Um valor baixo indica que <span class="math inline">\(\mathbf{y}\)</span> é suave sobre o grafo (vizinhos têm valores similares), enquanto um valor alto indica um campo rugoso ou heterogêneo.</p>
<p><strong>Propriedades espectrais e singularidade</strong></p>
<p>As propriedades espectrais (autovalores e autovetores) de <span class="math inline">\(\mathbf{L}\)</span> revelam características fundamentais da conectividade do sistema.</p>
<ul>
<li><p><span class="math inline">\(\mathbf{L}\)</span> é sempre semidefinida positiva, ou seja, <span class="math inline">\(\mathbf{y}^\top \mathbf{L} \mathbf{y} \geq 0\)</span> para todo <span class="math inline">\(\mathbf{y}\)</span>.</p></li>
<li><p>O menor autovalor de <span class="math inline">\(\mathbf{L}\)</span> é sempre <span class="math inline">\(\lambda_1 = 0\)</span>, e seu autovetor correspondente é o vetor constante <span class="math inline">\(\mathbf{1} = (1, \dots, 1)^\top\)</span>. Isto decorre diretamente do fato de que <span class="math inline">\(\mathbf{L}\mathbf{1} = \mathbf{0}\)</span> (a soma de cada linha é zero).</p></li>
<li><p>A existência do autovalor zero implica que <span class="math inline">\(\mathbf{L}\)</span> é uma matriz singular (não invertível). Estatisticamente, isso significa que uma distribuição com matriz de precisão proporcional a <span class="math inline">\(\mathbf{L}\)</span>, como <span class="math inline">\(\mathbf{Y} \sim \mathcal{N}(\mathbf{0}, \mathbf{L}^-)\)</span> (onde <span class="math inline">\(\mathbf{L}^-\)</span> denota uma inversa generalizada), é imprópria. Ela define uma densidade de probabilidade válida apenas no subespaço ortogonal ao vetor constante (ou seja, para contrastes entre os <span class="math inline">\(y_i\)</span>), pois a variância na direção do nível médio global é infinita.</p></li>
</ul>
</section>
<section id="sec-modelos_classicos" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="sec-modelos_classicos"><span class="header-section-number">4.7</span> Modelos mais comuns em dados de área: CAR, ICAR, SAR e BYM</h2>
<p>A modelagem de dados de área (ou <em>lattice data</em>) fundamenta-se na incorporação explícita da estrutura de vizinhança definida pela matriz de pesos espaciais <span class="math inline">\(\mathbf{W}=[w_{ij}]_{n \times n}\)</span> (ver <a href="#sec-lattice" class="quarto-xref"><span>Seção 4.1</span></a>) no mecanismo gerador de dados. A literatura distingue duas formas canônicas de especificar esta dependência: a especificação condicional (CAR), que modela a distribuição de uma área dados os seus vizinhos, e a especificação simultânea (SAR), que modela o sistema de equações de feedback instantâneo entre todas as áreas [<span class="citation" data-cites="cressie1993statistics">Cressie (<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">1993</a>)</span>].</p>
<section id="sec-car" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="sec-car"><span class="header-section-number">4.7.1</span> Modelo Condicional Autorregressivo (CAR)</h3>
<p>Introduzido por <span class="citation" data-cites="besag1974spatial">Besag (<a href="references.html#ref-besag1974spatial" role="doc-biblioref">1974</a>)</span>, o modelo autorregressivo condicional (CAR - <em>Conditional Autoregressive</em>) especifica cada observação <span class="math inline">\(Y_i\)</span> como uma função linear dos valores de seus vizinhos mais um termo de erro independente, mas a inferência é baseada na distribuição condicional.</p>
<p>Seja <span class="math inline">\(Y_i\)</span> a variável aleatória na unidade <span class="math inline">\(i\)</span> e <span class="math inline">\(\mathbf{Y}_{-i} = \{Y_j : j \neq i\}\)</span> o conjunto de todas as outras observações excluindo <span class="math inline">\(i\)</span>. O modelo CAR é definido por uma família de distribuições condicionais Gaussianas:</p>
<p><span id="eq-car"><span class="math display">\[
Y_i = \mu_i  + \sum_{j \neq i} w_{ij}(Y_j - \mu_j) + \epsilon_i,
\tag{4.2}\]</span></span></p>
<p>onde <span class="math inline">\(\mu_i\)</span> é uma tendência determinística (tendência, geralmente <span class="math inline">\(\mathbf{x}_i^\top \boldsymbol{\beta}\)</span>); <span class="math inline">\(w_{ij}\)</span> são os pesos espaciais normalizados, com <span class="math inline">\(w_{ij} \neq 0\)</span> apenas se <span class="math inline">\(j\)</span> é vizinho de <span class="math inline">\(i\)</span> e, <span class="math inline">\(\epsilon_i \sim \mathcal{N}(0, \sigma_i^2)\)</span> são erros independentes.</p>
<p>Aqui, o valor esperado em <span class="math inline">\(i\)</span>, condicional aos seus vizinhos, é a média global ajustada por uma média ponderada dos desvios dos seus vizinhos em relação à média global.</p>
<p>A partir <a href="#eq-car" class="quarto-xref">Eq.&nbsp;<span>4.2</span></a>, deriva-se a distribuição condicional que caracteriza o CAR:</p>
<p><span class="math display">\[
Y_i \mid \mathbf{Y}_{-i} \sim \mathcal{N}\left( \mu_i + \sum_{j \neq i} w_{ij}(Y_j - \mu_j),\, \sigma_i^2 \right), \: \: \mathbb{E} [Y_i \mid \mathbf{Y}_{-i}]=\mu_i + \sum_{j \neq i} w_{ij}(Y_j - \mu_j), \:\: \text{Var}[Y_i \mid \mathbf{Y}_{-i}] =\sigma^2_i
\]</span></p>
<p>Para que estas condicionais definam uma distribuição conjunta válida <span class="math inline">\(\mathbf{Y} \sim \mathcal{N}(\boldsymbol{\mu}, \mathbf{\sigma})\)</span>, o <a href="https://en.wikipedia.org/wiki/Hammersley%E2%80%93Clifford_theorem">Teorema de Hammersley-Clifford</a> impõe condições de simetria. <span class="citation" data-cites="besag1974spatial">Besag (<a href="references.html#ref-besag1974spatial" role="doc-biblioref">1974</a>)</span> mostrou que a matriz de precisão conjunta <span class="math inline">\(\Sigma^-1=\mathbf{Q} = [Q_{ij}]_{n \times n}\)</span> deve ser simétrica e positiva definida. A distribuição conjunta é dada por:</p>
<p><span class="math display">\[
\mathbf{Y} \sim \mathcal{N}_n(\boldsymbol{\mu}, \mathbf{Q}_{CAR}), \quad \text{onde} \quad \mathbf{Q}_{CAR} = \mathbf{M}^{-1} (\mathbf{I} - \rho \mathbf{W})\: \text{ se a inversa existir }
\]</span></p>
<p>Aqui, <span class="math inline">\(\Sigma= \mathbf{M}(\mathbf{I} - \rho \mathbf{W})^{-1}\)</span>, <span class="math inline">\(\mathbf{M}_{n \times n} =\text{diag}(\sigma_1^2, \dots, \sigma_n^2), \: \boldsymbol{\mu} = [\mu_1, \mu_2, \ldots, \mu_n]^\top\)</span> e <span class="math inline">\(\rho\)</span> parâmetro espacial desconhecido. Para garantir a simetria de <span class="math inline">\(\mathbf{Q}_{CAR}\)</span>, é necessário que <span class="math inline">\(\frac{w_{ij}}{\sigma_i^2} = \frac{w_{ji}}{\sigma_j^2}\)</span>. Note ainda que <span class="math inline">\(w_{ii}=0, \, Q_{ii} = 1/\sigma_i^2 &gt;0, \: Q_{ij}= -\rho w_{ij}/\sigma_i^2\: i \neq j\)</span>. Lembre-se que quando <span class="math inline">\(w_{ij} \neq 0\)</span>, pode-se escrever <span class="math inline">\(i \sim j\)</span> <span class="citation" data-cites="BesagKooperberg1995">(<a href="references.html#ref-BesagKooperberg1995" role="doc-biblioref">Besag e Kooperberg 1995</a>)</span>. Note que sem perda de generalidade, em várias literaturas tem se assumido que <span class="math inline">\(\mu=\mu_i=\mu_j=0\)</span>, removendo o efeito da tendência global.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, modelsummary,knitr, kableExtra, texreg,ggplot2, patchwork, sf)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Preparação dos Dados</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de Pesos Espaciais</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajuste dos Modelos</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Regressão linear classica </span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>mod_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo CAR (Incorpora dependência espacial condicional)</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co"># family = "CAR" ajusta via Máxima Verossimilhança</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>mod_car <span class="ot">&lt;-</span> <span class="fu">spautolm</span>(taxa_bruta <span class="sc">~</span> variavel_x, </span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> mg_dados, </span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">listw =</span> lw, </span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">"CAR"</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Função auxiliar para formatar valor</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>format_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se, pval) {</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  stars <span class="ot">&lt;-</span> <span class="fu">case_when</span>(pval <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>, pval <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"**"</span>, pval <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"*"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">format</span>(<span class="fu">round</span>(est, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">" ("</span>, <span class="fu">format</span>(<span class="fu">round</span>(se, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">")"</span>, stars)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>sum_ols <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_ols)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>coef_ols <span class="ot">&lt;-</span> sum_ols<span class="sc">$</span>coefficients</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>res_ols <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_coef</span>(coef_ols[<span class="dv">1</span>,<span class="dv">1</span>], coef_ols[<span class="dv">1</span>,<span class="dv">2</span>], coef_ols[<span class="dv">1</span>,<span class="dv">4</span>]), <span class="co"># Intercepto</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_coef</span>(coef_ols[<span class="dv">2</span>,<span class="dv">1</span>], coef_ols[<span class="dv">2</span>,<span class="dv">2</span>], coef_ols[<span class="dv">2</span>,<span class="dv">4</span>]), <span class="co"># Variavel X</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-"</span>,                                                      <span class="co"># Lambda (Não existe no OLS)</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">AIC</span>(mod_ols), <span class="dv">1</span>)                                    <span class="co"># AIC</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>sum_car <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_car)</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>coef_car <span class="ot">&lt;-</span> sum_car<span class="sc">$</span>Coef</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda (parametro espacial) e seu SE</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>lambda_val <span class="ot">&lt;-</span> mod_car<span class="sc">$</span>lambda</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>lambda_se  <span class="ot">&lt;-</span> mod_car<span class="sc">$</span>lambda.se</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste Z para o Lambda (aproximado)</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>lambda_p   <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(lambda_val <span class="sc">/</span> lambda_se)))</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>res_car <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_coef</span>(coef_car[<span class="dv">1</span>,<span class="dv">1</span>], coef_car[<span class="dv">1</span>,<span class="dv">2</span>], coef_car[<span class="dv">1</span>,<span class="dv">4</span>]), <span class="co"># Intercepto</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_coef</span>(coef_car[<span class="dv">2</span>,<span class="dv">1</span>], coef_car[<span class="dv">2</span>,<span class="dv">2</span>], coef_car[<span class="dv">2</span>,<span class="dv">4</span>]), <span class="co"># Variavel X</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_coef</span>(lambda_val, lambda_se, lambda_p),             <span class="co"># Lambda</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">AIC</span>(mod_car), <span class="dv">1</span>)                                    <span class="co"># AIC</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>tabela_final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro =</span> <span class="fu">c</span>(<span class="st">"Intercepto"</span>, <span class="st">"Variável X"</span>, <span class="st">"Lambda (Espacial)"</span>, <span class="st">"AIC"</span>),</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">OLS =</span> res_ols,</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">CAR =</span> res_car</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="co">#Gerar Tabela Bonita (HTML/LaTeX)</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(tabela_final, </span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"latex"</span>, </span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"lcc"</span>, </span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Modelos"</span> <span class="ot">=</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(<span class="at">general =</span> <span class="st">"* p&lt;0.05; ** p&lt;0.01; *** p&lt;0.001. Valores em parênteses são erros-padrão."</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnóstico dos Resíduos</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_ols <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_ols)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_car <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_car)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste de Moran</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>moran_car <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_car, <span class="at">listw=</span>lw)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"I de Moran (Resíduos CAR):"</span>, <span class="fu">round</span>(moran_car<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"| p-valor:"</span>, <span class="fu">round</span>(moran_car<span class="sc">$</span>p.value, <span class="dv">3</span>)))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> resid_ols), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">name =</span> <span class="st">"Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Resíduos OLS"</span>, <span class="at">subtitle =</span> <span class="st">"Dependência visível"</span>) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> resid_car), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">name =</span> <span class="st">"Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Resíduos CAR"</span>, <span class="at">subtitle =</span> <span class="st">"Padrão removido"</span>) <span class="sc">+</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-modelo_car_comparacao" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap="Comparação entre Mínimos Quadrados Ordinários e Modelo Autorregressivo Condicional (CAR).">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-modelo_car_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.1: <img src="lattice_data_files/figure-html/tbl-modelo_car_comparacao-1.png" class="img-fluid figure-img">
</figcaption>
<div aria-describedby="tbl-modelo_car_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>[1] “I de Moran (Resíduos CAR): -0.187 | p-valor: 1”</p>
</div>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>A tabela de resultados demonstra que o modelo CAR proporcionou uma redução substancial no critério de informação AIC (de 5275 para 5199), indicando um ajuste melhor em relação a regressão linear (OLS). O parâmetro espacial <span class="math inline">\(\lambda\)</span> (Lambda), estimado em 0,733, foi significativo (<span class="math inline">\(p &lt; 0,001\)</span>), confirmando que a vizinhança exerce influência determinante no processo, capturando a variabilidade que o modelo linear clássico falhou em explicar. Note-se ainda que a variável explicativa aleatória permaneceu não significativa em ambos os modelos, como esperado, mas o erro-padrão e o intercepto foram ajustados para refletir a incerteza real do sistema.</p>
<p>Quanto ao diagnóstico final, o teste de Moran aplicado aos resíduos do modelo CAR resultou em um índice de -0,187 com um valor-p de 1 (não significativo). Indica a rejeição da hipótese de aglomeração espacial positiva (clusters) nos erros. O valor-p unitário sugere que a forte autocorrelação positiva, anteriormente presente no OLS, foi absorvida pela estrutura condicional do modelo, restando resíduos que, estatisticamente, não apresentam mais o padrão de agrupamento que invalidava a inferência anterior.</p>
</section>
</section>
<section id="modelo-car-intrínseco-icar" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="modelo-car-intrínseco-icar"><span class="header-section-number">4.8</span> Modelo CAR Intrínseco (ICAR)</h2>
<p>Um caso limite do modelo CAR ocorre quando <span class="math inline">\(\rho \to 1\)</span>. Este modelo, denominado CAR Intrínseco , é amplamente utilizado como prior para efeitos aleatórios espaciais <span class="citation" data-cites="besag1991bayesian held2010conditional keefe2018formal Keefe2019ObjectiveBayesianICAR">(<a href="references.html#ref-besag1991bayesian" role="doc-biblioref">Besag, York, e Mollié 1991</a>; <a href="references.html#ref-held2010conditional" role="doc-biblioref">Held e Rue 2010</a>; <a href="references.html#ref-keefe2018formal" role="doc-biblioref">Matthew J. Keefe, Ferreira, e Franck 2018b</a>; <a href="references.html#ref-Keefe2019ObjectiveBayesianICAR" role="doc-biblioref">Michael J. Keefe, Ferreira, e Franck 2019</a>)</span>.</p>
<section id="sec-icar" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="sec-icar"><span class="header-section-number">4.8.1</span> Modelo Condicional Autorregressivo Intrínseco (ICAR)</h3>
<p>O modelo Condicional Autorregressivo Intrínseco (<em>Intrinsic Conditional Autoregressive</em>, (<a href="https://cran.r-project.org/web/packages/ref.ICAR/vignettes/ref-icar-vignette.html">ICAR</a>)) é um caso particular e amplamente utilizado do modelo CAR, no qual a matriz de precisão (<span class="math inline">\(\mathbf{Q}\)</span>) é singular (não é invertível), refletindo uma prior espacial que apenas penaliza diferenças entre vizinhos, sem especificar um nível absoluto para as variáveis. O ICAR pode ser entendido como o limite de um CAR próprio quando o parâmetro de dependência espacial se aproxima da fronteira do espaço paramétrico, resultando em uma matriz de precisão (<span class="math inline">\(\mathbf{Q}\)</span>) semidefinida positiva com posto <span class="math inline">\(n-1\)</span> <span class="citation" data-cites="BesagKooperberg1995">(<a href="references.html#ref-BesagKooperberg1995" role="doc-biblioref">Besag e Kooperberg 1995</a>)</span>.</p>
<p>Partindo da especificação condicional do CAR dada na <a href="#eq-car" class="quarto-xref">Eq.&nbsp;<span>4.2</span></a>, o ICAR é definido quando a dependência espacial atinge seu máximo (<span class="math inline">\(\rho \approx 1\)</span>), com a média condicional de cada área dependendo apenas da média simples de seus vizinhos. Para pesos da matriz de vizinhança (<span class="math inline">\(w_{ij}=1\)</span> se <span class="math inline">\(i \sim j\)</span>, 0 caso contrário), as distribuições condicionais são:</p>
<p><span id="eq-icar-cond"><span class="math display">\[
Y_i \mid \mathbf{Y}_{-i} \sim \mathcal{N}\left( \bar{Y}_{\partial i},\, \frac{\sigma^2}{m_i} \right),
\qquad
\mathbb{E}[Y_i \mid \mathbf{Y}_{-i}] = \bar{Y}_{\partial i} = \frac{1}{m_i}\sum_{j \in \partial i} Y_j,
\qquad
\text{Var}[Y_i \mid \mathbf{Y}_{-i}] = \frac{\sigma^2}{m_i},
\tag{4.3}\]</span></span></p>
<p>onde <span class="math inline">\(\partial i\)</span> denota o conjunto de vizinhos da área <span class="math inline">\(i\)</span>, <span class="math inline">\(m_i = |\partial i|\)</span> é o número de vizinhos (cardinal de <span class="math inline">\(\partial i\)</span>), e <span class="math inline">\(\sigma^2 &gt; 0\)</span> é um parâmetro de escala que controla a suavidade espacial. Nesta formulação, o valor esperado condicional é a média aritmética dos valores nas áreas vizinhas (<span class="math inline">\(\mathbb{E}[Y_i \mid \mathbf{Y}_{-i}]\)</span>), e a variância condicional (<span class="math inline">\(\text{Var}[Y_i \mid \mathbf{Y}_{-i}]\)</span>) é inversamente proporcional ao número de vizinhos, refletindo maior incerteza em áreas com menos conexões/vizinhos <span class="citation" data-cites="held2010conditional">(<a href="references.html#ref-held2010conditional" role="doc-biblioref">Held e Rue 2010</a>)</span>.</p>
<p>A especificação condicional implica uma matriz de precisão conjunta (<span class="math inline">\(\mathbf{Q}\)</span>) singular (sem inversa), com posto <span class="math inline">\(n-1\)</span>. Seja <span class="math inline">\(\mathbf{D} = \text{diag}(m_1, \dots, m_n)\)</span> e <span class="math inline">\(\mathbf{W}=[w_{ij}]_{n \times n}\)</span> a matriz de de vizinhança. A matriz de precisão do ICAR é proporcional a <span class="math inline">\(\mathbf{Q} = \sigma^{-2} (\mathbf{D} - \mathbf{W})=\tau (\mathbf{D} - \mathbf{W})\)</span>, que é semidefinida positiva, com um autovalor zero correspondente ao autovetor <span class="math inline">\(\mathbf{1}\)</span> (vetor de uns). Consequentemente, a densidade conjunta é imprópria e pode ser escrita (a menos de uma constante) como:</p>
<p><span class="math display">\[
p(\mathbf{Y}) \propto \exp\left( -\frac{1}{2\sigma^2} \sum_{i \sim j} (Y_i - Y_j)^2 \right),
\]</span></p>
<p>onde a soma percorre todos os pares de áreas adjacentes. Esta forma é conhecida como <em>pairwise difference prior</em> e destaca que a densidade só depende dos contrastes locais entre vizinhos, sendo invariante à adição de uma constante global <span class="citation" data-cites="BesagKooperberg1995 held2010conditional">(<a href="references.html#ref-BesagKooperberg1995" role="doc-biblioref">Besag e Kooperberg 1995</a>; <a href="references.html#ref-held2010conditional" role="doc-biblioref">Held e Rue 2010</a>)</span>.</p>
<p>Para obter uma distribuição própria e identificável, é comum impor uma restrição de soma-zero, <span class="math inline">\(\sum_{i=1}^n Y_i = 0\)</span>. Esta restrição pode ser aplicada formalmente projetando o vetor de efeitos espaciais no subespaço ortogonal a <span class="math inline">\(\mathbf{1}\)</span>, resultando em uma distribuição Gaussiana singular própria com matriz de covariância proporcional à <a href="https://en.wikipedia.org/wiki/Moore%E2%80%93Penrose_inverse">pseudoinversa de Moore-Penrose</a> de <span class="math inline">\(\mathbf{Q}_{ICAR}\)</span> <span class="citation" data-cites="KeefeFerreiraFranck2018">(<a href="references.html#ref-KeefeFerreiraFranck2018" role="doc-biblioref">Matthew J. Keefe, Ferreira, e Franck 2018a</a>)</span>. Em modelos hierárquicos Bayesianos, esta restrição é frequentemente implementada durante a amostragem MCMC, mas a formalização via projeção assegura unicidade e propriedades matemáticas bem definidas.</p>
<p>O ICAR é extensivamente utilizado como componente espacial estruturado em modelos hierárquicos, como no modelo Besag-York-Mollié (BYM) ( <a href="#sec-BYM" class="quarto-xref"><span>Seção 4.10</span></a>) <span class="citation" data-cites="besag1991bayesian">(<a href="references.html#ref-besag1991bayesian" role="doc-biblioref">Besag, York, e Mollié 1991</a>)</span>, que combina um efeito ICAR para variação espacial suave e um efeito aleatório independente para variação não estruturada. <span class="citation" data-cites="KeefeFerreiraFranck2019">Matthew J. Keefe, Ferreira, e Franck (<a href="references.html#ref-KeefeFerreiraFranck2019" role="doc-biblioref">2019</a>)</span> derivaram priors de referência objetivas para modelos com componentes ICAR, facilitando análise Bayesiana automática sem a necessidade de especificação subjetiva de hiperparâmetros.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># CARBayes é o pacote padrão para modelagem Bayesiana de áreas no CRAN</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(CARBayes, spdep, sf, ggplot2, patchwork, coda, gt)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Matriz de Vizinhança Binária (W)</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># O pacote CARBayes exige uma matriz binária (0 e 1), não normalizada.</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>W_binaria <span class="ot">&lt;-</span> <span class="fu">nb2mat</span>(nb, <span class="at">style =</span> <span class="st">"B"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajuste do Modelo ICAR (Bayesiano)</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>modelo_icar <span class="ot">&lt;-</span> <span class="fu">S.CARleroux</span>(<span class="at">formula =</span> taxa_bruta <span class="sc">~</span> variavel_x, </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> mg_dados, </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="co">#terias que ver a distr dos seus dados para decidir aqui</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>                           <span class="at">W =</span> W_binaria, </span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>                           <span class="at">burnin =</span> <span class="dv">2000</span>,   <span class="co"># Descarta as primeiras 2000 iterações (aquecimento)</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>                           <span class="at">n.sample =</span> <span class="dv">10000</span>, <span class="co"># Total de amostras MCMC</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">thin =</span> <span class="dv">10</span>,        <span class="co"># Salva a cada 10 para reduzir autocorrelação</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">rho =</span> <span class="dv">1</span>,          <span class="co"># RHO = 1 define o ICAR</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>                           <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co">#Extrair os resultados</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># O objeto mod_icar$summary.results contém médias e quantis</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>summ <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(modelo_icar<span class="sc">$</span>summary.results)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>params_interesse <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"variavel_x"</span>, <span class="st">"tau2"</span>, <span class="st">"nu2"</span>)</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>summ_filt <span class="ot">&lt;-</span> summ[<span class="fu">rownames</span>(summ) <span class="sc">%in%</span> params_interesse, ]</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Função para formatar: "Média [IC 2.5%; IC 97.5%]"</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>format_bayes <span class="ot">&lt;-</span> <span class="cf">function</span>(mean, lower, upper) {</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">format</span>(<span class="fu">round</span>(mean, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">" ["</span>, </span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>         <span class="fu">format</span>(<span class="fu">round</span>(lower, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">"; "</span>, </span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>         <span class="fu">format</span>(<span class="fu">round</span>(upper, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">"]"</span>)</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>tabela_icar <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro =</span> <span class="fu">rownames</span>(summ_filt),</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimativa =</span> <span class="fu">mapply</span>(format_bayes, summ_filt<span class="sc">$</span>Mean, summ_filt<span class="sc">$</span><span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>, summ_filt<span class="sc">$</span><span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>)</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Renomear</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>tabela_icar<span class="sc">$</span>Parametro <span class="ot">&lt;-</span> <span class="fu">recode</span>(</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>  tabela_icar<span class="sc">$</span>Parametro,</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span> <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>  <span class="ot">=</span> <span class="st">"Variável X"</span>,</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tau2"</span>         <span class="ot">=</span> <span class="st">"Variância Espacial $</span><span class="sc">\\</span><span class="st">tau^2$"</span>,</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nu2"</span>          <span class="ot">=</span> <span class="st">"Variância do Erro $</span><span class="sc">\\</span><span class="st">nu^2$"</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(tabela_icar, </span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"latex"</span>,</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"lc"</span>, </span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="cn">NULL</span>, </span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>, <span class="st">"striped"</span>), </span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(<span class="at">general =</span> <span class="st">"Estimativas: Média a posteriori [IC 95%]."</span>) </span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O modelo estima um efeito aleatório (phi) para cada município.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>efeito_icar <span class="ot">&lt;-</span> <span class="fu">apply</span>(modelo_icar<span class="sc">$</span>samples<span class="sc">$</span>phi, <span class="dv">2</span>, mean)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> efeito_icar), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Efeito Espacial"</span> <span class="sc">~</span>Phi)) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Componente Espacial ICAR"</span>, </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Padrão latente recuperado (Suavizado)"</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))<span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-icar_bayes" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap="Modelo ICAR Bayesiano: Estimativas a posteriori (MCMC).">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-icar_bayes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.2: <img src="lattice_data_files/figure-html/tbl-icar_bayes-1.png" class="img-fluid figure-img">
</figcaption>
<div aria-describedby="tbl-icar_bayes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>O intercepto do modelo foi estimado em 8,975 e é significativo uma vez que seu intervalo de pois o intervalo credibilidade de 95% (entre 8,657 e 9,285) encontra-se inteiramente acima de zero (não inclui zero). Em contrapartida, a covariável aleatória (“Variável X”) não demonstrou qualquer influência explicativa sobre a taxa, apresentando uma estimativa pontual quase nula (-0,001) e um intervalo de credibilidade que inclui zero, o que confirma sua irrelevância para o fenômeno analisado.</p>
<p>A variância do erro não estruturado (<span class="math inline">\(\nu^2\)</span>) foi estimada em 21,944, indicando uma presença de ruído nos dados brutos, enquanto a variância espacial (<span class="math inline">\(\tau^2\)</span>), estimada em 5,672 com um intervalo de credibilidade estritamente positivo (3,028 a 9,547), confirma que há um componente de vizinhança. A visualização deste efeito espacial (<span class="math inline">\(\phi\)</span>) no mapa recupera o gradiente norte-sul latente, isolando-o efetivamente da variabilidade aleatória capturada pelo termo de erro.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled" title="Saiba mais">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>Saiba mais
</div>
</div>
<div class="callout-body-container callout-body">
<p>Acesse ao <a href="https://connordonegan.github.io/geostan/index.html">link 1</a> e <a href="https://cran.r-project.org/web/packages/ref.ICAR/vignettes/ref-icar-vignette.html">link 2</a> e veja outras formas de de ajuste do mesmo modelo.</p>
</div>
</div>
</section>
</section>
<section id="sec-SAR" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="sec-SAR"><span class="header-section-number">4.9</span> Modelos Simultâneos Autorregressivos (SAR)</h2>
<p>O modelo Autorregressivo Simultâneo (SAR - <em>Simultaneous Autoregressive</em>), introduzido por <span class="citation" data-cites="whittle1954stationary">Whittle (<a href="references.html#ref-whittle1954stationary" role="doc-biblioref">1954</a>)</span>, tem raízes na análise de séries temporais e é predominante na econometria espacial <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p>
<p>Ao contrário do CAR (<a href="#sec-car" class="quarto-xref"><span>Seção 4.7.1</span></a>), o SAR modela a dependência através de um sistema de equações simultâneas onde a variável <span class="math inline">\(Y_i\)</span> é função direta dos seus valores contemporâneos <span class="math inline">\(Y_j\)</span> e de um termo de erro:</p>
<p><span class="math display">\[Y_i = \rho \sum_{j=1}^n w_{ij} Y_j + \mathbf{x}_i^\top \boldsymbol{\beta} + \epsilon_i, \quad \epsilon_i \sim \mathcal{N}(0, \sigma^2)\]</span></p>
<p>Aqui, <span class="math inline">\(\rho \sum w_{ij} Y_j\)</span> é o termo de defasagem espacial (<em>spatial lag</em>). Existe um efeito de feedback global: um choque em <span class="math inline">\(\epsilon_i\)</span> afeta <span class="math inline">\(Y_i\)</span>, que afeta os vizinhos <span class="math inline">\(Y_j\)</span>, que por sua vez afetam de volta <span class="math inline">\(Y_i\)</span> e se propagam por todo o sistema.</p>
<p>Em notação matricial, o modelo é:</p>
<p><span class="math display">\[
\mathbf{Y} = \rho \mathbf{W}\mathbf{Y} + \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon} \implies (\mathbf{I} - \rho \mathbf{W})\mathbf{Y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}, \: \: \mathbf{Y} = (\mathbf{I} - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}, \: \: \text{ se a inversa existir}
\]</span></p>
<p>A forma reduzida para a média e a covariância é:</p>
<p><span class="math display">\[\mathbf{Y}|\mathbf{X} \sim \mathcal{N}\left( (\mathbf{I} - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta}, \sigma^2 [(\mathbf{I} - \rho \mathbf{W})^\top (\mathbf{I} - \rho \mathbf{W})]^{-1} \right)\]</span></p>
<p><span class="citation" data-cites="ver2018relationship">Ver Hoef, Hanks, e Hooten (<a href="references.html#ref-ver2018relationship" role="doc-biblioref">2018</a>)</span> e <span class="citation" data-cites="wall2004close">Wall (<a href="references.html#ref-wall2004close" role="doc-biblioref">2004</a>)</span> destacam as diferenças fundamentais na estrutura de covariância:</p>
<ol type="1">
<li><p>A matriz de precisão do SAR é <span class="math inline">\(\mathbf{Q}_{SAR} = \sigma^{-2}(\mathbf{I} - \rho \mathbf{W})^\top (\mathbf{I} - \rho \mathbf{W})\)</span>. Note o produto cruzado das matrizes. Isso implica que a correlação no SAR decai mais lentamente com a distância do grafo do que no CAR.</p></li>
<li><p>O parâmetro <span class="math inline">\(\rho\)</span> no SAR tem uma interpretação de <em>spillover</em> global (efeito multiplicador), enquanto no CAR é uma medida de correlação condicional local.</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Outras especificações dos modelos SAR e CAR são discutidas no capítulo 4 do livro <span class="citation" data-cites="scalon2024analise">Scalon (<a href="references.html#ref-scalon2024analise" role="doc-biblioref">2024</a>)</span>.</p></li>
<li><p>Consulte o capítulo 4 do livro <span class="citation" data-cites="scalon2024analise">Scalon (<a href="references.html#ref-scalon2024analise" role="doc-biblioref">2024</a>)</span> para conhecer todos os procedimentos a seguir antes do ajuste do modelo, desde a análise exploratória até o ajuste propriamente dito.</p></li>
<li><p>A descrição completa dos pacotes <code>spdep</code> e <code>spatialreg</code> encontra-se no capítulo 4 do livro <span class="citation" data-cites="scalon2024analise">Scalon (<a href="references.html#ref-scalon2024analise" role="doc-biblioref">2024</a>)</span>.</p></li>
</ol>
</div>
</div>
</section>
<section id="sec-BYM" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="sec-BYM"><span class="header-section-number">4.10</span> O Modelo BYM (Besag-York-Mollié) e sua reparametrização (BYM2)</h2>
<p>Até este ponto, vimos os modelos CAR, SAR e ICAR que consideram que a variável de interesse <span class="math inline">\(\mathbf{Y}\)</span> segue, condicional aos parâmetros, uma distribuição Normal multivariada. Contudo, em epidemiologia, demografia e ciências sociais, é comum lidar com dados de contagem <span class="math inline">\(y_i\)</span> observados em uma região <span class="math inline">\(i\)</span>, as quais são comumente modeladas como variáveis aleatórias seguindo uma distribuição de Poisson:</p>
<p><span class="math display">\[y_i \mid \theta_i \sim \text{Poisson}(E_i \theta_i), \quad i = 1, \dots, n\]</span></p>
<p>Nessa formulação, <span class="math inline">\(E_i\)</span> representa o número esperado de casos, ajustado por características populacionais, enquanto <span class="math inline">\(\theta_i\)</span> denota o risco relativo verdadeiro ( ver <a href="#sec-risco" class="quarto-xref"><span>Seção 4.4</span></a>). Como os dados são de contagem, é imperativo que a média (número esperado) do processo seja positiva. No entanto, se utilizássemos um modelo linear direto para o risco, poderíamos incorrer no erro de estimar valores negativos, uma vez que, na distribuição Normal, o suporte do parâmetro de média compreende todos os números reais. É importante enfatizar que o foco da modelagem estatística reside na estrutura da média, embora existam extensões importantes como os modelos lineares generalizados (GLM) duplos, que modelam a média e a variância <span class="citation" data-cites="Paula2013DiagnosticsDGLM">(ver <a href="references.html#ref-Paula2013DiagnosticsDGLM" role="doc-biblioref">Paula 2013</a>)</span>, ou os modelos GAMLSS, que permitem modelar simultaneamente a média, a variância, a curtose e a assimetria <span class="citation" data-cites="Stasinopoulos2017GAMLSS Rigby2019DistributionsGAMLSS Stasinopoulos2024GAMLSS">(ver <a href="references.html#ref-Stasinopoulos2017GAMLSS" role="doc-biblioref">Stasinopoulos et al. 2017</a>, <a href="references.html#ref-Stasinopoulos2024GAMLSS" role="doc-biblioref">2024</a>; <a href="references.html#ref-Rigby2019DistributionsGAMLSS" role="doc-biblioref">Rigby et al. 2019</a>)</span>.</p>
<p>Para resolver o problema da restrição de positividade, não se aplica uma transformação diretamente à variável resposta, como se faria em modelos de regressão clássicos para estabilização de variância, mas sim uma função de ligação ao valor esperado do processo. Essa é a essência dos Modelos Lineares Generalizados (GLM). No caso da distribuição Poisson, a função de ligação canônica é o logaritmo natural (ver outras funções em <span class="citation" data-cites="Paula2025ModelosRegressao">(<a href="references.html#ref-Paula2025ModelosRegressao" role="doc-biblioref">Paula 2025</a>)</span>), o que nos permite definir o preditor linear <span class="math inline">\(\eta_i = \log(\theta_i)\)</span>. Esse preditor é então modelado através de uma estrutura aditiva que incorpora o intercepto <span class="math inline">\(\mu\)</span>, o efeito das covariáveis <span class="math inline">\(\mathbf{x}_i^\top \boldsymbol{\beta}\)</span> e um termo de efeito aleatório espacial <span class="math inline">\(\varepsilon_i\)</span>, resultando na expressão:</p>
<p><span class="math display">\[\eta_i = \log(\theta_i)=\mu + \mathbf{x}_i^\top \boldsymbol{\beta} + \varepsilon_i .\]</span></p>
<section id="modelo-bym" class="level3" data-number="4.10.1">
<h3 data-number="4.10.1" class="anchored" data-anchor-id="modelo-bym"><span class="header-section-number">4.10.1</span> Modelo BYM</h3>
<p>Proposto por <span class="citation" data-cites="besag1991bayesian">Besag, York, e Mollié (<a href="references.html#ref-besag1991bayesian" role="doc-biblioref">1991</a>)</span>, o modelo Besag-York-Mollié (BYM) decompõe o efeito aleatório espacial <span class="math inline">\(\varepsilon_i\)</span> em dois componentes aditivos <span class="citation" data-cites="riebler2016intuitive">(<a href="references.html#ref-riebler2016intuitive" role="doc-biblioref">Riebler et al. 2016</a>)</span>:</p>
<p><span class="math display">\[
\varepsilon_i = u_i + v_i
\]</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(u_i\)</span> é componente estrutural que modela a dependência espacial. Assume-se uma prior ICAR (ver seção sobre <a href="#sec-icar" class="quarto-xref"><span>Seção 4.8.1</span></a>), onde a distribuição condicional de <span class="math inline">\(u_i\)</span> depende apenas dos vizinhos <span class="math inline">\(\partial i\)</span>:</li>
</ul>
<p><span class="math display">\[u_i \mid \mathbf{u}_{-i}, \tau_u \sim \mathcal{N}\left( \frac{1}{m_i} \sum_{j \in \partial i} u_j, \frac{1}{m_i \tau_u} \right), \: \:\frac{1}{\tau_u} = \sigma_u^2\]</span></p>
<p>A distribuição conjunta é imprópria e dada por <span class="math inline">\(\mathbf{u} \sim \mathcal{N}(\mathbf{0}, \tau_u^{-1}\mathbf{Q}^-)\)</span>, onde <span class="math inline">\(\mathbf{Q}\)</span> é a matriz de estrutura definida pela vizinhança (<span class="math inline">\(Q_{ii} = m_i\)</span> e <span class="math inline">\(Q_{ij} = -1\)</span> se <span class="math inline">\(i \sim j\)</span>) e <span class="math inline">\(\mathbf{Q}^-\)</span> denota a sua <a href="https://en.wikipedia.org/wiki/Generalized_inverse">inversa generalizada</a>. <span class="math inline">\(\tau_u\)</span> é a precisão (inverso da variância) deste componente.</p>
<ul>
<li><span class="math inline">\(v_i\)</span> é componente não estrutural que modela o ruído aleatório independente (heterogeneidade pura). Assume-se normalidade i.i.d.:</li>
</ul>
<p><span class="math display">\[v_i \mid \tau_v \sim \mathcal{N}(0, \tau_v^{-1}), \: \: \frac{1}{\tau_v} = \sigma_v^2\]</span></p>
<p>A variância marginal do efeito total <span class="math inline">\(\varepsilon_i\)</span> no modelo BYM original é, portanto, a soma das variâncias dos componentes:</p>
<p><span class="math display">\[\text{Var}(\varepsilon_i \mid \tau_u, \tau_v) = \text{Var}(v_i) + \text{Var}(u_i) = \tau_v^{-1} + (\tau_u^{-1}\mathbf{Q}^-)_{ii}\]</span></p>
<p>Apesar de sua ampla utilização no mapeamento de doenças, <span class="citation" data-cites="riebler2016intuitive">Riebler et al. (<a href="references.html#ref-riebler2016intuitive" role="doc-biblioref">2016</a>)</span> identificaram limitações nesta parametrização que afetam a inferência:</p>
<ol type="1">
<li><p>Identificabilidade: Apenas a soma <span class="math inline">\(\varepsilon_i = u_i + v_i\)</span> é identificável. A separação entre <span class="math inline">\(u\)</span> e <span class="math inline">\(v\)</span> depende inteiramente das distribuições a priori, e os hiperparâmetros <span class="math inline">\(\tau_u\)</span> e <span class="math inline">\(\tau_v\)</span> competem pela explicação da variância total. Lembre-se que um parâmetro <span class="math inline">\(\boldsymbol{\theta}\)</span> é considerado identificável se valores distintos do parâmetro implicam necessariamente em distribuições de probabilidade distintas para os dados observados (formalmente, se <span class="math inline">\(P_{\boldsymbol{\theta}_1} = P_{\boldsymbol{\theta}_2} \implies \boldsymbol{\theta}_1 = \boldsymbol{\theta}_2\)</span>). No modelo BYM, infinitas combinações dos componentes <span class="math inline">\(u_i\)</span> e <span class="math inline">\(v_i\)</span> podem resultar no mesmo valor latente <span class="math inline">\(\varepsilon_i\)</span> e, por consequência, na mesma função de verossimilhança.</p></li>
<li><p>Escalonamento (Scaling): A variância marginal do componente espacial <span class="math inline">\((\mathbf{Q}^-)_{ii}\)</span> não é constante e depende da geometria do grafo (matriz) de vizinhança. Em grafos mais conectados (regiões com muitos vizinhos), a variância marginal induzida por um mesmo <span class="math inline">\(\tau_u\)</span> é menor do que em grafos menos conectados (regiões com poucos vizinhos). Isso torna as priors para <span class="math inline">\(\tau_u\)</span> não transferíveis: uma prior que é vagamente informativa para um mapa pode ser fortemente informativa para outro, impedindo a criação de padrões de referência <span class="citation" data-cites="sorbye2014scaling">(<a href="references.html#ref-sorbye2014scaling" role="doc-biblioref">Sigrunn H. Sørbye e Rue 2014</a>)</span>.</p></li>
</ol>
<p>Exemplo: Imagine que você ajusta um modelo espacial para os municípios de do estado de São Paulo (muitos vizinhos, malha densa) e outro para os municípios do estado do Amazonas (áreas enormes, poucos vizinhos). Se você usar a mesma prior para a precisão <span class="math inline">\(\tau\)</span> (ex: <span class="math inline">\(\tau=1\)</span>) em ambos os mapas, no mapa denso, a variância induzida será pequena enquanto no mapa esparso, a variância induzida será grande. Isso significa que a prior não é transferível, ou seja, o significado de <span class="math inline">\(\tau\)</span> muda dependendo do mapa que você está usando.</p>
</section>
<section id="modelo-bym2" class="level3" data-number="4.10.2">
<h3 data-number="4.10.2" class="anchored" data-anchor-id="modelo-bym2"><span class="header-section-number">4.10.2</span> Modelo BYM2</h3>
<p>Para solucionar os problemas de escalonamento e confundimento de parâmetros, <span class="citation" data-cites="riebler2016intuitive">Riebler et al. (<a href="references.html#ref-riebler2016intuitive" role="doc-biblioref">2016</a>)</span> propuseram o modelo BYM2. A inovação consiste em escalonar a matriz de precisão espacial e reparametrizar o modelo em termos de variância total e proporção de variância espacial.</p>
<p>Primeiramente, define-se uma matriz de estrutura escalonada <span class="math inline">\(\mathbf{Q}_*\)</span>. O escalonamento é realizado de tal forma que a média geométrica das variâncias marginais generalizadas do componente espacial seja igual a 1:</p>
<p><span class="math display">\[\exp\left( \frac{1}{n} \sum_{i=1}^n \log((\mathbf{Q}^-)_{ii}) \right) = 1\]</span></p>
<p>Esta operação normaliza o tamanho médio do efeito espacial, tornando-o comparável ao efeito não estruturado (cuja variância é 1 na escala padronizada). Com a matriz <span class="math inline">\(\mathbf{Q}_*\)</span> normalizada, o vetor de efeitos aleatórios <span class="math inline">\(\boldsymbol{\varepsilon} = (\varepsilon_1, \dots, \varepsilon_n)^\top\)</span> é reescrito como:</p>
<p><span class="math display">\[\boldsymbol{\varepsilon} = \frac{1}{\sqrt{\tau}} \left( \sqrt{1 - \phi}\,\mathbf{v} + \sqrt{\phi}\,\mathbf{u}_* \right)\]</span></p>
<p>onde <span class="math inline">\(\mathbf{v} \sim \mathcal{N}(\mathbf{0}, \mathbf{I})\)</span> é o componente não estruturado padronizado; <span class="math inline">\(\mathbf{u}_* \sim \mathcal{N}(\mathbf{0}, \mathbf{Q}_*^-)\)</span> é o componente estruturado escalonado; <span class="math inline">\(\tau &gt; 0\)</span> é o parâmetro de precisão marginal total e, <span class="math inline">\(\phi \in [0, 1]\)</span> é o parâmetro de mistura.</p>
<p>A matriz de covariância do vetor <span class="math inline">\(\boldsymbol{\varepsilon}\)</span> no modelo BYM2 torna-se:</p>
<p><span class="math display">\[\text{Var}(\boldsymbol{\varepsilon} \mid \tau, \phi) = \frac{1}{\tau} \left[ (1 - \phi)\mathbf{I} + \phi \mathbf{Q}_*^- \right]\]</span></p>
<p>Esta formulação desacopla a magnitude da variabilidade da estrutura de dependência, facilitando a interpretação. Assim, <span class="math inline">\(\tau\)</span> controla a variância marginal total do efeito latente. <span class="math inline">\(\sigma = \tau^{-1/2}\)</span> é o desvio padrão marginal de <span class="math inline">\(\varepsilon\)</span>, sendo invariante à estrutura do grafo (região com muitos ou poucos vizinhos), enquanto <span class="math inline">\(\phi\)</span> representa a proporção da variância total que é explicada pela estrutura espacial.</p>
<p>Note que se <span class="math inline">\(\phi=1\)</span>, temos um modelo puramente ICAR; se <span class="math inline">\(\phi=0\)</span>, um modelo puramente i.i.d.</p>
<p>Esta parametrização permite o uso de PC Priors (Penalised Complexity Priors, <span class="citation" data-cites="sorbye2017penalised simpson2017penalising">(<a href="references.html#ref-sorbye2017penalised" role="doc-biblioref">Sigrunn Holbek Sørbye e Rue 2017</a>; <a href="references.html#ref-simpson2017penalising" role="doc-biblioref">Simpson et al. 2017</a>)</span>), onde o pesquisador pode expressar conhecimento a priori de forma intuitiva (ex: acredito que a probabilidade do efeito espacial ser superior a 0.5 é baixa).</p>
</section>
</section>
<section id="priors-de-penalização-de-complexidade-pc-priors" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="priors-de-penalização-de-complexidade-pc-priors"><span class="header-section-number">4.11</span> Priors de Penalização de Complexidade (PC Priors)</h2>
<p>A especificação de distribuições a priori para parâmetros de variância e correlação em modelos hierárquicos Bayesianos constitui, historicamente, um desafio. As escolhas tradicionais, notadamente a família de distribuições <a href="https://en.wikipedia.org/wiki/Inverse-gamma_distribution">Gama-Inversa</a> (<span class="math inline">\(\epsilon, \epsilon\)</span>) para a variância <span class="math inline">\(\sigma^2\)</span> (ou <a href="https://en.wikipedia.org/wiki/Gamma_distribution">Gama</a> para a precisão) com parâmetros vagos (por exemplo, <span class="math inline">\(\epsilon = 0.001\)</span>), foram severamente criticadas por <span class="citation" data-cites="gelman2006prior">Gelman (<a href="references.html#ref-gelman2006prior" role="doc-biblioref">2006</a>)</span>. Gelman demonstra que, embora matematicamente convenientes devido à conjugação condicional, tais distribuições são inadequadas como referência não informativa. O autor argumenta que a família Gama-Inversa é patológica no limite <span class="math inline">\(\epsilon \to 0\)</span>, pois não converge para uma distribuição a posteriori própria em situações onde a verossimilhança permite variância nula. Consequentemente, a inferência torna-se instável e altamente sensível à escolha arbitrária do hiperparâmetro <span class="math inline">\(\epsilon\)</span>, especialmente em conjuntos de dados com um número pequeno de grupos ou quando a variância dos efeitos aleatórios é pequena. Na prática, a prior Gama-Inversa introduz um viés que empurra a massa da posteriori para longe da origem, distorcendo a inferência ao sugerir uma variabilidade entre grupos maior do que a suportada pelos dados. <span class="citation" data-cites="gelman2006prior">Gelman (<a href="references.html#ref-gelman2006prior" role="doc-biblioref">2006</a>)</span> recomenda, em vez disso, o uso de prioris Uniformes ou da família <a href="https://en.wikipedia.org/wiki/Folded-t_and_half-t_distributions">Half-t</a> (como a Half-Cauchy) para o desvio padrão <span class="math inline">\(\sigma\)</span>, que possuem melhor comportamento na origem e nas caudas.</p>
<p>Em resposta a essas e várias outras limitações, <span class="citation" data-cites="simpson2017penalising">Simpson et al. (<a href="references.html#ref-simpson2017penalising" role="doc-biblioref">2017</a>)</span> propuseram uma estrutura unificada para a construção de distribuições a priori denominadas Priors de Penalização de Complexidade (<em>PC Priors</em>).</p>
<p>A construção das PC Priors fundamenta-se em quatro princípios. O primeiro princípio, o <a href="https://pt.wikipedia.org/wiki/Navalha_de_Ockham">princípio da parcimônia</a>, estabelece a existência de um modelo base (denotado por <span class="math inline">\(g\)</span>) que é uma versão simplificada do modelo flexível (denotado por <span class="math inline">\(f\)</span>). A prior deve ser construída de modo a favorecer o modelo base, penalizando o afastamento deste a menos que os dados forneçam evidência robusta para justificar a complexidade adicional. O segundo princípio define uma medida de complexidade baseada na Divergência de Kullback-Leibler (KLD),</p>
<p><span class="math display">\[\text{KLD}(f \| g) = \int f(x) \log(f(x)/g(x)) dx\]</span>,</p>
<p>que quantifica a perda de informação ao aproximar o modelo flexível pelo modelo base. Para conferir interpretabilidade, essa divergência é transformada em uma distância unidirecional definida como</p>
<p><span class="math display">\[d(\xi) = \sqrt{2 \text{KLD}(f \| g)},\]</span></p>
<p>onde <span class="math inline">\(\xi\)</span> é o parâmetro que governa a flexibilidade do modelo.</p>
<p>O terceiro princípio determina a taxa de penalização. <span class="citation" data-cites="simpson2017penalising">Simpson et al. (<a href="references.html#ref-simpson2017penalising" role="doc-biblioref">2017</a>)</span> argumentam que, na ausência de informações externas que sugiram o contrário, a penalização deve ocorrer a uma taxa constante ao longo da distância métrica <span class="math inline">\(d\)</span>. A única distribuição de probabilidade contínua definida em <span class="math inline">\([0, \infty)\)</span> que satisfaz a propriedade de falta de memória (taxa de risco constante) é a distribuição exponencial. Portanto, a prior na escala da distância deve ser</p>
<p><span class="math display">\[\pi(d) = \lambda e^{-\lambda d},\]</span></p>
<p>onde <span class="math inline">\(\lambda\)</span> é a taxa de decaimento. A distribuição a priori para o parâmetro original <span class="math inline">\(\xi\)</span> é então obtida através da regra de transformação de variáveis, dada por</p>
<p><span class="math display">\[\pi(\xi) = \lambda e^{-\lambda d(\xi)} \left| \partial d(\xi) / \partial \xi \right|.\]</span></p>
<p>O quarto princípio permite a calibração definida pelo usuário. Em vez de escolher o parâmetro <span class="math inline">\(\lambda\)</span> diretamente, o pesquisador especifica uma regra probabilística intuitiva sobre a cauda da distribuição, da forma</p>
<p><span class="math display">\[\text{Prob}(Q(\xi) &gt; U) = \alpha,\]</span></p>
<p>onde <span class="math inline">\(Q(\xi)\)</span> é uma transformação interpretável do parâmetro, <span class="math inline">\(U\)</span> é um limite superior e <span class="math inline">\(\alpha\)</span> uma probabilidade pequena.</p>
<p><strong>Exemplo da Aplicação de PC Priors</strong></p>
<p>Considere um pesquisador que analisa a incidência de uma doença infecciosa em <span class="math inline">\(n\)</span> municípios. Os dados observados são contagens <span class="math inline">\(y_i\)</span> de casos, modeladas como <span class="math inline">\(y_i \mid \theta_i \sim \text{Poisson}(E_i \theta_i)\)</span>, onde <span class="math inline">\(E_i\)</span> é o número esperado de casos e <span class="math inline">\(\theta_i\)</span> o risco relativo. O preditor linear é definido como <span class="math inline">\(\eta_i = \log(\theta_i) = \mu + \mathbf{x}_i^\top \boldsymbol{\beta} + \varepsilon_i\)</span>. O efeito aleatório espacial <span class="math inline">\(\varepsilon_i\)</span> é modelado utilizando a reparametrização BYM2: <span class="math inline">\(\varepsilon_i = \tau^{-1/2} \left( \sqrt{1-\phi} \, v_i + \sqrt{\phi} \, u_i^* \right)\)</span>, onde <span class="math inline">\(\tau\)</span> é a precisão marginal total e <span class="math inline">\(\phi \in [0,1]\)</span> é o parâmetro de mistura. A especificação de distribuições a priori para <span class="math inline">\(\tau\)</span> e <span class="math inline">\(\phi\)</span> é crucial. O uso de priors Gama para a precisão, como <span class="math inline">\(\tau \sim \Gamma(1, 0.01)\)</span>, é comum, mas problemático, pois coloca densidade zero em <span class="math inline">\(\tau \to \infty\)</span> (o modelo base de variância nula), podendo levar a sobreajuste ao não permitir o encolhimento adequado.</p>
<p>A aplicação das PC Priors resolve este problema. O primeiro passo é identificar os modelos base para cada parâmetro (se o objetivo é modelar dependência espacial, o modelo base é aquele que não tem dependência espacial). Para a precisão <span class="math inline">\(\tau\)</span>, o modelo base é a ausência de efeitos aleatórios, correspondente a <span class="math inline">\(\tau \to \infty\)</span> ou, equivalentemente, ao desvio padrão marginal <span class="math inline">\(\sigma = \tau^{-1/2} = 0\)</span>. Para o parâmetro de mistura <span class="math inline">\(\phi\)</span>, o modelo base é a ausência de dependência espacial, ou seja, <span class="math inline">\(\phi = 0\)</span>. As PC Priors serão construídas para penalizar o afastamento destes modelos base.</p>
<p>Na prática, o pesquisador traduz conhecimento epidemiológico prévio em declarações probabilísticas (isso é prior). Para a precisão <span class="math inline">\(\tau\)</span>, é mais intuitivo pensar na escala do desvio padrão <span class="math inline">\(\sigma\)</span> (o quão afastados estão os casos de dengue em Lavras em relação média geral de todo estado de Minas Gerais) . Suponha que, com base na literatura, o pesquisador acredite ser improvável que a variação não explicada no log-risco seja extrema. Um desvio padrão de <span class="math inline">\(\sigma = 0.5\)</span> implica que os riscos relativos (na escala original) variam tipicamente por um fator de até <span class="math inline">\(e^{0.5} \approx 1.65\)</span> para mais ou para menos. O pesquisador pode considerar que é pouco plausível que a variação não explicada supere este patamar. Assim, formula-se a declaração: <span class="math inline">\(\text{Prob}(\sigma &gt; 0.5) = 0.01\)</span>. Isto significa que se atribui apenas 1% de probabilidade a priori a valores de <span class="math inline">\(\sigma\)</span> superiores a 0.5.</p>
<p>Esta declaração define os parâmetros da PC Prior: <span class="math inline">\(U = 0.5\)</span> e <span class="math inline">\(\alpha = 0.01\)</span>. Conforme a derivação de <span class="citation" data-cites="simpson2017penalising">Simpson et al. (<a href="references.html#ref-simpson2017penalising" role="doc-biblioref">2017</a>)</span>, isso implica uma distribuição exponencial para <span class="math inline">\(\sigma\)</span> com taxa <span class="math inline">\(\lambda = -\ln(\alpha)/U = -\ln(0.01)/0.5 \approx 9.21\)</span>. A prior correspondente para a precisão <span class="math inline">\(\tau\)</span> é uma distribuição tipo-2 Gumbel, mas o usuário não precisa manipulá-la diretamente.</p>
<p>Para o parâmetro de mistura <span class="math inline">\(\phi\)</span>, que representa a proporção da variância atribuída à dependência espacial, o raciocínio é similar. O modelo base é <span class="math inline">\(\phi=0\)</span> (ausência de estrutura espacial). O pesquisador deve refletir sobre a importância relativa esperada da dependência espacial. Em muitas aplicações epidemiológicas, é razoável assumir, na falta de informação forte, que a heterogeneidade não espacial (ruído) pode ser tão ou mais importante que a estrutura espacial. Uma declaração conservadora poderia ser: <span class="math inline">\(\text{Prob}(\phi &gt; 0.5) = 0.5\)</span>. Isto significa que se atribui igual probabilidade (50%) a <span class="math inline">\(\phi\)</span> estar acima ou abaixo de 0.5, mas ainda assim a prior é construída para encolher em direção a zero.</p>
<p>No pacote <code>R-INLA</code>, a especificação destas PC Priors é direta. Suponha que <code>id_regiao</code> é um vetor de índices que identificam cada município do estado de Minas Gerais, <code>grafo</code> é a matriz de vizinhança, e <code>y</code> é o vetor de contagens. A fórmula do modelo, incorporando as PC Priors com os parâmetros <span class="math inline">\(U\)</span> e <span class="math inline">\(\alpha\)</span> definidos acima, seria:</p>
<p>O argumento <code>param = c(U, α)</code> na prior <code>"pc.prec"</code> para a precisão codifica exatamente a declaração <span class="math inline">\(\text{Prob}(\sigma &gt; U) = \alpha\)</span>. Para a prior <code>"pc"</code> no parâmetro <code>phi</code>, <code>param = c(0.5, 0.5)</code> codifica <span class="math inline">\(\text{Prob}(\phi &gt; 0.5) = 0.5\)</span>. A opção <code>scale.model = TRUE</code> garante o escalonamento automático da matriz de precisão do componente estruturado, essencial para a interpretabilidade de <span class="math inline">\(\phi\)</span>.</p>
<p>A prior para <span class="math inline">\(\sigma\)</span> (derivada de <code>pc.prec</code>) tem seu pico em zero e decai exponencialmente. Assim, se os dados forem escassos ou pouco informativos, a posteriori de <span class="math inline">\(\sigma\)</span> será puxada para valores próximos de zero, efetivamente encolhendo os efeitos aleatórios <span class="math inline">\(\varepsilon_i\)</span> e produzindo estimativas de risco mais suaves e próximas da média global. Segundo, a prior para <span class="math inline">\(\phi\)</span> também encolhe em direção a zero. Portanto, na ausência de um sinal espacial claro nos dados, o modelo tenderá a alocar mais variância ao componente não estruturado (<span class="math inline">\(v_i\)</span>), evitando a imposição de uma suavização espacial injustificada.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalação do INLA </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout =</span> <span class="dv">600</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"INLA"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">install.packages</span>(<span class="st">"INLA"</span>, <span class="at">repos=</span><span class="fu">c</span>(<span class="fu">getOption</span>(<span class="st">"repos"</span>), <span class="at">INLA=</span><span class="st">"https://inla.r-inla-download.org/R/stable"</span>), <span class="at">dep=</span><span class="cn">TRUE</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Veja como instalar INLA no link:  https://www.r-inla.org/download-install</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># veja também browseVignettes("INLA") ou system.file("doc", package = "INLA") e veja a documentacao</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Veja também https://github.com/hrue/r-inla/tree/devel/rinla/vignettes</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(INLA, spdep, sf, dplyr, knitr, kableExtra, ggplot2, patchwork)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparação dos Dados</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar um identificador numérico sequencial para as áreas (exigência do INLA)</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>ID_AREA <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mg_dados)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Matriz de Vizinhança e Grafo</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(mg_dados), <span class="at">border =</span> <span class="st">"lightgrey"</span>, <span class="at">main =</span> <span class="st">"Estrutura de Vizinhança (Grafo)"</span>)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nb, coords, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter para formato de grafo do INLA</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nb2INLA</span>(<span class="st">"mg_graph.adj"</span>, nb)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">inla.read.graph</span>(<span class="st">"mg_graph.adj"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Definição dos PC Priors (Penalised Complexity)</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior para a Precisão (Tau): Prob(desvio padrão &gt; 1) = 0.01 , vc pode usar outros</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>   <span class="co">#A probabilidade do Desvio Padrão (σ) ser maior que 1 é de apenas 1% (0.01).</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior para Mistura (Phi): Prob(phi &lt; 0.5) = 0.5 (neutro), note que Phi = 1 (tudo é espacial), Phi=0 (tudo é aleatório).</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>       <span class="co">#Você está dizendo ao modelo: "Eu não sei se o fenômeno é mais espacial ou </span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>       <span class="co"># mais aleatório, então vou deixar 50% de chance para cada lado"</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>hyper_pc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">"pc.prec"</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.01</span>)),</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi  =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">"pc"</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajuste do Modelo BYM2</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>formula_bym2 <span class="ot">&lt;-</span> taxa_bruta <span class="sc">~</span> variavel_x <span class="sc">+</span> </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">f</span>(ID_AREA, <span class="at">model =</span> <span class="st">"bym2"</span>, <span class="at">graph =</span> g, <span class="at">scale.model =</span> <span class="cn">TRUE</span>, </span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">hyper =</span> hyper_pc)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>modelo_inla <span class="ot">&lt;-</span> <span class="fu">inla</span>(formula_bym2, </span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> mg_dados, </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">"gaussian"</span>, </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>), </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>, <span class="at">waic =</span> <span class="cn">TRUE</span>))</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Função auxiliar de formatação "Média [IC 95%]"</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(m, l, u) {</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">format</span>(<span class="fu">round</span>(m, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">" ["</span>, </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>         <span class="fu">format</span>(<span class="fu">round</span>(l, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">"; "</span>, </span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>         <span class="fu">format</span>(<span class="fu">round</span>(u, <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">"]"</span>)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Efeitos Fixos</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>fix <span class="ot">&lt;-</span> modelo_inla<span class="sc">$</span>summary.fixed[, <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"0.025quant"</span>, <span class="st">"0.975quant"</span>)]</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>df_fix <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro =</span> <span class="fu">rownames</span>(fix),</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">mapply</span>(fmt, fix<span class="sc">$</span>mean, fix<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>, fix<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>)</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="co"># renomear nomes</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>df_fix<span class="sc">$</span>Parametro <span class="ot">&lt;-</span> <span class="fu">recode</span>(df_fix<span class="sc">$</span>Parametro, </span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"(Intercept)"</span> <span class="ot">=</span> <span class="st">"Intercepto"</span>, </span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"variavel_x"</span> <span class="ot">=</span> <span class="st">"Variável X"</span>)</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Hiperparâmetros</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">&lt;-</span> modelo_inla<span class="sc">$</span>summary.hyperpar[, <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"0.025quant"</span>, <span class="st">"0.975quant"</span>)]</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>df_hyp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro =</span> <span class="fu">rownames</span>(hyp),</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">mapply</span>(fmt, hyp<span class="sc">$</span>mean, hyp<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>, hyp<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>)</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>df_hyp<span class="sc">$</span>Parametro <span class="ot">&lt;-</span> <span class="fu">recode</span>(df_hyp<span class="sc">$</span>Parametro,</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Precision for the Gaussian observations"</span> <span class="ot">=</span> <span class="st">"Precisão (Likelihood)"</span>,</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Precision for ID_AREA"</span> <span class="ot">=</span> <span class="st">"Precisão Marginal $</span><span class="sc">\\</span><span class="st">tau$"</span>,</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Phi for ID_AREA"</span> <span class="ot">=</span> <span class="st">"Dependência Espacial $</span><span class="sc">\\</span><span class="st">phi$"</span>)</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="co">#Métricas de Ajuste</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>df_met <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro =</span> <span class="fu">c</span>(<span class="st">"DIC"</span>, <span class="st">"WAIC"</span>),</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">c</span>(<span class="fu">format</span>(<span class="fu">round</span>(modelo_inla<span class="sc">$</span>dic<span class="sc">$</span>dic, <span class="dv">2</span>), <span class="at">nsmall=</span><span class="dv">2</span>),</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>            <span class="fu">format</span>(<span class="fu">round</span>(modelo_inla<span class="sc">$</span>waic<span class="sc">$</span>waic, <span class="dv">2</span>), <span class="at">nsmall=</span><span class="dv">2</span>))</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Unir tudo</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>df_final <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_fix, df_hyp, df_met)</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Gerar Tabela</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(df_final, </span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"latex"</span>,</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"lr"</span>, </span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Efeitos Fixos (Média [IC 95%])"</span>, <span class="dv">1</span>, <span class="fu">nrow</span>(df_fix)) <span class="sc">%&gt;%</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Hiperparâmetros (Média [IC 95%])"</span>, <span class="fu">nrow</span>(df_fix) <span class="sc">+</span> <span class="dv">1</span>, <span class="fu">nrow</span>(df_fix) <span class="sc">+</span> <span class="fu">nrow</span>(df_hyp)) <span class="sc">%&gt;%</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Qualidade do Ajuste"</span>, <span class="fu">nrow</span>(df_final) <span class="sc">-</span> <span class="dv">1</span>, <span class="fu">nrow</span>(df_final)) <span class="sc">%&gt;%</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>((<span class="fu">nrow</span>(df_final)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(df_final), <span class="at">bold =</span> <span class="cn">TRUE</span>) </span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-bym2_inla" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bym2_inla-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.3: Resultados do Modelo BYM2 com PC Priors.
</figcaption>
<div aria-describedby="tbl-bym2_inla-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><img src="lattice_data_files/figure-html/tbl-bym2_inla-1.png" class="img-fluid figure-img"></p>
</div>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>A análise dos efeitos fixos (<a href="#tbl-bym2_inla" class="quarto-xref">Tabela&nbsp;<span>4.3</span></a>) mostra que o intercepto do modelo foi estimado com uma média de 8,974, situando-se num intervalo de credibilidade de 95% entre 8,664 e 9,283 (não inclui zero). Por outro lado, a covariável “Variável X” apresentou uma estimativa média muito próxima de zero (-0,001) e, mais importante, o seu intervalo de credibilidade varia de -0,331 a 0,328. Como este intervalo inclui o valor zero, conclui-se que não existe evidência estatística de uma associação significativa entre a Variável X e a variável resposta; ou seja, a variável não contribui para explicar o fenômeno estudado neste modelo.</p>
<p>No que nos hiperparâmetros e à estrutura aleatória, a precisão da verossimilhança (<em>Likelihood</em>) é extremamente alta (média de 21117,082), o que indica que a variância do erro residual dos dados em torno da média predita é muito pequena. O parâmetro de dependência espacial (<span class="math inline">\(\phi\)</span>) foi estimado em 0,124 (com intervalo de 0,068 a 0,200), o que revela que apenas cerca de 12,4% da variabilidade capturada pelo efeito aleatório (campo latente) se deve à estrutura espacial de vizinhança, enquanto a maior parte (os restantes 87,6%) é atribuída a ruído não estruturado (efeito iid). Por fim, os critérios de informação DIC (-4822,46) e WAIC (-5056,00) indicam a qualidade do ajuste, servindo como base de comparação para modelos alternativos, onde valores menores indicariam um melhor ajuste.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DIAGNÓSTICO</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>efeito_bym <span class="ot">&lt;-</span> modelo_inla<span class="sc">$</span>summary.random<span class="sc">$</span>ID_AREA<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mg_dados)]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>ajustado   <span class="ot">&lt;-</span> modelo_inla<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>residuos   <span class="ot">&lt;-</span> mg_dados<span class="sc">$</span>taxa_bruta <span class="sc">-</span> mg_dados<span class="sc">$</span>ajustado</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Mapa do Efeito Espacial (Risco/Nível estimado)</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> efeito_bym), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">name =</span> <span class="st">"Efeito</span><span class="sc">\n</span><span class="st">Espacial"</span>) <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Componente Espacial (BYM2)"</span>) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa dos Resíduos </span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> residuos), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"PuOr"</span>, <span class="at">name =</span> <span class="st">"Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Mapa de Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico Observado vs Esperado</span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>cor_p <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(mg_dados<span class="sc">$</span>taxa_bruta, mg_dados<span class="sc">$</span>ajustado), <span class="dv">3</span>)</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> ajustado, <span class="at">y =</span> taxa_bruta)) <span class="sc">+</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Ajuste do Modelo"</span>, </span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Correlação: "</span>, cor_p),</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predito (INLA)"</span>, <span class="at">y =</span> <span class="st">"Observado"</span>) <span class="sc">+</span></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3)</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a><span class="co"># TESTE DE MORAN NOS RESÍDUOS</span></span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>moran_test <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>residuos, lw)</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_test)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mg_dados$residuos  
weights: lw    

Moran I statistic standard deviate = -1.4006, p-value = 0.9193
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
    -0.0309419300     -0.0011737089      0.0004517046 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(moran_test<span class="sc">$</span>p.value <span class="sc">&gt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"SUCESSO: Resíduos são aleatórios (p &gt; 0.05). O modelo removeu a autocorrelação."</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"ATENÇÃO: Ainda existe dependência espacial nos resíduos."</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-diagnosticoBYM" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diagnosticoBYM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-diagnosticoBYM-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diagnosticoBYM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.11: Diagnóstico do modelo BYM2 ajustado
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>O componente espacial mapeado em <a href="#fig-diagnosticoBYM" class="quarto-xref">Figura&nbsp;<span>4.11</span></a> (A) delineia a variabilidade latente, capturando a heterogeneidade geográfica do fenômeno. O ajuste é evidenciado na <a href="#fig-diagnosticoBYM" class="quarto-xref">Figura&nbsp;<span>4.11</span></a> (C), onde a relação entre os valores observados e os preditos pelo INLA exibe uma correlação unitária, com os pontos assentando-se perfeitamente sobre a linha de identidade, indicando ausência de viés sistemático nas predições.</p>
<p>A validade do modelo é confirmada pela análise dos resíduos. O mapa em <a href="#fig-diagnosticoBYM" class="quarto-xref">Figura&nbsp;<span>4.11</span></a> (B) sugere visualmente uma distribuição espacial aleatória dos erros, sem padrões de aglomeração (<em>clustering</em>) remanescentes. Esta inspeção visual é confirmada pelo Teste de I de Moran realizado nos resíduos (<span class="math inline">\(I = -0.0311\)</span>; <span class="math inline">\(p = 0.9203\)</span>). O valor-p elevado não permite rejeitar a hipótese nula de aleatoriedade espacial, o que confirma que o modelo BYM2 foi eficaz em incorporar toda a autocorrelação espacial significativa presente nos dados, restando nos resíduos apenas ruído branco estocástico.</p>
</section>
<section id="estatística-espacial-vs.-econometria-espacial" class="level2" data-number="4.12">
<h2 data-number="4.12" class="anchored" data-anchor-id="estatística-espacial-vs.-econometria-espacial"><span class="header-section-number">4.12</span> Estatística Espacial vs.&nbsp;Econometria Espacial</h2>
<p>A escolha entre as famílias de modelos condicionais (CAR/ICAR/BYM) e simultâneos (SAR) é fundamentalmente guiada pelo objetivo, pela natureza teórica da dependência espacial e pelo contexto disciplinar. A Estatística Espacial, com seus modelos CAR e ICAR, adota uma abordagem condicional ou markoviana <span class="citation" data-cites="besag1974spatial">(<a href="references.html#ref-besag1974spatial" role="doc-biblioref">Besag 1974</a>)</span>, cujo objetivo primário é a predição, suavização e mapeamento de superfícies latentes, como o risco de doença ou a concentração de poluentes <span class="citation" data-cites="cressie1993statistics">(<a href="references.html#ref-cressie1993statistics" role="doc-biblioref">Cressie 1993</a>)</span>. Neste paradigma, o foco reside em modelar com precisão a estrutura de covariância para capturar padrões espaciais, utilizando uma formulação baseada em distribuições condicionais locais. Esta especificação resulta em uma matriz de precisão esparsa, o que confere eficiência computacional a métodos bayesianos e hierárquicos, como MCMC e INLA <span class="citation" data-cites="rue2009approximate rue2005gaussian">(<a href="references.html#ref-rue2009approximate" role="doc-biblioref">Håvard Rue, Martino, e Chopin 2009</a>; <a href="references.html#ref-rue2005gaussian" role="doc-biblioref">Havard Rue e Held 2005</a>)</span>. Esta abordagem é predominante em campos como a epidemiologia, ecologia e ciências ambientais, onde a interpretação do processo espacial latente e a quantificação da incerteza de predição são objetivos centrais <span class="citation" data-cites="riebler2016intuitive banerjee2003hierarchical">(<a href="references.html#ref-riebler2016intuitive" role="doc-biblioref">Riebler et al. 2016</a>; <a href="references.html#ref-banerjee2003hierarchical" role="doc-biblioref">Banerjee, Carlin, e Gelfand 2003</a>)</span>.</p>
<p>Em contraste, a Econometria Espacial, fundamentada no modelo SAR, adota uma abordagem simultânea ou estrutural <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>. Seu objetivo primário é a inferência causal e a estimação não enviesada de parâmetros que capturem efeitos de interação e transbordamento (<em>spillovers</em>) entre unidades <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>. Sua formulação constitui um sistema de equações com feedback, onde o valor em uma unidade depende simultaneamente dos valores em outras, gerando uma estrutura de precisão geralmente densa <span class="citation" data-cites="ver2018relationship">(<a href="references.html#ref-ver2018relationship" role="doc-biblioref">Ver Hoef, Hanks, e Hooten 2018</a>)</span>. Esta característica associa-a mais fortemente a métodos de estimação frequentistas, como a máxima verossimilhança ou o método dos momentos generalizado (GMM) <span class="citation" data-cites="anselin2010thirty">(<a href="references.html#ref-anselin2010thirty" role="doc-biblioref">Anselin 2010</a>)</span>. Esta abordagem é predominante em campos como economia regional, ciências políticas e estudos urbanos, onde a questão central é testar teorias sobre interdependência estratégica, externalidades espaciais ou difusão de políticas.</p>
<p>A seleção do modelo deve ser uma função direta da pergunta de pesquisa. Deve-se optar por modelos CAR, ICAR ou BYM quando o interesse principal for a predição, suavização ou recuperação de um campo aleatório espacial subjacente <span class="citation" data-cites="wall2004close">(<a href="references.html#ref-wall2004close" role="doc-biblioref">Wall 2004</a>)</span>. Estes são a escolha natural para a criação de mapas de risco, interpolação de superfícies ou para modelagem bayesiana hierárquica que “empreste força” (<em>borrowing strength</em>) entre áreas vizinhas <span class="citation" data-cites="riebler2016intuitive">(<a href="references.html#ref-riebler2016intuitive" role="doc-biblioref">Riebler et al. 2016</a>)</span>. Por outro lado, modelos SAR (ou modelos de erro espacial - SEM) são mais adequados quando o interesse é a inferência causal sobre um parâmetro de interação espacial (<span class="math inline">\(\rho\)</span>) ou quando a teoria subjacente postula um mecanismo de dependência simultânea e <em>feedback</em> entre unidades observadas, como em modelos de competição ou difusão <span class="citation" data-cites="ver2018relationship">(<a href="references.html#ref-ver2018relationship" role="doc-biblioref">Ver Hoef, Hanks, e Hooten 2018</a>)</span>. Tais modelos são essenciais para corrigir viés de variável omitida espacial e para estimar efeitos diretos e indiretos de políticas. Ambas as abordagens são complementares, e a fronteira entre elas tem se tornado mais permeável, com avanços metodológicos permitindo, por exemplo, a interpretação de priors CAR em termos de equilíbrio de sistemas dinâmicos ou o uso de técnicas de álgebra esparsa para a estimação eficiente de certas especificações de modelos SAR <span class="citation" data-cites="ver2018relationship lesage2009introduction">(<a href="references.html#ref-ver2018relationship" role="doc-biblioref">Ver Hoef, Hanks, e Hooten 2018</a>; <a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p>
</section>
<section id="modelos-espaciais-econométricos-para-dados-de-área" class="level2" data-number="4.13">
<h2 data-number="4.13" class="anchored" data-anchor-id="modelos-espaciais-econométricos-para-dados-de-área"><span class="header-section-number">4.13</span> Modelos Espaciais Econométricos para Dados de Área</h2>
<p>A econometria espacial distingue-se da estatística espacial clássica (como os modelos CAR, SAR <a href="#sec-car" class="quarto-xref"><span>Seção 4.7.1</span></a>) por sua ênfase na identificação de relações causais, na fundamentação teórica dos processos de dependência (como interações estratégicas, efeitos de contágio ou <a href="https://pt.wikipedia.org/wiki/Externalidades">externalidades</a>) e na garantia de propriedades assintóticas dos estimadores, especialmente a consistência sob condições de endogeneidade. Enquanto os modelos CAR são frequentemente usados para suavização e predição em contextos Bayesianos hierárquicos, os modelos econométricos (SAR, SEM, SDM, etc.) são desenhados para testar hipóteses sobre mecanismos de interação e estimar o impacto de políticas ou choques exógenos em um sistema interconectado.</p>
<p>A literatura econométrica, consolidada por <span class="citation" data-cites="anselin1988spatial">Anselin (<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">1988</a>)</span> e expandida expressivamente por <span class="citation" data-cites="lesage2009introduction">J. LeSage e Pace (<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">2009</a>)</span>, <span class="citation" data-cites="elhorst2014spatial">Elhorst et al. (<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">2014</a>)</span> e <span class="citation" data-cites="kelejian2017spatial">H. Kelejian e Piras (<a href="references.html#ref-kelejian2017spatial" role="doc-biblioref">2017</a>)</span>, organiza os modelos espaciais com base na inclusão de três tipos fundamentais de interação entre unidades espaciais:</p>
<ul>
<li>Defasagem espacial na variável dependente (<span class="math inline">\(\mathbf{W}\mathbf{y}\)</span>): Refere-se ao fenômeno em que o resultado observado em uma região ou agente é diretamente influenciado pelos resultados observados em regiões ou agentes vizinhos. Isto é, o valor da variável de interesse na unidade <span class="math inline">\(i\)</span> (<span class="math inline">\(y_i\)</span>) é determinado simultaneamente pelos valores de <span class="math inline">\(y\)</span> nas unidades vizinhas (<span class="math inline">\(\mathbf{W}\mathbf{y}\)</span>, ver <span class="citation" data-cites="elhorst2022dynamic">Elhorst (<a href="references.html#ref-elhorst2022dynamic" role="doc-biblioref">2022</a>)</span>).</li>
</ul>
<p>Exemplo: Competição fiscal entre municípios (a alíquota de imposto de um município depende da alíquota dos vizinhos para não perder base tributária) ou efeitos de pares em educação (o desempenho de um aluno depende do desempenho dos colegas).</p>
<ul>
<li>Defasagem espacial nas variáveis explicativas (<span class="math inline">\(\mathbf{W}\mathbf{X}\)</span>): Refere-se à influência que as características ou políticas de regiões vizinhas exercem sobre os resultados de uma região. É um efeito de transbordamento direto ou externalidade, onde o que acontece ao lado importa tanto quanto o que acontece aqui (ver <span class="citation" data-cites="elhorst2022dynamic">Elhorst (<a href="references.html#ref-elhorst2022dynamic" role="doc-biblioref">2022</a>)</span>). Note que aqui <span class="math inline">\(\mathbf{X}\)</span> é covariável.</li>
</ul>
<p>Exemplo: A criminalidade em um bairro pode ser afetada não apenas pelo policiamento local, mas também pelo policiamento nos bairros vizinhos (deslocamento do crime).</p>
<ul>
<li>Dependência espacial no termo de erro (<span class="math inline">\(\mathbf{W}\mathbf{u}\)</span>): Refere-se à dependência residual. A correlação espacial surge devido a variáveis omitidas que são espacialmente correlacionadas ou a erros de medição com padrão espacial. Isto é, mesmo após controlar pelas variáveis explicativas observadas (<span class="math inline">\(\mathbf{X}\)</span>), os resíduos de unidades geograficamente próximas podem não ser independentes, podendo ser correlacionados. Isso indica que os fatores não observados que influenciam a variável resposta <span class="math inline">\(\mathbf{y}\)</span> possuem, eles próprios, uma estrutura espacial.</li>
</ul>
<p>Exemplo: Considere um modelo de preços de imóveis que inclui variáveis como tamanho, idade, número de quartos e proximidade do centro. Se o modelo omitir a poluição sonora (ruído de tráfego) um fator que varia gradualmente no espaço (ruas adjacentes têm níveis similares), os imóveis em ruas mais barulhentas terão sistematicamente preços abaixo do previsto pelo modelo, enquanto aqueles em ruas mais silenciosas terão preços acima do previsto. Como a poluição sonora é espacialmente correlacionada, os erros do modelo (resíduos) também o serão: resíduos negativos se agruparão em regiões barulhentas e positivos em regiões quietas. Essa estrutura espacial nos resíduos é exatamente a dependência espacial no termo de erro (<span class="math inline">\(W u\)</span>).</p>
<p>O modelo mais geral que engloba essas três formas de interação é o modelo geral de aninhamento espacial (GNS - <em>General Nesting Spatial Mode</em>l, <span class="citation" data-cites="elhorst2022dynamic">Elhorst (<a href="references.html#ref-elhorst2022dynamic" role="doc-biblioref">2022</a>)</span>), por vezes referido como <em>Spatial Autoregressive model with Spatial Autoregressive errors</em> (SARAR) ou <em>Spatial Autoregressive Combined</em> (SAC) generalizado:</p>
<p><span id="eq-GNS"><span class="math display">\[
\begin{aligned}
\mathbf{y} &amp;= \rho \mathbf{W}\mathbf{y} + \mathbf{X}\boldsymbol{\beta} + \mathbf{W}\mathbf{X}\boldsymbol{\theta} + \mathbf{u} \\
\mathbf{u} &amp;= \lambda \mathbf{W}\mathbf{u} + \boldsymbol{\epsilon}
\end{aligned}
\tag{4.4}\]</span></span></p>
<p>Onde:</p>
<ul>
<li><p><span class="math inline">\(\mathbf{y}\)</span> é um vetor <span class="math inline">\(N \times 1\)</span> da variável dependente.</p></li>
<li><p><span class="math inline">\(\mathbf{X}\)</span> é uma matriz <span class="math inline">\(N \times K\)</span> de variáveis explicativas (covaráveis).</p></li>
<li><p><span class="math inline">\(\mathbf{W}\)</span> é a matriz de pesos espaciais (ou matriz de vizinhança) <span class="math inline">\(N \times N\)</span>. Pode-se usar matrizes diferentes para cada termo (<span class="math inline">\(\mathbf{W}_1, \mathbf{W}_2\)</span>), mas frequentemente assume-se a mesma estrutura por parcimônia.</p></li>
<li><p><span class="math inline">\(\rho\)</span> é o coeficiente autorregressivo espacial (intensidade da dependência substantiva).</p></li>
<li><p><span class="math inline">\(\boldsymbol{\beta}\)</span> é o vetor <span class="math inline">\(K \times 1\)</span> de parâmetros associados às covariáveis.</p></li>
<li><p><span class="math inline">\(\boldsymbol{\theta}\)</span> é o vetor <span class="math inline">\(K \times 1\)</span> de parâmetros associados à defasagem espacial.</p></li>
<li><p><span class="math inline">\(\lambda\)</span> é o coeficiente de erro autorregressivo espacial.</p></li>
<li><p><span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span> é o vetor de erros, tipicamente assumido i.i.d. com média zero e variância constante <span class="math inline">\(\sigma^2\)</span> (embora métodos modernos relaxem a homocedasticidade).</p></li>
</ul>
<p>A partir desta estrutura geral, impõem-se restrições aos parâmetros (<span class="math inline">\(\rho=0\)</span>, <span class="math inline">\(\lambda=0\)</span>, ou <span class="math inline">\(\boldsymbol{\theta}=\mathbf{0}\)</span>) para derivar os modelos específicos mais utilizados na prática.</p>
<section id="modelo-de-defasagem-espacial-sar-spatial-autoregressive-model" class="level3" data-number="4.13.1">
<h3 data-number="4.13.1" class="anchored" data-anchor-id="modelo-de-defasagem-espacial-sar-spatial-autoregressive-model"><span class="header-section-number">4.13.1</span> Modelo de Defasagem Espacial (SAR – <em>Spatial Autoregressive Model</em>)</h3>
<p>O Modelo de Defasagem Espacial (SAR, o mesmo descrito na <a href="#sec-SAR" class="quarto-xref"><span>Seção 4.9</span></a>), também conhecido como <em>Spatial Lag Model</em>, constitui um caso particular do Modelo Geral de Aninhamento Espacial (GNS, <a href="#eq-GNS" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a>) obtido ao impor as restrições paramétricas <span class="math inline">\(\lambda = 0\)</span> e <span class="math inline">\(\boldsymbol{\theta} = \mathbf{0}\)</span>.</p>
<p>Esta especificação pressupõe que a dependência espacial é um fenômeno substantivo, resultante da interação direta e simultânea entre as unidades de observação, onde o resultado de uma localidade é condicionado pelos resultados de suas vizinhas. Formalmente, o modelo é definido pela seguinte equação estrutural <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>:</p>
<p><span id="eq-SAR"><span class="math display">\[
\mathbf{y} = \rho \mathbf{W}\mathbf{y} + \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon},
\tag{4.5}\]</span></span></p>
<p>com erros i.i.d. <span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span>. Na sua forma escalar, para uma unidade <span class="math inline">\(i\)</span>, o modelo é expresso como:</p>
<p><span class="math display">\[
y_i = \rho \sum_{j=1}^{n} w_{ij} y_j + \sum_{k=1}^{K} x_{ik}\beta_k + \epsilon_i,
\]</span></p>
<p>em que <span class="math inline">\(\rho\)</span> é o coeficiente de autocorrelação espacial, que quantifica a intensidade da dependência espacial.</p>
<p>A partir da forma reduzida do modelo, obtém-se a distribuição condicional completa de <span class="math inline">\(\mathbf{y}\)</span>. Assumindo que <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})\)</span> é não singular (tem inversa), temos:</p>
<p><span class="math display">\[
\mathbf{y} \, | \, \mathbf{X}, \mathbf{W} \sim \mathcal{N}\left( (\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta}, \quad \sigma^2 (\mathbf{I}_n - \rho \mathbf{W})^{-1} (\mathbf{I}_n - \rho \mathbf{W})^{-\top} \right).
\]</span></p>
<p>Esta expressão evidencia que tanto a média condicional quanto a estrutura de covariância de <span class="math inline">\(\mathbf{y}\)</span> são globalmente afetadas pela configuração espacial através da matriz de pesos <span class="math inline">\(\mathbf{W}\)</span> e do parâmetro <span class="math inline">\(\rho\)</span>.</p>
<p>A especificação é motivada por processos de difusão, contágio, competição estratégica, externalidades ou efeitos de aprendizagem entre agentes ou regiões geograficamente próximas <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p>
<p>A natureza simultânea do modelo é explicitada por sua forma reduzida (ou <a href="https://en.wikipedia.org/wiki/Data_generating_process">Data Generating Process – DGP</a>), obtida ao resolver a equação para <span class="math inline">\(\mathbf{y}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
(\mathbf{I}_n - \rho \mathbf{W})\mathbf{y} &amp;= \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}, \\
\mathbf{y} &amp;= (\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta} + (\mathbf{I}_n - \rho \mathbf{W})^{-1}\boldsymbol{\epsilon}.
\end{aligned}
\]</span></p>
<p>A matriz <span class="math inline">\(\mathbf{S}(\mathbf{W}) = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span> é denominada multiplicador espacial. Sua expansão em série de potências,</p>
<p><span class="math display">\[
(\mathbf{I}_n - \rho \mathbf{W})^{-1} = \mathbf{I}_n + \rho \mathbf{W} + \rho^2 \mathbf{W}^2 + \rho^3 \mathbf{W}^3 + \cdots,
\]</span></p>
<p>revela que um choque exógeno (seja via <span class="math inline">\(\mathbf{X}\)</span> ou <span class="math inline">\(\boldsymbol{\epsilon}\)</span>) em uma unidade <span class="math inline">\(i\)</span> não afeta apenas <span class="math inline">\(y_i\)</span> ou seus vizinhos diretos, mas propaga-se por toda a rede através de efeitos de <em>feedback</em> de ordem superior, envolvendo caminhos de comprimento crescente na estrutura de vizinhança <span class="citation" data-cites="elhorst2014spatial">(<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">Elhorst et al. 2014</a>)</span>.</p>
<p>Consequentemente, a esperança condicional da variável dependente é espacialmente estruturada:</p>
<p><span class="math display">\[
\mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}] = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta}.
\]</span> A presença do multiplicador espacial implica que a interpretação dos parâmetros <span class="math inline">\(\boldsymbol{\beta}\)</span> no modelo SAR difere fundamentalmente da regressão linear clássica. Estes coeficientes não representam os efeitos marginais diretos de uma mudança nas variáveis explicativas. Como qualquer alteração em uma covariável para a unidade <span class="math inline">\(i\)</span> afeta sua própria variável dependente e, via interdependência, as das demais unidades, os efeitos são globais.</p>
<p><span class="citation" data-cites="lesage2009introduction">J. LeSage e Pace (<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">2009</a>)</span> propõe uma decomposição da matriz de efeitos totais das variáveis explicativas, derivada da forma reduzida do modelo. Para uma variável explicativa <span class="math inline">\(k\)</span>, o efeito total de uma mudança unitária em todo o sistema é dado pela matriz:</p>
<p><span class="math display">\[
\frac{\partial \mathbf{y}}{\partial \mathbf{x}_k'} = \beta_k (\mathbf{I}_n - \rho \mathbf{W})^{-1}.
\]</span></p>
<p>Os efeitos são então decompostos em:</p>
<ul>
<li><p>Efeito direto médio que captura o impacto médio de uma mudança em <span class="math inline">\(x_{ik}\)</span> sobre o próprio <span class="math inline">\(y_i\)</span>. Este efeito inclui tanto o impacto inicial quanto os <em>feedbacks</em> espaciais que retornam à unidade de origem.</p></li>
<li><p>Efeito indireto médio (ou <em>Spillover</em>) que captura o impacto médio da mudança em <span class="math inline">\(x_{ik}\)</span> sobre todas as outras unidades <span class="math inline">\(y_j\)</span> (<span class="math inline">\(j \neq i\)</span>).</p></li>
</ul>
<p>A presença da variável dependente defasada espacialmente (<span class="math inline">\(\mathbf{W}\mathbf{y}\)</span>) no lado direito da equação gera um problema de simultaneidade: como <span class="math inline">\(y_i\)</span> depende de <span class="math inline">\(y_j\)</span> e vice-versa, o termo <span class="math inline">\(\mathbf{W}\mathbf{y}\)</span> está correlacionado com o termo de erro <span class="math inline">\(\boldsymbol{\epsilon}\)</span>. Isto implica que o estimador de Mínimos Quadrados Ordinários (MQO) é viesado e inconsistente (<span class="math inline">\(plim \, \hat{\rho}_{MQO} \neq \rho\)</span>), tendendo a superestimar a dependência espacial e enviesar os coeficientes <span class="math inline">\(\boldsymbol{\beta}\)</span> <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p>
<p>As abordagens mais comuns para a estimação consistente e eficiente são:</p>
<ol type="1">
<li><p>máxima verossimilhança: Maximiza a função de verossimilhança que incorpora o log-determinante do Jacobiano da transformação, <span class="math inline">\(\ln|\mathbf{I}_n - \rho \mathbf{W}|\)</span>, para corrigir a simultaneidade.</p></li>
<li><p>Método dos Momentos Generalizados (GMM) / Variáveis Instrumentais (VI): Utiliza defasagens espaciais das covariáveis (<span class="math inline">\(\mathbf{W}\mathbf{X}, \mathbf{W}^2\mathbf{X}, \dots\)</span>) como instrumentos válidos para <span class="math inline">\(\mathbf{W}\mathbf{y}\)</span>, uma estratégia robusta proposta por <span class="citation" data-cites="kelejian1998generalized">(<a href="references.html#ref-kelejian1998generalized" role="doc-biblioref">H. H. Kelejian e Prucha 1998</a>)</span> .</p></li>
</ol>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, texreg, knitr, kableExtra, dplyr)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparação dos Dados</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de Pesos Espaciais (Padronizada por linha 'W' é o padrão para SAR)</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuste do Modelo</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co"># A) OLS (Referência)</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>mod_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co"># SAR (Spatial Autoregressive Model) - Máxima Verossimilhança</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co"># A função lagsarlm ajusta do modelo SAR via ML</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>mod_sar <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(taxa_bruta <span class="sc">~</span> variavel_x, </span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> mg_dados, </span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">listw =</span> lw)</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>mapa_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span> <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>  <span class="ot">=</span> <span class="st">"Variável X"</span>,</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>         <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$ (Dependência Espacial)"</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>mapa_gof <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"N"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st"> R^2$"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"aic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"AIC"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"logLik"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Log Likelihood"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Gerar a Tabela Principal</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"OLS (Clássico)"</span> <span class="ot">=</span> mod_ols, <span class="st">"SAR (Lag Espacial)"</span> <span class="ot">=</span> mod_sar),</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> mapa_vars,      </span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> mapa_gof,      </span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate=</span><span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">'**'</span> <span class="ot">=</span> .<span class="dv">01</span>, <span class="st">'***'</span> <span class="ot">=</span> .<span class="dv">001</span>),</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>, </span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"kableExtra"</span>, </span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">5</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sar_estimacao" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sar_estimacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.4: Resultados da Estimação do Modelo SAR e Decomposição dos Efeitos. Estimativas [intervalo de confiança] e abaixo o respetivo erro padrão.
</figcaption>
<div aria-describedby="tbl-sar_estimacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS (Clássico)
</th>
<th style="text-align:center;">
SAR (Lag Espacial)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercepto
</td>
<td style="text-align:center;">
8.973 [8.616, 9.330]
</td>
<td style="text-align:center;">
5.751 [4.876, 6.626]
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.182)
</td>
<td style="text-align:center;">
(0.446)
</td>
</tr>
<tr>
<td style="text-align:left;">
Variável X
</td>
<td style="text-align:center;">
0.058 [−0.306, 0.422]
</td>
<td style="text-align:center;">
0.029 [−0.316, 0.374]
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.185)
</td>
<td style="text-align:center;">
(0.176)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
<span class="math inline">\(\rho\)</span> (Dependência Espacial)
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
0.359 [0.269, 0.449]
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
(0.046)
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\ R^2\)</span>
</td>
<td style="text-align:center;">
0.000
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
5275.0
</td>
<td style="text-align:center;">
5212.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Log Likelihood
</td>
<td style="text-align:center;">
−2634.5
</td>
<td style="text-align:center;">
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
</div>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>A <a href="#tbl-sar_estimacao" class="quarto-xref">Tabela&nbsp;<span>4.4</span></a> para a comparação de modelos evidencia a superioridade de ajuste do modelo de SAR em detrimento do linear (OLS), como observa-se pela redução substancial no Critério de Informação de Akaike (AIC), que decresceu de <span class="math inline">\(5275.0\)</span> no modelo clássico para <span class="math inline">\(5212.9\)</span> na especificação espacial. Este ganho de ajuste é atribuído à significância do parâmetro de autoregressão espacial <span class="math inline">\(\rho\)</span> (<span class="math inline">\(0.359\)</span>; <span class="math inline">\(IC_{95\%} [0.269, 0.449]\)</span>), que confirma a existência de dependência espacial positiva na variável resposta.</p>
<p>Não obstante a melhor adequação da estrutura espacial, a <a href="#tbl-sar_estimacao" class="quarto-xref">Tabela&nbsp;<span>4.4</span></a> de decomposição dos impactos demonstra que a covariável <span class="math inline">\(X\)</span> não possui significância estatística. A análise dos efeitos marginais revela que a variável explicativa não exerce influência sobre o desfecho, apresentando valores-p não significativos tanto para o efeito direto (<span class="math inline">\(0.030\)</span>; <span class="math inline">\(p=0.829\)</span>), que mensura o impacto local, quanto para o efeito indireto (<span class="math inline">\(0.015\)</span>; <span class="math inline">\(p=0.837\)</span>), que mensura o transbordamento espacial. Conclui-se, portanto, que embora a modelagem da dependência espacial seja necessária para a correção do viés de especificação, a variável <span class="math inline">\(X\)</span> não é um determinante estatisticamente relevante do fenômeno estudado, apresentando um efeito total nulo (<span class="math inline">\(0.045\)</span>; <span class="math inline">\(p=0.831\)</span>).</p>
<p>Você poderia gerar formatação em latex e colar no seu <a href="https://en.wikipedia.org/wiki/Overleaf">overleaf</a> ou latex.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">texreg</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(mod_ols, mod_sar),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">custom.model.names =</span> <span class="fu">c</span>(<span class="st">"OLS (Clássico)"</span>, <span class="st">"SAR (Lag Espacial)"</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">custom.coef.names =</span> <span class="fu">c</span>(<span class="st">"Intercepto"</span>, <span class="st">"Variável X"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$ (Autocorrelação)"</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparação de Modelos: OLS vs SAR"</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dcolumn =</span> <span class="cn">TRUE</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sar_latex" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-sar_latex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.5
</figcaption>
<div aria-describedby="tbl-sar_latex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
</figure>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, ggplot2, dplyr, tidyr, patchwork, viridis, Matrix)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mod_sar"</span>) <span class="sc">||</span> <span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  mod_sar <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de Impactos (Direto vs Indireto Unificado)</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>imp_mc_plot <span class="ot">&lt;-</span> <span class="fu">impacts</span>(mod_sar, <span class="at">listw =</span> lw, <span class="at">R =</span> <span class="dv">1000</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(imp_mc_plot<span class="sc">$</span>smat) <span class="sc">&amp;&amp;</span> <span class="fu">is.null</span>(imp_mc_plot<span class="sc">$</span>res)) {</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>   imp_mc_plot <span class="ot">&lt;-</span> <span class="fu">impacts</span>(mod_sar, <span class="at">listw =</span> lw, <span class="at">R =</span> <span class="dv">1000</span>, <span class="at">zstats =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe Direto e Indireto</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>df_impactos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">direct =</span> imp_mc_plot<span class="sc">$</span>res<span class="sc">$</span>direct,</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">indirect =</span> imp_mc_plot<span class="sc">$</span>res<span class="sc">$</span>indirect</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Tipo"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tipo =</span> <span class="fu">factor</span>(Tipo, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>),</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Direto"</span>, <span class="st">"Indireto (Spillover)"</span>)))</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>g_impactos <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_impactos, <span class="fu">aes</span>(<span class="at">x =</span> Tipo, <span class="at">fill =</span> Tipo, <span class="at">y=</span>Valor)) <span class="sc">+</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"gray30"</span>) <span class="sc">+</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Direto"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>, <span class="st">"Indireto (Spillover)"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>)) <span class="sc">+</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Impactos: Direto vs. Indireto"</span>, </span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Magnitude do efeito"</span>, <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa dos Valores Ajustados</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>fitted_sar <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_sar)</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>g_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fitted_sar), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Valores Preditos (SAR)"</span>, </span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Padrão espacial recuperado"</span>)<span class="sc">+</span></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,           </span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,          </span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>       </span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,           </span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,      </span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),   </span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnóstico dos Resíduos</span></span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_sar <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_sar)</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>moran_res <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_sar, lw)</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_lag <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>resid_sar)</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>g_resid_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> resid_sar, <span class="at">y =</span> resid_lag)) <span class="sc">+</span></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Scatter de Moran (Resíduos)"</span>, </span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_res<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" (p-valor: "</span>, <span class="fu">round</span>(moran_res<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial"</span>) <span class="sc">+</span></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>(g_impactos <span class="sc">|</span> g_fit <span class="sc">|</span> g_resid_scatter)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sar-diagnostico-comparativo" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sar-diagnostico-comparativo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sar-diagnostico-comparativo-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sar-diagnostico-comparativo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.12: Diagnóstico SAR: (A) Comparação Direto vs Indireto, (B) Ajuste do Modelo e (C) Análise de Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>O mapa de valores preditos em <a href="#fig-sar-diagnostico-comparativo" class="quarto-xref">Figura&nbsp;<span>4.12</span></a> (B) mostra que o modelo foi capaz de recuperar a estrutura espacial do processo, reproduzindo a heterogeneidade regional e os padrões de aglomeração observados na variável dependente, uma contribuição atribuível quase exclusivamente ao termo de autoregressão espacial (<span class="math inline">\(\rho\)</span>) dada a nulidade da covariável <span class="math inline">\(X\)</span>. A validade dessa especificação é confirmada na <a href="#fig-sar-diagnostico-comparativo" class="quarto-xref">Figura&nbsp;<span>4.12</span></a> (C), onde o grafico de dispersão para os resíduos de Moran não mostra nenhuma tendência. A estatística de Moran (<span class="math inline">\(I = -0.015\)</span>) com valor-p não significativo (<span class="math inline">\(0.735\)</span>) atesta a independência espacial dos resíduos.</p>
</section>
<section id="modelo-de-erro-espacial-sem---spatial-error-model" class="level3" data-number="4.13.2">
<h3 data-number="4.13.2" class="anchored" data-anchor-id="modelo-de-erro-espacial-sem---spatial-error-model"><span class="header-section-number">4.13.2</span> Modelo de Erro Espacial (SEM - <em>Spatial Error Model</em>)</h3>
<p>O Modelo de Erro Espacial (SEM) é um caso particular do Modelo Espacial Geral (GNS, <a href="#eq-GNS" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a>) obtido ao se impor as restrições paramétricas <span class="math inline">\(\rho = 0\)</span> e <span class="math inline">\(\boldsymbol{\theta} = \mathbf{0}\)</span>. Esta especificação pressupõe a ausência de interações espaciais diretas tanto na variável dependente quanto nas variáveis explicativas, concentrando toda a estrutura de dependência espacial no termo de erro estocástico. Formalmente, o modelo é definido pelo sistema de equações <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>:</p>
<p><span id="eq-SEM"><span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{u}, \qquad
\mathbf{u} = \lambda \mathbf{W}\mathbf{u} + \boldsymbol{\epsilon},
\tag{4.6}\]</span></span></p>
<p>com inovações i.i.d. <span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span>. A distribuição condicional de <span class="math inline">\(\mathbf{y}\)</span> é, portanto, uma normal multivariada:</p>
<p><span class="math display">\[
\mathbf{y} \, | \, \mathbf{X}, \mathbf{W} \sim \mathcal{N}\left( \mathbf{X}\boldsymbol{\beta}, \;
\sigma^2 (\mathbf{I}_n - \lambda \mathbf{W})^{-1} (\mathbf{I}_n - \lambda \mathbf{W})^{-\top} \right).
\]</span></p>
<p>Na forma escalar, para uma unidade de observação <span class="math inline">\(i\)</span>, o modelo se expressa como:</p>
<p><span class="math display">\[
y_i = \sum_{k=1}^K x_{ik}\beta_k + u_i, \qquad
u_i = \lambda \sum_{j=1}^N w_{ij} u_j + \epsilon_i, \qquad
\epsilon_i \sim \mathcal{N}(0, \sigma^2).
\]</span></p>
<p>Conforme destacado por <span class="citation" data-cites="lesage2009introduction">J. LeSage e Pace (<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">2009</a>)</span>, a utilidade do SEM reside no tratamento da dependência espacial como um fenômeno residual, frequentemente resultante de variáveis omitidas com padrão espacial ou de erros de medição decorrentes de delimitações administrativas arbitrárias que não coincidem com os verdadeiros limites econômicos. Diferentemente dos modelos SAR (<a href="#eq-SAR" class="quarto-xref">Eq.&nbsp;<span>4.5</span></a>) e SDM (<a href="#eq-SDM" class="quarto-xref">Eq.&nbsp;<span>4.8</span></a>), que capturam interações espaciais substantivas, a estrutura do SEM implica que a dependência espacial é um ruído a ser controlado para inferência válida.</p>
<p>A forma reduzida do processo gerador de dados é obtida substituindo a equação do erro na equação principal:</p>
<p><span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + (\mathbf{I}_n - \lambda \mathbf{W})^{-1}\boldsymbol{\epsilon},
\]</span></p>
<p>o que revela que erros (choques) aleatórios <span class="math inline">\(\boldsymbol{\epsilon}\)</span> propagam-se globalmente através do multiplicador espacial inverso <span class="math inline">\((\mathbf{I}_n - \lambda \mathbf{W})^{-1}\)</span> (desde que este exista). Contudo, a esperança condicional da variável dependente mantém-se não espacial:</p>
<p><span class="math display">\[
\mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}] = \mathbf{X}\boldsymbol{\beta}.
\]</span></p>
<p>No SEM, os coeficientes <span class="math inline">\(\boldsymbol{\beta}\)</span> representam derivadas parciais verdadeiras, isto é, os efeitos marginais diretos das variáveis explicativas. Uma variação em <span class="math inline">\(x_{ik}\)</span> afeta apenas <span class="math inline">\(y_i\)</span>, sem desencadear <em>feedback</em> ou <em>spillovers</em> espaciais na média das unidades vizinhas <span class="citation" data-cites="elhorst2014spatial">(<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">Elhorst et al. 2014</a>)</span>.</p>
<p>Do ponto de vista da estimação, a imposição incorreta de <span class="math inline">\(\lambda = 0\)</span> e o uso de Mínimos Quadrados Ordinários (MQO) não comprometem a consistência dos estimadores pontuais de <span class="math inline">\(\boldsymbol{\beta}\)</span>, uma vez que a média dos erros permanece zero e ortogonal aos regressores. No entanto, essa estratégia produz estimadores ineficientes e, mais criticamente, enviesa a estimação da matriz de covariância dos parâmetros, invalidando a inferência baseada em testes <span class="math inline">\(t\)</span> e <span class="math inline">\(F\)</span> padrão <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p>
<p>A estimação eficiente exige métodos que incorporem explicitamente a estrutura não esférica da matriz de covariância dos erros:</p>
<p><span class="math display">\[
\operatorname{Cov}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}] = \boldsymbol{\Omega} =
\sigma^2 \left[ (\mathbf{I}_n - \lambda \mathbf{W})^{\top} (\mathbf{I}_n - \lambda \mathbf{W}) \right]^{-1}.
\]</span></p>
<p>As abordagens usuais para obter estimadores consistentes e eficientes são a máxima verossimilhança e o Método dos Momentos Generalizados (GMM), que permitem a recuperação adequada dos erros-padrão e a realização de inferência válida <span class="citation" data-cites="kelejian2010specification">(<a href="references.html#ref-kelejian2010specification" role="doc-biblioref">H. H. Kelejian e Prucha 2010</a>)</span>.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, modelsummary, kableExtra, dplyr)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># SEM (Spatial Error Model)</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A função errorsarlm ajusta o SEM via Máxima Verossimilhança</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>mod_sem <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabela </span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>mapa_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span> <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>  <span class="ot">=</span> <span class="st">"Variável X"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>         <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$ (Lag Espacial)"</span>,  <span class="co"># Parâmetro do SAR</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lambda"</span>      <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$ (Erro Espacial)"</span> <span class="co"># Parâmetro do SEM</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>mapa_gof <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"N"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"$R^2$"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"aic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"AIC"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"logLik"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Log Likelihood"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Gerar a Tabela Comparativa (OLS, SAR, SEM)</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OLS (Clássico)"</span> <span class="ot">=</span> mod_ols, </span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAR"</span> <span class="ot">=</span> mod_sar, </span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SEM"</span> <span class="ot">=</span> mod_sem</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> mapa_vars,      </span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> mapa_gof,      </span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">'**'</span> <span class="ot">=</span> .<span class="dv">01</span>, <span class="st">'***'</span> <span class="ot">=</span> .<span class="dv">001</span>),</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,     </span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"kableExtra"</span>, </span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span>  </span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sem_comparacao" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sem_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.6: Resultados da Estimação: Comparação OLS, SAR e SEM. Estimativas [intervalo de confiança 95%].
</figcaption>
<div aria-describedby="tbl-sem_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS (Clássico)
</th>
<th style="text-align:center;">
SAR
</th>
<th style="text-align:center;">
SEM
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercepto
</td>
<td style="text-align:center;">
8.973 [8.616, 9.330]
</td>
<td style="text-align:center;">
5.751 [4.876, 6.626]
</td>
<td style="text-align:center;">
8.978 [8.449, 9.507]
</td>
</tr>
<tr>
<td style="text-align:left;">
Variável X
</td>
<td style="text-align:center;">
0.058 [−0.306, 0.422]
</td>
<td style="text-align:center;">
0.029 [−0.316, 0.374]
</td>
<td style="text-align:center;">
−0.001 [−0.342, 0.340]
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\rho\)</span> (Lag Espacial)
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.269, 0.449]
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5px">
<span class="math inline">\(\lambda\)</span> (Erro Espacial)
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
0.359 [0.270, 0.449]
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
N
</td>
<td style="text-align:center;font-weight: bold;">
853
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(R^2\)</span>
</td>
<td style="text-align:center;">
0.000
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
AIC
</td>
<td style="text-align:center;font-weight: bold;">
5275.0
</td>
<td style="text-align:center;font-weight: bold;">
5212.9
</td>
<td style="text-align:center;font-weight: bold;">
5213.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Log Likelihood
</td>
<td style="text-align:center;">
−2634.5
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
</div>
</figure>
</div>
<p><strong>Interprete</strong></p>
<p>A <a href="#tbl-sem_comparacao" class="quarto-xref">Tabela&nbsp;<span>4.6</span></a> apresenta a análise comparativa entre os modelos de regressão linear (OLS), de defasagem espacial (SAR) e de erro espacial (SEM), evidenciando a superioridade de ajuste das especificações espaciais sobre a abordagem clássica. Observa-se uma melhoria substancial na qualidade do ajuste ao incorporar a dependência espacial, demonstrada pela redução do Critério de Informação de Akaike (AIC), que declinou de <span class="math inline">\(5275.0\)</span> no OLS para valores idênticos de <span class="math inline">\(5212.9\)</span> no SAR e <span class="math inline">\(5213.0\)</span> no SEM. Essa equivalência entre os modelos espaciais é reforçada pela magnitude dos parâmetros estimados: tanto o coeficiente de defasagem espacial <span class="math inline">\(\rho\)</span> (<span class="math inline">\(0.359\)</span>; <span class="math inline">\(IC_{95\%} [0.269, 0.449]\)</span>) quanto o coeficiente de erro espacial <span class="math inline">\(\lambda\)</span> (<span class="math inline">\(0.359\)</span>; <span class="math inline">\(IC_{95\%} [0.270, 0.449]\)</span>) são estatisticamente significativos e apresentam estimativas pontuais coincidentes, indicando que a estrutura de autocorrelação independentemente da especificação funcional adotada. Adicionalmente, no modelo SEM o coeficiente estimado permaneceu estatisticamente nulo (<span class="math inline">\(-0.001\)</span>; <span class="math inline">\(IC_{95\%} [-0.342, 0.340]\)</span>), confirmando que a variabilidade do fenômeno é explicada predominantemente pela estrutura de dependência espacial e não pela variável preditora <span class="math inline">\(X\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, ggplot2, dplyr, tidyr, patchwork, viridis, Matrix, ggspatial)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mod_sem"</span>) <span class="sc">||</span> <span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  mod_sem <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa dos Valores Ajustados </span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>fitted_sem <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_sem)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>g_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fitted_sem), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Valores Preditos (SEM)"</span>, </span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Padrão recuperado (Erro Corrigido)"</span>) <span class="sc">+</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"bl"</span>,            </span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,           </span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>), </span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_family =</span> <span class="st">"sans"</span>        </span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"tl"</span>,            </span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_north =</span> <span class="st">"true"</span>,       </span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),    </span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),    </span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> north_arrow_fancy_orienteering </span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnóstico dos Resíduos</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_sem <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_sem)</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>moran_res <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_sem, lw)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_lag_sem <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>resid_sem)</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>g_resid_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> resid_sem, <span class="at">y =</span> resid_lag_sem)) <span class="sc">+</span></span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Scatter de Moran (Resíduos SEM)"</span>, </span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_res<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" (p-valor: "</span>, <span class="fu">round</span>(moran_res<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial"</span>) <span class="sc">+</span></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>(g_fit <span class="sc">|</span> g_resid_scatter)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sem-diagnostico-comparativo" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sem-diagnostico-comparativo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sem-diagnostico-comparativo-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sem-diagnostico-comparativo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.13: Diagnóstico SEM: (A) Ajuste do Modelo e (B) Análise de Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>O mapeamento dos valores preditos em <a href="#fig-sem-diagnostico-comparativo" class="quarto-xref">Figura&nbsp;<span>4.13</span></a> (A) demonstra a capacidade do modelo em capturar a variabilidade espacial latente, reproduzindo os gradientes regionais distintivos do fenômeno através da correção via termo <span class="math inline">\(\lambda\)</span>. A robustez desta especificação é atestada em <a href="#fig-sem-diagnostico-comparativo" class="quarto-xref">Figura&nbsp;<span>4.13</span></a> (B), onde a distribuição dos resíduos de Moran mostra ausência de associação espacial, evidenciada pela inclinação nula da reta de regressão e dispersão isotrópica. A estatística de I de Moran (<span class="math inline">\(-0.014\)</span>) associada a um valor-p não significativo (<span class="math inline">\(0.734\)</span>) confirma que a autocorrelação espacial foi integralmente absorvida pela estrutura de erro especificada, garantindo que os resíduos remanescentes se comportem como ruído branco estocástico.</p>
</section>
<section id="modelo-de-defasagem-espacial-de-x-slx-spatial-lag-of-x" class="level3" data-number="4.13.3">
<h3 data-number="4.13.3" class="anchored" data-anchor-id="modelo-de-defasagem-espacial-de-x-slx-spatial-lag-of-x"><span class="header-section-number">4.13.3</span> Modelo de Defasagem Espacial de X (SLX – <em>Spatial Lag of X</em>)</h3>
<p>O Modelo de Defasagem Espacial de X (SLX) representa a especificação mais parcimoniosa para incorporação de efeitos de interação espacial. Diferentemente dos modelos SAR (<a href="#eq-SAR" class="quarto-xref">Eq.&nbsp;<span>4.5</span></a>) e SEM (<a href="#eq-SEM" class="quarto-xref">Eq.&nbsp;<span>4.6</span></a>), que modelam a dependência através da variável resposta ou do termo de erro, o SLX postula que o resultado de uma unidade é influenciado tanto por suas características próprias quanto pelas características observáveis de suas unidades vizinhas.</p>
<p>Na taxonomia do Modelo Geral Espacial (GNS, <a href="#eq-GNS" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a>), o SLX é obtido ao impor as restrições paramétricas <span class="math inline">\(\rho = 0\)</span> e <span class="math inline">\(\lambda = 0\)</span>. O modelo é especificado pela equação estrutural:</p>
<p><span id="eq-SLX"><span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{W}\mathbf{X}\boldsymbol{\theta} + \boldsymbol{\epsilon},
\tag{4.7}\]</span></span></p>
<p>com erros independentes e identicamente distribuídos (i.i.d.) <span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span>.</p>
<p>Para uma unidade de observação <span class="math inline">\(i\)</span>, o modelo expressa-se como:</p>
<p><span class="math display">\[
y_i = \alpha + \sum_{k=1}^K x_{ik}\beta_k + \sum_{k=1}^K \theta_k \left( \sum_{j=1}^n w_{ij} x_{jk} \right) + \epsilon_i.
\]</span></p>
<p>onde: - <span class="math inline">\(\mathbf{W}\mathbf{X}\)</span> denota a matriz de defasagens espaciais das variáveis explicativas, capturando o contexto espacial das covariáveis.</p>
<ul>
<li><p><span class="math inline">\(\boldsymbol{\beta} \in \mathbb{R}^{K}\)</span> é o vetor de parâmetros associado aos efeitos diretos das características da própria unidade <span class="math inline">\(i\)</span>.</p></li>
<li><p><span class="math inline">\(\boldsymbol{\theta} \in \mathbb{R}^{K}\)</span> é o vetor de parâmetros associado aos efeitos de transbordamento exógenos (<em>spillovers</em>), capturando a influência das características das unidades vizinhas.</p></li>
</ul>
<p><span class="citation" data-cites="halleck2015slx">Halleck Vega e Elhorst (<a href="references.html#ref-halleck2015slx" role="doc-biblioref">2015</a>)</span>, posiciona o SLX como um modelo de referência inicial para modelagem de dados espaciais (o primeiro a ser testado antes de ir aos mais complexos). Sua justificativa teórica reside na modelagem de <a href="https://pt.wikipedia.org/wiki/Efeito_transbordamento">transbordamentos locais</a> (ou de primeira ordem), em contraste com a dependência global induzida pelo multiplicador espacial <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span> do modelo SAR (<a href="#eq-SAR" class="quarto-xref">Eq.&nbsp;<span>4.5</span></a>) <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p>
<p>A derivada parcial da esperança condicional <span class="math inline">\(\mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}]\)</span> em relação à <span class="math inline">\(k\)</span>-ésima variável explicativa revela uma separação clara dos efeitos:</p>
<p><span class="math display">\[
\frac{\partial \, \mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}]}{\partial \, \mathbf{x}_k'} = \beta_k \mathbf{I}_n + \theta_k \mathbf{W}.
\]</span></p>
<p>Esta expressão implica:</p>
<ol type="1">
<li><p>Efeito Direto: <span class="math inline">\(\frac{\partial y_i}{\partial x_{ik}} = \beta_k\)</span>. Uma mudança em <span class="math inline">\(x_{ik}\)</span> afeta <span class="math inline">\(y_i\)</span> diretamente, sem mecanismos de <a href="https://pt.wikipedia.org/wiki/Retroalimenta%C3%A7%C3%A3o">retroalimentação</a> (<em>feedback</em>).</p></li>
<li><p>Efeito Indireto (Spillover Local): <span class="math inline">\(\frac{\partial y_i}{\partial x_{jk}} = \theta_k w_{ij}\)</span>. O impacto de uma mudança na unidade vizinha <span class="math inline">\(j\)</span> sobre <span class="math inline">\(y_i\)</span> é proporcional ao peso espacial <span class="math inline">\(w_{ij}\)</span> e ao parâmetro <span class="math inline">\(\theta_k\)</span>. Se <span class="math inline">\(w_{ij} = 0\)</span>, o efeito é nulo, caracterizando a localidade do transbordamento.</p></li>
</ol>
<p>Uma limitação crítica dos modelos de dependência global, como o SAR, é que a razão entre efeitos indiretos e diretos é determinada unicamente pelo parâmetro <span class="math inline">\(\rho\)</span>, sendo idêntica para todas as variáveis explicativas. O modelo SLX supera esta restrição, permitindo que a magnitude e até o sinal dos efeitos de transbordamento (<span class="math inline">\(\theta_k\)</span>) sejam estimados livremente para cada covariável <span class="math inline">\(k\)</span>. Esta flexibilidade permite testar hipóteses substantivas complexas, como a coexistência de externalidades positivas para uma variável e negativas para outra.</p>
<p>Sob os pressupostos clássicos de linearidade, exogeneidade de <span class="math inline">\(\mathbf{X}\)</span> e <span class="math inline">\(\mathbf{W}\mathbf{X}\)</span>, e erros esféricos, o modelo SLX apresenta propriedades estatísticas desejáveis:</p>
<ol type="1">
<li><p>Dado que todas as variáveis do lado direito da equação (<span class="math inline">\(\mathbf{X}\)</span> e <span class="math inline">\(\mathbf{W}\mathbf{X}\)</span>) são <a href="https://pt.wikipedia.org/wiki/Vari%C3%A1veis_ex%C3%B3genas_e_end%C3%B3genas">exógenas</a>, o estimador MQO de <span class="math inline">\(\boldsymbol{\beta}\)</span> e <span class="math inline">\(\boldsymbol{\theta}\)</span> é não viesado, consistente e eficiente (sob homocedasticidade). Esta é uma vantagem operacional, dispensando métodos computacionalmente intensivos como máxima verossimilhança (ML) <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p></li>
<li><p>O modelo SLX minimiza problemas de multicolinearidade severa que podem surgir em modelos mais gerais (como o SDM ou GNS) devido à alta correlação entre <span class="math inline">\(\mathbf{W}\mathbf{y}\)</span> e <span class="math inline">\(\mathbf{W}\mathbf{X}\)</span>.</p></li>
<li><p>Conforme descrito por <span class="citation" data-cites="halleck2015slx">Halleck Vega e Elhorst (<a href="references.html#ref-halleck2015slx" role="doc-biblioref">2015</a>)</span>, a estrutura do SLX simplifica o tratamento estatístico da possível <a href="https://www.reddit.com/r/econometrics/comments/dpsi3k/what_is_endogeneity/?tl=pt-br">endogeneidade</a> das variáveis explicativas <span class="math inline">\(\mathbf{X}\)</span>. Métodos padrão de Variáveis Instrumentais (VI) ou Mínimos Quadrados em Dois Estágios (MQ2E) podem ser aplicados diretamente para instrumentar <span class="math inline">\(\mathbf{X}\)</span> e <span class="math inline">\(\mathbf{W}\mathbf{X}\)</span>, sem a complexidade adicional introduzida pela endogeneidade de <span class="math inline">\(\mathbf{W}\mathbf{y}\)</span> em modelos SAR.</p></li>
<li><p>A simplicidade da função objetivo (soma de quadrados dos resíduos) no SLX permite a estimação conjunta dos parâmetros do modelo (<span class="math inline">\(\boldsymbol{\beta}, \boldsymbol{\theta}\)</span>) e de parâmetros que definem a matriz de pesos espaciais <span class="math inline">\(\mathbf{W}\)</span>. Por exemplo, pode-se especificar <span class="math inline">\(w_{ij} = d_{ij}^{-\gamma}\)</span> e estimar o parâmetro de decaimento <span class="math inline">\(\gamma\)</span> via Mínimos Quadrados Não Lineares (NLS), permitindo que a estrutura de interação espacial seja inferida diretamente dos dados.</p></li>
</ol>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, modelsummary, kableExtra, dplyr, ggplot2, patchwork, viridis)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># SLX (Spatial Lag of X)</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lmSLX cria automaticamente as defasagens (lag.variavel_x)</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>mod_slx <span class="ot">&lt;-</span> <span class="fu">lmSLX</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>mapa_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span>    <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>     <span class="ot">=</span> <span class="st">"Variável X (Direto)"</span>,</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lag.variavel_x"</span> <span class="ot">=</span> <span class="st">"WX $</span><span class="sc">\\</span><span class="st">theta$"</span>, <span class="co"># SLX</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>            <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$ (Lag Espacial)"</span>,       <span class="co"># SAR</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lambda"</span>         <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$ (Erro Espacial)"</span>    <span class="co"># SEM</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>mapa_gof <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"N"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st"> R^2$"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"aic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"AIC"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"logLik"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Log Likelihood"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OLS"</span> <span class="ot">=</span> mod_ols, </span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SLX"</span> <span class="ot">=</span> mod_slx,</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAR"</span> <span class="ot">=</span> mod_sar, </span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SEM"</span> <span class="ot">=</span> mod_sem</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> mapa_vars,      </span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> mapa_gof,      </span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">'**'</span> <span class="ot">=</span> .<span class="dv">01</span>, <span class="st">'***'</span> <span class="ot">=</span> .<span class="dv">001</span>),</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,     </span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span> </span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-slx_comparacao" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-slx_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.7: Resultados da Estimação: Comparação OLS, SLX, SAR e SEM. Estimativas [intervalo de confiança 95%].
</figcaption>
<div aria-describedby="tbl-slx_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS
</th>
<th style="text-align:center;">
&nbsp;SLX
</th>
<th style="text-align:center;">
SAR
</th>
<th style="text-align:center;">
SEM
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercepto
</td>
<td style="text-align:center;">
8.973 [8.616, 9.330]
</td>
<td style="text-align:center;">
8.970 [8.613, 9.327]
</td>
<td style="text-align:center;">
5.751 [4.876, 6.626]
</td>
<td style="text-align:center;">
8.978 [8.449, 9.507]
</td>
</tr>
<tr>
<td style="text-align:left;">
Variável X (Direto)
</td>
<td style="text-align:center;">
0.058 [−0.306, 0.422]
</td>
<td style="text-align:center;">
0.056 [−0.308, 0.420]
</td>
<td style="text-align:center;">
0.029 [−0.316, 0.374]
</td>
<td style="text-align:center;">
−0.001 [−0.342, 0.340]
</td>
</tr>
<tr>
<td style="text-align:left;">
WX <span class="math inline">\(\theta\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.397 [−0.396, 1.190]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\rho\)</span> (Lag Espacial)
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.269, 0.449]
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5pxfont-weight: bold;">
<span class="math inline">\(\lambda\)</span> (Erro Espacial)
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.359 [0.270, 0.449]
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
<span class="math inline">\(\ R^2\)</span>
</td>
<td style="text-align:center;font-weight: bold;">
0.000
</td>
<td style="text-align:center;font-weight: bold;">
0.001
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
5275.0
</td>
<td style="text-align:center;">
5276.1
</td>
<td style="text-align:center;">
5212.9
</td>
<td style="text-align:center;">
5213.0
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Log Likelihood
</td>
<td style="text-align:center;font-weight: bold;">
−2634.5
</td>
<td style="text-align:center;font-weight: bold;">
−2634.0
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
</div>
</figure>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo coeficientes e intervalos de confiança do SLX</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod_slx)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>cis   <span class="ot">&lt;-</span> <span class="fu">confint</span>(mod_slx)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa dos Valores Ajustados</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>fitted_slx <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_slx)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>g_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fitted_slx), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Valores Preditos (SLX)"</span>, </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Ajuste com defasagens de X"</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">style =</span> north_arrow_fancy_orienteering,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"in"</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"in"</span>))</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnóstico dos Resíduos (Scatter de Moran)</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_slx <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_slx)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>moran_slx <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_slx, lw)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_lag_slx <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>resid_slx)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>g_resid_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> resid_slx, <span class="at">y =</span> resid_lag_slx)) <span class="sc">+</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Scatter de Moran (Resíduos SLX)"</span>, </span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_slx<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" (p-valor: "</span>, <span class="fu">round</span>(moran_slx<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial"</span>) <span class="sc">+</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>( g_fit <span class="sc">|</span> g_resid_scatter)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-slx-diagnostico-visual" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-slx-diagnostico-visual-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-slx-diagnostico-visual-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-slx-diagnostico-visual-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.14: Diagnóstico SLX: (A) Ajuste do Modelo e (B) Análise de Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpretação</strong></p>
<p>Ao contrário dos modelos globais (SAR e SEM), o mapa de valores preditos em <a href="#fig-slx-diagnostico-visual" class="quarto-xref">Figura&nbsp;<span>4.14</span></a> (A) exibe uma superfície de predição com variabilidade atenuada, falhando em reproduzir a heterogeneidade e os clusters de valores altos observados nos dados originais. A inadequação do ajuste é demonstrada definitivamente em <a href="#fig-slx-diagnostico-visual" class="quarto-xref">Figura&nbsp;<span>4.14</span></a> (C), onde o Scatter de Moran dos resíduos mostra tendência linear positiva, indicando que o modelo não foi capaz de capturar a estrutura espacial dos dados. A estatística de I de Moran (<span class="math inline">\(I = 0.198\)</span>) com valor-p significativo (<span class="math inline">\(p \approx 0\)</span>) confirma a persistência de autocorrelação espacial positiva nos erros, violando o pressuposto de independência estocástica e evidenciando que a simples inclusão de defasagens exógenas de <span class="math inline">\(X\)</span> é ineficaz para capturar a dependência espacial presente no fenômeno.</p>
</section>
<section id="modelo-espacial-de-durbin-sdm-spatial-durbin-model" class="level3" data-number="4.13.4">
<h3 data-number="4.13.4" class="anchored" data-anchor-id="modelo-espacial-de-durbin-sdm-spatial-durbin-model"><span class="header-section-number">4.13.4</span> Modelo Espacial de Durbin (SDM – <em>Spatial Durbin Model</em>)</h3>
<p>O Modelo Espacial de Durbin (SDM) constitui uma especificação geral que unifica os mecanismos de dependência espacial endógena e efeitos contextuais exógenos. Dentro da família do Modelo Geral Espacial (GNS, <a href="#eq-GNS" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a>), o SDM é obtido ao impor a restrição <span class="math inline">\(\lambda = 0\)</span>, mantendo os parâmetros <span class="math inline">\(\rho\)</span> e <span class="math inline">\(\boldsymbol{\theta}\)</span> livres. Esta estrutura postula que o valor observado para uma unidade <span class="math inline">\(i\)</span> é uma função simultânea: (i) dos valores da variável resposta em suas unidades vizinhas, (ii) de suas próprias características observadas, e (iii) das características observadas de suas vizinhas.</p>
<p>Formalmente, o modelo é definido pela equação estrutural <span class="citation" data-cites="anselin1988spatial lesage2009introduction">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>; <a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>:</p>
<p><span id="eq-SDM"><span class="math display">\[
\mathbf{y} = \rho \mathbf{W}\mathbf{y} + \mathbf{X}\boldsymbol{\beta} + \mathbf{W}\mathbf{X}\boldsymbol{\theta} + \boldsymbol{\epsilon},
\tag{4.8}\]</span></span></p>
<p>com o vetor de erros assumido como <span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span>. Na sua forma escalar para uma unidade <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
y_i = \rho \sum_{j=1}^n w_{ij} y_j + \sum_{k=1}^K x_{ik}\beta_k + \sum_{k=1}^K \theta_k \left( \sum_{j=1}^n w_{ij} x_{jk} \right) + \epsilon_i.
\]</span></p>
<p>O SDM é frequentemente defendido como uma especificação de partida robusta em modelagem espacial <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>. Sua principal justificativa reside em sua capacidade de mitigar potenciais tendências de especificação (<a href="https://en.wikipedia.org/wiki/Omitted-variable_bias">omitted variable bias</a>). Se o processo gerador de dados subjacente envolver fatores não observados que são espacialmente correlacionados e relacionados a <span class="math inline">\(\mathbf{X}\)</span>, a omissão desses fatores induzirá dependência espacial nos resíduos. A inclusão do termo <span class="math inline">\(\mathbf{W}\mathbf{X}\)</span> no SDM pode absorver parte desta correlação espacial omitida, produzindo estimativas mais estáveis para <span class="math inline">\(\boldsymbol{\beta}\)</span>.</p>
<p>Uma ligação fundamental na teoria dos modelos espaciais é que o modelo SEM (<a href="#eq-SEM" class="quarto-xref">Eq.&nbsp;<span>4.6</span></a>) é um caso restrito do SDM. Esta relação é estabelecida pela hipótese de fator comom (<a href="https://en.wikipedia.org/wiki/Common_factors_theory">Common Factor Hypothesis</a>) <span class="citation" data-cites="burridge1981testing anselin1988spatial">(<a href="references.html#ref-burridge1981testing" role="doc-biblioref">Burridge 1981</a>; <a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>. A restrição não-linear <span class="math inline">\(\boldsymbol{\theta} = -\rho \boldsymbol{\beta}\)</span>, quando válida, reduz a forma reduzida do SDM à do SEM. Consequentemente, estimar um SDM permite testar estatisticamente se a dependência espacial é de natureza substancial (capturada por <span class="math inline">\(\rho\)</span> e <span class="math inline">\(\boldsymbol{\theta}\)</span>) ou meramente residual (um artefato de erros correlacionados, como no SEM).</p>
<p>A presença simultânea do termo autorregressivo <span class="math inline">\(\mathbf{W}\mathbf{y}\)</span> confere ao SDM uma estrutura de dependência global. A forma reduzida do modelo, obtida isolando <span class="math inline">\(\mathbf{y}\)</span>, é:</p>
<p><span class="math display">\[
\mathbf{y} = (\mathbf{I}_n - \rho \mathbf{W})^{-1} (\mathbf{X}\boldsymbol{\beta} + \mathbf{W}\mathbf{X}\boldsymbol{\theta}) + (\mathbf{I}_n - \rho \mathbf{W})^{-1} \boldsymbol{\epsilon}.
\]</span></p>
<p>A matriz <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span> atua como um multiplicador espacial global, propagando choques e efeitos através de toda a rede de interconexões (matriz de pesos / de vizinhança).</p>
<p>A interpretação direta dos coeficientes <span class="math inline">\(\boldsymbol{\beta}\)</span> e <span class="math inline">\(\boldsymbol{\theta}\)</span> é limitada, pois não representam efeitos marginais simples. Seguindo <span class="citation" data-cites="lesage2009introduction">J. LeSage e Pace (<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">2009</a>)</span>, a matriz de derivadas parciais da esperança condicional <span class="math inline">\(\mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}]\)</span> em relação a uma variável explicativa <span class="math inline">\(k\)</span> fornece a decomposição completa dos efeitos:</p>
<p><span class="math display">\[
\frac{\partial \, \mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}]}{\partial \, \mathbf{x}_k'} = \mathbf{S}_k(\mathbf{W}) = (\mathbf{I}_n - \rho \mathbf{W})^{-1} (\beta_k \mathbf{I}_n + \theta_k \mathbf{W}).
\]</span></p>
<p>A partir desta matriz <span class="math inline">\(\mathbf{S}_k(\mathbf{W})\)</span> de dimensão <span class="math inline">\(n \times n\)</span>, calculam-se os seguintes impactos médios:</p>
<ul>
<li><p>Efeito direto médio, que é a média dos elementos da diagonal de <span class="math inline">\(\mathbf{S}_k(\mathbf{W})\)</span>. Mede o impacto esperado de uma mudança em <span class="math inline">\(x_{ik}\)</span> sobre o próprio <span class="math inline">\(y_i\)</span>, incluindo todos os <em>feedbacks</em> espaciais que retornam à unidade <span class="math inline">\(i\)</span>.</p></li>
<li><p>Efeito indireto médio (ou de transbordamento), que é média da soma dos elementos fora da diagonal para cada linha (ou coluna) de <span class="math inline">\(\mathbf{S}_k(\mathbf{W})\)</span>. Mede o impacto esperado de uma mudança em <span class="math inline">\(x_{ik}\)</span> sobre todas as outras unidades <span class="math inline">\(y_j\)</span> (<span class="math inline">\(j \neq i\)</span>).</p></li>
<li><p>Efeito total médio que é a soma do efeito direto e do efeito indireto, equivalente ao impacto médio de uma mudança simultânea em <span class="math inline">\(x_{k}\)</span> para todas as unidades.</p></li>
</ul>
<p>Ao contrário do modelo SAR, onde a razão entre efeitos indiretos e diretos é idêntica para todas as covariáveis, no SDM esta razão é única para cada variável <span class="math inline">\(k\)</span>, determinada pela combinação específica de <span class="math inline">\(\rho\)</span>, <span class="math inline">\(\beta_k\)</span> e <span class="math inline">\(\theta_k\)</span> <span class="citation" data-cites="halleck2015slx">(<a href="references.html#ref-halleck2015slx" role="doc-biblioref">Halleck Vega e Elhorst 2015</a>)</span>.</p>
<p>A presença da variável dependente defasada espacialmente (<span class="math inline">\(\mathbf{W}\mathbf{y}\)</span>) no lado direito da equação introduz simultaneidade, tornando o estimador de Mínimos Quadrados Ordinários (MQO) viesado e inconsistente. Métodos de estimação consistentes são necessários:</p>
<ol type="1">
<li><p>máxima verossimilhança, que maximiza a função de log-verossimilhança condicional, incorporando o termo <span class="math inline">\(\ln |\mathbf{I}_n - \rho \mathbf{W}|\)</span> para corrigir a simultaneidade <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p></li>
<li><p>Abordagem Bayesiana (MCMC), na qual <span class="citation" data-cites="lesage1997bayesian">J. P. LeSage (<a href="references.html#ref-lesage1997bayesian" role="doc-biblioref">1997</a>)</span> desenvolveu um procedimento de inferência via Monte Carlo via Cadeias de Markov (MCMC). Esta abordagem é particularmente útil para realizar inferência sobre os impactos médios (diretos, indiretos e totais), que são funções não-lineares dos parâmetros, permitindo a construção direta de intervalos de credibilidade.</p></li>
</ol>
<p>Assim, o SDM serve como um modelo geral que aninha especificações mais simples: o SAR (<span class="math inline">\(\boldsymbol{\theta} = \mathbf{0}\)</span>), o SLX (<span class="math inline">\(\rho = 0\)</span>), e o SEM (sob a restrição <span class="math inline">\(\boldsymbol{\theta} = -\rho \boldsymbol{\beta}\)</span>). Por esta razão, uma estratégia de modelagem do geral para o específico, começando pelo SDM, é frequentemente recomendada para a análise de dados espaciais <span class="citation" data-cites="elhorst2014spatial">(<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">Elhorst et al. 2014</a>)</span>.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, modelsummary, kableExtra, dplyr, ggplot2, patchwork, viridis, ggspatial, tidyr, Matrix)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Preparação dos Dados</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># SDM (Spatial Durbin Model)</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># type = "mixed" inclui lag de Y (rho) e lag de X (theta)</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>mod_sdm <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw, <span class="at">type =</span> <span class="st">"mixed"</span>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabela</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>mapa_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span>    <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>     <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">beta$"</span>,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lag.variavel_x"</span> <span class="ot">=</span> <span class="st">"WX $</span><span class="sc">\\</span><span class="st">theta$"</span>, <span class="co"># Compartilhado por SLX e SDM</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>            <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$"</span>,       <span class="co"># Compartilhado por SAR e SDM</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lambda"</span>         <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$"</span>    <span class="co"># Exclusivo do SEM</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>mapa_gof <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"N"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"$R^2$"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"aic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"AIC"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"logLik"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Log Likelihood"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela Unificada</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OLS"</span> <span class="ot">=</span> mod_ols, </span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SLX"</span> <span class="ot">=</span> mod_slx,</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAR"</span> <span class="ot">=</span> mod_sar, </span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SEM"</span> <span class="ot">=</span> mod_sem,</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SDM"</span> <span class="ot">=</span> mod_sdm</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> mapa_vars,      </span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> mapa_gof,      </span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">'**'</span> <span class="ot">=</span> .<span class="dv">01</span>, <span class="st">'***'</span> <span class="ot">=</span> .<span class="dv">001</span>),</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,     </span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sdm_comparacao" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sdm_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.8: Resultados da Estimação: Comparação Geral (OLS, SLX, SAR, SEM, SDM). Estimativas [IC 95%].
</figcaption>
<div aria-describedby="tbl-sdm_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS
</th>
<th style="text-align:center;">
&nbsp;SLX
</th>
<th style="text-align:center;">
SAR
</th>
<th style="text-align:center;">
SEM
</th>
<th style="text-align:center;">
SDM
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercepto
</td>
<td style="text-align:center;">
8.973 [8.616, 9.330]
</td>
<td style="text-align:center;">
8.970 [8.613, 9.327]
</td>
<td style="text-align:center;">
5.751 [4.876, 6.626]
</td>
<td style="text-align:center;">
8.978 [8.449, 9.507]
</td>
<td style="text-align:center;">
5.748 [4.873, 6.622]
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\beta\)</span>
</td>
<td style="text-align:center;">
0.058 [−0.306, 0.422]
</td>
<td style="text-align:center;">
0.056 [−0.308, 0.420]
</td>
<td style="text-align:center;">
0.029 [−0.316, 0.374]
</td>
<td style="text-align:center;">
−0.001 [−0.342, 0.340]
</td>
<td style="text-align:center;">
0.027 [−0.318, 0.372]
</td>
</tr>
<tr>
<td style="text-align:left;">
WX <span class="math inline">\(\theta\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.397 [−0.396, 1.190]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.391 [−0.361, 1.143]
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\rho\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.269, 0.449]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.270, 0.449]
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5pxfont-weight: bold;">
<span class="math inline">\(\lambda\)</span>
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.359 [0.270, 0.449]
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
<span class="math inline">\(R^2\)</span>
</td>
<td style="text-align:center;font-weight: bold;">
0.000
</td>
<td style="text-align:center;font-weight: bold;">
0.001
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
5275.0
</td>
<td style="text-align:center;">
5276.1
</td>
<td style="text-align:center;">
5212.9
</td>
<td style="text-align:center;">
5213.0
</td>
<td style="text-align:center;">
5213.9
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Log Likelihood
</td>
<td style="text-align:center;font-weight: bold;">
−2634.5
</td>
<td style="text-align:center;font-weight: bold;">
−2634.0
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
</div>
</figure>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa dos Valores Ajustados</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>fitted_sdm <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_sdm)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>g_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fitted_sdm), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Valores Preditos (SDM)"</span>, </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Ajuste considerando Wy e WX"</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">style =</span> north_arrow_fancy_orienteering,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"in"</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"in"</span>))</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Diagnóstico dos Resíduos</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_sdm <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_sdm)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>moran_sdm <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_sdm, lw)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_lag_sdm <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>resid_sdm)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>g_resid_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> resid_sdm, <span class="at">y =</span> resid_lag_sdm)) <span class="sc">+</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Scatter de Moran (Resíduos SDM)"</span>, </span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_sdm<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" (p-valor: "</span>, <span class="fu">round</span>(moran_sdm<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial"</span>) <span class="sc">+</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>g_fit <span class="sc">|</span> g_resid_scatter</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sdm-diagnostico" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sdm-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sdm-diagnostico-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sdm-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.15: Diagnóstico SDM: (A) Densidade dos Impactos Globais, (B) Ajuste e (C) Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="modelo-espacial-de-durbin-com-erro-sdem-spatial-durbin-error-model" class="level3" data-number="4.13.5">
<h3 data-number="4.13.5" class="anchored" data-anchor-id="modelo-espacial-de-durbin-com-erro-sdem-spatial-durbin-error-model"><span class="header-section-number">4.13.5</span> Modelo Espacial de Durbin com Erro (SDEM – <em>Spatial Durbin Error Model</em>)</h3>
<p>O Modelo Espacial de Durbin com Erro (SDEM) é uma especificação híbrida que combina a modelagem de efeitos contextuais exógenos locais com a correção para dependência espacial residual de natureza global. No contexto do Modelo Geral Espacial (GNS, <a href="#eq-GNS" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a>), o SDEM é obtido ao impor a restrição paramétrica <span class="math inline">\(\rho = 0\)</span>, mantendo livres os parâmetros <span class="math inline">\(\boldsymbol{\theta}\)</span> e <span class="math inline">\(\lambda\)</span>.</p>
<p>Esta estrutura pressupõe que o valor da variável dependente em uma unidade <span class="math inline">\(i\)</span> é explicado por: (1) suas próprias características observadas, (2) as características observadas de suas unidades vizinhas, e (3) um termo de erro que exibe autocorrelação espacial. O modelo é definido pelo seguinte sistema de equações <span class="citation" data-cites="anselin1988spatial elhorst2014spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>; <a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">Elhorst et al. 2014</a>)</span>:</p>
<p><span id="eq-SDEM"><span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{W}\mathbf{X}\boldsymbol{\theta} + \mathbf{u}, \quad \mathbf{u} = \lambda \mathbf{W}\mathbf{u} + \boldsymbol{\epsilon},
\tag{4.9}\]</span></span> com erros independentes e identicamente distribuídos <span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span>.</p>
<p>Na sua forma escalar, para uma unidade <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
y_i = \sum_{k=1}^K x_{ik}\beta_k + \sum_{k=1}^K \theta_k \left( \sum_{j=1}^n w_{ij} x_{jk} \right) + u_i, \quad u_i = \lambda \sum_{j=1}^n w_{ij} u_j + \epsilon_i.
\]</span></p>
<p>O SDEM tem sido destacado na literatura como uma alternativa robusta ao Modelo de Durbin Espacial (SDM), especialmente quando a teoria subjacente sugere que os mecanismos de interação substantiva têm alcance geográfico limitado <span class="citation" data-cites="halleck2015slx">(<a href="references.html#ref-halleck2015slx" role="doc-biblioref">Halleck Vega e Elhorst 2015</a>)</span>. A especificação separa duas fontes de dependência espacial:</p>
<ol type="1">
<li><p>A ausência do termo autorregressivo <span class="math inline">\(\rho \mathbf{W}\mathbf{y}\)</span> implica que os <em>spillovers</em> substantivos são estritamente locais. Uma mudança nas características <span class="math inline">\(\mathbf{x}_j\)</span> de uma unidade <span class="math inline">\(j\)</span> afeta a unidade <span class="math inline">\(i\)</span> apenas se <span class="math inline">\(w_{ij} \neq 0\)</span>, ou seja, se as unidades forem vizinhas diretas na estrutura definida por <span class="math inline">\(\mathbf{W}\)</span>. Não há mecanismos de <em>feedback</em> ou propagação global destes efeitos através da rede (matriz de pesos / de vizinhança).</p></li>
<li><p>O parâmetro <span class="math inline">\(\lambda\)</span> captura a autocorrelação espacial nos resíduos, tipicamente atribuída a variáveis omitidas com padrão espacial ou a choques não observados que se difundem regionalmente. Diferentemente dos efeitos na média, estes choques propagam-se globalmente através do multiplicador espacial <span class="math inline">\((\mathbf{I}_n - \lambda \mathbf{W})^{-1}\)</span> no termo de erro.</p></li>
</ol>
<p>Esta separação é teoricamente atraente em aplicações onde se espera que externalidades de política ou características de vizinhança (<span class="math inline">\(\mathbf{W}\mathbf{X}\)</span>) tenham alcance limitado (ex.: poluição sonora, sombreamento), enquanto fatores de confusão não observados (ex.:, normas culturais, clima) exibam um padrão de correlação espacial de longo alcance <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p>
<p>A forma reduzida do modelo é obtida ao substituir a estrutura do erro na <a href="#eq-SDEM" class="quarto-xref">Eq.&nbsp;<span>4.9</span></a>:</p>
<p><span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{W}\mathbf{X}\boldsymbol{\theta} + (\mathbf{I}_n - \lambda \mathbf{W})^{-1} \boldsymbol{\epsilon}.
\]</span></p>
<p>A esperança condicional da variável dependente, <span class="math inline">\(\mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}]\)</span>, é dada por:</p>
<p><span class="math display">\[
\mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}] = \mathbf{X}\boldsymbol{\beta} + \mathbf{W}\mathbf{X}\boldsymbol{\theta}.
\]</span></p>
<p>Crucialmente, a ausência do multiplicador global <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span> na parte determinística simplifica radicalmente a interpretação dos coeficientes. A matriz de derivadas parciais é linear e diretamente obtida dos parâmetros estimados:</p>
<p><span class="math display">\[
\frac{\partial \, \mathbb{E}[\mathbf{y} \, | \, \mathbf{X}, \mathbf{W}]}{\partial \, \mathbf{x}_k'} = \beta_k \mathbf{I}_n + \theta_k \mathbf{W}.
\]</span></p>
<p>Disto decorre uma decomposição dos efeitos:</p>
<ul>
<li><p>Efeito direto, onde <span class="math inline">\(\frac{\partial y_i}{\partial x_{ik}} = \beta_k\)</span> representa o impacto de uma mudança na característica própria <span class="math inline">\(x_{ik}\)</span> sobre o resultado <span class="math inline">\(y_i\)</span>. Este efeito é idêntico ao de uma regressão clássica, sem <em>feedback</em> espacial.</p></li>
<li><p>Efeito indireto (ou de <em>Spillover</em> local), onde <span class="math inline">\(\frac{\partial y_i}{\partial x_{jk}} = \theta_k w_{ij}\)</span> representa o impacto de uma mudança na característica de uma unidade vizinha <span class="math inline">\(j\)</span> sobre o resultado da unidade <span class="math inline">\(i\)</span>. Se <span class="math inline">\(w_{ij} = 0\)</span> (unidades não conectadas), o efeito é nulo.</p></li>
</ul>
<p>Embora a equação da média contenha apenas regressores exógenos (<span class="math inline">\(\mathbf{X}\)</span> e <span class="math inline">\(\mathbf{W}\mathbf{X}\)</span>), a presença de autocorrelação espacial no erro (<span class="math inline">\(\lambda \neq 0\)</span>) viola o pressuposto de esfericidade. Consequentemente, o estimador de Mínimos Quadrados Ordinários (MQO) permanece não viesado e consistente para <span class="math inline">\(\boldsymbol{\beta}\)</span> e <span class="math inline">\(\boldsymbol{\theta}\)</span>, mas se torna ineficiente. Mais criticamente, a estimativa da matriz de covariância dos parâmetros e, portanto, os erros-padrão e testes de hipótese padrão (testes <span class="math inline">\(t\)</span>, <span class="math inline">\(F\)</span>) tornam-se inválidos <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p>
<p>A estimação eficiente e a inferência válida exigem métodos que incorporem explicitamente a estrutura de covariância não esférica dos erros, <span class="math inline">\(\operatorname{Cov}(\mathbf{u}) = \sigma^2 [(\mathbf{I}_n - \lambda \mathbf{W})^{\top}(\mathbf{I}_n - \lambda \mathbf{W})]^{-1}\)</span>. As abordagens padrão são:</p>
<ol type="1">
<li><p>máxima verossimilhança, que maximiza a função de log-verossimilhança que inclui o termo <span class="math inline">\(\ln |\mathbf{I}_n - \lambda \mathbf{W}|\)</span> associado à transformação do erro.</p></li>
<li><p>Método dos Momentos Generalizados (GMM) que utiliza os momentos dos resíduos para estimar <span class="math inline">\(\lambda\)</span> de forma consistente, conforme proposto por <span class="citation" data-cites="kelejian1999generalized">H. H. Kelejian e Prucha (<a href="references.html#ref-kelejian1999generalized" role="doc-biblioref">1999</a>)</span> para modelos com erros espaciais.</p></li>
</ol>
<p>O SDEM é, portanto, uma ferramenta valiosa quando a teoria apoia a existência de <em>spillovers</em> contextuais locais, mas é necessário controlar rigorosamente a heterogeneidade espacial não observada de longo alcance. Conforme recomendado por <span class="citation" data-cites="elhorst2014spatial">Elhorst et al. (<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">2014</a>)</span>, este modelo é preferível ao SDM quando testes de especificação rejeitam a dependência espacial na variável dependente (rejeitam <span class="math inline">\(\rho \neq 0\)</span> em favor de <span class="math inline">\(\rho = 0\)</span>), mas indicam a presença simultânea de efeitos contextuais (<span class="math inline">\(\boldsymbol{\theta} \neq \mathbf{0}\)</span>) e dependência residual nos erros (<span class="math inline">\(\lambda \neq 0\)</span>).</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, modelsummary, kableExtra, dplyr, ggplot2, patchwork, viridis, ggspatial, tidyr, Matrix)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co"># SDEM (Spatial Durbin Error Model)</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co"># errorsarlm com Durbin=TRUE inclui WX (theta) e lambda (erro)</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>mod_sdem <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw, <span class="at">Durbin =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Configuração da Tabela</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>mapa_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span>    <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>     <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">beta$"</span>,</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lag.variavel_x"</span> <span class="ot">=</span> <span class="st">"WX $</span><span class="sc">\\</span><span class="st">theta$"</span>,      <span class="co"># Theta (SLX, SDM, SDEM)</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>            <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$"</span>,      <span class="co"># Rho (SAR, SDM)</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lambda"</span>         <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$"</span>     <span class="co"># Lambda (SEM, SDEM)</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>mapa_gof <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"N"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"$R^2$"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"aic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"AIC"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"logLik"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Log Likelihood"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela Unificada (6 Modelos)</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OLS"</span>  <span class="ot">=</span> mod_ols, </span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SLX"</span>  <span class="ot">=</span> mod_slx,</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAR"</span>  <span class="ot">=</span> mod_sar, </span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SEM"</span>  <span class="ot">=</span> mod_sem,</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SDM"</span>  <span class="ot">=</span> mod_sdm,</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SDEM"</span> <span class="ot">=</span> mod_sdem</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> mapa_vars,      </span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> mapa_gof,      </span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">'**'</span> <span class="ot">=</span> .<span class="dv">01</span>, <span class="st">'***'</span> <span class="ot">=</span> .<span class="dv">001</span>),</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,    </span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"kableExtra"</span>, </span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sdem_comparacao" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sdem_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.9: Resultados da Estimação: Comparação Geral (OLS, SLX, SAR, SEM, SDM, SDEM). Estimativas [IC 95%].
</figcaption>
<div aria-describedby="tbl-sdem_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS
</th>
<th style="text-align:center;">
&nbsp;SLX
</th>
<th style="text-align:center;">
SAR
</th>
<th style="text-align:center;">
SEM
</th>
<th style="text-align:center;">
SDM
</th>
<th style="text-align:center;">
SDEM
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercepto
</td>
<td style="text-align:center;">
8.973 [8.616, 9.330]
</td>
<td style="text-align:center;">
8.970 [8.613, 9.327]
</td>
<td style="text-align:center;">
5.751 [4.876, 6.626]
</td>
<td style="text-align:center;">
8.978 [8.449, 9.507]
</td>
<td style="text-align:center;">
5.748 [4.873, 6.622]
</td>
<td style="text-align:center;">
8.974 [8.444, 9.503]
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\beta\)</span>
</td>
<td style="text-align:center;">
0.058 [−0.306, 0.422]
</td>
<td style="text-align:center;">
0.056 [−0.308, 0.420]
</td>
<td style="text-align:center;">
0.029 [−0.316, 0.374]
</td>
<td style="text-align:center;">
−0.001 [−0.342, 0.340]
</td>
<td style="text-align:center;">
0.027 [−0.318, 0.372]
</td>
<td style="text-align:center;">
0.060 [−0.297, 0.417]
</td>
</tr>
<tr>
<td style="text-align:left;">
WX <span class="math inline">\(\theta\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.397 [−0.396, 1.190]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.391 [−0.361, 1.143]
</td>
<td style="text-align:center;">
0.496 [−0.366, 1.359]
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\rho\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.269, 0.449]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.270, 0.449]
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5pxfont-weight: bold;">
<span class="math inline">\(\lambda\)</span>
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.359 [0.270, 0.449]
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.360 [0.270, 0.450]
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
<span class="math inline">\(R^2\)</span>
</td>
<td style="text-align:center;font-weight: bold;">
0.000
</td>
<td style="text-align:center;font-weight: bold;">
0.001
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
5275.0
</td>
<td style="text-align:center;">
5276.1
</td>
<td style="text-align:center;">
5212.9
</td>
<td style="text-align:center;">
5213.0
</td>
<td style="text-align:center;">
5213.9
</td>
<td style="text-align:center;">
5213.7
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Log Likelihood
</td>
<td style="text-align:center;font-weight: bold;">
−2634.5
</td>
<td style="text-align:center;font-weight: bold;">
−2634.0
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
</div>
</figure>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa dos Valores Ajustados</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>fitted_sdem <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_sdem)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>g_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fitted_sdem), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Valores Preditos (SDEM)"</span>, </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Padrão recuperado (WX + Erro)"</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>, <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>, </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"in"</span>),</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnóstico dos Resíduos</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_sdem <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_sdem)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>moran_sdem <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_sdem, lw)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_lag_sdem <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>resid_sdem)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>g_resid_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> resid_sdem, <span class="at">y =</span> resid_lag_sdem)) <span class="sc">+</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Scatter de Moran (Resíduos SDEM)"</span>, </span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_sdem<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" (p-valor: "</span>, <span class="fu">round</span>(moran_sdem<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial"</span>) <span class="sc">+</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>(g_fit <span class="sc">|</span> g_resid_scatter)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sdem-diagnostico" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sdem-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sdem-diagnostico-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sdem-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.16: Diagnóstico SDEM: (A) Impactos Locais (Sem Feedback Global), (B) Ajuste e (C) Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="modelo-autorregressivo-espacial-com-erros-autorregressivos-sarar-spatial-autoregressive-with-autoregressive-disturbances" class="level3" data-number="4.13.6">
<h3 data-number="4.13.6" class="anchored" data-anchor-id="modelo-autorregressivo-espacial-com-erros-autorregressivos-sarar-spatial-autoregressive-with-autoregressive-disturbances"><span class="header-section-number">4.13.6</span> Modelo Autorregressivo Espacial com Erros Autorregressivos (SARAR-<em>Spatial Autoregressive with Autoregressive Disturbances</em>)</h3>
<p>O Modelo Autorregressivo Espacial com Erros Autorregressivos (SARAR), também referido como modelo SAC (<em>Spatial Autoregressive Combined</em>) ou modelo generalizado de Cliff-Ord, é uma especificação abrangente que modela simultaneamente a dependência espacial na variável resposta e a autocorrelação espacial no termo de erro.</p>
<p>No contexto do Modelo Geral Espacial (GNS, <a href="#eq-GNS" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a>), o SARAR é obtido ao impor a restrição <span class="math inline">\(\boldsymbol{\theta} = \mathbf{0}\)</span>, mantendo os parâmetros <span class="math inline">\(\rho \neq 0\)</span> e <span class="math inline">\(\lambda \neq 0\)</span>. Formalmente, o modelo é definido pelo sistema de equações <span class="citation" data-cites="anselin1988spatial kelejian1998generalized">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>; <a href="references.html#ref-kelejian1998generalized" role="doc-biblioref">H. H. Kelejian e Prucha 1998</a>)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{y} &amp;= \rho \mathbf{W}_1 \mathbf{y} + \mathbf{X}\boldsymbol{\beta} + \mathbf{u}, \quad
\mathbf{u} = \lambda \mathbf{W}_2 \mathbf{u} + \boldsymbol{\epsilon},
\end{aligned}
\]</span></p>
<p>com erros independentes e identicamente distribuídos <span class="math inline">\(\boldsymbol{\epsilon} \sim (\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span>. As matrizes de pesos espaciais <span class="math inline">\(\mathbf{W}_1\)</span> e <span class="math inline">\(\mathbf{W}_2\)</span> podem ser distintas, refletindo diferentes estruturas de interação para a variável dependente e para os erros, embora a especificação com <span class="math inline">\(\mathbf{W}_1 = \mathbf{W}_2 = \mathbf{W}\)</span> seja comum por parcimônia.</p>
<p>Na forma escalar, para uma unidade <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
y_i = \rho \sum_{j=1}^n w_{1,ij} y_j + \sum_{k=1}^K x_{ik}\beta_k + u_i, \quad u_i = \lambda \sum_{j=1}^n w_{2,ij} u_j + \epsilon_i.
\]</span></p>
<p>A especificação SARAR é motivada pela necessidade de distinguir e controlar dois processos espaciais operando conjuntamente: 1) um mecanismo de interação substantiva ou de <em>feedback</em>, onde o resultado de uma unidade é diretamente influenciado pelos resultados de suas vizinhas (capturado por <span class="math inline">\(\rho\)</span>); e 2) um mecanismo de dependência residual, onde fatores não observados ou choques exógenos exibem padrão espacial (capturado por <span class="math inline">\(\lambda\)</span>).</p>
<p>A identificação conjunta dos parâmetros <span class="math inline">\(\rho\)</span> e <span class="math inline">\(\lambda\)</span> é assegurada pela não-linearidade da função de verossimilhança, embora o uso de matrizes de pesos distintas (<span class="math inline">\(\mathbf{W}_1 \neq \mathbf{W}_2\)</span>) possa melhorar as propriedades de identificação ao introduzir variação exógena adicional <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p>
<p>Assumindo que <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W}_1)\)</span> e <span class="math inline">\((\mathbf{I}_n - \lambda \mathbf{W}_2)\)</span> são não singulares, a forma reduzida do modelo é obtida por substituição:</p>
<p><span class="math display">\[
\mathbf{y} = (\mathbf{I}_n - \rho \mathbf{W}_1)^{-1}\mathbf{X}\boldsymbol{\beta} + (\mathbf{I}_n - \rho \mathbf{W}_1)^{-1}(\mathbf{I}_n - \lambda \mathbf{W}_2)^{-1}\boldsymbol{\epsilon}.
\]</span></p>
<p>Esta expressão revela a estrutura do processo gerador de dados:</p>
<ul>
<li><p><span class="math inline">\(\mathbb{E}[\mathbf{y} \, | \, \mathbf{X}] = (\mathbf{I}_n - \rho \mathbf{W}_1)^{-1}\mathbf{X}\boldsymbol{\beta}\)</span>. A interpretação dos efeitos marginais das variáveis explicativas segue a mesma lógica do modelo SAR, com a decomposição em efeitos diretos, indiretos e totais via o multiplicador espacial <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W}_1)^{-1}\)</span> <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p></li>
<li><p><span class="math inline">\(\operatorname{Cov}(\mathbf{y} \, | \, \mathbf{X}) = \sigma^2 [(\mathbf{I}_n - \rho \mathbf{W}_1)^{\top}(\mathbf{I}_n - \lambda \mathbf{W}_2)^{\top}(\mathbf{I}_n - \lambda \mathbf{W}_2)(\mathbf{I}_n - \rho \mathbf{W}_1)]^{-1}\)</span>. A estrutura de dependência estocástica resulta de uma dupla filtragem espacial: os choques <span class="math inline">\(\boldsymbol{\epsilon}\)</span> são primeiro filtrados pelo processo de erro (<span class="math inline">\(\lambda\)</span>) e depois propagados pelo mecanismo autorregressivo da variável dependente (<span class="math inline">\(\rho\)</span>).</p></li>
</ul>
<p>A presença simultânea da variável dependente defasada (<span class="math inline">\(\mathbf{W}_1\mathbf{y}\)</span>) e da autocorrelação nos erros torna o estimador de Mínimos Quadrados Ordinários (MQO) inconsistente e ineficiente. Os métodos de estimação padrão são:</p>
<ol type="1">
<li>máxima verossimilhança, onde Sob a suposição de normalidade dos erros, a função de log-verossimilhança é:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\ln L(\boldsymbol{\beta}, \rho, \lambda, \sigma^2) &amp;= C + \ln|\mathbf{I}_n - \rho \mathbf{W}_1| + \ln|\mathbf{I}_n - \lambda \mathbf{W}_2| - \frac{n}{2}\ln(\sigma^2) - \frac{1}{2\sigma^2} \boldsymbol{\epsilon}(\rho, \lambda)^{\top} \boldsymbol{\epsilon}(\rho, \lambda),
\end{aligned}
\]</span> onde <span class="math inline">\(\boldsymbol{\epsilon}(\rho, \lambda) = (\mathbf{I}_n - \lambda \mathbf{W}_2)[(\mathbf{I}_n - \rho \mathbf{W}_1)\mathbf{y} - \mathbf{X}\boldsymbol{\beta}]\)</span>. A maximização requer o cálculo de dois <a href="https://pt.wikipedia.org/wiki/Matriz_jacobiana">determinantes Jacobianos</a>, o que pode ser computacionalmente intensivo para grandes amostras.</p>
<ol start="2" type="1">
<li><p>Método Generalizado dos Momentos (GMM) / Mínimos Quadrados em Dois Estágios Espaciais Generalizados (GS2SLS), desenvolvida por <span class="citation" data-cites="kelejian1998generalized">H. H. Kelejian e Prucha (<a href="references.html#ref-kelejian1998generalized" role="doc-biblioref">1998</a>)</span> e <span class="citation" data-cites="kelejian1999generalized">H. H. Kelejian e Prucha (<a href="references.html#ref-kelejian1999generalized" role="doc-biblioref">1999</a>)</span>, não exige suposições distribucionais fortes e evita o cálculo de determinantes. O procedimento é iterativo:</p>
<ol type="a">
<li><p>No primeiro estágio (2SLS) estima-se a equação estrutural ignorando inicialmente a autocorrelação do erro. Utilizam-se como instrumentos para <span class="math inline">\(\mathbf{W}_1\mathbf{y}\)</span> as variáveis <span class="math inline">\(\mathbf{H} = [\mathbf{X}, \mathbf{W}_1\mathbf{X}, \mathbf{W}_1^2\mathbf{X}, \dots]\)</span>, obtendo estimativas consistentes de <span class="math inline">\(\rho\)</span> e <span class="math inline">\(\boldsymbol{\beta}\)</span> e os resíduos <span class="math inline">\(\hat{\mathbf{u}}\)</span>.</p></li>
<li><p>Estimação de <span class="math inline">\(\lambda\)</span> utilizando um estimador GMM baseado nos momentos dos resíduos <span class="math inline">\(\hat{\mathbf{u}}\)</span> para obter uma estimativa consistente de <span class="math inline">\(\lambda\)</span>.</p></li>
<li><p>Transformação e estimação, na qual aplica-se a <a href="https://en.wikipedia.org/wiki/Cochrane%E2%80%93Orcutt_estimation">transformação de Cochrane-Orcutt</a> espacial aos dados para eliminar a autocorrelação, usando <span class="math inline">\(\hat{\lambda}\)</span>. A equação transformada é então reestimada via 2SLS, produzindo estimativas finais eficientes.</p></li>
</ol></li>
</ol>
<p>O modelo SARAR é a especificação preferencial quando evidências empíricas (testes de Multiplicador de Lagrange robustos) indicam a presença conjunta de dependência espacial substantiva e dependência residual. Ele oferece um controle robusto para a heterogeneidade espacial não observada enquanto captura os mecanismos de interação de interesse.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, modelsummary, kableExtra, dplyr, ggplot2, patchwork, viridis, ggspatial, tidyr, Matrix)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuste do SARAR (SAC)</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estima rho e lambda simultaneamente</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>mod_sarar <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>mapa_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span>    <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>     <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">beta$"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lag.variavel_x"</span> <span class="ot">=</span> <span class="st">"WX $</span><span class="sc">\\</span><span class="st">theta$"</span>,      </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>            <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$"</span>,      </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lambda"</span>         <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$"</span>     </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>mapa_gof <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"N"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"$R^2$"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"aic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"AIC"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"logLik"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Log Likelihood"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OLS"</span>   <span class="ot">=</span> mod_ols, </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SLX"</span>   <span class="ot">=</span> mod_slx,</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAR"</span>   <span class="ot">=</span> mod_sar, </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SEM"</span>   <span class="ot">=</span> mod_sem,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SDM"</span>   <span class="ot">=</span> mod_sdm,</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SDEM"</span>  <span class="ot">=</span> mod_sdem,</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SARAR"</span> <span class="ot">=</span> mod_sarar</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> mapa_vars,      </span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> mapa_gof,      </span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">'**'</span> <span class="ot">=</span> .<span class="dv">01</span>, <span class="st">'***'</span> <span class="ot">=</span> .<span class="dv">001</span>),</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,     </span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"kableExtra"</span>, </span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>), </span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sarar_comparacao" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sarar_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.10: Comparação Completa (OLS, SLX, SAR, SEM, SDM, SDEM, SARAR). Estimativas [IC 95%].
</figcaption>
<div aria-describedby="tbl-sarar_comparacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS
</th>
<th style="text-align:center;">
&nbsp;SLX
</th>
<th style="text-align:center;">
SAR
</th>
<th style="text-align:center;">
SEM
</th>
<th style="text-align:center;">
SDM
</th>
<th style="text-align:center;">
SDEM
</th>
<th style="text-align:center;">
SARAR
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercepto
</td>
<td style="text-align:center;">
8.973 [8.616, 9.330]
</td>
<td style="text-align:center;">
8.970 [8.613, 9.327]
</td>
<td style="text-align:center;">
5.751 [4.876, 6.626]
</td>
<td style="text-align:center;">
8.978 [8.449, 9.507]
</td>
<td style="text-align:center;">
5.748 [4.873, 6.622]
</td>
<td style="text-align:center;">
8.974 [8.444, 9.503]
</td>
<td style="text-align:center;">
2.715 [1.695, 3.735]
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\beta\)</span>
</td>
<td style="text-align:center;">
0.058 [−0.306, 0.422]
</td>
<td style="text-align:center;">
0.056 [−0.308, 0.420]
</td>
<td style="text-align:center;">
0.029 [−0.316, 0.374]
</td>
<td style="text-align:center;">
−0.001 [−0.342, 0.340]
</td>
<td style="text-align:center;">
0.027 [−0.318, 0.372]
</td>
<td style="text-align:center;">
0.060 [−0.297, 0.417]
</td>
<td style="text-align:center;">
0.065 [−0.243, 0.373]
</td>
</tr>
<tr>
<td style="text-align:left;">
WX <span class="math inline">\(\theta\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.397 [−0.396, 1.190]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.391 [−0.361, 1.143]
</td>
<td style="text-align:center;">
0.496 [−0.366, 1.359]
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\rho\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.269, 0.449]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.270, 0.449]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.698 [0.587, 0.809]
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5pxfont-weight: bold;">
<span class="math inline">\(\lambda\)</span>
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.359 [0.270, 0.449]
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.360 [0.270, 0.450]
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
−0.558 [−0.767, −0.349]
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
<span class="math inline">\(R^2\)</span>
</td>
<td style="text-align:center;font-weight: bold;">
0.000
</td>
<td style="text-align:center;font-weight: bold;">
0.001
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
5275.0
</td>
<td style="text-align:center;">
5276.1
</td>
<td style="text-align:center;">
5212.9
</td>
<td style="text-align:center;">
5213.0
</td>
<td style="text-align:center;">
5213.9
</td>
<td style="text-align:center;">
5213.7
</td>
<td style="text-align:center;">
5200.4
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Log Likelihood
</td>
<td style="text-align:center;font-weight: bold;">
−2634.5
</td>
<td style="text-align:center;font-weight: bold;">
−2634.0
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
</div>
</figure>
</div>
<p>Enquanto as especificações de dependência única (SAR, SEM) e suas generalizações com defasagens exógenas (SDM, SDEM) atingiram um patamar de ajuste estacionário, com AICs oscilando em torno de <span class="math inline">\(5213\)</span> (<a href="#tbl-sarar_comparacao" class="quarto-xref">Tabela&nbsp;<span>4.10</span></a>), o modelo SARAR (<a href="#tbl-sarar_comparacao" class="quarto-xref">Tabela&nbsp;<span>4.10</span></a> ) reduziu o critério de informação para <span class="math inline">\(5200.4\)</span>. Esta melhoria no ajuste é suportada pela significância estatística simultânea de ambos os parâmetros de dependência: uma forte autoregressão espacial positiva capturada por <span class="math inline">\(\rho\)</span> (<span class="math inline">\(0.698\)</span>; <span class="math inline">\(IC_{95\%} [0.587, 0.809]\)</span>) e um ajuste corretivo nos resíduos evidenciado por um <span class="math inline">\(\lambda\)</span> negativo significante (<span class="math inline">\(-0.558\)</span>; <span class="math inline">\(IC_{95\%} [-0.767, -0.349]\)</span>). Adicionalmente, a tabela reforça a robustez da inferência sobre a covariável <span class="math inline">\(X\)</span>: em todas as sete especificações testadas desde o OLS básico até o complexo SARAR o coeficiente <span class="math inline">\(\beta\)</span> e seus transbordamentos locais (<span class="math inline">\(\theta\)</span>) permaneceram estatisticamente nulos, consolidando a evidência de que a estrutura dos dados é dominada por dinâmicas espaciais endógenas e estocásticas, independentes da variável explicativa proposta.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>imp_sarar <span class="ot">&lt;-</span> <span class="fu">impacts</span>(mod_sarar, <span class="at">listw =</span> lw, <span class="at">R =</span> <span class="dv">1000</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(imp_sarar<span class="sc">$</span>res)) {</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  imp_sarar <span class="ot">&lt;-</span> <span class="fu">impacts</span>(mod_sarar, <span class="at">listw =</span> lw, <span class="at">R =</span> <span class="dv">1000</span>, <span class="at">zstats =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>df_impactos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">direct =</span> imp_sarar<span class="sc">$</span>res<span class="sc">$</span>direct,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">indirect =</span> imp_sarar<span class="sc">$</span>res<span class="sc">$</span>indirect</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Tipo"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tipo =</span> <span class="fu">factor</span>(Tipo, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Direto"</span>, <span class="st">"Indireto (Spillover Global)"</span>)))</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>g_impactos <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_impactos, <span class="fu">aes</span>(<span class="at">x =</span> Tipo, <span class="at">fill =</span> Tipo, <span class="at">y=</span>Valor)) <span class="sc">+</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"gray30"</span>) <span class="sc">+</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Direto"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>, <span class="st">"Indireto (Spillover)"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>)) <span class="sc">+</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Impactos: Direto vs. Indireto"</span>, </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Magnitude do efeito"</span>, <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa dos Valores Ajustados</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>fitted_sarar <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_sarar)</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>g_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fitted_sarar), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a> <span class="fu">labs</span>(</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"B. Valores Preditos (SARAR)"</span>, </span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Ajuste simultâneo"</span> <span class="sc">~</span> (rho <span class="sc">+</span> lambda))</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>, <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">style =</span> north_arrow_fancy_orienteering,</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"in"</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"in"</span>))</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnóstico dos Resíduos</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_sarar <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_sarar)</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>moran_sarar <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_sarar, lw)</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_lag_sarar <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>resid_sarar)</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>g_resid_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> resid_sarar, <span class="at">y =</span> resid_lag_sarar)) <span class="sc">+</span></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Scatter de Moran (Resíduos SARAR)"</span>, </span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_sarar<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" (p-valor: "</span>, <span class="fu">round</span>(moran_sarar<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial"</span>) <span class="sc">+</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>(g_impactos <span class="sc">|</span> g_fit <span class="sc">|</span> g_resid_scatter)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sarar-diagnostico" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sarar-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sarar-diagnostico-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sarar-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.17: Diagnóstico SARAR: (A) Impactos Globais, (B) Ajuste e (C) Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="modelo-de-média-móvel-espacial-sma-spatial-moving-average" class="level3" data-number="4.13.7">
<h3 data-number="4.13.7" class="anchored" data-anchor-id="modelo-de-média-móvel-espacial-sma-spatial-moving-average"><span class="header-section-number">4.13.7</span> Modelo de Média Móvel Espacial (SMA – <em>Spatial Moving Average</em>)</h3>
<p>O modelo de Média Móvel Espacial (SMA) oferece uma abordagem alternativa para a modelagem da dependência espacial no termo de erro. Enquanto o modelo SEM especifica um processo autorregressivo que induz uma dependência de longo alcance, o SMA postula que a dependência espacial é um fenômeno estritamente local e de curto alcance.</p>
<p>Embora menos comum na literatura aplicada que os modelos SAR ou SEM, o SMA é relevante para testar hipóteses sobre a extensão geográfica das interdependências. O modelo é especificado pela seguinte estrutura <span class="citation" data-cites="anselin1988spatial haining2003spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>; <a href="references.html#ref-haining2003spatial" role="doc-biblioref">R. P. Haining 2003</a>)</span>:</p>
<p><span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{u}, \quad \mathbf{u} = \boldsymbol{\epsilon} + \lambda \mathbf{W}\boldsymbol{\epsilon},
\]</span></p>
<p>com erros independentes e identicamente distribuídos <span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\)</span>.</p>
<p>Na forma escalar para uma unidade <span class="math inline">\(i\)</span>, o processo para o termo de erro é dado por:</p>
<p><span class="math display">\[
u_i = \epsilon_i + \lambda \sum_{j=1}^n w_{ij} \epsilon_j.
\]</span></p>
<p>Onde <span class="math inline">\(\lambda\)</span> é o coeficiente de média móvel espacial.</p>
<p>A distinção fundamental entre o SMA e os modelos autorregressivos (SAR, SEM) reside na estrutura de propagação dos choques estocásticos.</p>
<ol type="1">
<li><p>Nos modelos autorregressivos, a dependência é modelada através da inversa de uma matriz de filtro espacial, por exemplo, <span class="math inline">\((\mathbf{I}_n - \lambda \mathbf{W})^{-1}\)</span>. A expansão em <a href="https://pt.wikipedia.org/wiki/S%C3%A9rie_de_Neumann">série de Neumann</a> desta inversa, <span class="math inline">\((\mathbf{I}_n - \lambda \mathbf{W})^{-1} = \mathbf{I}_n + \lambda \mathbf{W} + \lambda^2 \mathbf{W}^2 + \cdots\)</span>, implica que um choque em uma unidade <span class="math inline">\(i\)</span> afeta seus vizinhos diretos (<span class="math inline">\(\lambda \mathbf{W}\)</span>), os vizinhos dos vizinhos (<span class="math inline">\(\lambda^2 \mathbf{W}^2\)</span>), e assim sucessivamente, propagando-se por todo o sistema, ainda que com intensidade decrescente <span class="citation" data-cites="elhorst2014spatial">(<a href="references.html#ref-elhorst2014spatial" role="doc-biblioref">Elhorst et al. 2014</a>)</span>. Isso caracteriza uma dependência de longo alcance.</p></li>
<li><p>No modelo SMA, não há inversão de matriz na definição do erro <span class="math inline">\(\mathbf{u}\)</span>. Um choque <span class="math inline">\(\epsilon_i\)</span> afeta diretamente a unidade <span class="math inline">\(i\)</span> e, através do termo <span class="math inline">\(\lambda \mathbf{W}\boldsymbol{\epsilon}\)</span>, afeta apenas os vizinhos imediatos de <span class="math inline">\(i\)</span> (aqueles para os quais <span class="math inline">\(w_{ij} \neq 0\)</span>). O efeito é contido na primeira ordem de vizinhança; não há mecanismo de retransmissão para unidades mais distantes.</p></li>
</ol>
<p>A natureza local do SMA é explicitamente descrita por sua matriz de covariância. Dado que <span class="math inline">\(\mathbf{u} = (\mathbf{I}_n + \lambda \mathbf{W}) \boldsymbol{\epsilon}\)</span>, a matriz de covariância de <span class="math inline">\(\mathbf{u}\)</span> (condicional a <span class="math inline">\(\mathbf{X}\)</span>) é:</p>
<p><span class="math display">\[
\operatorname{Cov}(\mathbf{u}) = \sigma^2 (\mathbf{I}_n + \lambda \mathbf{W})(\mathbf{I}_n + \lambda \mathbf{W})^{\top} = \sigma^2 (\mathbf{I}_n + \lambda \mathbf{W} + \lambda \mathbf{W}^{\top} + \lambda^2 \mathbf{W}\mathbf{W}^{\top}).
\]</span></p>
<p>Note que:</p>
<ul>
<li><p>A covariância entre <span class="math inline">\(u_i\)</span> e <span class="math inline">\(u_j\)</span> é não nula se <span class="math inline">\(w_{ij} \neq 0\)</span> (são vizinhos diretos) ou se <span class="math inline">\(w_{ji} \neq 0\)</span> (para <span class="math inline">\(\mathbf{W}\)</span> não simétrica).</p></li>
<li><p>O elemento <span class="math inline">\((i, j)\)</span> da matriz <span class="math inline">\(\mathbf{W}\mathbf{W}^{\top}\)</span> é não nulo se existe pelo menos uma unidade <span class="math inline">\(k\)</span> tal que <span class="math inline">\(w_{ik} \neq 0\)</span> e <span class="math inline">\(w_{jk} \neq 0\)</span>. Ou seja, se as unidades <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span> compartilham pelo menos um vizinho comum.</p></li>
</ul>
<p>Portanto, no modelo SMA, a correlação espacial é efetivamente nula para qualquer par de unidades que não sejam vizinhas diretas nem compartilhem um vizinho comum (vizinhos de segunda ordem). Isto contrasta com o SEM, onde a matriz de covariância é teoricamente densa, implicando correlação não nula (embora pequena) entre todos os pares de unidades no sistema.</p>
<p>Assim como no SEM, o estimador de Mínimos Quadrados Ordinários (MQO) para <span class="math inline">\(\boldsymbol{\beta}\)</span> no modelo SMA é não viesado e consistente sob a exogeneidade de <span class="math inline">\(\mathbf{X}\)</span>. No entanto, é ineficiente na presença de autocorrelação espacial (<span class="math inline">\(\lambda \neq 0\)</span>), e as estimativas dos erros-padrão obtidas pelo procedimento MQO padrão são viesadas, invalidando a inferência estatística habitual <span class="citation" data-cites="anselin1988spatial">(<a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p>
<p>A estimação eficiente tipicamente requer o método de máxima verossimilhança. A função de log-verossimilhança assume a forma:</p>
<p><span class="math display">\[
\ln L(\boldsymbol{\beta}, \lambda, \sigma^2) = C - \frac{1}{2} \ln |\sigma^2 \boldsymbol{\Omega}(\lambda)| - \frac{1}{2\sigma^2} (\mathbf{y} - \mathbf{X}\boldsymbol{\beta})^{\top} \boldsymbol{\Omega}(\lambda)^{-1} (\mathbf{y} - \mathbf{X}\boldsymbol{\beta}),
\]</span></p>
<p>onde <span class="math inline">\(\boldsymbol{\Omega}(\lambda) = (\mathbf{I}_n + \lambda \mathbf{W})(\mathbf{I}_n + \lambda \mathbf{W})^{\top}\)</span>. A complexidade computacional reside no cálculo do determinante e da inversa de <span class="math inline">\(\boldsymbol{\Omega}(\lambda)\)</span>. Diferentemente dos modelos autorregressivos, que envolvem o determinante de <span class="math inline">\((\mathbf{I}_n - \lambda \mathbf{W})\)</span>, o SMA requer o cálculo do determinante de <span class="math inline">\((\mathbf{I}_n + \lambda \mathbf{W})\)</span>.</p>
<p>Para garantir que o processo seja invertível e a matriz de covariância seja positiva definida, são impostas restrições no espaço do parâmetro <span class="math inline">\(\lambda\)</span>. Geralmente, exige-se que <span class="math inline">\(|\lambda| &lt; 1 / |\omega_{max}|\)</span>, onde <span class="math inline">\(\omega_{max}\)</span> é o maior autovalor de <span class="math inline">\(\mathbf{W}\)</span> em módulo <span class="citation" data-cites="hepple1979bayesian anselin1988spatial">(<a href="references.html#ref-hepple1979bayesian" role="doc-biblioref">Hepple 1979</a>; <a href="references.html#ref-anselin1988spatial" role="doc-biblioref">Anselin 1988</a>)</span>.</p>
<p>O uso do SMA é recomendado quando a análise exploratória dos dados (por exemplo, correlogramas espaciais ou testes de dependência para diferentes ordens de vizinhança) indica um decaimento abrupto da correlação espacial após a primeira defasagem, em contraste com o decaimento suave e prolongado característico dos processos autorregressivos.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialreg, spdep, sf, modelsummary, kableExtra, dplyr, ggplot2, patchwork, viridis, ggspatial, tidyr, Matrix)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_dados))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>taxa_bruta <span class="ot">&lt;-</span> (<span class="sc">-</span>coords[,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  mg_dados<span class="sc">$</span>variavel_x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(mg_dados))</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"lw"</span>)) {</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>   nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(mg_dados, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>   lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>mod_sma <span class="ot">&lt;-</span> <span class="fu">spautolm</span>(taxa_bruta <span class="sc">~</span> variavel_x, <span class="at">data =</span> mg_dados, <span class="at">listw =</span> lw, <span class="at">family =</span> <span class="st">"SMA"</span>)</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>sum_sma <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_sma)</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Extrair Betas da matriz de coeficientes </span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>coefs_mat <span class="ot">&lt;-</span> sum_sma<span class="sc">$</span>Coef <span class="co"># Matriz com Estimate, Std. Error, etc.</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>df_tidy_betas <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> <span class="fu">rownames</span>(coefs_mat),</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> coefs_mat[, <span class="st">"Estimate"</span>],</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">std.error =</span> coefs_mat[, <span class="st">"Std. Error"</span>]</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair Lambda</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>df_tidy_lambda <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> <span class="st">"lambda"</span>,</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> mod_sma<span class="sc">$</span>lambda,</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">std.error =</span> mod_sma<span class="sc">$</span>lambda.se</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Unir tudo</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>df_tidy_sma <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_tidy_betas, df_tidy_lambda)</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="co">#Calcular estatísticas finais</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>df_tidy_sma<span class="sc">$</span>statistic <span class="ot">&lt;-</span> df_tidy_sma<span class="sc">$</span>estimate <span class="sc">/</span> df_tidy_sma<span class="sc">$</span>std.error</span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>df_tidy_sma<span class="sc">$</span>p.value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(df_tidy_sma<span class="sc">$</span>statistic)))</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>df_tidy_sma<span class="sc">$</span>conf.low <span class="ot">&lt;-</span> df_tidy_sma<span class="sc">$</span>estimate <span class="sc">-</span> (<span class="fl">1.96</span> <span class="sc">*</span> df_tidy_sma<span class="sc">$</span>std.error)</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>df_tidy_sma<span class="sc">$</span>conf.high <span class="ot">&lt;-</span> df_tidy_sma<span class="sc">$</span>estimate <span class="sc">+</span> (<span class="fl">1.96</span> <span class="sc">*</span> df_tidy_sma<span class="sc">$</span>std.error)</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>df_glance_sma <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">nobs =</span> <span class="fu">length</span>(<span class="fu">residuals</span>(mod_sma)),</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">logLik =</span> <span class="fu">as.numeric</span>(<span class="fu">logLik</span>(mod_sma)),</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">aic =</span> <span class="fu">AIC</span>(mod_sma),</span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">r.squared =</span> <span class="cn">NA</span></span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>mod_sma_custom <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">tidy =</span> df_tidy_sma, <span class="at">glance =</span> df_glance_sma)</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mod_sma_custom) <span class="ot">&lt;-</span> <span class="st">"modelsummary_list"</span></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>mapa_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span>    <span class="ot">=</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"variavel_x"</span>     <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">beta$"</span>,</span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lag.variavel_x"</span> <span class="ot">=</span> <span class="st">"WX $</span><span class="sc">\\</span><span class="st">theta$"</span>,      </span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>            <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$"</span>,      </span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lambda"</span>         <span class="ot">=</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$"</span>     </span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>mapa_gof <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"N"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"$R^2$"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"aic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"AIC"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"logLik"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Log Likelihood"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela Final</span></span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OLS"</span>   <span class="ot">=</span> mod_ols, </span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SLX"</span>   <span class="ot">=</span> mod_slx,</span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAR"</span>   <span class="ot">=</span> mod_sar, </span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SEM"</span>   <span class="ot">=</span> mod_sem,</span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SDM"</span>   <span class="ot">=</span> mod_sdm,</span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SDEM"</span>  <span class="ot">=</span> mod_sdem,</span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SARAR"</span> <span class="ot">=</span> mod_sarar,</span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SMA"</span>   <span class="ot">=</span> mod_sma_custom</span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> mapa_vars,      </span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> mapa_gof,      </span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="st">"{estimate} [{conf.low}, {conf.high}]"</span>,</span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span>, </span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">'**'</span> <span class="ot">=</span> .<span class="dv">01</span>, <span class="st">'***'</span> <span class="ot">=</span> .<span class="dv">001</span>),</span>
<span id="cb58-92"><a href="#cb58-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="cn">NULL</span>,     </span>
<span id="cb58-93"><a href="#cb58-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"kableExtra"</span>, </span>
<span id="cb58-94"><a href="#cb58-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb58-95"><a href="#cb58-95" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb58-96"><a href="#cb58-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>, <span class="st">"scale_down"</span>),</span>
<span id="cb58-97"><a href="#cb58-97" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb58-98"><a href="#cb58-98" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-99"><a href="#cb58-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-100"><a href="#cb58-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-101"><a href="#cb58-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-comparacao_final_8_modelos" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-comparacao_final_8_modelos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.11: Comparação entre ajuste dos modelos OLS, SLX, SAR, SEM, SDM, SDEM, SARAR e SMA. Estimativas [IC 95%].
</figcaption>
<div aria-describedby="tbl-comparacao_final_8_modelos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;" class="table table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS
</th>
<th style="text-align:center;">
&nbsp;SLX
</th>
<th style="text-align:center;">
SAR
</th>
<th style="text-align:center;">
SEM
</th>
<th style="text-align:center;">
SDM
</th>
<th style="text-align:center;">
SDEM
</th>
<th style="text-align:center;">
SARAR
</th>
<th style="text-align:center;">
SMA
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercepto
</td>
<td style="text-align:center;">
8.973 [8.616, 9.330]
</td>
<td style="text-align:center;">
8.970 [8.613, 9.327]
</td>
<td style="text-align:center;">
5.751 [4.876, 6.626]
</td>
<td style="text-align:center;">
8.978 [8.449, 9.507]
</td>
<td style="text-align:center;">
5.748 [4.873, 6.622]
</td>
<td style="text-align:center;">
8.974 [8.444, 9.503]
</td>
<td style="text-align:center;">
2.715 [1.695, 3.735]
</td>
<td style="text-align:center;">
8.975 [8.499, 9.450]
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\beta\)</span>
</td>
<td style="text-align:center;">
0.058 [−0.306, 0.422]
</td>
<td style="text-align:center;">
0.056 [−0.308, 0.420]
</td>
<td style="text-align:center;">
0.029 [−0.316, 0.374]
</td>
<td style="text-align:center;">
−0.001 [−0.342, 0.340]
</td>
<td style="text-align:center;">
0.027 [−0.318, 0.372]
</td>
<td style="text-align:center;">
0.060 [−0.297, 0.417]
</td>
<td style="text-align:center;">
0.065 [−0.243, 0.373]
</td>
<td style="text-align:center;">
0.001 [−0.343, 0.345]
</td>
</tr>
<tr>
<td style="text-align:left;">
WX <span class="math inline">\(\theta\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.397 [−0.396, 1.190]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.391 [−0.361, 1.143]
</td>
<td style="text-align:center;">
0.496 [−0.366, 1.359]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\rho\)</span>
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.269, 0.449]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.359 [0.270, 0.449]
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.698 [0.587, 0.809]
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5pxfont-weight: bold;">
<span class="math inline">\(\lambda\)</span>
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.359 [0.270, 0.449]
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.360 [0.270, 0.450]
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
−0.558 [−0.767, −0.349]
</td>
<td style="text-align:center;box-shadow: 0px 1.5pxfont-weight: bold;">
0.363
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
853
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
853
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
<span class="math inline">\(R^2\)</span>
</td>
<td style="text-align:center;font-weight: bold;">
0.000
</td>
<td style="text-align:center;font-weight: bold;">
0.001
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
5275.0
</td>
<td style="text-align:center;">
5276.1
</td>
<td style="text-align:center;">
5212.9
</td>
<td style="text-align:center;">
5213.0
</td>
<td style="text-align:center;">
5213.9
</td>
<td style="text-align:center;">
5213.7
</td>
<td style="text-align:center;">
5200.4
</td>
<td style="text-align:center;">
5221.0
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Log Likelihood
</td>
<td style="text-align:center;font-weight: bold;">
−2634.5
</td>
<td style="text-align:center;font-weight: bold;">
−2634.0
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
</td>
<td style="text-align:center;font-weight: bold;">
−2606.5
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
</div>
</figure>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>fitted_sma <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_sma)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>g_fit <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> fitted_sma), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Valores Preditos (SMA)"</span>) <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Resíduos</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_sma <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_sma)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>moran_sma <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(mg_dados<span class="sc">$</span>resid_sma, lw)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>mg_dados<span class="sc">$</span>resid_lag_sma <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(lw, mg_dados<span class="sc">$</span>resid_sma)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>g_resid_scatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mg_dados, <span class="fu">aes</span>(<span class="at">x =</span> resid_sma, <span class="at">y =</span> resid_lag_sma)) <span class="sc">+</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Scatter de Moran (Resíduos SMA)"</span>, </span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_sma<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" (p-valor: "</span>, <span class="fu">round</span>(moran_sma<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Resíduos"</span>, <span class="at">y =</span> <span class="st">"Lag Espacial"</span>) <span class="sc">+</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>( g_fit <span class="sc">|</span> g_resid_scatter)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-sma-diagnostico" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sma-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sma-diagnostico-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sma-diagnostico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.18: Diagnóstico SMA: (A) Ajuste e (B) Resíduos.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="modelos-espaciais-para-respostas-limitadas-e-discretas" class="level2" data-number="4.14">
<h2 data-number="4.14" class="anchored" data-anchor-id="modelos-espaciais-para-respostas-limitadas-e-discretas"><span class="header-section-number">4.14</span> Modelos espaciais para respostas limitadas e discretas</h2>
<section id="modelo-probit-espacial" class="level3" data-number="4.14.1">
<h3 data-number="4.14.1" class="anchored" data-anchor-id="modelo-probit-espacial"><span class="header-section-number">4.14.1</span> Modelo Probit Espacial</h3>
<p>O Modelo Probit Espacial é aplicado quando a variável dependente observada <span class="math inline">\(y_i\)</span> é binária (<span class="math inline">\(y_i \in \{0, 1\}\)</span>) e existe interdependência espacial entre as unidades de observação.</p>
<p>A formulação comum para o modelo Probit Espacial Autorregressivo (SAR Probit) baseia-se numa variável latente contínua não observada, <span class="math inline">\(y_i^*\)</span>. Assume-se que esta variável latente segue um processo autorregressivo espacial:</p>
<p><span class="math display">\[
y_i^* = \rho \sum_{j=1}^n w_{ij} y_j^* + \mathbf{x}_i^{\top}\boldsymbol{\beta} + \epsilon_i, \quad \epsilon_i \sim \mathcal{N}(0, 1).
\]</span></p>
<p>A variável binária observada <span class="math inline">\(y_i\)</span> é então determinada por um mecanismo de limiar:</p>
<p><span class="math display">\[
y_i =
\begin{cases}
1, &amp; \text{se } y_i^* &gt; 0,\\
0, &amp; \text{se } y_i^* \le 0.
\end{cases}
\]</span></p>
<p>Aqui, <span class="math inline">\(\mathbf{W}\)</span> é a matriz de pesos espaciais, <span class="math inline">\(\rho\)</span> é o parâmetro de autocorrelação espacial, <span class="math inline">\(\mathbf{X}\)</span> é a matriz de covariáveis e <span class="math inline">\(\boldsymbol{\beta}\)</span> o vetor de coeficientes. A variância do erro <span class="math inline">\(\epsilon_i\)</span> é fixada em 1 para identificação do modelo Probit <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p>
<p>Resolvendo a equação estrutural para o vetor latente <span class="math inline">\(\mathbf{y}^*\)</span>, obtém-se sua forma reduzida:</p>
<p><span class="math display">\[
\mathbf{y}^* = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta} + (\mathbf{I}_n - \rho \mathbf{W})^{-1}\boldsymbol{\epsilon}.
\]</span></p>
<p>Define-se <span class="math inline">\(\tilde{\boldsymbol{\epsilon}} = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\boldsymbol{\epsilon}\)</span>. A estrutura de covariância deste termo de erro composto é:</p>
<p><span class="math display">\[
\operatorname{Cov}(\tilde{\boldsymbol{\epsilon}}) = [(\mathbf{I}_n - \rho \mathbf{W})(\mathbf{I}_n - \rho \mathbf{W})^{\top}]^{-1}.
\]</span></p>
<p>A diagonal desta matriz de covariância não é constante. Cada elemento diagonal, <span class="math inline">\(\tilde{\sigma}_i^2\)</span>, varia em função da posição da unidade <span class="math inline">\(i\)</span> na rede espacial, conforme definida por <span class="math inline">\(\mathbf{W}\)</span>. Consequentemente, o modelo de variável latente exibe heterocedasticidade induzida espacialmente. A aplicação de um estimador Probit padrão, que assume homocedasticidade (<span class="math inline">\(\tilde{\sigma}_i^2 = 1\)</span> para todo <span class="math inline">\(i\)</span>), a dados gerados por este processo, produz estimativas inconsistentes dos parâmetros <span class="math inline">\(\rho\)</span> e <span class="math inline">\(\boldsymbol{\beta}\)</span> <span class="citation" data-cites="mcmillen1992probit calabrese2014estimators">(<a href="references.html#ref-mcmillen1992probit" role="doc-biblioref">McMillen 1992</a>; <a href="references.html#ref-calabrese2014estimators" role="doc-biblioref">Calabrese e Elkink 2014</a>)</span>.</p>
<p>A função de verossimilhança para o modelo Probit Espacial é a probabilidade conjunta de observar a amostra <span class="math inline">\(\mathbf{y} = (y_1, \ldots, y_n)^{\top}\)</span>. Esta probabilidade requer o cálculo de uma integral <span class="math inline">\(n\)</span>-dimensional sobre uma distribuição normal multivariada restrita a ortantes definidos pelos valores observados <span class="math inline">\(y_i\)</span>:</p>
<p><span class="math display">\[
L(\boldsymbol{\beta}, \rho | \mathbf{y}) = \int_{R_1} \cdots \int_{R_n} \phi_n(\mathbf{y}^* | \boldsymbol{\mu}, \boldsymbol{\Omega}) \, d\mathbf{y}^*,
\]</span></p>
<p>onde <span class="math inline">\(\boldsymbol{\mu} = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta}\)</span>, <span class="math inline">\(\boldsymbol{\Omega} = [(\mathbf{I}_n - \rho \mathbf{W})(\mathbf{I}_n - \rho \mathbf{W})^{\top}]^{-1}\)</span>, e <span class="math inline">\(R_i = (-\infty, 0]\)</span> se <span class="math inline">\(y_i = 0\)</span> e <span class="math inline">\(R_i = (0, \infty)\)</span> se <span class="math inline">\(y_i = 1\)</span>. Para amostras de tamanho moderado ou grande, o cálculo numérico direto desta integral é computacionalmente proibitivo <span class="citation" data-cites="fleming2004techniques">(<a href="references.html#ref-fleming2004techniques" role="doc-biblioref">Fleming 2004</a>)</span>.</p>
<p>A literatura desenvolveu várias estratégias para superar esta intratabilidade:</p>
<ol type="1">
<li><p>Algoritmo EM (<a href="https://en.wikipedia.org/wiki/Expectation%E2%80%93maximization_algorithm">Expectation-Maximization</a>): Proposto por <span class="citation" data-cites="mcmillen1992probit">McMillen (<a href="references.html#ref-mcmillen1992probit" role="doc-biblioref">1992</a>)</span>, este método trata o vetor latente <span class="math inline">\(\mathbf{y}^*\)</span> como dados faltantes. O algoritmo itera entre um passo E, que calcula a esperança de <span class="math inline">\(\mathbf{y}^*\)</span> condicional nos parâmetros atuais e em <span class="math inline">\(\mathbf{y}\)</span>, e um passo M, que maximiza a verossimilhança de um modelo espacial linear contínuo. Apesar de fornecer estimativas consistentes, a obtenção de erros-padrão válidos é complexa.</p></li>
<li><p>Método Generalizado dos Momentos (GMM): <span class="citation" data-cites="pinkse1998contracting">Pinkse e Slade (<a href="references.html#ref-pinkse1998contracting" role="doc-biblioref">1998</a>)</span> desenvolveram um estimador GMM baseado nos resíduos generalizados do modelo Probit. <span class="citation" data-cites="klier2008clustering">Klier e McMillen (<a href="references.html#ref-klier2008clustering" role="doc-biblioref">2008</a>)</span> propuseram uma versão linearizada (LGMM), computacionalmente eficiente e adequada para grandes conjuntos de dados, embora potencialmente sujeita a viés quando a dependência espacial <span class="math inline">\(\rho\)</span> é forte <span class="citation" data-cites="calabrese2014estimators">(<a href="references.html#ref-calabrese2014estimators" role="doc-biblioref">Calabrese e Elkink 2014</a>)</span>.</p></li>
<li><p>Simulação recursiva de importância (GHK): <span class="citation" data-cites="beron2004probit">Beron e Vijverberg (<a href="references.html#ref-beron2004probit" role="doc-biblioref">2004</a>)</span> implementaram a estimação de máxima verossimilhança simulada usando o simulador GHK (<a href="https://en.wikipedia.org/wiki/GHK_algorithm">Geweke-Hajivassiliou-Keane</a>) para aproximar a integral <span class="math inline">\(n\)</span>-dimensional. Este método é preciso, mas seu custo computacional cresce consideravelmente com o tamanho da amostra.</p></li>
<li><p>Abordagem Bayesiana (MCMC): Consolidada por <span class="citation" data-cites="lesage2000bayesian">J. P. LeSage (<a href="references.html#ref-lesage2000bayesian" role="doc-biblioref">2000</a>)</span>, esta abordagem emprega métodos de Monte Carlo via Cadeias de Markov (MCMC). Utiliza-se uma estratégia de aumento de dados (<a href="https://en.wikipedia.org/wiki/Data_augmentation">data augmentation</a>), na qual o vetor latente <span class="math inline">\(\mathbf{y}^*\)</span> é tratado como um parâmetro a ser amostrado sequencialmente de uma distribuição normal multivariada truncada, condicional aos valores observados <span class="math inline">\(\mathbf{y}\)</span> e aos parâmetros do modelo. Esta é frequentemente considerada a abordagem mais precisa para amostras finitas, fornecendo a distribuição completa a posteriori dos parâmetros <span class="citation" data-cites="calabrese2014estimators wilhelm2013estimating">(<a href="references.html#ref-calabrese2014estimators" role="doc-biblioref">Calabrese e Elkink 2014</a>; <a href="references.html#ref-wilhelm2013estimating" role="doc-biblioref">Wilhelm e Godinho de Matos 2013</a>)</span>.</p></li>
<li><p>Aproximações e Verossimilhança Parcial: Para grandes conjuntos de dados, métodos aproximados ganham relevância. Destacam-se a aproximação de verossimilhança via método de Mendell-Elston <span class="citation" data-cites="martinetti2017approximate">(<a href="references.html#ref-martinetti2017approximate" role="doc-biblioref">Martinetti e Geniaux 2017</a>)</span>, a verossimilhança parcial por pares <span class="citation" data-cites="bille2020partial">(<a href="references.html#ref-bille2020partial" role="doc-biblioref">Billé e Leorato 2020</a>)</span>, e técnicas de amostragem por importância eficiente (EIS) que exploram a esparsidade da matriz de precisão <span class="citation" data-cites="liesenfeld2013analysis">(<a href="references.html#ref-liesenfeld2013analysis" role="doc-biblioref">Liesenfeld, Richard, e Vogler 2013</a>)</span>.</p></li>
</ol>
<p>Em modelos Probit Espaciais, os coeficientes <span class="math inline">\(\boldsymbol{\beta}\)</span> não possuem uma interpretação direta como efeitos marginais sobre a probabilidade <span class="math inline">\(P(y_i = 1)\)</span>, devido à não linearidade da função de ligação Probit e à presença do multiplicador espacial global <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span>.</p>
<p>A análise deve concentrar-se nos efeitos médios diretos, indiretos (de transbordamento) e totais <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>. Um cambio em uma covariável <span class="math inline">\(x_{ik}\)</span> não afeta apenas a probabilidade na unidade <span class="math inline">\(i\)</span>, mas também se propaga através da rede, afetando as probabilidades em todas as outras unidades <span class="math inline">\(j \neq i\)</span>. Estes efeitos são não lineares e variam entre observações. Prática comum resume-os através das médias amostrais dos efeitos calculados para cada unidade, fornecendo uma medida sumária do impacto global de cada variável explicativa.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialprobit, spdep, sf, geobr, ggplot2, viridis, ggspatial, kableExtra, dplyr, Matrix, patchwork, scales)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparação e Simulação (IGNORE ISTO)</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"sp_dados"</span>) <span class="sc">||</span> <span class="sc">!</span>(<span class="st">"y_bin"</span> <span class="sc">%in%</span> <span class="fu">names</span>(sp_dados))) {</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  sp_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"SP"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(sp_dados))</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  knn <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(coords, <span class="at">k =</span> <span class="dv">6</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  nb_sp <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(knn)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  lw_sp <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_sp, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  W_mat <span class="ot">&lt;-</span> <span class="fu">as</span>(lw_sp, <span class="st">"CsparseMatrix"</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sp_dados)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  rho_true <span class="ot">&lt;-</span> <span class="fl">0.65</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  beta_0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1.0</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  beta_1 <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>x_var <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  I_n <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">Diagonal</span>(n)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  inv_spatial <span class="ot">&lt;-</span> <span class="fu">solve</span>(I_n <span class="sc">-</span> rho_true <span class="sc">*</span> W_mat)</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  y_latente <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(inv_spatial <span class="sc">%*%</span> (beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> sp_dados<span class="sc">$</span>x_var <span class="sc">+</span> epsilon))</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Y binário: 0 ou 1 (Corte em 0)</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>y_bin <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y_latente <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"W_mat"</span>)) {</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>      knn <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(sp_dados)), <span class="at">k =</span> <span class="dv">6</span>)</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>      nb_sp <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(knn)</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>      lw_sp <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_sp, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>      W_mat <span class="ot">&lt;-</span> <span class="fu">as</span>(lw_sp, <span class="st">"CsparseMatrix"</span>)</span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuste do Modelo PROBIT (Binário)</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>mod_sar_probit <span class="ot">&lt;-</span> <span class="fu">sarprobit</span>(y_bin <span class="sc">~</span> x_var, </span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>                             <span class="at">W =</span> W_mat, </span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> sp_dados, </span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ndraw =</span> <span class="dv">2000</span>, </span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>                             <span class="at">burn.in =</span> <span class="dv">500</span>, </span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>                             <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela de Resultados</span></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>all_draws1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mod_sar_probit<span class="sc">$</span>B)</span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_sar_probit<span class="sc">$</span>names)) <span class="fu">colnames</span>(all_draws1) <span class="ot">&lt;-</span> mod_sar_probit<span class="sc">$</span>names</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">"rho"</span>, <span class="fu">colnames</span>(all_draws1), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))) all_draws1<span class="sc">$</span>rho <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mod_sar_probit<span class="sc">$</span>rho)</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro  =</span> <span class="fu">names</span>(all_draws1),</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimativa =</span> <span class="fu">colMeans</span>(all_draws1),</span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Inf     =</span> <span class="fu">apply</span>(all_draws1, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Sup     =</span> <span class="fu">apply</span>(all_draws1, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatação da Tabela</span></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano1<span class="sc">$</span>Resultado <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.3f [%.3f, %.3f]"</span>, </span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano1<span class="sc">$</span>Estimativa, </span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano1<span class="sc">$</span>IC_Inf, </span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano1<span class="sc">$</span>IC_Sup)</span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano1<span class="sc">$</span>Parametro <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a>  resumo_bayesiano1<span class="sc">$</span>Parametro <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"beta_1"</span>) <span class="sc">~</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>  resumo_bayesiano1<span class="sc">$</span>Parametro <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"x_var"</span>, <span class="st">"beta_2"</span>) <span class="sc">~</span> <span class="st">"Variável X"</span>,</span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"rho"</span>, resumo_bayesiano1<span class="sc">$</span>Parametro, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$ (Dependência)"</span>,</span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> resumo_bayesiano1<span class="sc">$</span>Parametro</span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a>tabela_final1 <span class="ot">&lt;-</span> resumo_bayesiano1 <span class="sc">%&gt;%</span></span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(Parametro)) <span class="sc">%&gt;%</span></span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Parametro, Resultado)</span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tabela_final1) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(tabela_final1, </span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"latex"</span>,</span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"lc"</span>,  </span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">""</span>, </span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>, <span class="st">"striped"</span>), </span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) </span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sarprobit_resumo" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sarprobit_resumo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.12: Modelo Probit Binário (Bayesiano) - SP.
</figcaption>
<div aria-describedby="tbl-sarprobit_resumo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>A Tabela <a href="#tbl-sarprobit_resumo" class="quarto-xref">Tabela&nbsp;<span>4.12</span></a> apresenta as estimativas estruturais modelo Probit ajustado. Observa-se que a Variável <span class="math inline">\(X\)</span> exerce um efeito positivo (<span class="math inline">\(2.274\)</span>; <span class="math inline">\(IC_{95\%} [1.677, 2.909]\)</span>), indicando que elevações nesta covariável aumentam significativamente a probabilidade de classificação nos estratos superiores da resposta ordinal. A dependência espacial, mensurada pelo parâmetro <span class="math inline">\(\rho\)</span> (<span class="math inline">\(0.707\)</span>; <span class="math inline">\(IC_{95\%} [0.649, 0.761]\)</span>), demonstra que a categoria observada em uma unidade espacial é fortemente condicionada pelo perfil de sua vizinhança, validando a presença de feedback espacial no processo gerador dos dados.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialprobit, spdep, sf, geobr, ggplot2, viridis, ggspatial, kableExtra, dplyr, Matrix, patchwork, scales)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>X_mat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x_var, <span class="at">data =</span> sp_dados)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>all_params <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mod_sar_probit<span class="sc">$</span>B)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>beta_vec <span class="ot">&lt;-</span> all_params[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(X_mat)] </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>rho_hat  <span class="ot">&lt;-</span> <span class="fu">mean</span>(mod_sar_probit<span class="sc">$</span>rho)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Predição Linear (X * Beta)</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>xb <span class="ot">&lt;-</span> X_mat <span class="sc">%*%</span> beta_vec</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co">#(I - rho*W)^-1</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>I_n <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">Diagonal</span>(<span class="fu">nrow</span>(sp_dados))</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>S_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(I_n <span class="sc">-</span> rho_hat <span class="sc">*</span> W_mat)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co">#y*_pred = S_inv * Xb</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>y_star_pred <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(S_inv <span class="sc">%*%</span> xb)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>y_obs <span class="ot">&lt;-</span> sp_dados<span class="sc">$</span>y_bin</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y_obs <span class="sc">==</span> <span class="dv">0</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">0</span>)</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>hi <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y_obs <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="cn">Inf</span>)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>z_lo <span class="ot">&lt;-</span> lo <span class="sc">-</span> y_star_pred</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>z_hi <span class="ot">&lt;-</span> hi <span class="sc">-</span> y_star_pred</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>safe_pnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(q) <span class="fu">pnorm</span>(q)</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>safe_dnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">dnorm</span>(x)</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>diff_cdf <span class="ot">&lt;-</span> <span class="fu">safe_pnorm</span>(z_hi) <span class="sc">-</span> <span class="fu">safe_pnorm</span>(z_lo)</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>diff_cdf[diff_cdf <span class="sc">&lt;</span> <span class="fl">1e-10</span>] <span class="ot">&lt;-</span> <span class="fl">1e-10</span> </span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>diff_pdf <span class="ot">&lt;-</span> <span class="fu">safe_dnorm</span>(z_lo) <span class="sc">-</span> <span class="fu">safe_dnorm</span>(z_hi) <span class="co"># pdf(lo) - pdf(hi)</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="co"># E[y* | y] = mu + sigma * (pdf_lo - pdf_hi) / (cdf_hi - cdf_lo)</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>y_latente_esperada <span class="ot">&lt;-</span> y_star_pred <span class="sc">+</span> (diff_pdf <span class="sc">/</span> diff_cdf)</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a><span class="co"># u = (I - rho*W) * E[y*|y] - X*beta</span></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>A_mat <span class="ot">&lt;-</span> (I_n <span class="sc">-</span> rho_hat <span class="sc">*</span> W_mat)</span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>term_spatial_removed <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(A_mat <span class="sc">%*%</span> sp_dados<span class="sc">$</span>y_latente_esperada)</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>resid_generalized <span class="ot">&lt;-</span> term_spatial_removed <span class="sc">-</span> <span class="fu">as.vector</span>(xb)</span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste de Moran nos Resíduos Generalizados</span></span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a>moran_resid <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(sp_dados<span class="sc">$</span>resid_generalized, lw_sp)</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a>label_moran <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Moran (Gen. Resid): "</span>, <span class="fu">round</span>(moran_resid<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>                      <span class="st">" (p: "</span>, <span class="fu">round</span>(moran_resid<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>)</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Impactos (Efeitos Marginais)</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a>imp_probit <span class="ot">&lt;-</span> <span class="fu">impacts</span>(mod_sar_probit)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<p>——–Marginal Effects——–</p>
<ol type="a">
<li><p>Direct effects lower_005 posterior_mean upper_095 x_var 0.04418 0.07616 0.111</p></li>
<li><p>Indirect effects lower_005 posterior_mean upper_095 x_var 0.1064 0.1909 0.283</p></li>
<li><p>Total effects lower_005 posterior_mean upper_095 x_var 0.1499 0.2671 0.394</p></li>
</ol>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_imp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tipo =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>, <span class="st">"total"</span>), </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>, <span class="st">"total"</span>),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Direto"</span>, <span class="st">"Indireto"</span>, <span class="st">"Total"</span>)),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">c</span>(imp_probit<span class="sc">$</span>direct[, <span class="st">"posterior_mean"</span>], </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>            imp_probit<span class="sc">$</span>indirect[, <span class="st">"posterior_mean"</span>], </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>            imp_probit<span class="sc">$</span>total[, <span class="st">"posterior_mean"</span>])</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># PREDIÇÃO E CLASSIFICAÇÃO </span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>latente_predita <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">fitted</span>(mod_sar_probit))</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Definição dos Cortes (Breaks): O vetor 'phi' contém os limites: 0 (fixo)</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>breaks_finais <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">0</span>, <span class="cn">Inf</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Classificação</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>cat_predita <span class="ot">&lt;-</span> <span class="fu">cut</span>(sp_dados<span class="sc">$</span>latente_predita, </span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">breaks =</span> breaks_finais, </span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>cat_predita <span class="ot">&lt;-</span> sp_dados<span class="sc">$</span>cat_predita<span class="dv">-1</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(sp_dados<span class="sc">$</span>cat_predita))) {</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>cat_predita_class[<span class="fu">is.na</span>(sp_dados<span class="sc">$</span>cat_predita)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Tema Customizado (Do seu exemplo)</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>theme_map_custom <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>(),</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"pt"</span>),</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">color=</span><span class="st">"grey30"</span>)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>),</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a><span class="co"># CORES PADRONIZADAS</span></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>cor_zero <span class="ot">&lt;-</span> <span class="st">"white"</span></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>cor_um   <span class="ot">&lt;-</span> <span class="st">"#FDE725"</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa Observado</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>g_obs <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.factor</span>(y_bin)), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> cor_zero, <span class="st">"1"</span> <span class="ot">=</span> cor_um), <span class="at">name =</span> <span class="st">"Observado"</span>) <span class="sc">+</span></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Observado (Binário)"</span>, <span class="at">subtitle =</span> <span class="st">"Valor Real"</span>) <span class="sc">+</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), </span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a><span class="co">#Mapa Predito</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>g_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.factor</span>(cat_predita)), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> cor_zero, <span class="st">"1"</span> <span class="ot">=</span> cor_um), <span class="at">name =</span> <span class="st">"Predito"</span>) <span class="sc">+</span></span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Predito pelo Modelo"</span>) <span class="sc">+</span></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), </span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de Impactos</span></span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a>g_imp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_imp, <span class="fu">aes</span>(<span class="at">x =</span> Tipo, <span class="at">y =</span> Valor, <span class="at">fill =</span> Tipo)) <span class="sc">+</span></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Valor, <span class="dv">3</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"viridis"</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Efeitos Marginais Médios"</span>, </span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mudança na Probabilidade"</span>, <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a><span class="co">#Mapa de Resíduos</span></span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a>g_resid <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> resid_generalized), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Resíduo"</span>) <span class="sc">+</span></span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"D. Resíduos"</span>, </span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Autocorrelação:</span><span class="sc">\n</span><span class="st">"</span>, label_moran)) <span class="sc">+</span></span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>),</span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a>(g_obs <span class="sc">|</span> g_pred) <span class="sc">/</span> (g_imp <span class="sc">|</span> g_resid) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="dv">1</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-sarprobit_completo_resid" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sarprobit_completo_resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sarprobit_completo_resid-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sarprobit_completo_resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.19: (A) Efeitos Marginais, (B) Resíduos Generalizados, (C) Observado e (D) Probabilidade Predita.
</figcaption>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>A análise comparativa entre a distribuição dos eventos observados (<a href="#fig-sarprobit_completo_resid" class="quarto-xref">Figura&nbsp;<span>4.19</span></a> C) e as probabilidades preditas (<a href="#fig-sarprobit_completo_resid" class="quarto-xref">Figura&nbsp;<span>4.19</span></a> D) indica que o modelo probit identificou as zonas de maior suscetibilidade, recuperando o padrão geográfico do fenômeno. O efeito indireto (<span class="math inline">\(0.192\)</span>; <a href="#fig-sarprobit_completo_resid" class="quarto-xref">Figura&nbsp;<span>4.19</span></a> A) supera o efeito direto (<span class="math inline">\(0.073\)</span>; <a href="#fig-sarprobit_completo_resid" class="quarto-xref">Figura&nbsp;<span>4.19</span></a> A), sugerindo que a alteração na probabilidade do evento local depende preponderantemente das características das vizinhanças. Entretanto, o diagnóstico dos resíduos apresentado em <a href="#fig-sarprobit_completo_resid" class="quarto-xref">Figura&nbsp;<span>4.19</span></a> (B) evidencia uma violação do pressuposto de independência condicional. A estatística de I de Moran global aplicada aos resíduos (<span class="math inline">\(I = 0.076\)</span>), estatisticamente significativa (<span class="math inline">\(p \approx 0\)</span>), aponta para a persistência de autocorrelação espacial positiva não capturada pelo termo de defasagem, indicando que a especificação atual é insuficiente para filtrar a totalidade da dependência espacial latente.</p>
</section>
<section id="modelo-probit-ordenado-espacial" class="level3" data-number="4.14.2">
<h3 data-number="4.14.2" class="anchored" data-anchor-id="modelo-probit-ordenado-espacial"><span class="header-section-number">4.14.2</span> Modelo Probit Ordenado Espacial</h3>
<p>O Modelo Probit Ordenado Espacial é uma extensão para dados categóricos ordenados em contextos espaciais. Ele é adequado quando a variável dependente observada, <span class="math inline">\(y_i\)</span>, assume valores em categorias ordenadas, como classificações de intensidade, níveis de satisfação ou escalas de severidade, e existe interdependência espacial entre as unidades de observação.</p>
<p>A premissa central do modelo é que a variável categórica ordenada observada é uma manifestação censurada de uma variável latente contínua subjacente, <span class="math inline">\(y_i^*\)</span>, que representa uma propensão ou utilidade não observada. A dependência espacial é modelada diretamente no processo gerador desta variável latente.</p>
<p>Seguindo a estrutura autorregressiva espacial, a equação estrutural para a variável latente é especificada como <span class="citation" data-cites="lesage2009introduction wang2009baysian">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>; <a href="references.html#ref-wang2009baysian" role="doc-biblioref">Wang e Kockelman 2009</a>)</span>:</p>
<p><span class="math display">\[
\mathbf{y}^* = \rho \mathbf{W}\mathbf{y}^* + \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}, \quad \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \mathbf{I}_n).
\]</span></p>
<p>A variável observada <span class="math inline">\(y_i\)</span> está relacionada com sua contraparte latente através de um conjunto de limiares ordenados, <span class="math inline">\(\gamma = (\gamma_0, \gamma_1, \dots, \gamma_J, \gamma_{J+1})'\)</span>. Para uma observação <span class="math inline">\(i\)</span> com <span class="math inline">\(J+1\)</span> categorias possíveis (<span class="math inline">\(j = 0, 1, \dots, J\)</span>):</p>
<p><span class="math display">\[
y_i = j \quad \text{se, e somente se,} \quad \gamma_j &lt; y_i^* \le \gamma_{j+1}.
\]</span></p>
<p>Para identificação do modelo, fixam-se os valores <span class="math inline">\(\gamma_0 = -\infty\)</span>, <span class="math inline">\(\gamma_1 = 0\)</span> e <span class="math inline">\(\gamma_{J+1} = \infty\)</span>. Os limiares restantes, <span class="math inline">\(\gamma_2, \dots, \gamma_J\)</span>, são parâmetros desconhecidos a serem estimados, sujeitos à restrição de ordenamento <span class="math inline">\(\gamma_2 &lt; \gamma_3 &lt; \dots &lt; \gamma_J\)</span>. A variância do erro <span class="math inline">\(\epsilon_i\)</span> é fixada em 1, conforme convenção padrão em modelos Probit.</p>
<p>Resolvendo a equação estrutural para o vetor latente <span class="math inline">\(\mathbf{y}^*\)</span>, obtém-se sua forma reduzida:</p>
<p><span class="math display">\[
\mathbf{y}^* = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta} + \mathbf{u}, \quad \text{onde} \quad \mathbf{u} = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\boldsymbol{\epsilon}.
\]</span></p>
<p>A matriz de covariância do termo de erro composto <span class="math inline">\(\mathbf{u}\)</span> é:</p>
<p><span class="math display">\[
\operatorname{Cov}(\mathbf{u}) = \boldsymbol{\Omega} = [(\mathbf{I}_n - \rho \mathbf{W})'(\mathbf{I}_n - \rho \mathbf{W})]^{-1}.
\]</span></p>
<p>Esta matriz é não diagonal e seus elementos diagonais, <span class="math inline">\(\sigma_i^2 = \boldsymbol{\Omega}_{ii}\)</span>, não são constantes. Eles variam em função da posição de cada unidade <span class="math inline">\(i\)</span> na estrutura de vizinhança definida por <span class="math inline">\(\mathbf{W}\)</span>. Consequentemente, o modelo exibe heterocedasticidade induzida espacialmente. A aplicação de um estimador Probit Ordenado padrão, que assume independência e homocedasticidade, a dados gerados por este processo resulta em estimadores inconsistentes para <span class="math inline">\(\boldsymbol{\beta}\)</span>, <span class="math inline">\(\rho\)</span> e <span class="math inline">\(\boldsymbol{\gamma}\)</span>, comprometendo a inferência <span class="citation" data-cites="wang2009baysian">(<a href="references.html#ref-wang2009baysian" role="doc-biblioref">Wang e Kockelman 2009</a>)</span>.</p>
<p>A função de verossimilhança do modelo envolve o cálculo de probabilidades de uma distribuição normal multivariada restrita a ortantes definidos pelos limiares, uma tarefa computacionalmente intratável para amostras de tamanho moderado. A abordagem Bayesiana, utilizando métodos de Monte Carlo via Cadeias de Markov (MCMC) com aumento de dados (<em>data augmentation</em>), supera esta dificuldade e tornou-se o método padrão <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p>
<p>O algoritmo de amostragem de Gibbs itera entre os seguintes passos, amostrando de cada distribuição condicional completa:</p>
<ol type="1">
<li><p>Variável Latente (<span class="math inline">\(\mathbf{y}^*\)</span>): Condicional aos parâmetros <span class="math inline">\((\boldsymbol{\beta}, \rho, \boldsymbol{\gamma})\)</span> e aos dados observados <span class="math inline">\(\mathbf{y}\)</span>, cada <span class="math inline">\(y_i^*\)</span> é amostrado de uma distribuição normal univariada truncada. O suporte de truncagem é o intervalo <span class="math inline">\((\gamma_{y_i}, \gamma_{y_i+1}]\)</span>, determinado pela categoria observada <span class="math inline">\(y_i\)</span>. A média e variância condicionais de <span class="math inline">\(y_i^*\)</span> dependem dos valores latentes atuais das unidades vizinhas, requerendo algoritmos eficientes como o de Geweke para a amostragem.</p></li>
<li><p>Parâmetros de regressão e espacial (<span class="math inline">\(\boldsymbol{\beta}, \rho\)</span>): Condicional ao vetor latente completo <span class="math inline">\(\mathbf{y}^*\)</span>, o modelo reduz-se a um modelo autorregressivo espacial (SAR) linear contínuo. Os parâmetros <span class="math inline">\(\boldsymbol{\beta}\)</span> são amostrados de uma distribuição normal multivariada, e <span class="math inline">\(\rho\)</span> é amostrado via um passo de Metropolis-Hastings, utilizando suas distribuições condicionais completas padrão.</p></li>
<li><p>Parâmetros de limiar (<span class="math inline">\(\boldsymbol{\gamma}\)</span>): Condicional a <span class="math inline">\(\mathbf{y}^*\)</span>, os limiares <span class="math inline">\(\gamma_j\)</span> (para <span class="math inline">\(j=2, \dots, J\)</span>) são amostrados de distribuições uniformes em intervalos restritos. O intervalo para <span class="math inline">\(\gamma_j\)</span> é determinado pelos valores latentes das observações nas categorias adjacentes: <span class="math display">\[
\gamma_j \mid \mathbf{y}^*, \mathbf{y} \sim \mathcal{U}\left( \max_{\{i: y_i = j-1\}} y_i^*, \min_{\{i: y_i = j\}} y_i^* \right).
\]</span> Para garantir uma boa mistura da cadeia de Markov, emprega-se frequentemente o algoritmo de Cowles (1996) <span class="citation" data-cites="tobias2024note">(<a href="references.html#ref-tobias2024note" role="doc-biblioref">Tobias 2024</a>)</span>.</p></li>
</ol>
<p>A interpretação dos coeficientes <span class="math inline">\(\boldsymbol{\beta}\)</span> no modelo Probit Ordenado Espacial não é direta. O sinal de <span class="math inline">\(\beta_k\)</span> indica a direção do efeito da variável <span class="math inline">\(x_k\)</span> sobre a variável latente <span class="math inline">\(y_i^*\)</span>, mas o efeito sobre as probabilidades das categorias observadas <span class="math inline">\(P(y_i = j)\)</span> é ambíguo e depende dos limiares estimados <span class="math inline">\(\boldsymbol{\gamma}\)</span> <span class="citation" data-cites="Greene2003Econometric">(<a href="references.html#ref-Greene2003Econometric" role="doc-biblioref">Greene 2003</a>)</span>. Além disso, a presença do multiplicador espacial <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span> implica que uma mudança em uma covariável para a unidade <span class="math inline">\(i\)</span> gera efeitos de transbordamento (<em>spillovers</em>) sobre as probabilidades de todas as outras unidades.</p>
<p>Portanto, a análise deve concentrar-se nos efeitos marginais espaciais para cada categoria <span class="math inline">\(j\)</span>. O efeito marginal de uma mudança na covariável <span class="math inline">\(x_{rk}\)</span> (da unidade <span class="math inline">\(r\)</span>) sobre a probabilidade da unidade <span class="math inline">\(i\)</span> pertencer à categoria <span class="math inline">\(j\)</span> é dado por:</p>
<p><span class="math display">\[
\frac{\partial P(y_i = j \mid \mathbf{X})}{\partial x_{rk}} = \left[ \phi(\gamma_j - \mu_i) - \phi(\gamma_{j+1} - \mu_i) \right] \cdot \frac{ \left[ (\mathbf{I}_n - \rho \mathbf{W})^{-1} \beta_k \right]_{ir} }{\sigma_i},
\]</span></p>
<p>onde <span class="math inline">\(\mu_i\)</span> é o i-ésimo elemento do vetor <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta}\)</span>, <span class="math inline">\(\sigma_i = \sqrt{\boldsymbol{\Omega}_{ii}}\)</span>, e <span class="math inline">\(\phi(\cdot)\)</span> é a função de densidade da normal padrão. O termo <span class="math inline">\(\left[ (\mathbf{I}_n - \rho \mathbf{W})^{-1} \beta_k \right]_{ir}\)</span> representa o elemento <span class="math inline">\((i, r)\)</span> da matriz de multiplicador espacial ponderada por <span class="math inline">\(\beta_k\)</span>.</p>
<p>Estes efeitos são decompostos em:</p>
<ul>
<li><p>Efeito direto médio: O impacto médio de uma mudança em <span class="math inline">\(x_{ik}\)</span> sobre a probabilidade da própria unidade <span class="math inline">\(i\)</span> estar na categoria <span class="math inline">\(j\)</span>.</p></li>
<li><p>Efeito indireto (ou de Transbordamento) médio: O impacto médio cumulativo de uma mudança em <span class="math inline">\(x_{ik}\)</span> sobre as probabilidades de todas as outras unidades <span class="math inline">\(r \neq i\)</span> estarem na categoria <span class="math inline">\(j\)</span>.</p></li>
<li><p>Efeito total médio: A soma dos efeitos direto e indireto.</p></li>
</ul>
<p>Dada a não linearidade do modelo, estes efeitos variam para cada observação. A prática padrão é reportar as médias amostrais dos efeitos diretos, indiretos e totais para cada categoria <span class="math inline">\(j\)</span>, juntamente com medidas de incerteza (como intervalos de credibilidade) obtidas a partir das amostras da cadeia MCMC.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialprobit, spdep, sf, geobr, ggplot2, viridis, </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>               kableExtra, dplyr, Matrix, patchwork, ggspatial, scales, truncnorm)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Ignore esta parte</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"sp_dados"</span>) <span class="sc">||</span> <span class="sc">!</span>(<span class="st">"y_ordered"</span> <span class="sc">%in%</span> <span class="fu">names</span>(sp_dados))) {</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Baixando shapefile e simulando dados..."</span>)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  sp_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"SP"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  sp_dados <span class="ot">&lt;-</span> sp_dados[<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">st_dimension</span>(sp_dados)), ]</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(sp_dados))</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Matriz de Vizinhança (k=6)</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  knn <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(coords, <span class="at">k =</span> <span class="dv">6</span>)</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  nb_sp <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(knn)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  lw_sp <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_sp, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  W_mat <span class="ot">&lt;-</span> <span class="fu">as</span>(lw_sp, <span class="st">"CsparseMatrix"</span>)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sp_dados)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  rho_true <span class="ot">&lt;-</span> <span class="fl">0.60</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>  beta_x <span class="ot">&lt;-</span> <span class="fl">2.0</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>  intercept_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>x_var <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SAR: y* = (I - rho W)^-1 (Xb + e)</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  I_n <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">Diagonal</span>(n)</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  inv_spatial <span class="ot">&lt;-</span> <span class="fu">solve</span>(I_n <span class="sc">-</span> rho_true <span class="sc">*</span> W_mat)</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>  epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>  xb <span class="ot">&lt;-</span> intercept_true <span class="sc">+</span> (beta_x <span class="sc">*</span> sp_dados<span class="sc">$</span>x_var)</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  y_latente <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(inv_spatial <span class="sc">%*%</span> (xb <span class="sc">+</span> epsilon))</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>  cortes_sim <span class="ot">&lt;-</span> <span class="fu">quantile</span>(y_latente, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.33</span>, <span class="fl">0.66</span>))</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>y_ordered <span class="ot">&lt;-</span> <span class="fu">cut</span>(y_latente, </span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>                            <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, cortes_sim, <span class="cn">Inf</span>), </span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"W_mat"</span>)) {</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>    knn <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(sp_dados)), <span class="at">k =</span> <span class="dv">6</span>)</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>    nb_sp <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(knn)</span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>    lw_sp <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_sp, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>    W_mat <span class="ot">&lt;-</span> <span class="fu">as</span>(lw_sp, <span class="st">"CsparseMatrix"</span>)</span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a><span class="co"># AJUSTE DO MODELO (ORDERED PROBIT)</span></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>mod_sar_ordered <span class="ot">&lt;-</span> <span class="fu">sarorderedprobit</span>(y_ordered <span class="sc">~</span> x_var, </span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">W =</span> W_mat, </span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">data =</span> sp_dados, </span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ndraw =</span> <span class="dv">2000</span>, </span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">burn.in =</span> <span class="dv">500</span>, </span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a><span class="co">#TABELA DE RESULTADOS E IMPACTOS</span></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>all_draws <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mod_sar_ordered<span class="sc">$</span>B)</span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_sar_ordered<span class="sc">$</span>names)) <span class="fu">colnames</span>(all_draws) <span class="ot">&lt;-</span> mod_sar_ordered<span class="sc">$</span>names</span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">"rho"</span>, <span class="fu">colnames</span>(all_draws), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))) all_draws<span class="sc">$</span>rho <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mod_sar_ordered<span class="sc">$</span>rho)</span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro  =</span> <span class="fu">names</span>(all_draws),</span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimativa =</span> <span class="fu">colMeans</span>(all_draws),</span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Inf     =</span> <span class="fu">apply</span>(all_draws, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Sup     =</span> <span class="fu">apply</span>(all_draws, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatação da Tabela</span></span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano<span class="sc">$</span>Resultado <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.3f [%.3f, %.3f]"</span>, </span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano<span class="sc">$</span>Estimativa, </span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano<span class="sc">$</span>IC_Inf, </span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano<span class="sc">$</span>IC_Sup)</span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano<span class="sc">$</span>Parametro <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a>  resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"beta_1"</span>) <span class="sc">~</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a>  resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"x_var"</span>, <span class="st">"beta_2"</span>) <span class="sc">~</span> <span class="st">"Variável X"</span>,</span>
<span id="cb63-81"><a href="#cb63-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"rho"</span>, resumo_bayesiano<span class="sc">$</span>Parametro, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$ (Dependência)"</span>,</span>
<span id="cb63-82"><a href="#cb63-82" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> resumo_bayesiano<span class="sc">$</span>Parametro</span>
<span id="cb63-83"><a href="#cb63-83" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-84"><a href="#cb63-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-85"><a href="#cb63-85" aria-hidden="true" tabindex="-1"></a>tabela_final <span class="ot">&lt;-</span> resumo_bayesiano <span class="sc">%&gt;%</span></span>
<span id="cb63-86"><a href="#cb63-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(Parametro)) <span class="sc">%&gt;%</span></span>
<span id="cb63-87"><a href="#cb63-87" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Parametro, Resultado)</span>
<span id="cb63-88"><a href="#cb63-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tabela_final) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb63-89"><a href="#cb63-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-90"><a href="#cb63-90" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(tabela_final, </span>
<span id="cb63-91"><a href="#cb63-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"latex"</span>, </span>
<span id="cb63-92"><a href="#cb63-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb63-93"><a href="#cb63-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">""</span>, </span>
<span id="cb63-94"><a href="#cb63-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-95"><a href="#cb63-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>, <span class="st">"striped"</span>), </span>
<span id="cb63-96"><a href="#cb63-96" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb63-97"><a href="#cb63-97" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-98"><a href="#cb63-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) </span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sar_ordered_probitT" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sar_ordered_probitT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.13: Estimativas do modelo Probit Ordenado
</figcaption>
<div aria-describedby="tbl-sar_ordered_probitT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>A Tabela <a href="#tbl-sar_ordered_probitT" class="quarto-xref">Tabela&nbsp;<span>4.13</span></a> apresenta os parâmetros estruturais do modelo. A covariável <span class="math inline">\(X\)</span> exerce uma influência positiva sobre a variável latente (<span class="math inline">\(0.863\)</span>; <span class="math inline">\(IC_{95\%} [0.762, 0.963]\)</span>), indicando que elevações nesta preditora aumentam a probabilidade de classificação nos estratos ordinais superiores. Simultaneamente, a dependência espacial é confirmada pela estimativa de <span class="math inline">\(\rho\)</span> (<span class="math inline">\(0.437\)</span>; <span class="math inline">\(IC_{95\%} [0.331, 0.537]\)</span>), demonstrando que o nível ordenado de uma observação é positivamente correlacionado com o status de sua vizinhança geográfica. A calibração dos limiares (<em>thresholds</em>), especificamente o parâmetro de corte <span class="math inline">\(y \ge 3\)</span> (<span class="math inline">\(0.865\)</span>; <span class="math inline">\(IC_{95\%} [0.802, 0.941]\)</span>), define as fronteiras probabilísticas que segregam as categorias mais elevadas da distribuição.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialprobit, spdep, sf, geobr, ggplot2, viridis, </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>               kableExtra, dplyr, Matrix, patchwork, ggspatial, scales, truncnorm)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cálculo dos Impactos (Médios)</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>rho_medio <span class="ot">&lt;-</span> <span class="fu">mean</span>(mod_sar_ordered<span class="sc">$</span>rho)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>beta_val <span class="ot">&lt;-</span> resumo_bayesiano<span class="sc">$</span>Estimativa[resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">==</span> <span class="st">"Variável X"</span>]</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>impacto_total  <span class="ot">&lt;-</span> beta_val <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> rho_medio)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>impacto_direto <span class="ot">&lt;-</span> beta_val </span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>impacto_indireto <span class="ot">&lt;-</span> impacto_total <span class="sc">-</span> impacto_direto</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>df_imp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tipo =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>, <span class="st">"total"</span>), </span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>, <span class="st">"total"</span>),</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Direto"</span>, <span class="st">"Indireto"</span>, <span class="st">"Total"</span>)),</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">c</span>(impacto_direto, impacto_indireto, impacto_total)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="co"># PREDIÇÃO E CLASSIFICAÇÃO </span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>latente_predita <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">fitted</span>(mod_sar_ordered))</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Definição dos Cortes (Breaks): O vetor 'phi' contém os limites: 0 (fixo) e o valor estimado</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>breaks_finais <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, mod_sar_ordered<span class="sc">$</span>phi, <span class="cn">Inf</span>)</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Classificação</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>cat_predita_class <span class="ot">&lt;-</span> <span class="fu">cut</span>(sp_dados<span class="sc">$</span>latente_predita, </span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">breaks =</span> breaks_finais, </span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(sp_dados<span class="sc">$</span>cat_predita_class))) {</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>cat_predita_class[<span class="fu">is.na</span>(sp_dados<span class="sc">$</span>cat_predita_class)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="co">#CÁLCULO DOS RESÍDUOS GENERALIZADOS</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a><span class="co">#Chesher, A. and Irish, M., 1987. Residual analysis in the grouped and censored normal linear model. Journal of Econometrics, 34(1-2), pp.33-61.</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="co">#Gourieroux, C., Monfort, A., Renault, E. and Trognon, A., 1987. Generalised residuals. Journal of econometrics, 34(1-2), pp.5-32.</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">&lt;-</span> resumo_bayesiano<span class="sc">$</span>Estimativa[resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">==</span> <span class="st">"Variável X"</span>] </span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>intercepto <span class="ot">&lt;-</span> resumo_bayesiano<span class="sc">$</span>Estimativa[resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">==</span> <span class="st">"Intercepto"</span>]</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>rho_hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(mod_sar_ordered<span class="sc">$</span>rho)</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>cuts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">0</span>, mod_sar_ordered<span class="sc">$</span>phi, <span class="cn">Inf</span>) <span class="co"># Cuts: 0 é fixo no spatialprobit</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a><span class="co">#y* = (I - rho*W)^-1 * (X*beta)</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>X_mat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x_var, <span class="at">data =</span> sp_dados) </span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>betas_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(intercepto, beta_hat) <span class="co"># Ordem deve bater com X_mat</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a><span class="co">#X * Beta</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>xb <span class="ot">&lt;-</span> X_mat <span class="sc">%*%</span> betas_vec</span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="co">#(I - rho * W)^-1</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>I_n <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">Diagonal</span>(<span class="fu">nrow</span>(sp_dados)) <span class="co">#I</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>S_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(I_n <span class="sc">-</span> rho_hat <span class="sc">*</span> W_mat) <span class="co">#(I - rho * W)^-1</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>y_star_pred <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(S_inv <span class="sc">%*%</span> xb)  <span class="co">#(I - rho * W)^-1 *xb</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a><span class="co">#E[y* | y_obs]: mu + sigma * (pdf(a) - pdf(b)) / (cdf(b) - cdf(a))</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>y_obs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sp_dados<span class="sc">$</span>y_ordered)</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> cuts[y_obs]     <span class="co"># Limite inferior da categoria observada</span></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>hi <span class="ot">&lt;-</span> cuts[y_obs <span class="sc">+</span> <span class="dv">1</span>] <span class="co"># Limite superior da categoria observada</span></span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>z_lo <span class="ot">&lt;-</span> lo <span class="sc">-</span> y_star_pred</span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>z_hi <span class="ot">&lt;-</span> hi <span class="sc">-</span> y_star_pred</span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a>safe_pnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(q) <span class="fu">pnorm</span>(q)</span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a>safe_dnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">dnorm</span>(x)</span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a>diff_cdf <span class="ot">&lt;-</span> <span class="fu">safe_pnorm</span>(z_hi) <span class="sc">-</span> <span class="fu">safe_pnorm</span>(z_lo)</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a>diff_cdf[diff_cdf <span class="sc">&lt;</span> <span class="fl">1e-10</span>] <span class="ot">&lt;-</span> <span class="fl">1e-10</span> </span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>diff_pdf <span class="ot">&lt;-</span> <span class="fu">safe_dnorm</span>(z_lo) <span class="sc">-</span> <span class="fu">safe_dnorm</span>(z_hi) <span class="co"># Note a ordem: pdf(lo) - pdf(hi)</span></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a><span class="co"># E[y* | y] = mu + (phi(lo) - phi(hi)) / (Phi(hi) - Phi(lo))</span></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>y_latente_esperada <span class="ot">&lt;-</span> y_star_pred <span class="sc">+</span> (diff_pdf <span class="sc">/</span> diff_cdf)</span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a><span class="co"># u = (I - rho*W) * E[y*|y] - X*beta</span></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a>A_mat <span class="ot">&lt;-</span> (I_n <span class="sc">-</span> rho_hat <span class="sc">*</span> W_mat)</span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>term_spatial_removed <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(A_mat <span class="sc">%*%</span> sp_dados<span class="sc">$</span>y_latente_esperada)</span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>resid_generalized <span class="ot">&lt;-</span> term_spatial_removed <span class="sc">-</span> <span class="fu">as.vector</span>(xb)</span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a><span class="co">#Teste de Moran</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a>moran_resid <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(sp_dados<span class="sc">$</span>resid_generalized, lw_sp)</span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a>label_moran <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Moran (Gen. Resid): "</span>, <span class="fu">round</span>(moran_resid<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a>                      <span class="st">" (p: "</span>, <span class="fu">round</span>(moran_resid<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>)</span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a>max_res <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(sp_dados<span class="sc">$</span>resid_generalized), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficos</span></span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a>theme_map_custom <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>(),</span>
<span id="cb64-105"><a href="#cb64-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb64-107"><a href="#cb64-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"pt"</span>),</span>
<span id="cb64-108"><a href="#cb64-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb64-109"><a href="#cb64-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb64-110"><a href="#cb64-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">color=</span><span class="st">"grey30"</span>)</span>
<span id="cb64-111"><a href="#cb64-111" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb64-112"><a href="#cb64-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>),</span>
<span id="cb64-113"><a href="#cb64-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb64-114"><a href="#cb64-114" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb64-115"><a href="#cb64-115" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-116"><a href="#cb64-116" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-117"><a href="#cb64-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-118"><a href="#cb64-118" aria-hidden="true" tabindex="-1"></a><span class="co">#Observado</span></span>
<span id="cb64-119"><a href="#cb64-119" aria-hidden="true" tabindex="-1"></a>g_obs <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb64-120"><a href="#cb64-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(y_ordered, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb64-121"><a href="#cb64-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"viridis"</span>, <span class="at">name =</span> <span class="st">"Observed"</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb64-122"><a href="#cb64-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Dados Observados"</span>, <span class="at">subtitle =</span> <span class="st">"Variável Dependente Real"</span>) <span class="sc">+</span></span>
<span id="cb64-123"><a href="#cb64-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map_custom</span>()</span>
<span id="cb64-124"><a href="#cb64-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-125"><a href="#cb64-125" aria-hidden="true" tabindex="-1"></a><span class="co">#Predito</span></span>
<span id="cb64-126"><a href="#cb64-126" aria-hidden="true" tabindex="-1"></a>g_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb64-127"><a href="#cb64-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(cat_predita_class, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb64-128"><a href="#cb64-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"viridis"</span>, <span class="at">name =</span> <span class="st">"Predicted"</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb64-129"><a href="#cb64-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Predição do Modelo"</span>) <span class="sc">+</span></span>
<span id="cb64-130"><a href="#cb64-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map_custom</span>()</span>
<span id="cb64-131"><a href="#cb64-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-132"><a href="#cb64-132" aria-hidden="true" tabindex="-1"></a><span class="co">#Impactos</span></span>
<span id="cb64-133"><a href="#cb64-133" aria-hidden="true" tabindex="-1"></a>g_imp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_imp, <span class="fu">aes</span>(<span class="at">x =</span> Tipo, <span class="at">y =</span> Valor, <span class="at">fill =</span> Tipo)) <span class="sc">+</span></span>
<span id="cb64-134"><a href="#cb64-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb64-135"><a href="#cb64-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Valor, <span class="dv">2</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb64-136"><a href="#cb64-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"cividis"</span>, <span class="at">begin =</span> <span class="fl">0.2</span>, <span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb64-137"><a href="#cb64-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Decomposição de Impactos"</span>, <span class="at">y =</span> <span class="st">"Magnitude"</span>, <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb64-138"><a href="#cb64-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb64-139"><a href="#cb64-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb64-140"><a href="#cb64-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-141"><a href="#cb64-141" aria-hidden="true" tabindex="-1"></a><span class="co">#Resíduos</span></span>
<span id="cb64-142"><a href="#cb64-142" aria-hidden="true" tabindex="-1"></a>max_res <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(sp_dados<span class="sc">$</span>resid_generalized), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb64-143"><a href="#cb64-143" aria-hidden="true" tabindex="-1"></a>g_resid <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb64-144"><a href="#cb64-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> resid_generalized), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb64-145"><a href="#cb64-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb64-146"><a href="#cb64-146" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>max_res, max_res),</span>
<span id="cb64-147"><a href="#cb64-147" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Resíduo"</span>) <span class="sc">+</span></span>
<span id="cb64-148"><a href="#cb64-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"D. Resíduos"</span>, </span>
<span id="cb64-149"><a href="#cb64-149" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Autocorrelação:</span><span class="sc">\n</span><span class="st">"</span>, label_moran)) <span class="sc">+</span></span>
<span id="cb64-150"><a href="#cb64-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map_custom</span>()</span>
<span id="cb64-151"><a href="#cb64-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-152"><a href="#cb64-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-153"><a href="#cb64-153" aria-hidden="true" tabindex="-1"></a>g_obs<span class="sc">+</span>g_pred<span class="sc">+</span>g_imp<span class="sc">+</span>g_resid</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-sar_ordered_probit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sar_ordered_probit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sar_ordered_probit-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sar_ordered_probit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.20: (A) Observado, (B) Predito, (C) Impactos e (D) Resíduos Generalizados (Estimativa do erro estrutural).
</figcaption>
</figure>
</div>
<p><strong>Interpretação</strong></p>
<p>Os padrões observados em <a href="#fig-sar_ordered_probit" class="quarto-xref">Figura&nbsp;<span>4.20</span></a> (A) e as estimativas do modelo em <a href="#fig-sar_ordered_probit" class="quarto-xref">Figura&nbsp;<span>4.20</span></a> (B), demonstram a eficácia da especificação modelo probit ordinal na recuperação da estrutura espacial das categorias, replicando com fidelidade a heterogeneidade e as aglomerações regionais. A decomposição dos impactos ilustrada em <a href="#fig-sar_ordered_probit" class="quarto-xref">Figura&nbsp;<span>4.20</span></a> (C) revela que a dinâmica do fenômeno é governada preponderantemente por fatores intra-regionais, uma vez que a magnitude do efeito direto (<span class="math inline">\(0.86\)</span>) supera a do efeito indireto (<span class="math inline">\(0.67\)</span>), embora a influência do transbordamento espacial permaneça substantiva. A validade estatística das inferências é assegurada em <a href="#fig-sar_ordered_probit" class="quarto-xref">Figura&nbsp;<span>4.20</span></a> (D), onde a análise dos resíduos generalizados atesta a ausência de padrões espaciais sistemáticos; a estatística de I de Moran (<span class="math inline">\(-0.077\)</span>) associada ao p-valor unitário (<span class="math inline">\(p=1\)</span>) confirma que o modelo filtrou adequadamente a autocorrelação espacial, garantindo a independência estocástica dos erros.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Estimativas do Modelo SAR Probit Ordenado">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Nota</span>Estimativas do Modelo SAR Probit Ordenado
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para ajustar o modelo certifique-se de que <span class="math inline">\(\mathbf{y}^*\)</span> (seja discreta), <span class="math inline">\(\mathbf{y}^* \in \{1, \dots, J\}\)</span>. Após ajustar o modelo, os resultados não serão categóricos, e sim quantitativos contínuos. A transição da escala contínua para as categorias discretas observadas <span class="math inline">\(\mathbf{y}^* \in \{1, \dots, J\}\)</span> é determinada pelo vetor de limiares <span class="math inline">\(\boldsymbol{\gamma}\)</span> (referenciado internamente no software como phi), onde o primeiro corte <span class="math inline">\(\gamma_1\)</span> é restrito a zero por definição. Consequentemente, os valores ajustados para <code>beta, rho e phi</code> representam as médias a posteriori das distribuições dos parâmetros estimados via MCMC. Para fins de diagnóstico e inferência estatística, o objeto (modelo ajustado) armazena não apenas essas médias pontuais e os valores ajustados, mas também as cadeias completas de simulação (<code>bdraw, pdraw, phidraw</code>) e os metadados da matriz de pesos <span class="math inline">\(\mathbf{W}\)</span>, permitindo ao pesquisador avaliar a convergência e a incerteza associada aos parâmetros espaciais e aos cortes.</p>
</div>
</div>
</section>
<section id="modelo-tobit-espacial-spatial-tobit-model" class="level3" data-number="4.14.3">
<h3 data-number="4.14.3" class="anchored" data-anchor-id="modelo-tobit-espacial-spatial-tobit-model"><span class="header-section-number">4.14.3</span> Modelo Tobit Espacial (<em>Spatial Tobit Model</em>)</h3>
<p>O Modelo Tobit Espacial é a extensão para processos espaciais onde a variável dependente observada é contínua, mas sujeita a censura. Esta situação ocorre frequentemente quando a variável de interesse assume um valor limite (comumente zero) para uma proporção substantiva das observações, enquanto apresenta variação contínua acima desse limite. Exemplos incluem dados de despesas, fluxos comerciais ou níveis de poluição, onde muitas unidades registram zero, mas os valores positivos são contínuos <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>.</p>
<p>A aplicação de um modelo Tobit padrão, que assume independência entre as observações, ou de um modelo linear espacial, que ignora a censura, a dados com tais características produz estimadores viesados e inconsistentes dos parâmetros de interesse.</p>
<p>O modelo é formulado utilizando uma variável latente contínua não observada, <span class="math inline">\(y_i^*\)</span>, que segue um processo autorregressivo espacial. Para o Modelo Tobit Espacial Autorregressivo (SAR Tobit), a equação estrutural é <span class="citation" data-cites="lesage2009introduction">(<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">J. LeSage e Pace 2009</a>)</span>:</p>
<p><span class="math display">\[
y_i^* = \rho \sum_{j=1}^n w_{ij} y_j^* + \mathbf{x}_i^{\top}\boldsymbol{\beta} + \epsilon_i, \quad \epsilon_i \sim \mathcal{N}(0, \sigma^2).
\]</span></p>
<p>A variável observada <span class="math inline">\(y_i\)</span> relaciona-se com sua contraparte latente através da seguinte regra de <a href="https://en.wikipedia.org/wiki/Censoring_(statistics)">censura</a> à esquerda no limiar zero:</p>
<p><span class="math display">\[
y_i = \max(0, y_i^*).
\]</span></p>
<p>Aqui, <span class="math inline">\(\mathbf{W}\)</span> é a matriz de pesos espaciais, <span class="math inline">\(\rho\)</span> o parâmetro de autocorrelação espacial, <span class="math inline">\(\mathbf{X}\)</span> a matriz de covariáveis e <span class="math inline">\(\boldsymbol{\beta}\)</span> o vetor de coeficientes.</p>
<p>A introdução da dependência espacial na variável latente tem implicações importantes na estrutura do erro na forma reduzida. Resolvendo a equação estrutural para o vetor latente <span class="math inline">\(\mathbf{y}^*\)</span>, obtém-se:</p>
<p><span class="math display">\[
\mathbf{y}^* = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\mathbf{X}\boldsymbol{\beta} + (\mathbf{I}_n - \rho \mathbf{W})^{-1}\boldsymbol{\epsilon}.
\]</span></p>
<p>Definindo o termo de erro composto como <span class="math inline">\(\tilde{\boldsymbol{\epsilon}} = (\mathbf{I}_n - \rho \mathbf{W})^{-1}\boldsymbol{\epsilon}\)</span>, sua matriz de covariância é:</p>
<p><span class="math display">\[
\operatorname{Cov}(\tilde{\boldsymbol{\epsilon}}) = \sigma^2 [(\mathbf{I}_n - \rho \mathbf{W})(\mathbf{I}_n - \rho \mathbf{W})^{\top}]^{-1}.
\]</span></p>
<p>Conforme demonstrado por <span class="citation" data-cites="mcmillen1992probit">McMillen (<a href="references.html#ref-mcmillen1992probit" role="doc-biblioref">1992</a>)</span>, os elementos da diagonal principal desta matriz não são constantes. Cada variância <span class="math inline">\(\tilde{\sigma}_i^2\)</span> é uma função da localização da unidade <span class="math inline">\(i\)</span> na rede definida por <span class="math inline">\(\mathbf{W}\)</span>. Esta heterocedasticidade induzida espacialmente na forma reduzida do modelo é uma consequência direta da dependência espacial. Em modelos não lineares como o Tobit, a violação do pressuposto de homocedasticidade leva à inconsistência do estimador de máxima verossimilhança padrão, não apenas a uma perda de eficiência <span class="citation" data-cites="bille2019spatial kelejian2017spatial">(<a href="references.html#ref-bille2019spatial" role="doc-biblioref">Billé e Arbia 2019</a>; <a href="references.html#ref-kelejian2017spatial" role="doc-biblioref">H. Kelejian e Piras 2017</a>)</span>.</p>
<p>A função de verossimilhança para o modelo Tobit Espacial envolve a probabilidade conjunta de observar os valores <span class="math inline">\(\mathbf{y}\)</span>, o que requer a integração sobre uma distribuição normal multivariada truncada, com a dimensão da integral igual ao número de observações censuradas. Este cálculo é computacionalmente intratável para amostras de tamanho moderado ou grande.</p>
<p>A literatura propõe várias estratégias para superar este obstáculo:</p>
<ol type="1">
<li><p>Algoritmo EM (<em>Expectation-Maximization</em>): <span class="citation" data-cites="mcmillen1992probit">McMillen (<a href="references.html#ref-mcmillen1992probit" role="doc-biblioref">1992</a>)</span> adaptou o algoritmo EM para este contexto. O método itera entre um passo E, que imputa os valores esperados da variável latente <span class="math inline">\(y_i^*\)</span> para as observações censuradas (condicional nos parâmetros atuais), e um passo M, que maximiza a verossimilhança de um modelo espacial linear contínuo utilizando os dados latentes completos. Embora produza estimativas consistentes, a obtenção de erros-padrão válidos é não trivial.</p></li>
<li><p>Abordagem Bayesiana (MCMC com Aumento de Dados): Esta é uma abordagem robusta e amplamente utilizada, detalhada por <span class="citation" data-cites="lesage2000bayesian">J. P. LeSage (<a href="references.html#ref-lesage2000bayesian" role="doc-biblioref">2000</a>)</span> e <span class="citation" data-cites="lesage2009introduction">J. LeSage e Pace (<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">2009</a>)</span>. O método emprega amostragem de Gibbs e uma estratégia de aumento de dados (<em>data augmentation</em>), tratando os valores latentes das observações censuradas como parâmetros a serem estimados. O algoritmo amostra sequencialmente das seguintes distribuições condicionais completas:</p>
<ul>
<li><p>Os parâmetros <span class="math inline">\((\boldsymbol{\beta}, \rho, \sigma^2)\)</span> condicionais ao vetor latente completo <span class="math inline">\(\mathbf{y}^*\)</span>. Dado <span class="math inline">\(\mathbf{y}^*\)</span>, o problema reduz-se à estimação de um modelo SAR Bayesiano padrão.</p></li>
<li><p>A variável latente <span class="math inline">\(\mathbf{y}^*\)</span> condicional aos parâmetros e aos dados observados <span class="math inline">\(\mathbf{y}\)</span>. Para uma observação não censurada (<span class="math inline">\(y_i &gt; 0\)</span>), temos <span class="math inline">\(y_i^* = y_i\)</span>.</p></li>
</ul></li>
</ol>
<p>Para uma observação censurada (<span class="math inline">\(y_i = 0\)</span>), amostra-se <span class="math inline">\(y_i^*\)</span> de uma distribuição normal truncada à esquerda em zero, <span class="math inline">\(y_i^* | \cdot \sim \mathcal{N}_{(-\infty, 0]}(E[y_i^* | \cdot], \operatorname{Var}(y_i^* | \cdot))\)</span>, onde a média e a variância condicionais incorporam a dependência espacial dos vizinhos.</p>
<p>Esta abordagem fornece a distribuição a posteriori completa dos parâmetros, tratando adequadamente a incerteza associada aos valores censurados e à estrutura de dependência.</p>
<ol start="3" type="1">
<li><p>Métodos de Simulação (GHK): Técnicas de simulação, como o simulador GHK, podem ser empregadas para aproximar a integral da verossimilhança <span class="citation" data-cites="fleming2004techniques">(<a href="references.html#ref-fleming2004techniques" role="doc-biblioref">Fleming 2004</a>)</span>. No entanto, o custo computacional pode tornar-se proibitivo para amostras grandes com alta proporção de censura.</p></li>
<li><p>Antes de uma estimação de um modelo complexo, é recomendável testar a presença de dependência espacial nos resíduos de um modelo Tobit padrão (teste de especificação). <span class="citation" data-cites="kelejian2017spatial">H. Kelejian e Piras (<a href="references.html#ref-kelejian2017spatial" role="doc-biblioref">2017</a>)</span> propõem versões generalizadas do teste I de Moran adaptadas para resíduos de modelos Tobit.</p></li>
</ol>
<p>No modelo Tobit Espacial, a interpretação dos coeficientes <span class="math inline">\(\boldsymbol{\beta}\)</span> não é direta. O efeito de uma mudança em uma covariável <span class="math inline">\(x_{ik}\)</span> sobre o valor esperado da variável observada <span class="math inline">\(E[y_i | \mathbf{X}]\)</span> é não linear e depende do multiplicador espacial global <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span> e da probabilidade de a observação não ser censurada.</p>
<p>Seguindo a decomposição de <span class="citation" data-cites="lesage2009introduction">J. LeSage e Pace (<a href="references.html#ref-lesage2009introduction" role="doc-biblioref">2009</a>)</span>, é necessário calcular os efeitos médios diretos, indiretos (de transbordamento) e totais.</p>
<ul>
<li><p>O efeito direto médio captura o impacto esperado de uma mudança em <span class="math inline">\(x_{ik}\)</span> sobre <span class="math inline">\(y_i\)</span>, incluindo os <em>feedbacks</em> espaciais que retornam à unidade <span class="math inline">\(i\)</span>.</p></li>
<li><p>O efeito indireto médio captura o impacto esperado da mudança em <span class="math inline">\(x_{ik}\)</span> sobre todos os outros <span class="math inline">\(y_j\)</span> (<span class="math inline">\(j \neq i\)</span>), ou seja, os <em>spillovers</em> espaciais.</p></li>
<li><p>O efeito total médio é a soma dos dois.</p></li>
</ul>
<p>Estes efeitos são calculados a partir das derivadas parciais de <span class="math inline">\(E[\mathbf{y} | \mathbf{X}]\)</span> em relação a <span class="math inline">\(\mathbf{x}_k\)</span>, que envolvem a matriz <span class="math inline">\((\mathbf{I}_n - \rho \mathbf{W})^{-1}\)</span> e os termos da função de distribuição normal associados à probabilidade de censura. Como variam entre observações, a prática padrão é reportar suas médias amostrais.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialprobit, spdep, sf, geobr, ggplot2, viridis, kableExtra, dplyr, Matrix, patchwork, ggspatial, scales)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparação e Simulação (DADOS TOBIT - CENSURA EM 0)</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"sp_dados"</span>) <span class="sc">||</span> <span class="sc">!</span>(<span class="st">"y_tobit"</span> <span class="sc">%in%</span> <span class="fu">names</span>(sp_dados))) {</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  sp_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"SP"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(sp_dados))</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  knn <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(coords, <span class="at">k =</span> <span class="dv">6</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  nb_sp <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(knn)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  lw_sp <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_sp, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  W_mat <span class="ot">&lt;-</span> <span class="fu">as</span>(lw_sp, <span class="st">"CsparseMatrix"</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sp_dados)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  rho_true <span class="ot">&lt;-</span> <span class="fl">0.60</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  beta_x <span class="ot">&lt;-</span> <span class="fl">2.0</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  sigma_true <span class="ot">&lt;-</span> <span class="fl">1.5</span> </span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>x_var <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  I_n <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">Diagonal</span>(n)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  inv_spatial <span class="ot">&lt;-</span> <span class="fu">solve</span>(I_n <span class="sc">-</span> rho_true <span class="sc">*</span> W_mat)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>  epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sigma_true)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  y_latente <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(inv_spatial <span class="sc">%*%</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> beta_x <span class="sc">*</span> sp_dados<span class="sc">$</span>x_var <span class="sc">+</span> epsilon))</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>  sp_dados<span class="sc">$</span>y_tobit <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, y_latente)</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"W_mat"</span>)) {</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>      knn <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(sp_dados)), <span class="at">k =</span> <span class="dv">6</span>)</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>      nb_sp <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(knn)</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>      lw_sp <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_sp, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>      W_mat <span class="ot">&lt;-</span> <span class="fu">as</span>(lw_sp, <span class="st">"CsparseMatrix"</span>)</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuste do Modelo (SAR TOBIT)</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>mod_sar_tobit <span class="ot">&lt;-</span> <span class="fu">sartobit</span>(y_tobit <span class="sc">~</span> x_var, </span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>                          <span class="at">W =</span> W_mat, </span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> sp_dados, </span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ndraw =</span> <span class="dv">1000</span>, </span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>                          <span class="at">burn.in =</span> <span class="dv">200</span>, </span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>                          <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela de Resultados </span></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>draws_beta <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mod_sar_tobit<span class="sc">$</span>B)</span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_sar_tobit<span class="sc">$</span>names) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(mod_sar_tobit<span class="sc">$</span>names) <span class="sc">==</span> <span class="fu">ncol</span>(draws_beta)) {</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(draws_beta) <span class="ot">&lt;-</span> mod_sar_tobit<span class="sc">$</span>names</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_sar_tobit<span class="sc">$</span>pdraw)) {</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>  draws_rho <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rho =</span> <span class="fu">as.vector</span>(mod_sar_tobit<span class="sc">$</span>pdraw))</span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>  draws_rho <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rho =</span> <span class="fu">as.vector</span>(mod_sar_tobit<span class="sc">$</span>rho))</span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a>draws_sigma <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sigma2 =</span> <span class="fu">as.vector</span>(mod_sar_tobit<span class="sc">$</span>sdraw))</span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"rho"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(draws_beta)) {</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>  draws_beta <span class="ot">&lt;-</span> draws_beta[, <span class="sc">!</span><span class="fu">colnames</span>(draws_beta) <span class="sc">%in%</span> <span class="st">"rho"</span>]</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a>all_draws <span class="ot">&lt;-</span> <span class="fu">cbind</span>(draws_beta, draws_rho, draws_sigma)</span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Estatísticas</span></span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parametro  =</span> <span class="fu">names</span>(all_draws),</span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimativa =</span> <span class="fu">colMeans</span>(all_draws),</span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Inf     =</span> <span class="fu">apply</span>(all_draws, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Sup     =</span> <span class="fu">apply</span>(all_draws, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano<span class="sc">$</span>Resultado <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.3f [%.3f, %.3f]"</span>, </span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano<span class="sc">$</span>Estimativa, </span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano<span class="sc">$</span>IC_Inf, </span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a>                                      resumo_bayesiano<span class="sc">$</span>IC_Sup)</span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Renomear</span></span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a>resumo_bayesiano<span class="sc">$</span>Parametro <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a>  resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"beta_1"</span>) <span class="sc">~</span> <span class="st">"Intercepto"</span>,</span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a>  resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"x_var"</span>, <span class="st">"beta_2"</span>) <span class="sc">~</span> <span class="st">"Variável X"</span>,</span>
<span id="cb65-89"><a href="#cb65-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"rho"</span>, resumo_bayesiano<span class="sc">$</span>Parametro, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">rho$ (Dependência)"</span>,</span>
<span id="cb65-90"><a href="#cb65-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"sigma"</span>, resumo_bayesiano<span class="sc">$</span>Parametro, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">sigma^2$ (Variância)"</span>,</span>
<span id="cb65-91"><a href="#cb65-91" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> resumo_bayesiano<span class="sc">$</span>Parametro</span>
<span id="cb65-92"><a href="#cb65-92" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-93"><a href="#cb65-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-94"><a href="#cb65-94" aria-hidden="true" tabindex="-1"></a>tabela_final <span class="ot">&lt;-</span> resumo_bayesiano <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Parametro, Resultado)</span>
<span id="cb65-95"><a href="#cb65-95" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tabela_final) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb65-96"><a href="#cb65-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-97"><a href="#cb65-97" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(tabela_final, </span>
<span id="cb65-98"><a href="#cb65-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"latex"</span>, </span>
<span id="cb65-99"><a href="#cb65-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb65-100"><a href="#cb65-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">""</span>, </span>
<span id="cb65-101"><a href="#cb65-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-102"><a href="#cb65-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"HOLD_position"</span>, <span class="st">"striped"</span>), </span>
<span id="cb65-103"><a href="#cb65-103" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb65-104"><a href="#cb65-104" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-105"><a href="#cb65-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-106"><a href="#cb65-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(<span class="at">general =</span> <span class="st">"Estimativas: Média a Posteriori [Intervalo de Credibilidade 95%]."</span>) </span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="tbl-sar_tobitT" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sar_tobitT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.14: Resultados da Estimação: Modelo SAR Tobit (Bayesiano) - SP.
</figcaption>
<div aria-describedby="tbl-sar_tobitT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">

</div>
</figure>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(spatialprobit, spdep, sf, geobr, ggplot2, viridis, kableExtra, dplyr, Matrix, patchwork, ggspatial, scales)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A. Impactos (Marginais na Latente)</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>beta_val <span class="ot">&lt;-</span> resumo_bayesiano<span class="sc">$</span>Estimativa[resumo_bayesiano<span class="sc">$</span>Parametro <span class="sc">==</span> <span class="st">"Variável X"</span>]</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>rho_val  <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_rho<span class="sc">$</span>rho, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Cálculo</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>impacto_total_latente  <span class="ot">&lt;-</span> beta_val <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> rho_val)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>impacto_direto_latente <span class="ot">&lt;-</span> beta_val</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>impacto_indireto_latente <span class="ot">&lt;-</span> impacto_total_latente <span class="sc">-</span> impacto_direto_latente</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>df_imp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tipo =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>, <span class="st">"total"</span>), </span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"direct"</span>, <span class="st">"indirect"</span>, <span class="st">"total"</span>),</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Direto"</span>, <span class="st">"Indireto"</span>, <span class="st">"Total"</span>)),</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">c</span>(impacto_direto_latente, </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>            impacto_indireto_latente, </span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>            impacto_total_latente)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Resíduos Generalizados (Chesher &amp; Irish, 1987)</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(draws_beta)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>rho_hat  <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_rho<span class="sc">$</span>rho)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>sigma_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(draws_sigma<span class="sc">$</span>sigma2)) </span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrizes</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>X_mat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x_var, <span class="at">data =</span> sp_dados)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">&lt;-</span> beta_hat[<span class="fu">colnames</span>(draws_beta) <span class="sc">%in%</span> <span class="fu">colnames</span>(X_mat) <span class="sc">|</span> <span class="fu">colnames</span>(draws_beta) <span class="sc">==</span> <span class="st">"(Intercept)"</span>]</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>xb <span class="ot">&lt;-</span> X_mat <span class="sc">%*%</span> beta_hat</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>I_n <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">Diagonal</span>(<span class="fu">nrow</span>(sp_dados))</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>S_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(I_n <span class="sc">-</span> rho_hat <span class="sc">*</span> W_mat)</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Média Latente (Sem censura): mu = (I - rho W)^-1 Xb</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>y_star_mu <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(S_inv <span class="sc">%*%</span> xb)</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a><span class="co"># E[y* | y]: </span></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Se y &gt; 0: E = y_obs</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Se y = 0: E = mu - sigma * (pdf(z)/cdf(z)), onde z = (0 - mu)/sigma </span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>y_obs <span class="ot">&lt;-</span> sp_dados<span class="sc">$</span>y_tobit</span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>z_score <span class="ot">&lt;-</span> (<span class="dv">0</span> <span class="sc">-</span> y_star_mu) <span class="sc">/</span> sigma_hat</span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>mills_ratio <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(z_score) <span class="sc">/</span> <span class="fu">pnorm</span>(z_score)</span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>y_latente_generalized <span class="ot">&lt;-</span> y_obs</span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>censurados <span class="ot">&lt;-</span> (y_obs <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a><span class="co"># E[y* | y* &lt; 0] é mu - sigma * lambda(-z_score)</span></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>y_latente_generalized[censurados] <span class="ot">&lt;-</span> y_star_mu[censurados] <span class="sc">-</span> (sigma_hat <span class="sc">*</span> mills_ratio[censurados])</span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a><span class="co"># u = (I - rho W) * y_generalized - Xb</span></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a>term_spatial_removed <span class="ot">&lt;-</span> <span class="fu">as.vector</span>((I_n <span class="sc">-</span> rho_hat <span class="sc">*</span> W_mat) <span class="sc">%*%</span> y_latente_generalized)</span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>resid_generalized <span class="ot">&lt;-</span> term_spatial_removed <span class="sc">-</span> <span class="fu">as.vector</span>(xb)</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran</span></span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>moran_resid <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(sp_dados<span class="sc">$</span>resid_generalized, lw_sp)</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>label_moran <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_resid<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>                      <span class="st">" (p: "</span>, <span class="fu">round</span>(moran_resid<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>)</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Cores</span></span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>cor_zero <span class="ot">&lt;-</span> <span class="st">"white"</span></span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a>cor_um   <span class="ot">&lt;-</span> <span class="st">"#FDE725"</span></span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a><span class="co"># PLOTS</span></span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a>sp_dados<span class="sc">$</span>y_pred_censurado <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, y_star_mu) </span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a><span class="co"># C. Mapa Observado </span></span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a>g_obs <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> y_tobit), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">name =</span> <span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Observado (y)"</span>, <span class="at">subtitle =</span> <span class="st">"Valores Reais (Censurados em 0)"</span>) <span class="sc">+</span></span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), </span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa Predito</span></span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a>g_pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> y_pred_censurado), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">name =</span> <span class="st">"Predito"</span>,</span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(sp_dados<span class="sc">$</span>y_tobit))) <span class="sc">+</span></span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"D. Predição de Valores (y)"</span>, <span class="at">subtitle =</span> <span class="st">"Expectativa dos Valores Observáveis"</span>) <span class="sc">+</span></span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb66-92"><a href="#cb66-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb66-93"><a href="#cb66-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>),</span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a><span class="co">#Impactos</span></span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a>g_imp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_imp, <span class="fu">aes</span>(<span class="at">x =</span> Tipo, <span class="at">y =</span> Valor, <span class="at">fill =</span> Tipo)) <span class="sc">+</span></span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Valor, <span class="dv">3</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"viridis"</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A. Impactos na Latente (y*)"</span>, <span class="at">y =</span> <span class="st">"Mudança"</span>, <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa de Resíduos</span></span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a>g_resid <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sp_dados) <span class="sc">+</span></span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> resid_generalized), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#440154"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"#FDE725"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>max_res, max_res), <span class="at">name =</span> <span class="st">"Resíduo"</span>) <span class="sc">+</span></span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B. Resíduos Generalizados"</span>, <span class="at">subtitle =</span> label_moran) <span class="sc">+</span></span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a>(g_obs <span class="sc">|</span> g_pred) <span class="sc">/</span> (g_imp <span class="sc">|</span> g_resid) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="dv">1</span>))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-sar_tobit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sar_tobit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="lattice_data_files/figure-html/fig-sar_tobit-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sar_tobit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.21: Diagnóstico Tobit: (A) Observado (Censurado), (B) Predito (Latente Esperado), (C) Impactos e (D) Resíduos Generalizados.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="modelos-locais-e-não-estacionários" class="level2" data-number="4.15">
<h2 data-number="4.15" class="anchored" data-anchor-id="modelos-locais-e-não-estacionários"><span class="header-section-number">4.15</span> Modelos locais e não estacionários</h2>
<p>Os modelos vistos até aqui (CAR, SAR, GNS e seus casos particulares) fundamentam-se na premissa de estacionariedade espacial, assumindo que a relação funcional entre a variável dependente e as variáveis explicativas permanece invariante em todo o domínio geográfico. Por exemplo, ao modelar o preço de imóveis no município de São Paulo, esses modelos pressupõem que o impacto de uma variável (como a área construída) é idêntico em todas as regiões. Contudo, em fenômenos geográficos, essa premissa é frequentemente violada, caracterizando a não estacionariedade ou heterogeneidade espacial <span class="citation" data-cites="brunsdon1996geographically">(<a href="references.html#ref-brunsdon1996geographically" role="doc-biblioref">Brunsdon, Fotheringham, e Charlton 1996</a>)</span>. Na prática, bairros periféricos, como os da Zona Leste (por exemplo, Guaianases, Jardim Ângela e São Mateus), podem apresentar uma valorização marginal menor por metro quadrado, enquanto bairros nobres, como Vila Madalena, Pinheiros, Vila Mariana, Higienópolis, Jardim Paulista e Moema, podem apresentar uma valorização superior devido a fatores de localização e infraestrutura.</p>
<p><span class="citation" data-cites="sachdeva2022do">Sachdeva, Fotheringham, e Li (<a href="references.html#ref-sachdeva2022do" role="doc-biblioref">2022</a>)</span> demonstram, utilizando modelagem local, que é possível decompor o preço de um imóvel em componentes estruturais e um valor intrínseco da localização (capturado pelo intercepto local), permitindo quantificar quanto se paga apenas por estar em um determinado lugar, <a href="https://pt.wikipedia.org/wiki/Ceteris_paribus">ceteris paribus</a>. A aplicação de modelos globais a processos espacialmente heterogêneos tende a produzir estimativas de parâmetros que representam médias espaciais enganosas, mascarando variações locais relevantes e induzindo a erros de especificação <span class="citation" data-cites="fotheringham2002geographically fotheringham2017multiscale">(<a href="references.html#ref-fotheringham2002geographically" role="doc-biblioref">Binbin Lu et al. 2014</a>; <a href="references.html#ref-fotheringham2017multiscale" role="doc-biblioref">Fotheringham, Yang, e Kang 2017</a>)</span>.</p>
<p>Para abordar esta limitação, desenvolveram-se abordagens de modelagem local, entre as quais a Regressão Geograficamente Ponderada (GWR) e a Regressão Geograficamente Ponderada Multiescalar (MGWR).</p>
<section id="regressão-geograficamente-ponderada-gwr" class="level3" data-number="4.15.1">
<h3 data-number="4.15.1" class="anchored" data-anchor-id="regressão-geograficamente-ponderada-gwr"><span class="header-section-number">4.15.1</span> Regressão Geograficamente Ponderada (GWR)</h3>
<p>A Regressão Geograficamente Ponderada (GWR) é uma técnica de análise espacial local que estende o modelo de regressão linear clássico, permitindo que os coeficientes variem continuamente no espaço. Em vez de estimar um único conjunto de parâmetros globais <span class="math inline">\(\boldsymbol{\beta}\)</span>, a GWR estima um conjunto distinto de parâmetros <span class="math inline">\(\boldsymbol{\beta}(u_i, v_i)\)</span> para cada localização <span class="math inline">\(i\)</span> da amostra <span class="citation" data-cites="fotheringham2002geographically">(<a href="references.html#ref-fotheringham2002geographically" role="doc-biblioref">Binbin Lu et al. 2014</a>)</span>.</p>
<p>O modelo GWR para uma observação na localização <span class="math inline">\(i\)</span>, com coordenadas <span class="math inline">\((u_i, v_i)\)</span>, é expresso por:</p>
<p><span class="math display">\[y_i = \beta_0(u_i, v_i) + \sum_{k=1}^{p} \beta_k(u_i, v_i) x_{ik} + \epsilon_i\]</span></p>
<p>onde:</p>
<ul>
<li><p><span class="math inline">\(y_i\)</span> é o valor da variável dependente na localização <span class="math inline">\(i\)</span>;</p></li>
<li><p><span class="math inline">\(x_{ik}\)</span> é o valor da <span class="math inline">\(k\)</span>-ésima variável independente na localização <span class="math inline">\(i\)</span>;</p></li>
<li><p><span class="math inline">\(\beta_k(u_i, v_i)\)</span> é o coeficiente de regressão local para a <span class="math inline">\(k\)</span>-ésima variável independente na localização <span class="math inline">\(i\)</span>;</p></li>
<li><p><span class="math inline">\(\epsilon_i\)</span> é o termo de erro estocástico, tipicamente assumido como <span class="math inline">\(\epsilon_i \sim \mathcal{N}(0, \sigma^2)\)</span>.</p></li>
</ul>
<p>A estimação dos parâmetros locais <span class="math inline">\(\hat{\boldsymbol{\beta}}(u_i, v_i)\)</span> é realizada através do método de Mínimos Quadrados Ponderados (<a href="https://en.wikipedia.org/wiki/Weighted_least_squares">WLS</a>), onde a ponderação é função da proximidade espacial. O estimador para a localização <span class="math inline">\(i\)</span> é:</p>
<p><span class="math display">\[\hat{\boldsymbol{\beta}}(u_i, v_i) = \left( \mathbf{X}^\top \mathbf{W}(i) \mathbf{X} \right)^{-1} \mathbf{X}^\top \mathbf{W}(i) \mathbf{y}.\]</span></p>
<p>A matriz <span class="math inline">\(\mathbf{W}(i)\)</span> é uma matriz diagonal <span class="math inline">\(n \times n\)</span> de pesos espaciais específica para a localização de calibração <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
\mathbf{W}(i) = \text{diag}\left(w_{i1}, w_{i2}, \dots, w_{in}\right) =
\begin{bmatrix}
w_{i1} &amp; 0 &amp; \cdots &amp; 0 \\
0 &amp; w_{i2} &amp; \cdots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \cdots &amp; w_{in}
\end{bmatrix},
\]</span></p>
<p>Cada elemento diagonal <span class="math inline">\(w_{ij}\)</span> representa o peso atribuído à observação <span class="math inline">\(j\)</span> quando o modelo é calibrado para a localização <span class="math inline">\(i\)</span>. Estes pesos são determinados por uma função kernel. Embora o kernel Gaussiano seja comum, <span class="citation" data-cites="gollini2015gwmodel">Gollini et al. (<a href="references.html#ref-gollini2015gwmodel" role="doc-biblioref">2015</a>)</span> destacam a importância de experimentar diferentes funções, como o kernel Bi-quadrado ou Box-car. O kernel Bi-quadrado, por exemplo, oferece eficiência computacional e um corte claro de influência, sendo definido como:</p>
<p><span class="math display">\[
w_{ij} = \begin{cases}
\left[1 - (d_{ij}/b)^2\right]^2 &amp; \text{se } d_{ij} &lt; b \\
0 &amp; \text{caso contrário}
\end{cases}
\]</span> onde <span class="math inline">\(b &gt; 0\)</span> é o parâmetro de largura de banda (ver outras em <span class="citation" data-cites="gollini2015gwmodel">(<a href="references.html#ref-gollini2015gwmodel" role="doc-biblioref">Gollini et al. 2015</a>)</span>), que controla o decaimento espacial da influência. Para <span class="math inline">\(i = j\)</span>, <span class="math inline">\(d_{ii} = 0\)</span>, resultando no peso máximo <span class="math inline">\(w_{ii} = 1\)</span>. Conforme <span class="math inline">\(d_{ij}\)</span> aumenta, <span class="math inline">\(w_{ij}\)</span> tende assintoticamente a zero, implementando a primeira lei da Geografia de Tobler.</p>
<p>A seleção da largura de banda ótima <span class="math inline">\(b\)</span> é fundamental, representando um compromisso entre viés e variância. Valores pequenos de <span class="math inline">\(b\)</span> produzem estimativas locais de alta variância (<em>overfitting</em>), enquanto valores grandes introduzem viés, aproximando o modelo de uma regressão global.</p>
<p>A seleção da largura de banda ótima <span class="math inline">\(b\)</span> pode ser definida de duas formas principais: Fixa (uma distância constante para todas as unidades) ou Adaptativa (um número fixo de <span class="math inline">\(N\)</span> vizinhos mais próximos). <span class="citation" data-cites="guo2008comparison">Guo, Ma, e Zhang (<a href="references.html#ref-guo2008comparison" role="doc-biblioref">2008</a>)</span> demonstram empiricamente que, em dados com agrupamento espacial, kernels adaptativos tendem a capturar melhor a heterogeneidade local do que kernels fixos, que podem suavizar excessivamente os padrões em áreas densas e sofrer com escassez de dados em áreas dispersas.</p>
<p>Mais do que um parâmetro técnico de ajuste, <span class="citation" data-cites="fotheringham2022notion">Fotheringham et al. (<a href="references.html#ref-fotheringham2022notion" role="doc-biblioref">2022</a>)</span> argumentam que a largura de banda deve ser interpretada como um indicador da escala do processo espacial. Segundo os autores, o valor ótimo de <span class="math inline">\(b\)</span> é determinado por três características do processo:</p>
<ol type="1">
<li><p>Variabilidade do parâmetro: Processos altamente heterogêneos exigem larguras de banda pequenas.</p></li>
<li><p>Dependência espacial: Processos com forte autocorrelação espacial tendem a resultar em larguras de banda menores.</p></li>
<li><p>Força do processo (ruído): Relações fracas ou com alto nível de erro (<span class="math inline">\(\sigma^2\)</span>) tendem a resultar em larguras de banda maiores, pois o modelo precisa “emprestar” mais dados para reduzir a incerteza da estimativa.</p></li>
</ol>
<p>A otimização de <span class="math inline">\(b\)</span> geralmente busca minimizar critérios como a Validação Cruzada (CV) ou o Critério de Informação de Akaike corrigido (AICc) <span class="citation" data-cites="hurvich1998regression fotheringham2002geographically">(<a href="references.html#ref-hurvich1998regression" role="doc-biblioref">Hurvich, Simonoff, e Tsai 1998</a>; <a href="references.html#ref-fotheringham2002geographically" role="doc-biblioref">Binbin Lu et al. 2014</a>)</span>:</p>
<p><span class="math display">\[
\text{AICc} = 2n \ln(\hat{\sigma}) + n \ln(2\pi) + n \frac{n + \text{tr}(\mathbf{S})}{n - 2 - \text{tr}(\mathbf{S})}.
\]</span></p>
<p>Nesta expressão, <span class="math inline">\(\text{tr}(\mathbf{S})\)</span> é o traço da matriz chapéu (hat matrix) <span class="math inline">\(\mathbf{S}\)</span>, que mapeia os valores observados <span class="math inline">\(\mathbf{y}\)</span> para os preditos <span class="math inline">\(\hat{\mathbf{y}}\)</span>, representando o número efetivo de parâmetros.</p>
<p>Na GWR a matriz <span class="math inline">\(\mathbf{S}\)</span> é construída linha por linha, pois cada observação <span class="math inline">\(i\)</span> possui sua própria matriz de pesos <span class="math inline">\(\mathbf{W}(i)\)</span>.</p>
<p>Conforme derivado por <span class="citation" data-cites="yu2019inference">Hanchen Yu et al. (<a href="references.html#ref-yu2019inference" role="doc-biblioref">2020</a>)</span>, o valor predito <span class="math inline">\(\hat{y}_i\)</span> é obtido multiplicando-se o vetor de covariáveis da observação <span class="math inline">\(i\)</span>, denotado por <span class="math inline">\(\mathbf{x}_i\)</span> (um vetor linha), pelos parâmetros estimados localmente:</p>
<p><span class="math display">\[\hat{y}_i = \mathbf{x}_i \hat{\boldsymbol{\beta}}(u_i, v_i) = \mathbf{x}_i \left( \mathbf{X}^\top \mathbf{W}(i) \mathbf{X} \right)^{-1} \mathbf{X}^\top \mathbf{W}(i) \mathbf{y}.\]</span></p>
<p>Definindo o vetor linha <span class="math inline">\(\mathbf{r}_i = \mathbf{x}_i (\mathbf{X}^\top \mathbf{W}(i) \mathbf{X})^{-1} \mathbf{X}^\top \mathbf{W}(i)\)</span>, a matriz completa <span class="math inline">\(\mathbf{S}\)</span> de dimensão <span class="math inline">\(n \times n\)</span> é formada pelo empilhamento destes vetores:</p>
<p><span class="math display">\[\mathbf{S} = \begin{bmatrix} \mathbf{r}_1 \\ \mathbf{r}_2 \\ \vdots \\ \mathbf{r}_n \end{bmatrix}.\]</span></p>
<p>Assim, temos a relação matricial <span class="math inline">\(\hat{\mathbf{y}} = \mathbf{S}\mathbf{y}\)</span>. O traço desta matriz, <span class="math inline">\(\text{tr}(\mathbf{S})\)</span>, utilizado no denominador do AICc, representa a soma das influências de cada observação sobre o seu próprio valor predito, fornecendo uma medida da complexidade do modelo equivalente aos graus de liberdade em modelos lineares generalizados <span class="citation" data-cites="fotheringham2002geographically">(<a href="references.html#ref-fotheringham2002geographically" role="doc-biblioref">Binbin Lu et al. 2014</a>)</span>.</p>
<p>Embora a minimização do AICc ou a Validação Cruzada (CV) sejam procedimentos padrão, a literatura recente aponta limitações nestes métodos automáticos. <span class="citation" data-cites="guo2008comparison">Guo, Ma, e Zhang (<a href="references.html#ref-guo2008comparison" role="doc-biblioref">2008</a>)</span> alertam que o critério AICc tende a ser conservador, selecionando frequentemente larguras de banda maiores que suavizam excessivamente os padrões espaciais, obscurecendo heterogeneidades locais biologicamente ou socialmente relevantes em favor de um ajuste global mais estável.</p>
<p>Adicionalmente, <span class="citation" data-cites="dasilva2018comparing">da Silva e Mendes (<a href="references.html#ref-dasilva2018comparing" role="doc-biblioref">2018</a>)</span> demonstram que a função objetivo de Validação Cruzada em modelos GWR com kernels adaptativos frequentemente não é estritamente convexa, apresentando múltiplos mínimos locais. O uso de algoritmos de otimização padrão, como a Busca de Seção Áurea (<a href="https://en.wikipedia.org/wiki/Golden-section_search">Golden Section Search</a>), pode convergir para soluções sub-ótimas, sugerindo a necessidade de algoritmos mais robustos como o <em>Lightning Search Algorithm</em> (ver <span class="citation" data-cites="Shareef2015LightningSearch">Shareef, Ibrahim, e Mutlag (<a href="references.html#ref-Shareef2015LightningSearch" role="doc-biblioref">2015</a>)</span>) ou abordagens híbridas de divisão de intervalo para garantir a identificação do mínimo global.</p>
<p>Alternativamente, <span class="citation" data-cites="koc2022bandwidth">Koç (<a href="references.html#ref-koc2022bandwidth" role="doc-biblioref">2022</a>)</span> propõe a substituição dos critérios clássicos por critérios de Complexidade de Informação (ICOMP). Ao penalizar não apenas o número de parâmetros, mas também a interdependência (estrutura de covariância) entre as estimativas dos parâmetros, o ICOMP demonstrou, em estudos de simulação e aplicações reais, selecionar larguras de banda que produzem modelos com maior precisão preditiva e melhor equilíbrio entre viés e variância do que o AICc ou CV.</p>
<p>A inferência estatística na GWR, como o cálculo de intervalos de confiança e testes de hipóteses para os parâmetros locais, requer a estimação da variância dos coeficientes locais. Reformulando a GWR como um modelo aditivo generalizado (GAM), <span class="citation" data-cites="yu2019inference">Hanchen Yu et al. (<a href="references.html#ref-yu2019inference" role="doc-biblioref">2020</a>)</span> fornecem a expressão para a matriz de covariância dos estimadores:</p>
<p><span class="math display">\[\text{Var}(\hat{\boldsymbol{\beta}}_j) = \text{diag}(\mathbf{C}\mathbf{C}^\top \hat{\sigma}^2)\]</span></p>
<p>onde <span class="math inline">\(\mathbf{C} = [\text{diag}(\mathbf{X}_j)]^{-1}\mathbf{R}_j\)</span> e <span class="math inline">\(\mathbf{R}_j\)</span> é a matriz de projeção específica da covariável. Isso permite o cálculo de erros-padrão locais precisos e o ajuste dos valores críticos da distribuição <span class="math inline">\(t\)</span> para evitar falsos positivos, garantindo que a heterogeneidade espacial detectada seja estatisticamente significante e não apenas ruído aleatório.</p>
<p>A reformulação do modelo GWR em modelo GAM, consistiu em não olhar o GWR como uma soma de produtos entre coeficientes variáveis e covariáveis. O vetor de resposta <span class="math inline">\(\mathbf{y}\)</span> é modelado como uma soma de funções suaves (<a href="https://en.wikipedia.org/wiki/Smoothness">smooth functions</a>) mais um termo de erro:</p>
<p><span class="math display">\[\mathbf{y} = \sum_{j=0}^{p} \mathbf{f}_j + \boldsymbol{\epsilon}, \quad \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2 \mathbf{I}_n)\]</span></p>
<p>No contexto da GWR, cada termo aditivo <span class="math inline">\(\mathbf{f}_j\)</span> representa o componente espacial da <span class="math inline">\(j\)</span>-ésima variável explicativa. Este termo é definido como o produto elemento a elemento entre a covariável e seu coeficiente espacialmente variável:</p>
<p><span class="math display">\[\mathbf{f}_j = \text{diag}(\mathbf{X}_j) \boldsymbol{\beta}_j\]</span></p>
<p>onde <span class="math inline">\(\mathbf{X}_j\)</span> é o vetor <span class="math inline">\(n \times 1\)</span> contendo as observações da <span class="math inline">\(j\)</span>-ésima variável independente, <span class="math inline">\(\text{diag}(\mathbf{X}_j)\)</span> é uma matriz diagonal com esses valores, e <span class="math inline">\(\boldsymbol{\beta}_j\)</span> é o vetor <span class="math inline">\(n \times 1\)</span> dos parâmetros locais para a variável <span class="math inline">\(j\)</span> em todas as localizações.</p>
<p>A calibração do modelo gera uma matriz de projeção específica <span class="math inline">\(\mathbf{R}_j\)</span> para cada covariável, tal que o valor ajustado para o componente <span class="math inline">\(j\)</span> é:</p>
<p><span class="math display">\[\hat{\mathbf{f}}_j = \mathbf{R}_j \mathbf{y}\]</span></p>
<p>Combinando as definições, temos que <span class="math inline">\(\text{diag}(\mathbf{X}_j) \hat{\boldsymbol{\beta}}_j = \mathbf{R}_j \mathbf{y}\)</span>. Isolando o vetor de parâmetros estimados <span class="math inline">\(\hat{\boldsymbol{\beta}}_j\)</span>, obtemos uma expressão linear em relação a <span class="math inline">\(\mathbf{y}\)</span>:</p>
<p><span class="math display">\[\hat{\boldsymbol{\beta}}_j = [\text{diag}(\mathbf{X}_j)]^{-1} \mathbf{R}_j \mathbf{y} = \mathbf{C}_j \mathbf{y}\]</span></p>
<p>onde definimos a matriz linear transformadora como <span class="math inline">\(\mathbf{C}_j = [\text{diag}(\mathbf{X}_j)]^{-1} \mathbf{R}_j\)</span>.</p>
<p>Com o estimador <span class="math inline">\(\hat{\boldsymbol{\beta}}_j\)</span> expresso como uma combinação linear da variável resposta (<span class="math inline">\(\mathbf{C}_j \mathbf{y}\)</span>), a derivação de sua variância torna-se direta, aplicando as propriedades de variância de operadores lineares (<span class="math inline">\(\text{Var}(\mathbf{A}\mathbf{y}) = \mathbf{A}\text{Var}(\mathbf{y})\mathbf{A}^\top\)</span>):</p>
<p><span class="math display">\[\text{Var}(\hat{\boldsymbol{\beta}}_j) = \text{Var}(\mathbf{C}_j \mathbf{y}) = \mathbf{C}_j \text{Var}(\boldsymbol{\epsilon}) \mathbf{C}_j^\top = \mathbf{C}_j (\sigma^2 \mathbf{I}) \mathbf{C}_j^\top\]</span></p>
<p>Portanto, a matriz de covariância para as estimativas dos parâmetros locais da <span class="math inline">\(j\)</span>-ésima variável é dada por <span class="citation" data-cites="yu2019inference">(<a href="references.html#ref-yu2019inference" role="doc-biblioref">Hanchen Yu et al. 2020</a>)</span>:</p>
<p><span class="math display">\[\text{Var}(\hat{\boldsymbol{\beta}}_j) = \sigma^2 \mathbf{C}_j \mathbf{C}_j^\top\]</span></p>
<p>Os erros-padrão locais para a localização <span class="math inline">\(i\)</span> e variável <span class="math inline">\(j\)</span> são obtidos simplesmente pela raiz quadrada dos elementos diagonais desta matriz:</p>
<p><span class="math display">\[SE(\hat{\beta}_{ij}) = \sqrt{\left( \text{Var}(\hat{\boldsymbol{\beta}}_j) \right)_{ii}}\]</span></p>
<p>Este formalismo permite a construção de estatísticas <span class="math inline">\(t\)</span> locais (<span class="math inline">\(t_{ij} = \hat{\beta}_{ij} / SE(\hat{\beta}_{ij})\)</span>). Contudo, a realização de testes individuais para cada localização incorre no problema de comparações múltiplas. Para mitigar o aumento da taxa de erro tipo I sem a severidade excessiva da correção de Bonferroni, <span class="citation" data-cites="dasilva2016multiple">da Silva e Fotheringham (<a href="references.html#ref-dasilva2016multiple" role="doc-biblioref">2016</a>)</span> propõem o ajuste do nível de significância <span class="math inline">\(\alpha\)</span> baseando-se no número efetivo de parâmetros (<span class="math inline">\(\text{ENP}_j = \text{tr}(\mathbf{R}_j)\)</span>) específico de cada covariável, garantindo que a heterogeneidade espacial detectada seja estatisticamente significativa.</p>
<p>Uma limitação inerente do modelo GWR é a suposição de uma única escala espacial para todos os processos, uma vez que utiliza uma largura de banda <span class="math inline">\(b\)</span> comum a todas as variáveis independentes. Como notado por <span class="citation" data-cites="yang2011extension Yang2014FlexibleBandwidthGWR">(<a href="references.html#ref-yang2011extension" role="doc-biblioref">Wenbai Yang, Fotheringham, e Harris 2011</a>; <a href="references.html#ref-Yang2014FlexibleBandwidthGWR" role="doc-biblioref">Wenbo Yang 2014</a>)</span> e formalizado por <span class="citation" data-cites="fotheringham2017multiscale">Fotheringham, Yang, e Kang (<a href="references.html#ref-fotheringham2017multiscale" role="doc-biblioref">2017</a>)</span>, diferentes processos (ex: renda, clima, topografia) operam em escalas distintas. Esta restrição motivou o desenvolvimento da Regressão Geograficamente Ponderada Multiescalar (MGWR).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(GWmodel, sf, sp, spdep, ggplot2, viridis, gridExtra, dplyr,kableExtra, geobr, ggspatial)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"mg_dados"</span>)) {</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  mg_dados <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"MG"</span>, <span class="at">year =</span> <span class="dv">2020</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>mg_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mg_dados, <span class="dv">5880</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>) </span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(mg_proj))</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mg_proj)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Variável X1</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>mg_proj<span class="sc">$</span>X1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">10</span>, <span class="dv">2</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Variável X2</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>mg_proj<span class="sc">$</span>X2 <span class="ot">&lt;-</span> <span class="fl">0.3</span> <span class="sc">*</span> mg_proj<span class="sc">$</span>X1 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">5</span>, <span class="dv">1</span>)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>lat_norm <span class="ot">&lt;-</span> (coords[,<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">min</span>(coords[,<span class="dv">2</span>])) <span class="sc">/</span> (<span class="fu">max</span>(coords[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="fu">min</span>(coords[,<span class="dv">2</span>]))</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>beta1_local <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">+</span> (<span class="fl">2.0</span> <span class="sc">*</span> lat_norm) </span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>lon_norm <span class="ot">&lt;-</span> (coords[,<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">min</span>(coords[,<span class="dv">1</span>])) <span class="sc">/</span> (<span class="fu">max</span>(coords[,<span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">min</span>(coords[,<span class="dv">1</span>]))</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>beta2_local <span class="ot">&lt;-</span> <span class="fl">3.0</span> <span class="sc">-</span> (<span class="fl">1.5</span> <span class="sc">*</span> lon_norm)</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Variável Dependente Y = Intercepto + Beta1*X1 + Beta2*X2 + Erro</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>mg_proj<span class="sc">$</span>Y <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> (beta1_local <span class="sc">*</span> mg_proj<span class="sc">$</span>X1) <span class="sc">+</span> (beta2_local <span class="sc">*</span> mg_proj<span class="sc">$</span>X2) <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Conversão para Objeto Spatial (Requisito do GWmodel)</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>mg_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(mg_proj, <span class="st">"Spatial"</span>)</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a><span class="co">#DIAGNÓSTICO DE COLINEARIDADE LOCAL</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleção da largura da banda (bandwidth)</span></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>bw_diag <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, <span class="at">data =</span> mg_sp, <span class="at">approach =</span> <span class="st">"AICc"</span>, </span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel =</span> <span class="st">"bisquare"</span>, <span class="at">adaptive =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Adaptive bandwidth (number of nearest neighbours): 534 AICc value: 3863.265 
Adaptive bandwidth (number of nearest neighbours): 338 AICc value: 3401.226 
Adaptive bandwidth (number of nearest neighbours): 215 AICc value: 3093.095 
Adaptive bandwidth (number of nearest neighbours): 141 AICc value: 2892.588 
Adaptive bandwidth (number of nearest neighbours): 93 AICc value: 2771.422 
Adaptive bandwidth (number of nearest neighbours): 65 AICc value: 2728.761 
Adaptive bandwidth (number of nearest neighbours): 46 AICc value: 2717.541 
Adaptive bandwidth (number of nearest neighbours): 36 AICc value: 2740.905 
Adaptive bandwidth (number of nearest neighbours): 54 AICc value: 2720.107 
Adaptive bandwidth (number of nearest neighbours): 43 AICc value: 2721.94 
Adaptive bandwidth (number of nearest neighbours): 50 AICc value: 2718.747 
Adaptive bandwidth (number of nearest neighbours): 45 AICc value: 2718.291 
Adaptive bandwidth (number of nearest neighbours): 48 AICc value: 2718.798 
Adaptive bandwidth (number of nearest neighbours): 46 AICc value: 2717.541 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Bandwidth Ótimo (k vizinhos):"</span>, bw_diag)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Bandwidth Ótimo (k vizinhos): 46"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>collin_diag <span class="ot">&lt;-</span> <span class="fu">gwr.collin.diagno</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, <span class="at">data =</span> mg_sp, <span class="at">bw =</span> bw_diag, </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">kernel =</span> <span class="st">"bisquare"</span>, <span class="at">adaptive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(collin_diag<span class="sc">$</span>SDF<span class="sc">$</span>local_CN))</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  10.11   17.13   19.03   19.53   21.58   33.93 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajuste do Modelo GWR</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>gwr_model <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> mg_sp, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bw =</span> bw_diag, </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kernel =</span> <span class="st">"bisquare"</span>, </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">adaptive =</span> <span class="cn">TRUE</span>, </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">F123.test =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co">#print(gwr_model)</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co">#INFERÊNCIA  (descomente leva tempo para rodar)</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co">#mc_test &lt;- gwr.montecarlo(Y ~ X1 + X2, </span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                          data = mg_sp, </span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                          nsims = 99, </span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                          kernel = "bisquare", </span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a> <span class="co">#                         adaptive = TRUE, </span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a> <span class="co">#                         bw = bw_diag)</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co">#print(mc_test)</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>gwr_adj <span class="ot">&lt;-</span> <span class="fu">gwr.t.adjust</span>(gwr_model)</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Nota, precisamos extrair os resultados para fazer os mapas</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair resultados para SF</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>results_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(gwr_adj<span class="sc">$</span>SDF)</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimativa do Coeficiente Local (Beta X1)</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>p_beta <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results_sf) <span class="sc">+</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> X1_t), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)[<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A)"</span>) <span class="sc">+</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>p_beta2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results_sf) <span class="sc">+</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> X2_t), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B)"</span>) <span class="sc">+</span></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a><span class="co"># valor-p ajustado</span></span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a>p_sig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results_sf) <span class="sc">+</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> X2_p_by <span class="sc">&lt;</span> <span class="fl">0.05</span>), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"#377eb8"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"gray95"</span>), </span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"Significativo</span><span class="sc">\n</span><span class="st">(p-adj &lt; 0.05)"</span>) <span class="sc">+</span></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C)"</span>) <span class="sc">+</span></span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Resíduos</span></span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(results_sf, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>results_sf<span class="sc">$</span>residual <span class="ot">&lt;-</span> gwr_model<span class="sc">$</span>SDF<span class="sc">$</span>residual</span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>moran_gwr <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(results_sf<span class="sc">$</span>residual, lw, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a>label_moran <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_gwr<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a>                      <span class="st">" (p = "</span>, <span class="fu">round</span>(moran_gwr<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>)</span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a>p_resid <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results_sf) <span class="sc">+</span></span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> residual), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#d73027"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"#4575b4"</span>, </span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">name =</span> <span class="st">"Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"D)"</span>, </span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> label_moran) <span class="sc">+</span></span>
<span id="cb73-75"><a href="#cb73-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb73-76"><a href="#cb73-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a>(p_beta <span class="sc">|</span>p_beta2 )<span class="sc">/</span>(p_sig <span class="sc">|</span>p_resid)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lattice_data_files/figure-html/gwr-best-practice-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="regressão-geograficamente-ponderada-multiescalar-mgwr" class="level3" data-number="4.15.2">
<h3 data-number="4.15.2" class="anchored" data-anchor-id="regressão-geograficamente-ponderada-multiescalar-mgwr"><span class="header-section-number">4.15.2</span> Regressão Geograficamente Ponderada Multiescalar (MGWR)</h3>
<p>A aplicação da GWR impõe uma restrição: a suposição de que todos os processos modelados operam na mesma escala espacial. Isto decorre da estimação de uma única largura de banda ótima <span class="math inline">\(b\)</span> para todas as covariáveis simultaneamente. Contudo, em sistemas geográficos complexos, é intuitivo e frequentemente observado que diferentes preditores influenciem a variável resposta em escalas distintas <span class="citation" data-cites="fotheringham2017multiscale Yang2014FlexibleBandwidthGWR">(<a href="references.html#ref-fotheringham2017multiscale" role="doc-biblioref">Fotheringham, Yang, e Kang 2017</a>; <a href="references.html#ref-Yang2014FlexibleBandwidthGWR" role="doc-biblioref">Wenbo Yang 2014</a>)</span>.</p>
<p>Por exemplo, em um modelo de preços imobiliários, a influência da proximidade a uma centralidade metropolitana pode variar suavemente em uma escala regional (processo de larga escala), enquanto o efeito da qualidade da infraestrutura local (como pavimentação) pode mudar abruptamente entre quarteirões adjacentes (processo de escala local). A imposição de uma largura de banda única na GWR introduz viés nas estimativas de processos localmente heterogêneos (ao suavizá-los excessivamente) e aumenta a variância das estimativas de processos globalmente estáveis (ao torná-las desnecessariamente ruidosas) <span class="citation" data-cites="fotheringham2002geographically">(<a href="references.html#ref-fotheringham2002geographically" role="doc-biblioref">Binbin Lu et al. 2014</a>)</span>.</p>
<p>Adicionalmente, estudos demonstram que o uso de uma largura de banda única pode exacerbar problemas de multicolinearidade local e concurvidade (colinearidade funcional em modelos não paramétricos), levando a coeficientes instáveis e de difícil interpretação <span class="citation" data-cites="wheeler2005multicollinearity">(<a href="references.html#ref-wheeler2005multicollinearity" role="doc-biblioref">Wheeler e Tiefelsdorf 2005</a>)</span>. <span class="citation" data-cites="oshan2020targeting">Oshan, Smith, e Fotheringham (<a href="references.html#ref-oshan2020targeting" role="doc-biblioref">2020</a>)</span> evidenciam, em um estudo sobre determinantes espaciais da obesidade, que a GWR consome excessivos graus de liberdade ao forçar a modelagem local de processos que são, na verdade, globais. Isto resulta em sobreajuste e perda de parcimônia. A abordagem multiescalar, ao permitir que processos globais sejam modelados como tal (com larguras de banda tendendo ao infinito), produz modelos mais parcimoniosos, com menor AICc e diagnósticos de colinearidade mais robustos.</p>
<p>A MGWR relaxa a suposição de homogeneidade de escala da GWR, permitindo que cada covariável possua sua própria largura de banda ótima <span class="math inline">\(bw_j\)</span>. Isto transforma a largura de banda de um parâmetro de suavização em um indicador empírico das propriedades espaciais intrínsecas de cada relação causal investigada <span class="citation" data-cites="fotheringham2017multiscale">(<a href="references.html#ref-fotheringham2017multiscale" role="doc-biblioref">Fotheringham, Yang, e Kang 2017</a>)</span>.</p>
<p>O modelo MGWR para uma observação na localização <span class="math inline">\(i\)</span> é formalmente especificado como:</p>
<p><span class="math display">\[
y_i = \beta_0(u_i, v_i; bw_0) + \sum_{j=1}^{p} \beta_j(u_i, v_i; bw_j) \, x_{ij} + \epsilon_i, \quad \epsilon_i \sim \mathcal{N}(0, \sigma^2),
\]</span></p>
<p>onde a notação <span class="math inline">\(\beta_j(\cdot; bw_j)\)</span> enfatiza que a superfície do coeficiente associado à <span class="math inline">\(j\)</span>-ésima covariável é estimada utilizando uma função kernel com largura de banda específica <span class="math inline">\(bw_j\)</span>. O intercepto <span class="math inline">\(\beta_0\)</span> também possui sua própria escala, <span class="math inline">\(bw_0\)</span>.</p>
<p>Diferentemente da GWR, que possui uma solução em forma fechada via Mínimos Quadrados Ponderados para cada localização, a MGWR não tem uma solução analítica direta devido à dependência mútua das superfícies de coeficientes estimadas com diferentes larguras de banda. A estratégia padrão de estimação reformula o problema dentro da estrutura dos Modelos Aditivos Generalizados (GAMs) <span class="citation" data-cites="yu2019inference">(<a href="references.html#ref-yu2019inference" role="doc-biblioref">Hanchen Yu et al. 2020</a>)</span>.</p>
<p>O modelo é reescrito como uma soma de funções suaves:</p>
<p><span class="math display">\[
\mathbf{y} = \sum_{j=0}^{p} \mathbf{f}_j + \boldsymbol{\epsilon},
\]</span></p>
<p>onde cada termo aditivo <span class="math inline">\(\mathbf{f}_j\)</span> é um vetor <span class="math inline">\(n \times 1\)</span> que representa a contribuição espacialmente suave da <span class="math inline">\(j\)</span>-ésima covariável. No contexto da MGWR, <span class="math inline">\(\mathbf{f}_j = \text{diag}(\mathbf{x}_j) \, \boldsymbol{\beta}_j\)</span>, com <span class="math inline">\(\boldsymbol{\beta}_j\)</span> sendo o vetor de coeficientes locais para a covariável <span class="math inline">\(j\)</span>.</p>
<p>A estimação é realizada através de um algoritmo iterativo de <em>back-fitting</em>, inspirado na estimação de GAMs <span class="citation" data-cites="hastie1990generalized">(<a href="references.html#ref-hastie1990generalized" role="doc-biblioref">Hastie e Tibshirani 1990</a>)</span>. O procedimento, detalhado por <span class="citation" data-cites="fotheringham2017multiscale">Fotheringham, Yang, e Kang (<a href="references.html#ref-fotheringham2017multiscale" role="doc-biblioref">2017</a>)</span> e <span class="citation" data-cites="yu2019inference">Hanchen Yu et al. (<a href="references.html#ref-yu2019inference" role="doc-biblioref">2020</a>)</span>, segue os seguintes passos:</p>
<ol type="1">
<li><p>Inicialização: As funções <span class="math inline">\(\hat{\mathbf{f}}_j^{(0)}\)</span> são inicializadas, por exemplo, com as estimativas de um modelo de regressão linear ou de uma GWR com banda única.</p></li>
<li><p>Iteração (<em>Back-fitting</em>): Para cada covariável <span class="math inline">\(j = 0, 1, \dots, p\)</span> na iteração <span class="math inline">\([k+1]\)</span>:</p>
<ol type="a">
<li><p>Calcula-se o resíduo parcial removendo a contribuição atual de todas as outras covariáveis: <span class="math display">\[
\mathbf{r}_j^{[k]} = \mathbf{y} - \sum_{l &lt; j} \hat{\mathbf{f}}_l^{[k+1]} - \sum_{l &gt; j} \hat{\mathbf{f}}_l^{[k]}.
\]</span></p></li>
<li><p>Ajusta-se um modelo GWR univariado do resíduo parcial <span class="math inline">\(\mathbf{r}_j^{[k]}\)</span> contra a covariável <span class="math inline">\(\mathbf{x}_j\)</span>. Nesta etapa, otimiza-se a largura de banda específica <span class="math inline">\(bw_j\)</span> que minimiza um critério de informação (usualmente o AICc) para este submodelo.</p></li>
<li><p>Atualiza-se a estimativa da função: <span class="math inline">\(\hat{\mathbf{f}}_j^{[k+1]} = \text{diag}(\mathbf{x}_j) \, \hat{\boldsymbol{\beta}}_j^{[k+1]}\)</span>, onde <span class="math inline">\(\hat{\boldsymbol{\beta}}_j^{[k+1]}\)</span> é o vetor de coeficientes obtido do modelo GWR univariado calibrado com <span class="math inline">\(bw_j^{[k+1]}\)</span>.</p></li>
</ol></li>
<li><p>Convergência: O algoritmo itera até que a mudança nas estimativas dos coeficientes ou na soma dos quadrados dos resíduos entre iterações sucessivas seja inferior a um limiar pré-definido (ex: <span class="math inline">\(10^{-5}\)</span>). <span class="citation" data-cites="Yang2014FlexibleBandwidthGWR">Wenbo Yang (<a href="references.html#ref-Yang2014FlexibleBandwidthGWR" role="doc-biblioref">2014</a>)</span> introduz o conceito de <em>Score of Change (SOC)</em> para monitorar esta convergência.</p></li>
</ol>
<p>A estabilidade deste processo depende do algoritmo de otimização utilizado para encontrar cada <span class="math inline">\(bw_j\)</span>. Conforme destacado por <span class="citation" data-cites="dasilva2018comparing">da Silva e Mendes (<a href="references.html#ref-dasilva2018comparing" role="doc-biblioref">2018</a>)</span>, a superfície do critério de seleção (AICc ou CV) para larguras de banda adaptativos é frequentemente não convexa e multimodal. Portanto, métodos robustos como a busca exaustiva em grade (<a href="https://en.wikipedia.org/wiki/Hyperparameter_optimization">grid search</a>) ou algoritmos heurísticos são preferíveis ao método padrão de Busca da Seção Áurea para evitar mínimos locais subóptimos.</p>
<p>A principal inovação da MGWR é a capacidade de interpretar as larguras de banda <span class="math inline">\(bw_j\)</span> como métricas da escala espacial de cada processo. Baseando-se na teoria desenvolvida por <span class="citation" data-cites="fotheringham2022notion">Fotheringham et al. (<a href="references.html#ref-fotheringham2022notion" role="doc-biblioref">2022</a>)</span>, pode-se inferir que:</p>
<ul>
<li><p><span class="math inline">\(bw_j\)</span> pequeno: Indica um processo localmente heterogêneo, onde a relação entre <span class="math inline">\(x_j\)</span> e <span class="math inline">\(y\)</span> muda rapidamente no espaço. Isto pode ser causado por alta variabilidade do parâmetro verdadeiro ou por forte dependência espacial de curto alcance.</p></li>
<li><p><span class="math inline">\(bw_j\)</span> grande (próximo de <span class="math inline">\(n\)</span>): Indica um processo regional ou globalmente estável, onde a relação é aproximadamente constante no espaço. Quando <span class="math inline">\(bw_j \to \infty\)</span>, o coeficiente <span class="math inline">\(\beta_j\)</span> converge para uma constante, recuperando a estacionariedade do modelo OLS.</p></li>
</ul>
<p>A análise dessas escalas não deve ser estática. <span class="citation" data-cites="lu2023uncovering">Bo Lu et al. (<a href="references.html#ref-lu2023uncovering" role="doc-biblioref">2023</a>)</span> demonstram, em um estudo longitudinal do mercado imobiliário, que as larguras de banda ótimas podem evoluir temporalmente, refletindo mudanças na estrutura subjacente do fenômeno (ex.: a influência de áreas verdes tornar-se mais localizada após a implementação de políticas urbanas específicas).</p>
<p>Para realizar inferência estatística na MGWR, é necessário estimar a variância das superfícies de coeficientes. <span class="citation" data-cites="yu2019inference">Hanchen Yu et al. (<a href="references.html#ref-yu2019inference" role="doc-biblioref">2020</a>)</span> estendem o arcabouço de inferência da GWR para o caso multiescalar.</p>
<p>O modelo MGWR completo pode ser representado por uma única matriz de projeção (ou <em>hat matrix</em>) <span class="math inline">\(\mathbf{S}_{MGWR}\)</span>, tal que <span class="math inline">\(\hat{\mathbf{y}} = \mathbf{S}_{MGWR} \, \mathbf{y}\)</span>. Esta matriz é complexa de derivar analiticamente, mas pode ser entendida como o resultado da composição das operações de <em>back-fitting</em>. A contribuição de cada covariável é associada a uma matriz de suavização <span class="math inline">\(\mathbf{S}_j(bw_j)\)</span>.</p>
<p>A variância do estimador para o vetor de coeficientes da covariável <span class="math inline">\(j\)</span>, <span class="math inline">\(\hat{\boldsymbol{\beta}}_j\)</span>, é dada por:</p>
<p><span class="math display">\[
\text{Var}(\hat{\boldsymbol{\beta}}_j) = \sigma^2 \, \mathbf{C}_j \mathbf{C}_j^\top, \quad \text{onde} \quad \mathbf{C}_j = [\text{diag}(\mathbf{x}_j)]^{-1} \mathbf{S}_j(bw_j).
\]</span></p>
<p>Os erros-padrão locais para <span class="math inline">\(\hat{\beta}_j(u_i, v_i)\)</span> são as raízes quadradas dos elementos diagonais correspondentes de <span class="math inline">\(\text{Var}(\hat{\boldsymbol{\beta}}_j)\)</span>. Estatísticas <span class="math inline">\(t\)</span> locais podem então ser construídas para testar hipóteses pontuais (ex.: <span class="math inline">\(\beta_j(u_i, v_i) = 0\)</span>).</p>
<p>Contudo, a realização de testes simultâneos em centenas ou milhares de localizações incorre no problema de comparações múltiplas. <span class="citation" data-cites="dasilva2016multiple">da Silva e Fotheringham (<a href="references.html#ref-dasilva2016multiple" role="doc-biblioref">2016</a>)</span> propõem uma correção baseada no Número Efetivo de Parâmetros (ENP) específico de cada superfície. O nível de significância <span class="math inline">\(\alpha\)</span> é ajustado utilizando <span class="math inline">\(ENP_j = \text{tr}(\mathbf{S}_j(bw_j))\)</span> como uma medida dos graus de liberdade consumidos pela covariável <span class="math inline">\(j\)</span>, oferecendo um controle mais adequado da taxa de erro tipo I do que a correção de Bonferroni excessivamente conservadora.</p>
<p>A lógica multiescalar foi estendida para incorporar explicitamente a dimensão temporal, resultando no modelo MGWR Espaço-Temporal (MGTWR) <span class="citation" data-cites="wu2018multiscale fotheringham2020">(<a href="references.html#ref-wu2018multiscale" role="doc-biblioref">Wu et al. 2019</a>; <a href="references.html#ref-fotheringham2020" role="doc-biblioref">Huili Yu et al. 2020</a>)</span>. Nesta formulação, cada covariável possui uma largura de banda espacial (<span class="math inline">\(h_S\)</span>) e uma largura de banda temporal (<span class="math inline">\(h_T\)</span>) específicas, definidas por um kernel espaço-temporal (ex.: produto de kernels separáveis).</p>
<p>O modelo MGTWR permite discriminar processos que são (1) espacialmente locais mas temporalmente estáveis (ex.: efeito de uma escola no preço da habitação); (2) espacialmente globais mas temporalmente voláteis (ex.: impacto de uma política monetária nacional).</p>
<p>A calibração envolve a otimização conjunta de <span class="math inline">\(h_S\)</span> e <span class="math inline">\(h_T\)</span> para cada termo, aumentando a complexidade computacional, mas oferecendo uma representação mais rica da dinâmica espaço-temporal.</p>
<p>A flexibilidade da MGWR tem facilitado sua integração com fontes de dados não tradicionais e de alta dimensão. Exemplos incluem:</p>
<ul>
<li><p>Imagens de <em>Street View</em> e Visão Computacional: <span class="citation" data-cites="he2022multiscale">He et al. (<a href="references.html#ref-he2022multiscale" role="doc-biblioref">2022</a>)</span> utilizaram a MGWR para modelar a relação entre características visuais extraídas do <em>Google Street View</em> (vegetação, manutenção de edifícios) e taxas de criminalidade em Nova York, revelando que a influência de certas características varia espacialmente em escalas diferentes.</p></li>
<li><p>Dados de mobilidade e redes sociais: <span class="citation" data-cites="liu2023multiscale">Liu, Chau, e Bao (<a href="references.html#ref-liu2023multiscale" role="doc-biblioref">2023</a>)</span> aplicaram a MGWR para analisar como diferentes fatores socioeconômicos, em diferentes escalas espaciais, explicam padrões de uso do transporte público derivados de dados de cartões inteligentes.</p></li>
</ul>
<p>Nestes contextos, a MGWR frequentemente supera modelos tradicionais (OLS, SLM, SEM, GWR padrão) em medidas de ajuste (<span class="math inline">\(R^2\)</span> ajustado, AICc) e capacidade explicativa, por sua aptidão em capturar a multiescalaridade inerente a processos urbanos e sociais complexos.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(GWmodel, sf, sp, ggplot2, viridis, gridExtra, kableExtra, dplyr, ggspatial)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#CALIBRAÇÃO DO MODELO MGWR </span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mgwr_model <span class="ot">&lt;-</span> <span class="fu">gwr.multiscale</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> Y <span class="sc">~</span> X1 <span class="sc">+</span> X2,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mg_sp,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"bisquare"</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive =</span> <span class="cn">TRUE</span>,         </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">criterion =</span> <span class="st">"dCVR"</span>,      <span class="co"># Critério de convergência robusto</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">1e-5</span>,        <span class="co"># Tolerância para convergência</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.iterations =</span> <span class="dv">100</span>,   </span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictor.centered =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>) <span class="co"># Centralizar X1 e X2</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<p>—— Calculate the initial bandwidths for each independent variable —— Now select an optimum bandwidth for the model: Y~1 [1] “bws0[i]&lt;-bw.gwr(Y~1,data=regression.points,kernel=kernel,approach=approach,adaptive=adaptive,dMat=dMats[[var.dMat.indx[i]]], parallel.method=parallel.method,parallel.arg=parallel.arg)” Adaptive bandwidth (number of nearest neighbours): 534 AICc value: 5108.313 Adaptive bandwidth (number of nearest neighbours): 338 AICc value: 5024.466 Adaptive bandwidth (number of nearest neighbours): 215 AICc value: 4988.935 Adaptive bandwidth (number of nearest neighbours): 141 AICc value: 4974.096 Adaptive bandwidth (number of nearest neighbours): 93 AICc value: 4967.439 Adaptive bandwidth (number of nearest neighbours): 65 AICc value: 4969.396 Adaptive bandwidth (number of nearest neighbours): 111 AICc value: 4969.312 Adaptive bandwidth (number of nearest neighbours): 82 AICc value: 4967.451 Adaptive bandwidth (number of nearest neighbours): 100 AICc value: 4967.842 Adaptive bandwidth (number of nearest neighbours): 89 AICc value: 4967.256 Adaptive bandwidth (number of nearest neighbours): 86 AICc value: 4967.559 Adaptive bandwidth (number of nearest neighbours): 90 AICc value: 4967.335 Adaptive bandwidth (number of nearest neighbours): 87 AICc value: 4967.546 Adaptive bandwidth (number of nearest neighbours): 89 AICc value: 4967.256 Now select an optimum bandwidth for the model: Y~X1 [1] “bws0[i]&lt;-bw.gwr(Y~X1,data=regression.points,kernel=kernel,approach=approach,adaptive=adaptive,dMat=dMats[[var.dMat.indx[i]]], parallel.method=parallel.method,parallel.arg=parallel.arg)” Adaptive bandwidth (number of nearest neighbours): 534 AICc value: 4405.382 Adaptive bandwidth (number of nearest neighbours): 338 AICc value: 4196.427 Adaptive bandwidth (number of nearest neighbours): 215 AICc value: 4092.447 Adaptive bandwidth (number of nearest neighbours): 141 AICc value: 4040.078 Adaptive bandwidth (number of nearest neighbours): 93 AICc value: 4016.505 Adaptive bandwidth (number of nearest neighbours): 65 AICc value: 4021.724 Adaptive bandwidth (number of nearest neighbours): 111 AICc value: 4022.917 Adaptive bandwidth (number of nearest neighbours): 82 AICc value: 4015.8 Adaptive bandwidth (number of nearest neighbours): 75 AICc value: 4016.762 Adaptive bandwidth (number of nearest neighbours): 86 AICc value: 4015.667 Adaptive bandwidth (number of nearest neighbours): 89 AICc value: 4015.827 Adaptive bandwidth (number of nearest neighbours): 84 AICc value: 4016.029 Adaptive bandwidth (number of nearest neighbours): 87 AICc value: 4015.536 Adaptive bandwidth (number of nearest neighbours): 88 AICc value: 4015.645 Adaptive bandwidth (number of nearest neighbours): 87 AICc value: 4015.536 Now select an optimum bandwidth for the model: Y~X2 [1] “bws0[i]&lt;-bw.gwr(Y~X2,data=regression.points,kernel=kernel,approach=approach,adaptive=adaptive,dMat=dMats[[var.dMat.indx[i]]], parallel.method=parallel.method,parallel.arg=parallel.arg)” Adaptive bandwidth (number of nearest neighbours): 534 AICc value: 4416.663 Adaptive bandwidth (number of nearest neighbours): 338 AICc value: 4203.26 Adaptive bandwidth (number of nearest neighbours): 215 AICc value: 4094.814 Adaptive bandwidth (number of nearest neighbours): 141 AICc value: 4045.604 Adaptive bandwidth (number of nearest neighbours): 93 AICc value: 4030.648 Adaptive bandwidth (number of nearest neighbours): 65 AICc value: 4034.646 Adaptive bandwidth (number of nearest neighbours): 111 AICc value: 4033.74 Adaptive bandwidth (number of nearest neighbours): 82 AICc value: 4029.413 Adaptive bandwidth (number of nearest neighbours): 75 AICc value: 4029.958 Adaptive bandwidth (number of nearest neighbours): 86 AICc value: 4029.663 Adaptive bandwidth (number of nearest neighbours): 79 AICc value: 4029.528 Adaptive bandwidth (number of nearest neighbours): 83 AICc value: 4029.424 Adaptive bandwidth (number of nearest neighbours): 80 AICc value: 4029.383 Adaptive bandwidth (number of nearest neighbours): 80 AICc value: 4029.383 —— The end for the initial selections —— Calculate the initial beta0 from the above bandwidths. End of calculating the inital beta0. Find the optimum bandwidths for each independent variable. Iteration 1 Now select an optimum bandwidth for the variable: Intercept The newly selected bandwidth for variable: Intercept is 32 The bandwidth used in the last iteration is: 89 and the difference in bandwidths is: 57 The bandwidth for variable Intercept will be continually selected in the next iteration. Now select an optimum bandwidth for the variable: X1 The newly selected bandwidth for variable: X1 is 97 The bandwidth used in the last iteration is: 87 and the difference in bandwidths is: 10 The bandwidth for variable X1 will be continually selected in the next iteration. Now select an optimum bandwidth for the variable: X2 The newly selected bandwidth for variable: X2 is 238 The bandwidth used in the last iteration is: 80 and the difference in bandwidths is: 158 The bandwidth for variable X2 will be continually selected in the next iteration. Iteration 1 change of RSS (dCVR) is 0.0572369. Iteration 2 Now select an optimum bandwidth for the variable: Intercept The newly selected bandwidth for variable: Intercept is 32 The bandwidth used in the last iteration is: 32 and the difference in bandwidths is: 0 The bandwidth for variable Intercept seems to be converged for 1 times. It will be continually optimized in the next 4 times Now select an optimum bandwidth for the variable: X1 The newly selected bandwidth for variable: X1 is 130 The bandwidth used in the last iteration is: 97 and the difference in bandwidths is: 33 The bandwidth for variable X1 will be continually selected in the next iteration. Now select an optimum bandwidth for the variable: X2 The newly selected bandwidth for variable: X2 is 267 The bandwidth used in the last iteration is: 238 and the difference in bandwidths is: 29 The bandwidth for variable X2 will be continually selected in the next iteration. Iteration 2 change of RSS (dCVR) is 0.0819936. Iteration 3 Now select an optimum bandwidth for the variable: Intercept The newly selected bandwidth for variable: Intercept is 32 The bandwidth used in the last iteration is: 32 and the difference in bandwidths is: 0 The bandwidth for variable Intercept seems to be converged for 2 times. It will be continually optimized in the next 3 times Now select an optimum bandwidth for the variable: X1 The newly selected bandwidth for variable: X1 is 130 The bandwidth used in the last iteration is: 130 and the difference in bandwidths is: 0 The bandwidth for variable X1 seems to be converged for 1 times. It will be continually optimized in the next 4 times Now select an optimum bandwidth for the variable: X2 The newly selected bandwidth for variable: X2 is 267 The bandwidth used in the last iteration is: 267 and the difference in bandwidths is: 0 The bandwidth for variable X2 seems to be converged for 1 times. It will be continually optimized in the next 4 times Iteration 3 change of RSS (dCVR) is 0.0417213. Iteration 4 Now select an optimum bandwidth for the variable: Intercept The newly selected bandwidth for variable: Intercept is 32 The bandwidth used in the last iteration is: 32 and the difference in bandwidths is: 0 The bandwidth for variable Intercept seems to be converged for 3 times. It will be continually optimized in the next 2 times Now select an optimum bandwidth for the variable: X1 The newly selected bandwidth for variable: X1 is 130 The bandwidth used in the last iteration is: 130 and the difference in bandwidths is: 0 The bandwidth for variable X1 seems to be converged for 2 times. It will be continually optimized in the next 3 times Now select an optimum bandwidth for the variable: X2 The newly selected bandwidth for variable: X2 is 267 The bandwidth used in the last iteration is: 267 and the difference in bandwidths is: 0 The bandwidth for variable X2 seems to be converged for 2 times. It will be continually optimized in the next 3 times Iteration 4 change of RSS (dCVR) is 0.0116581. Iteration 5 Now select an optimum bandwidth for the variable: Intercept The newly selected bandwidth for variable: Intercept is 32 The bandwidth used in the last iteration is: 32 and the difference in bandwidths is: 0 The bandwidth for variable Intercept seems to be converged for 4 times. It will be continually optimized in the next 1 times Now select an optimum bandwidth for the variable: X1 The newly selected bandwidth for variable: X1 is 130 The bandwidth used in the last iteration is: 130 and the difference in bandwidths is: 0 The bandwidth for variable X1 seems to be converged for 3 times. It will be continually optimized in the next 2 times Now select an optimum bandwidth for the variable: X2 The newly selected bandwidth for variable: X2 is 267 The bandwidth used in the last iteration is: 267 and the difference in bandwidths is: 0 The bandwidth for variable X2 seems to be converged for 3 times. It will be continually optimized in the next 2 times Iteration 5 change of RSS (dCVR) is 0.00850599. Iteration 6 Now select an optimum bandwidth for the variable: Intercept The newly selected bandwidth for variable: Intercept is 32 The bandwidth used in the last iteration is: 32 and the difference in bandwidths is: 0 The bandwidth for variable Intercept seems to be converged and will be kept the same in the following iterations. Now select an optimum bandwidth for the variable: X1 The newly selected bandwidth for variable: X1 is 130 The bandwidth used in the last iteration is: 130 and the difference in bandwidths is: 0 The bandwidth for variable X1 seems to be converged for 4 times. It will be continually optimized in the next 1 times Now select an optimum bandwidth for the variable: X2 The newly selected bandwidth for variable: X2 is 267 The bandwidth used in the last iteration is: 267 and the difference in bandwidths is: 0 The bandwidth for variable X2 seems to be converged for 4 times. It will be continually optimized in the next 1 times Iteration 6 change of RSS (dCVR) is 0.00497904. Iteration 7 Now select an optimum bandwidth for the variable: X1 The newly selected bandwidth for variable: X1 is 130 The bandwidth used in the last iteration is: 130 and the difference in bandwidths is: 0 The bandwidth for variable X1 seems to be converged and will be kept the same in the following iterations. Now select an optimum bandwidth for the variable: X2 The newly selected bandwidth for variable: X2 is 267 The bandwidth used in the last iteration is: 267 and the difference in bandwidths is: 0 The bandwidth for variable X2 seems to be converged and will be kept the same in the following iterations. Iteration 7 change of RSS (dCVR) is 0.00280838. Iteration 8 Iteration 8 change of RSS (dCVR) is 0.00156492. Iteration 9 Iteration 9 change of RSS (dCVR) is 0.000868011. Iteration 10 Iteration 10 change of RSS (dCVR) is 0.000480783. Iteration 11 Iteration 11 change of RSS (dCVR) is 0.000266314. Iteration 12 Iteration 12 change of RSS (dCVR) is 0.000147614. Iteration 13 Iteration 13 change of RSS (dCVR) is 8.18955e-05. Iteration 14 Iteration 14 change of RSS (dCVR) is 4.54831e-05. Iteration 15 Iteration 15 change of RSS (dCVR) is 2.52891e-05. Iteration 16 Iteration 16 change of RSS (dCVR) is 1.4078e-05. Iteration 17 Iteration 17 change of RSS (dCVR) is 7.84706e-06.</p>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ANÁLISE DAS ESCALAS ESPACIAIS (BANDWIDTHS) </span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrair bandwidths do objeto</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>bws_mgwr <span class="ot">&lt;-</span> mgwr_model<span class="sc">$</span>GW.arguments<span class="sc">$</span>bws</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bws_mgwr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Intercepto"</span>, <span class="st">"X1"</span>, <span class="st">"X2"</span>) </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>df_bws <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variavel =</span> <span class="fu">names</span>(bws_mgwr),</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bandwidth_Otimizado =</span> <span class="fu">as.numeric</span>(bws_mgwr),</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_Total =</span> <span class="fu">nrow</span>(mg_sp)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Proporcao_N =</span> <span class="fu">round</span>((Bandwidth_Otimizado <span class="sc">/</span> N_Total) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Escala_Interpretada =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>      Bandwidth_Otimizado <span class="sc">&lt;</span> N_Total <span class="sc">*</span> <span class="fl">0.2</span> <span class="sc">~</span> <span class="st">"Local (Heterogêneo)"</span>,</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>      Bandwidth_Otimizado <span class="sc">&gt;</span> N_Total <span class="sc">*</span> <span class="fl">0.8</span> <span class="sc">~</span> <span class="st">"Global (Estacionário)"</span>,</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Regional (Intermediária)"</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(df_bws, </span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Escalas Espaciais Identificadas pelo MGWR"</span>,</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variável"</span>, <span class="st">"Vizinhos (k)"</span>, <span class="st">"N Total"</span>, <span class="st">"% da Amostra"</span>, <span class="st">"Interpretação"</span>),</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">"HOLD_position"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<table class="table caption-top">
<caption>Escalas Espaciais Identificadas pelo MGWR</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Variável</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Vizinhos (k)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">N Total</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">% da Amostra</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Interpretação</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intercepto</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">853</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: left;">Local (Heterogêneo)</td>
</tr>
<tr class="even">
<td style="text-align: left;">X1</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">853</td>
<td style="text-align: right;">15.2</td>
<td style="text-align: left;">Local (Heterogêneo)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X2</td>
<td style="text-align: right;">267</td>
<td style="text-align: right;">853</td>
<td style="text-align: right;">31.3</td>
<td style="text-align: left;">Regional (Intermediária)</td>
</tr>
</tbody>
</table>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#COMPARAÇÃO DE AJUSTE: GWR vs MGWR</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"gwr_model"</span>)) {</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  aic_gwr <span class="ot">&lt;-</span> gwr_model<span class="sc">$</span>GW.diagnostic<span class="sc">$</span>AICc</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  aic_mgwr <span class="ot">&lt;-</span> mgwr_model<span class="sc">$</span>GW.diagnostic<span class="sc">$</span>AICc </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  df_comp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"GWR"</span>, <span class="st">"MGWR"</span>),</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">AICc =</span> <span class="fu">c</span>(aic_gwr, aic_mgwr),</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Melhoria =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, aic_gwr <span class="sc">-</span> aic_mgwr))</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kbl</span>(df_comp, <span class="at">caption =</span> <span class="st">"Comparação de Ajuste (AICc)"</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<table class="table table-striped table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Comparação de Ajuste (AICc)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Modelo
</th>
<th style="text-align:right;">
AICc
</th>
<th style="text-align:left;">
Melhoria
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
GWR
</td>
<td style="text-align:right;">
2717.541
</td>
<td style="text-align:left;">
<ul>
<li></li></ul></td>
</tr>
<tr>
<td style="text-align:left;">
MGWR
</td>
<td style="text-align:right;">
2613.408
</td>
<td style="text-align:left;">
104.13
</td>
</tr>
</tbody>
</table>

<details open="" class="code-fold">
<summary>Código</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#VISUALIZAÇÃO DOS RESULTADOS</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>mgwr_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mgwr_model<span class="sc">$</span>SDF)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Coeficiente Local X1</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>p_beta_mgwr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mgwr_sf) <span class="sc">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> X1), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)[X1] <span class="sc">~</span> <span class="st">"(MGWR)"</span>)) <span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A)"</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Coeficiente Local X2</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>p_beta2_mgwr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mgwr_sf) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> X2), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">name =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)[X2] <span class="sc">~</span> <span class="st">"(MGWR)"</span>)) <span class="sc">+</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B)"</span>) <span class="sc">+</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Significância (t-value &gt; 1.96) para X1</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>p_sig_mgwr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mgwr_sf) <span class="sc">+</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">abs</span>(X1_TV) <span class="sc">&gt;</span> <span class="fl">1.96</span>), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"#377eb8"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"gray95"</span>), </span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"Signif. (t &gt; 1.96)"</span>) <span class="sc">+</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C. Significância X1"</span>, </span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Inferência Local"</span>) <span class="sc">+</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="co">#I de Moran</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(mgwr_sf, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>resid_col <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"resid"</span>, <span class="fu">names</span>(mgwr_sf), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>, <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>moran_mgwr <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">moran.test</span>(mgwr_sf[[resid_col]], lw, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>label_moran_m <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"I de Moran: "</span>, <span class="fu">round</span>(moran_mgwr<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">3</span>), </span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>                        <span class="st">" (p = "</span>, <span class="fu">round</span>(moran_mgwr<span class="sc">$</span>p.value, <span class="dv">3</span>), <span class="st">")"</span>)</span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>p_resid_mgwr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mgwr_sf) <span class="sc">+</span></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> .data[[resid_col]]), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#d73027"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"#4575b4"</span>, </span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">name =</span> <span class="st">"Resíduos"</span>) <span class="sc">+</span></span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"D. Resíduos MGWR"</span>, </span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> label_moran_m) <span class="sc">+</span></span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> north_arrow_fancy_orienteering)</span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p_beta_mgwr, p_beta2_mgwr, p_sig_mgwr, p_resid_mgwr, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<p><img src="lattice_data_files/figure-html/mgwr-advanced-analysis-1.png" class="img-fluid"></p>
</section>
</section>
<section id="pacote-gwmodel" class="level2" data-number="4.16">
<h2 data-number="4.16" class="anchored" data-anchor-id="pacote-gwmodel"><span class="header-section-number">4.16</span> Pacote GWmodel</h2>
<p>O pacote <code>GWmodel</code> <span class="citation" data-cites="gollini2015gwmodel">(<a href="references.html#ref-gollini2015gwmodel" role="doc-biblioref">Gollini et al. 2015</a>)</span> é um pacote mais abrangente e usado para modelo GWR. Desenvolvido por Binbin Lu, Paul Harris, Martin Charlton, Chris Brunsdon e colaboradores, o pacote implementa tanto GWR assim como MGWR.</p>
<p><strong>Principais funcionalidades</strong></p>
<p>A escolha da largura de banda é crucial em modelos GW, controlando o grau de suavização espacial. O pacote oferece funções especializadas:</p>
<ul>
<li><p><code>bw.gwr()</code>: Seleciona a largura de banda ótima para GWR</p></li>
<li><p><code>bw.ggwr()</code>**: Para modelos GWR generalizados (Poisson ou Binomial)</p></li>
<li><p><code>bw.gwr.lcr()</code>: Para modelos GWR com compensação local de <em>ridge</em></p></li>
<li><p><code>bw.gwpca()</code>: Para Análise de Componentes Principais Geograficamente Ponderada</p></li>
<li><p><code>bw.gwda()</code>: Para Análise Discriminante Geograficamente Ponderada</p></li>
<li><p><code>bw.gtwr()</code>: Para Regressão Geográfica e Temporalmente Ponderada</p></li>
<li><p><code>bw.gwss.average()</code>: Para estatísticas descritivas geograficamente ponderadas</p></li>
</ul>
<p><strong>Ajuste do modelo</strong></p>
<ul>
<li><p><code>gwr.basic()</code>: Ajusta o modelo GWR básico, produzindo estimativas locais de coeficientes</p></li>
<li><p><code>gwr.robust()</code>: Versões robustas resistentes a <em>outliers</em></p></li>
<li><p><code>gwr.hetero()</code>: Modelos GWR heterocedásticos</p></li>
<li><p><code>gwr.mixed()</code>**: GWR mista (semiparamétrica)</p></li>
<li><p><code>gwr.lcr()</code>: GWR com compensação local de <em>ridge</em> para colinearidade</p></li>
<li><p><code>gwr.predict()</code>: Previsão espacial usando modelos GWR</p></li>
<li><p><code>gwr.scalable()</code>: Implementação escalável para grandes conjuntos de dados</p></li>
<li><p><code>gwr.multiscale()</code>: Ajusta GWR multiescala (MGWR), onde cada variável pode ter sua própria largura de banda</p></li>
<li><p><code>gwr.mink.approach()</code>: Seleciona métricas de distância ótimas além da Euclidiana</p></li>
<li><p><code>gwss()</code>: Calcula médias, medianas, desvios-padrão, covariâncias e correlações locais</p></li>
<li><p><code>gwss.montecarlo()</code>: Testes de significância para estatísticas locais</p></li>
</ul>
<p><strong>Diagnóstico</strong></p>
<ul>
<li><p><code>gw.dist()</code>: Cálculo de matrizes de distância com várias métricas</p></li>
<li><p><code>gw.weight()</code>: Cálculo de matrizes de pesos espaciais</p></li>
<li><p><code>gwr.collin.diagno()</code>: Diagnósticos de colinearidade local</p></li>
<li><p><code>gwr.model.selection()</code>: Seleção de modelos GWR</p></li>
<li><p><code>gwr.bootstrap()</code>: Métodos de <em>bootstrap</em> para inferência</p></li>
<li><p><code>gwr.t.adjust()</code>: Ajuste de valores-p para testes múltiplos</p></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-anselin1988spatial" class="csl-entry" role="listitem">
Anselin, Luc. 1988. <span>“Spatial econometrics: methods and models”</span>. <em>Kluwer Academic Publishers google schola</em> 2: 283–91.
</div>
<div id="ref-anselin1995local" class="csl-entry" role="listitem">
———. 1995. <span>“Local indicators of spatial association—LISA”</span>. <em>Geographical analysis</em> 27 (2): 93–115.
</div>
<div id="ref-anselin2001spatial" class="csl-entry" role="listitem">
———. 2001. <span>“Spatial Econometrics”</span>. Em <em>A Companion to Theoretical Econometrics</em>, editado por Badi H. Baltagi, 310–30. Oxford: Blackwell Publishing.
</div>
<div id="ref-anselin2002under" class="csl-entry" role="listitem">
———. 2002. <span>“Under the hood issues in the specification and interpretation of spatial regression models”</span>. <em>Agricultural economics</em> 27 (3): 247–67.
</div>
<div id="ref-anselin2010thirty" class="csl-entry" role="listitem">
———. 2010. <span>“Thirty years of spatial econometrics”</span>. <em>Papers in regional science</em> 89 (1): 3–26.
</div>
<div id="ref-banerjee2016spatial" class="csl-entry" role="listitem">
Banerjee, Sudipto. 2016. <span>“Spatial data analysis”</span>. <em>Annual review of public health</em> 37 (1): 47–60.
</div>
<div id="ref-banerjee2003hierarchical" class="csl-entry" role="listitem">
Banerjee, Sudipto, Bradley P Carlin, e Alan E Gelfand. 2003. <em>Hierarchical modeling and analysis for spatial data</em>. Chapman; Hall/CRC.
</div>
<div id="ref-beron2004probit" class="csl-entry" role="listitem">
Beron, Kurt J, e Wim PM Vijverberg. 2004. <span>“Probit in a spatial context: a Monte Carlo analysis”</span>. Em <em>Advances in spatial econometrics: methodology, tools and applications</em>, 169–95. Springer.
</div>
<div id="ref-besag1974spatial" class="csl-entry" role="listitem">
Besag, Julian. 1974. <span>“Spatial interaction and the statistical analysis of lattice systems”</span>. <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 36 (2): 192–225.
</div>
<div id="ref-besag1975statistical" class="csl-entry" role="listitem">
———. 1975. <span>“Statistical analysis of non-lattice data”</span>. <em>Journal of the Royal Statistical Society Series D: The Statistician</em> 24 (3): 179–95.
</div>
<div id="ref-besag1993spatial" class="csl-entry" role="listitem">
Besag, Julian, e Peter J Green. 1993. <span>“Spatial statistics and Bayesian computation”</span>. <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 55 (1): 25–37.
</div>
<div id="ref-BesagKooperberg1995" class="csl-entry" role="listitem">
Besag, Julian, e Charles Kooperberg. 1995. <span>“<span>On Conditional and Intrinsic Autoregression</span>”</span>. <em>Biometrika</em> 82 (4): 733–46. <a href="https://doi.org/10.2307/2337341">https://doi.org/10.2307/2337341</a>.
</div>
<div id="ref-besag1991bayesian" class="csl-entry" role="listitem">
Besag, Julian, Jeremy York, e Annie Mollié. 1991. <span>“Bayesian image restoration, with two applications in spatial statistics”</span>. <em>Annals of the institute of statistical mathematics</em> 43 (1): 1–20.
</div>
<div id="ref-bille2019spatial" class="csl-entry" role="listitem">
Billé, Anna Gloria, e Giuseppe Arbia. 2019. <span>“Spatial limited dependent variable models: A review focused on specification, estimation, and health economics applications”</span>. <em>Journal of Economic Surveys</em> 33 (5): 1531–54.
</div>
<div id="ref-bille2020partial" class="csl-entry" role="listitem">
Billé, Anna Gloria, e Samantha Leorato. 2020. <span>“Partial ML estimation for spatial autoregressive nonlinear probit models with autoregressive disturbances”</span>. <em>Econometric Reviews</em> 39 (5): 437–75.
</div>
<div id="ref-brunsdon1996geographically" class="csl-entry" role="listitem">
Brunsdon, Chris, A Stewart Fotheringham, e Martin E Charlton. 1996. <span>“Geographically weighted regression: a method for exploring spatial nonstationarity”</span>. <em>Geographical analysis</em> 28 (4): 281–98.
</div>
<div id="ref-burridge1980cliff" class="csl-entry" role="listitem">
Burridge, Peter. 1980. <span>“On the Cliff-Ord test for spatial correlation”</span>. <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 42 (1): 107–8.
</div>
<div id="ref-burridge1981testing" class="csl-entry" role="listitem">
———. 1981. <span>“Testing for a common factor in a spatial autoregression model”</span>. <em>Environment and planning A</em> 13 (7): 795–800.
</div>
<div id="ref-calabrese2014estimators" class="csl-entry" role="listitem">
Calabrese, Raffaella, e Johan A Elkink. 2014. <span>“Estimators of binary spatial autoregressive models: A Monte Carlo study”</span>. <em>Journal of Regional Science</em> 54 (4): 664–87.
</div>
<div id="ref-cliff1981spatial" class="csl-entry" role="listitem">
Cliff, Andrew David, e J Keith Ord. 1981. <span>“Spatial processes: models &amp; applications”</span>. <em>(No Title)</em>. https://doi.org/<a href="https://doi.org/10.2307/2530324">https://doi.org/10.2307/2530324</a>.
</div>
<div id="ref-cressie1993statistics" class="csl-entry" role="listitem">
Cressie, Noel. 1993. <em>Statistics for spatial data</em>. John Wiley &amp; Sons.
</div>
<div id="ref-cressie1989spatial" class="csl-entry" role="listitem">
Cressie, Noel, e Ngai H Chan. 1989. <span>“Spatial modeling of regional variables”</span>. <em>Journal of the American Statistical Association</em> 84 (406): 393–401.
</div>
<div id="ref-cressie2022spatial" class="csl-entry" role="listitem">
Cressie, Noel, e Matthew T Moores. 2022. <span>“Spatial statistics”</span>. Em <em>Encyclopedia of mathematical geosciences</em>, 1–11. Springer.
</div>
<div id="ref-dasilva2016multiple" class="csl-entry" role="listitem">
da Silva, Anderson R., e A. Stewart Fotheringham. 2016. <span>“The multiple testing issue in geographically weighted regression”</span>. <em>Geographical Analysis</em> 48 (3): 233–47.
</div>
<div id="ref-dasilva2018comparing" class="csl-entry" role="listitem">
da Silva, Anderson R., e Flávio F. Mendes. 2018. <span>“On comparing some algorithms for finding the optimal bandwidth in geographically weighted regression”</span>. <em>Applied Soft Computing</em> 73: 943–57.
</div>
<div id="ref-elhorst2014spatial" class="csl-entry" role="listitem">
Elhorst, J Paul et al. 2014. <em>Spatial econometrics: from cross-sectional data to spatial panels</em>. Vol. 479. Springer.
</div>
<div id="ref-elhorst2022dynamic" class="csl-entry" role="listitem">
Elhorst, J Paul. 2022. <span>“The dynamic general nesting spatial econometric model for spatial panels with common factors: Further raising the bar”</span>. <em>Review of Regional Research</em> 42 (3): 249–67.
</div>
<div id="ref-fleming2004techniques" class="csl-entry" role="listitem">
Fleming, Mark M. 2004. <span>“Techniques for estimating spatially dependent discrete choice models”</span>. Em <em>Advances in spatial econometrics: methodology, tools and applications</em>, 145–68. Springer.
</div>
<div id="ref-fotheringham2017multiscale" class="csl-entry" role="listitem">
Fotheringham, A. Stewart, Wenbai Yang, e Wei Kang. 2017. <span>“Multiscale Geographically Weighted Regression (MGWR)”</span>. <em>Annals of the American Association of Geographers</em> 107 (6): 1247–65. <a href="https://doi.org/10.1080/24694452.2017.1352480">https://doi.org/10.1080/24694452.2017.1352480</a>.
</div>
<div id="ref-fotheringham2022notion" class="csl-entry" role="listitem">
Fotheringham, A. Stewart, Hanchen Yu, Levi John Wolf, Taylor M. Oshan, e Ziqi Li. 2022. <span>“On the notion of <span>‘bandwidth’</span> in geographically weighted regression models of spatially varying processes”</span>. <em>International Journal of Geographical Information Science</em> 36 (8): 1485–1502. <a href="https://doi.org/10.1080/13658816.2022.2034829">https://doi.org/10.1080/13658816.2022.2034829</a>.
</div>
<div id="ref-gelman2006prior" class="csl-entry" role="listitem">
Gelman, Andrew. 2006. <span>“Prior Distributions for Variance Parameters in Hierarchical Models”</span>. <em>Bayesian Analysis</em> 1 (3): 515–34.
</div>
<div id="ref-getis1995cliff" class="csl-entry" role="listitem">
Getis, Arthur. 1995. <span>“Cliff, ad and ord, jk 1973: Spatial autocorrelation. london: Pion”</span>. <em>Progress in Human Geography</em> 19 (2): 245–49.
</div>
<div id="ref-Getis2010SpatialAutocorrelation" class="csl-entry" role="listitem">
———. 2010. <span>“Spatial Autocorrelation”</span>. Em <em>Handbook of Applied Spatial Analysis: Software Tools, Methods and Applications</em>, editado por Manfred M. Fischer e Arthur Getis, 255–78. Berlin, Heidelberg: Springer.
</div>
<div id="ref-getis1992analysis" class="csl-entry" role="listitem">
Getis, Arthur, e J Keith Ord. 1992. <span>“The analysis of spatial association by use of distance statistics”</span>. <em>Geographical analysis</em> 24 (3): 189–206.
</div>
<div id="ref-gollini2015gwmodel" class="csl-entry" role="listitem">
Gollini, Isabella, Binbin Lu, Martin Charlton, Christopher Brunsdon, e Paul Harris. 2015. <span>“GWmodel: an R package for exploring spatial heterogeneity using geographically weighted models”</span>. <em>Journal of statistical software</em> 63: 1–50.
</div>
<div id="ref-Greene2003Econometric" class="csl-entry" role="listitem">
Greene, William H. 2003. <em>Econometric Analysis</em>. 5º ed. Prentice Hall.
</div>
<div id="ref-guo2008comparison" class="csl-entry" role="listitem">
Guo, L., Z. Ma, e L. Zhang. 2008. <span>“Comparison of bandwidth selection in application of geographically weighted regression: a case study”</span>. <em>Canadian Journal of Forest Research</em> 38 (9): 2526–34.
</div>
<div id="ref-haining1998exploratory" class="csl-entry" role="listitem">
Haining, Robert Haining, Stephen Wise, e Jingsheng Ma. 1998. <span>“Exploratory spatial data analysis in a geographic information system environment”</span>. <em>Journal of the Royal Statistical Society Series D: The Statistician</em> 47 (3): 457–69.
</div>
<div id="ref-haining2003spatial" class="csl-entry" role="listitem">
Haining, Robert P. 2003. <em>Spatial data analysis: theory and practice</em>. Cambridge university press.
</div>
<div id="ref-halleck2015slx" class="csl-entry" role="listitem">
Halleck Vega, Solmaria, e J Paul Elhorst. 2015. <span>“The SLX model”</span>. <em>Journal of Regional Science</em> 55 (3): 339–63.
</div>
<div id="ref-harris2011search" class="csl-entry" role="listitem">
Harris, Richard, John Moffat, e Victoria Kravtsova. 2011. <span>“In search of <span>‘W’</span>”</span>. <em>Spatial Economic Analysis</em> 6 (3): 249–70.
</div>
<div id="ref-hastie1990generalized" class="csl-entry" role="listitem">
Hastie, Trevor, e Robert Tibshirani. 1990. <em>Generalized Additive Models</em>. Monographs on Statistics e Applied Probability. London: Chapman; Hall.
</div>
<div id="ref-he2022multiscale" class="csl-entry" role="listitem">
He, Zhanjun, Zhe Wang, Zhiqiang Xie, Lin Wu, e Zhen Chen. 2022. <span>“Multiscale analysis of the influence of street built environment on crime occurrence using street-view images”</span>. <em>Computers, Environment and Urban Systems</em> 97: 101865. <a href="https://doi.org/10.1016/j.compenvurbsys.2022.101865">https://doi.org/10.1016/j.compenvurbsys.2022.101865</a>.
</div>
<div id="ref-held2010conditional" class="csl-entry" role="listitem">
Held, Leonhard, e Havard Rue. 2010. <span>“Conditional and intrinsic autoregressions”</span>. <em>Handbook of spatial statistics</em>, 201–16.
</div>
<div id="ref-hepple1979bayesian" class="csl-entry" role="listitem">
Hepple, Leslie W. 1979. <span>“Bayesian analysis of the linear model with spatial dependence”</span>. Em <em>Exploratory and explanatory statistical analysis of spatial data</em>, 179–99. Springer.
</div>
<div id="ref-hodges2010adding" class="csl-entry" role="listitem">
Hodges, James S, e Brian J Reich. 2010. <span>“Adding spatially-correlated errors can mess up the fixed effect you love”</span>. <em>The American Statistician</em> 64 (4): 325–34.
</div>
<div id="ref-hurvich1998regression" class="csl-entry" role="listitem">
Hurvich, Clifford M., Jeffrey S. Simonoff, e Chih-Ling Tsai. 1998. <span>“Smoothing Parameter Selection in Nonparametric Regression Using an Improved Akaike Information Criterion”</span>. <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 60 (2): 271–93.
</div>
<div id="ref-de1984extreme" class="csl-entry" role="listitem">
Jong, Peter de, C Sprenger, e Frans van Veen. 1984. <span>“On extreme values of Moran’s I and Geary’s c”</span>. <em>Geographical Analysis</em> 16 (1): 17–24.
</div>
<div id="ref-KeefeFerreiraFranck2018" class="csl-entry" role="listitem">
Keefe, Matthew J., Marcelo A. Ferreira, e Christopher T. Franck. 2018a. <span>“On the formal specification of sum-zero constrained intrinsic conditional autoregressive models”</span>. <em>Spatial Statistics</em> 24: 54–65. <a href="https://doi.org/10.1016/j.spasta.2018.02.005">https://doi.org/10.1016/j.spasta.2018.02.005</a>.
</div>
<div id="ref-KeefeFerreiraFranck2019" class="csl-entry" role="listitem">
Keefe, Matthew J., Marco A. R. Ferreira, e Christopher T. Franck. 2019. <span>“Objective Bayesian Analysis for Gaussian Hierarchical Models with Intrinsic Conditional Autoregressive Priors”</span>. <em>Bayesian Analysis</em> 14 (1): 181–209. <a href="https://doi.org/10.1214/18-BA1107">https://doi.org/10.1214/18-BA1107</a>.
</div>
<div id="ref-keefe2018formal" class="csl-entry" role="listitem">
Keefe, Matthew J, Marco AR Ferreira, e Christopher T Franck. 2018b. <span>“On the formal specification of sum-zero constrained intrinsic conditional autoregressive models”</span>. <em>Spatial statistics</em> 24: 54–65.
</div>
<div id="ref-Keefe2019ObjectiveBayesianICAR" class="csl-entry" role="listitem">
Keefe, Michael J., Marco A. R. Ferreira, e Christopher T. Franck. 2019. <span>“Objective Bayesian analysis for Gaussian hierarchical models with intrinsic conditional autoregressive priors”</span>. <em>Bayesian Analysis</em> 14 (1): 181–209. <a href="https://doi.org/10.1214/18-BA1107">https://doi.org/10.1214/18-BA1107</a>.
</div>
<div id="ref-kelejian1998generalized" class="csl-entry" role="listitem">
Kelejian, Harry H, e Ingmar R Prucha. 1998. <span>“A generalized spatial two-stage least squares procedure for estimating a spatial autoregressive model with autoregressive disturbances”</span>. <em>The journal of real estate finance and economics</em> 17 (1): 99–121.
</div>
<div id="ref-kelejian1999generalized" class="csl-entry" role="listitem">
———. 1999. <span>“A generalized moments estimator for the autoregressive parameter in a spatial model”</span>. <em>International economic review</em> 40 (2): 509–33.
</div>
<div id="ref-kelejian2010specification" class="csl-entry" role="listitem">
———. 2010. <span>“Specification and estimation of spatial autoregressive models with autoregressive and heteroskedastic disturbances”</span>. <em>Journal of econometrics</em> 157 (1): 53–67.
</div>
<div id="ref-kelejian2017spatial" class="csl-entry" role="listitem">
Kelejian, Harry, e Gianfranco Piras. 2017. <em>Spatial econometrics</em>. Academic Press.
</div>
<div id="ref-klier2008clustering" class="csl-entry" role="listitem">
Klier, Thomas, e Daniel P McMillen. 2008. <span>“Clustering of auto supplier plants in the United States: generalized method of moments spatial logit for large samples”</span>. <em>Journal of Business &amp; Economic Statistics</em> 26 (4): 460–71.
</div>
<div id="ref-koc2022bandwidth" class="csl-entry" role="listitem">
Koç, Tufan. 2022. <span>“Bandwidth selection in geographically weighted regression models via information complexity criteria”</span>. <em>Journal of Mathematics</em>.
</div>
<div id="ref-lesage1997bayesian" class="csl-entry" role="listitem">
LeSage, James P. 1997. <span>“Bayesian estimation of spatial autoregressive models”</span>. <em>International regional science review</em> 20 (1-2): 113–29.
</div>
<div id="ref-lesage2000bayesian" class="csl-entry" role="listitem">
———. 2000. <span>“Bayesian estimation of limited dependent variable spatial autoregressive models”</span>. <em>Geographical Analysis</em> 32 (1): 19–35.
</div>
<div id="ref-lesage2009introduction" class="csl-entry" role="listitem">
LeSage, James, e Robert Kelley Pace. 2009. <em>Introduction to spatial econometrics</em>. Chapman; Hall/CRC.
</div>
<div id="ref-liesenfeld2013analysis" class="csl-entry" role="listitem">
Liesenfeld, Roman, Jean-François Richard, e Jan Vogler. 2013. <span>“Analysis of discrete dependent variable models with spatial correlation”</span>. Economics Working Paper.
</div>
<div id="ref-liu2023multiscale" class="csl-entry" role="listitem">
Liu, Jun, K. W. Chau, e Zhen Bao. 2023. <span>“Multiscale spatial analysis of metro usage and its determinants for sustainable urban development in Shenzhen, China”</span>. <em>Tunnelling and Underground Space Technology</em>. <a href="https://doi.org/10.1016/j.tust.2022.104912">https://doi.org/10.1016/j.tust.2022.104912</a>.
</div>
<div id="ref-fotheringham2002geographically" class="csl-entry" role="listitem">
Lu, Binbin, Martin Charlton, Paul Harris, e A Stewart Fotheringham. 2014. <span>“Geographically weighted regression with a non-Euclidean distance metric: a case study using hedonic house price data”</span>. <em>International Journal of Geographical Information Science</em> 28 (4): 660–81.
</div>
<div id="ref-lu2023uncovering" class="csl-entry" role="listitem">
Lu, Bo, Yong Ge, Yeqiao Shi, Jing Zheng, e Paul Harris. 2023. <span>“Uncovering drivers of community-level house price dynamics through multiscale geographically weighted regression: A case study of Wuhan, China”</span>. <em>Spatial Statistics</em> 53: 100723. <a href="https://doi.org/10.1016/j.spasta.2022.100723">https://doi.org/10.1016/j.spasta.2022.100723</a>.
</div>
<div id="ref-mallows1995more" class="csl-entry" role="listitem">
Mallows, Cohn L. 1995. <span>“More comments on Cp”</span>. <em>Technometrics</em> 37 (4): 362–72.
</div>
<div id="ref-Mallows1973" class="csl-entry" role="listitem">
Mallows, Colin L. 1973. <span>“Some Comments on <span><span class="math inline">\(C_p\)</span></span>”</span>. <em>Technometrics</em> 15 (4): 661–75. <a href="https://doi.org/10.1080/00401706.1973.10489103">https://doi.org/10.1080/00401706.1973.10489103</a>.
</div>
<div id="ref-martinetti2017approximate" class="csl-entry" role="listitem">
Martinetti, Davide, e Ghislain Geniaux. 2017. <span>“Approximate likelihood estimation of spatial probit models”</span>. <em>Regional Science and Urban Economics</em> 64: 30–45.
</div>
<div id="ref-mcmillen1992probit" class="csl-entry" role="listitem">
McMillen, Daniel P. 1992. <span>“Probit with spatial autocorrelation”</span>. <em>Journal of Regional Science</em> 32 (3): 335–48.
</div>
<div id="ref-miao2025spatial" class="csl-entry" role="listitem">
Miao, Xin, Fang Fang, Xuening Zhu, e Hansheng Wang. 2025. <span>“Spatial weights matrix selection and model averaging for multivariate spatial autoregressive models”</span>. <em>Econometric Reviews</em>, 1–31.
</div>
<div id="ref-moran1950notes" class="csl-entry" role="listitem">
Moran, Patrick AP. 1950. <span>“Notes on continuous stochastic phenomena”</span>. <em>Biometrika</em> 37 (1/2): 17–23.
</div>
<div id="ref-openshaw1984modifiable" class="csl-entry" role="listitem">
Openshaw, Stan. 1984. <span>“The modifiable areal unit problem”</span>. <em>Concepts and techniques in modern geography</em>.
</div>
<div id="ref-oshan2020targeting" class="csl-entry" role="listitem">
Oshan, Taylor M., James P. Smith, e A. Stewart Fotheringham. 2020. <span>“Targeting the spatial context of obesity determinants via multiscale geographically weighted regression”</span>. <em>International Journal of Health Geographics</em> 19 (1): 11. <a href="https://doi.org/10.1186/s12942-020-00204-8">https://doi.org/10.1186/s12942-020-00204-8</a>.
</div>
<div id="ref-Paula2013DiagnosticsDGLM" class="csl-entry" role="listitem">
Paula, Gilberto A. 2013. <span>“On diagnostics in double generalized linear models”</span>. <em>Computational Statistics &amp; Data Analysis</em> 68: 44–51. <a href="https://doi.org/10.1016/j.csda.2013.07.003">https://doi.org/10.1016/j.csda.2013.07.003</a>.
</div>
<div id="ref-Paula2025ModelosRegressao" class="csl-entry" role="listitem">
———. 2025. <em>Modelos de Regress<span>ã</span>o e Aplica<span>ç</span><span>õ</span>es</em>. S<span>ã</span>o Paulo: Instituto de Matem<span>á</span>tica e Estat<span>ı́</span>stica, Universidade de S<span>ã</span>o Paulo.
</div>
<div id="ref-pinkse1998contracting" class="csl-entry" role="listitem">
Pinkse, Joris, e Margaret E Slade. 1998. <span>“Contracting in space: An application of spatial statistics to discrete-choice models”</span>. <em>Journal of Econometrics</em> 85 (1): 125–54.
</div>
<div id="ref-reich2006effects" class="csl-entry" role="listitem">
Reich, Brian J, James S Hodges, e Vesna Zadnik. 2006. <span>“Effects of residual smoothing on the posterior of the fixed effects in disease-mapping models”</span>. <em>Biometrics</em> 62 (4): 1197–1206.
</div>
<div id="ref-riebler2016intuitive" class="csl-entry" role="listitem">
Riebler, Andrea, Sigrunn H Sørbye, Daniel Simpson, e Håvard Rue. 2016. <span>“An intuitive Bayesian spatial model for disease mapping that accounts for scaling”</span>. <em>Statistical methods in medical research</em> 25 (4): 1145–65.
</div>
<div id="ref-Rigby2019DistributionsGAMLSS" class="csl-entry" role="listitem">
Rigby, Robert A., Mikis D. Stasinopoulos, Gillian Z. Heller, e Frosso De Bastiani. 2019. <em>Distributions for Modeling Location, Scale, and Shape: Using <span>GAMLSS</span> in <span>R</span></em>. Boca Raton: Chapman; Hall/CRC.
</div>
<div id="ref-rue2005gaussian" class="csl-entry" role="listitem">
Rue, Havard, e Leonhard Held. 2005. <em>Gaussian Markov random fields: theory and applications</em>. Chapman; Hall/CRC.
</div>
<div id="ref-RueHeld2005" class="csl-entry" role="listitem">
Rue, Håvard, e Leonhard Held. 2005. <em>Gaussian Markov Random Fields: Theory and Applications</em>. Chapman &amp; Hall/CRC Monographs on Statistics &amp; Applied Probability. Boca Raton: Chapman; Hall/CRC.
</div>
<div id="ref-rue2009approximate" class="csl-entry" role="listitem">
Rue, Håvard, Sara Martino, e Nicolas Chopin. 2009. <span>“Approximate Bayesian inference for latent Gaussian models by using integrated nested Laplace approximations”</span>. <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 71 (2): 319–92.
</div>
<div id="ref-sachdeva2022do" class="csl-entry" role="listitem">
Sachdeva, Manish, A. Stewart Fotheringham, e Zhen Li. 2022. <span>“Do places have value? <span>Q</span>uantifying the intrinsic value of housing neighborhoods using <span>MGWR</span>”</span>. <em>Journal of Housing Research</em> 31 (1): 24–52.
</div>
<div id="ref-scalon2024analise" class="csl-entry" role="listitem">
Scalon, João Domingos. 2024. <em>Análise de Dados Espaciais com Aplicações em R</em>. Lavras: Ed. UFLA.
</div>
<div id="ref-Shareef2015LightningSearch" class="csl-entry" role="listitem">
Shareef, Hitham, A. A. Ibrahim, e A. H. Mutlag. 2015. <span>“Lightning search algorithm”</span>. <em>Applied Soft Computing</em> 36: 315–33.
</div>
<div id="ref-simpson2017penalising" class="csl-entry" role="listitem">
Simpson, Daniel, Håvard Rue, Andrea Riebler, Thiago G Martins, e Sigrunn H Sørbye. 2017. <span>“Penalising model component complexity: A principled, practical approach to constructing priors”</span>.
</div>
<div id="ref-sorbye2017penalised" class="csl-entry" role="listitem">
Sørbye, Sigrunn Holbek, e Håvard Rue. 2017. <span>“Penalised complexity priors for stationary autoregressive processes”</span>. <em>Journal of Time Series Analysis</em> 38 (6): 923–35.
</div>
<div id="ref-sorbye2014scaling" class="csl-entry" role="listitem">
Sørbye, Sigrunn H., e Håvard Rue. 2014. <span>“Scaling intrinsic Gaussian Markov random field priors in spatial modelling”</span>. <em>Spatial Statistics</em> 8: 39–51. <a href="https://doi.org/10.1016/j.spasta.2013.06.004">https://doi.org/10.1016/j.spasta.2013.06.004</a>.
</div>
<div id="ref-Stasinopoulos2024GAMLSS" class="csl-entry" role="listitem">
Stasinopoulos, Mikis D., Thomas Kneib, Nadja Klein, Andreas Mayr, e Gillian Z. Heller. 2024. <em>Generalized Additive Models for Location, Scale and Shape: A Distributional Regression Approach, with Applications</em>. Vol. 56. Cambridge: Cambridge University Press.
</div>
<div id="ref-Stasinopoulos2017GAMLSS" class="csl-entry" role="listitem">
Stasinopoulos, Mikis D., Robert A. Rigby, Gillian Z. Heller, Vlasios Voudouris, e Frosso De Bastiani. 2017. <em>Flexible Regression and Smoothing: Using <span>GAMLSS</span> in <span>R</span></em>. Chapman &amp; Hall/CRC Texts em Statistical Science. Boca Raton: CRC Press.
</div>
<div id="ref-tiefelsdorf2000modelling" class="csl-entry" role="listitem">
Tiefelsdorf, Michael. 2000. <em>Modelling spatial processes: the identification and analysis of spatial relationships in regression residuals by means of Moran’s I</em>. Springer.
</div>
<div id="ref-tobias2024note" class="csl-entry" role="listitem">
Tobias, Justin L. 2024. <span>“A Note on the Cowles-EM Algorithm for Bayesian Ordinal Probit Models”</span>. <em>Research in Statistics</em> 3 (1): 2476409.
</div>
<div id="ref-ver2018relationship" class="csl-entry" role="listitem">
Ver Hoef, Jay M, Ephraim M Hanks, e Mevin B Hooten. 2018. <span>“On the relationship between conditional (CAR) and simultaneous (SAR) autoregressive models”</span>. <em>Spatial statistics</em> 25: 68–85.
</div>
<div id="ref-wall2004close" class="csl-entry" role="listitem">
Wall, Melanie M. 2004. <span>“A close look at the spatial structure implied by the CAR and SAR models”</span>. <em>Journal of statistical planning and inference</em> 121 (2): 311–24.
</div>
<div id="ref-wang2009baysian" class="csl-entry" role="listitem">
Wang, Xiaokun, e Kara M Kockelman. 2009. <span>“Baysian inference for ordered response data with a dynamic spatial-ordered probit model”</span>. <em>Journal of Regional Science</em> 49 (5): 877–913.
</div>
<div id="ref-wheeler2005multicollinearity" class="csl-entry" role="listitem">
Wheeler, David, e Michael Tiefelsdorf. 2005. <span>“Multicollinearity and correlation among local regression coefficients in geographically weighted regression”</span>. <em>Journal of Geographical Systems</em> 7 (2): 161–87. <a href="https://doi.org/10.1007/s10109-005-0155-6">https://doi.org/10.1007/s10109-005-0155-6</a>.
</div>
<div id="ref-whittle1954stationary" class="csl-entry" role="listitem">
Whittle, Peter. 1954. <span>“On stationary processes in the plane”</span>. <em>Biometrika</em>, 434–49.
</div>
<div id="ref-wilhelm2013estimating" class="csl-entry" role="listitem">
Wilhelm, Stefan, e Miguel Godinho de Matos. 2013. <span>“Estimating spatial probit models in R”</span>.
</div>
<div id="ref-wu2018multiscale" class="csl-entry" role="listitem">
Wu, Chengdong, Feng Ren, Wei Hu, e Qingyun Du. 2019. <span>“Multiscale geographically and temporally weighted regression: Exploring the spatiotemporal determinants of housing prices”</span>. <em>International Journal of Geographical Information Science</em> 33 (3): 489–511. <a href="https://doi.org/10.1080/13658816.2018.1528246">https://doi.org/10.1080/13658816.2018.1528246</a>.
</div>
<div id="ref-yang2011extension" class="csl-entry" role="listitem">
Yang, Wenbai, A. Stewart Fotheringham, e Paul Harris. 2011. <span>“An Extension of Geographically Weighted Regression with Flexible Bandwidths”</span>. Em <em>Proceedings of an International Conference on Spatial Analysis and Modelling</em>. St Andrews, Scotland, UK.
</div>
<div id="ref-Yang2014FlexibleBandwidthGWR" class="csl-entry" role="listitem">
Yang, Wenbo. 2014. <span>“An extension of geographically weighted regression with flexible bandwidths”</span>. Tese de doutorado, University of St Andrews.
</div>
<div id="ref-yu2019inference" class="csl-entry" role="listitem">
Yu, Hanchen, A. Stewart Fotheringham, Zhen Li, Taylor M. Oshan, Wei Kang, e Levi J. Wolf. 2020. <span>“Inference in multiscale geographically weighted regression”</span>. <em>Geographical Analysis</em> 52 (1): 87–106.
</div>
<div id="ref-fotheringham2020" class="csl-entry" role="listitem">
Yu, Huili, A. Stewart Fotheringham, Zhenlong Li, Taylor M. Oshan, e Levi J. Wolf. 2020. <span>“On the measurement of bias in geographically weighted regression models”</span>. <em>Spatial Statistics</em> 38: 100453. <a href="https://doi.org/10.1016/j.spasta.2020.100453">https://doi.org/10.1016/j.spasta.2020.100453</a>.
</div>
<div id="ref-zhang2018spatial" class="csl-entry" role="listitem">
Zhang, Xinyu, e Jihai Yu. 2018. <span>“Spatial weights matrix selection and model averaging for spatial autoregressive models”</span>. <em>Journal of Econometrics</em> 203 (1): 1–18.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiada");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiada");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./geostat.html" class="pagination-link" aria-label="Geoestatística">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geoestatística</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./point_process.html" class="pagination-link" aria-label="Processos Pontuais">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Processos Pontuais</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright Cursos de Verão IME-USP 2025, Alex Monito Nhancololo</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Nhancololo/Introducao-a-Estatistica-Espacial">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/seu-usuario">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>